import{_ as Q6,p as Z6,u as eI}from"./index.50890cf2.js";import{d as v$,o as G1,c as b$,r as UE,G as tI,b as nI,f as ym,H as iI,g as rI,h as oI,I as aI}from"./vendor.f90edea8.js";const sI="vega-lite",uI='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',lI="5.5.0",cI=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],fI="https://vega.github.io/vega-lite/",dI="Vega-Lite is a concise high-level language for interactive visualization.",hI=["vega","chart","visualization"],gI="build/vega-lite.js",pI="build/vega-lite.min.js",mI="build/vega-lite.min.js",yI="build/src/index",vI="build/src/index.d.ts",bI={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},xI=["bin","build","src","vega-lite*","tsconfig.json"],wI={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/","watch:test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest --watch test-runtime/ --config test-runtime/jest-config.json",release:"yarn run prebuild && yarn build && yarn shipit",shipit:"auto shipit"},_I={type:"git",url:"https://github.com/vega/vega-lite.git"},EI="BSD-3-Clause",SI={url:"https://github.com/vega/vega-lite/issues"},OI={"@auto-it/conventional-commits":"^10.37.6","@auto-it/first-time-contributor":"^10.37.6","@babel/core":"^7.19.1","@babel/preset-env":"^7.19.1","@babel/preset-typescript":"^7.18.6","@rollup/plugin-alias":"^4.0.0","@rollup/plugin-babel":"^6.0.0","@rollup/plugin-commonjs":"^23.0.0","@rollup/plugin-json":"^4.1.0","@types/jest":"^27.4.1","@rollup/plugin-node-resolve":"^14.1.0","@types/chai":"^4.3.3","@types/d3":"^7.4.0","@types/mkdirp":"^1.0.2","@types/pako":"^2.0.0","@typescript-eslint/eslint-plugin":"^5.38.0","@typescript-eslint/parser":"^5.38.0",ajv:"^8.11.0","ajv-formats":"^2.1.1",auto:"^10.37.6",chai:"^4.3.6",cheerio:"^1.0.0-rc.12","conventional-changelog-cli":"^2.2.2",d3:"^7.6.1","del-cli":"^5.0.0",eslint:"^8.23.1","eslint-config-prettier":"^8.5.0","eslint-plugin-jest":"^27.0.4","eslint-plugin-prettier":"^4.2.1","gh-pages":"^4.0.0",jest:"^27.5.1","highlight.js":"^11.6.0","jest-dev-server":"^6.1.1",mkdirp:"^1.0.4",pako:"^2.0.4",prettier:"^2.7.1",puppeteer:"^15.0.0",rollup:"^2.79.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3","rollup-plugin-terser":"^7.0.2",serve:"^14.0.1",terser:"^5.15.0","ts-jest":"^29.0.1","ts-json-schema-generator":"^1.1.1","vega-cli":"^5.22.1",typescript:"~4.8.3","vega-datasets":"~2.5.1","vega-embed":"^6.21.0","vega-tooltip":"^0.28.0","yaml-front-matter":"^4.1.1"},AI={"@types/clone":"~2.1.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.4.0","vega-event-selector":"~3.0.0","vega-expression":"~5.0.0","vega-util":"~1.17.0",yargs:"~17.6.0"},kI={vega:"^5.22.0"},CI={node:">=12"};var $I={name:sI,author:uI,version:lI,collaborators:cI,homepage:fI,description:dI,keywords:hI,main:gI,unpkg:pI,jsdelivr:mI,module:yI,types:vI,bin:bI,files:xI,scripts:wI,repository:_I,license:EI,bugs:SI,devDependencies:OI,dependencies:AI,peerDependencies:kI,engines:CI};function Cn(e,t,n){return e.fields=t||[],e.fname=n,e}function Qe(e){return e==null?null:e.fname}function Lt(e){return e==null?null:e.fields}function x$(e){return e.length===1?FI(e[0]):TI(e)}const FI=e=>function(t){return t[e]},TI=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function P(e){throw Error(e)}function br(e){const t=[],n=e.length;let i=null,r=0,o="",a,s,u;e=e+"";function l(){t.push(o+e.substring(a,s)),o="",a=s+1}for(a=s=0;s<n;++s)if(u=e[s],u==="\\")o+=e.substring(a,s),o+=e.substring(++s,++s),a=s;else if(u===i)l(),i=null,r=-1;else{if(i)continue;a===r&&u==='"'||a===r&&u==="'"?(a=s+1,i=u):u==="."&&!r?s>a?l():a=s+1:u==="["?(s>a&&l(),r=a=s+1):u==="]"&&(r||P("Access path missing open bracket: "+e),r>0&&l(),r=0,a=s+1)}return r&&P("Access path missing closing bracket: "+e),i&&P("Access path missing closing quote: "+e),s>a&&(s++,l()),t}function wn(e,t,n){const i=br(e);return e=i.length===1?i[0]:e,Cn((n&&n.get||x$)(i),[e],t||e)}const Ef=wn("id"),Wt=Cn(e=>e,[],"identity"),ko=Cn(()=>0,[],"zero"),al=Cn(()=>1,[],"one"),Zn=Cn(()=>!0,[],"true"),bo=Cn(()=>!1,[],"false");function MI(e,t,n){const i=[t].concat([].slice.call(n));console[e].apply(console,i)}const w$=0,fb=1,db=2,_$=3,E$=4;function hb(e,t,n=MI){let i=e||w$;return{level(r){return arguments.length?(i=+r,this):i},error(){return i>=fb&&n(t||"error","ERROR",arguments),this},warn(){return i>=db&&n(t||"warn","WARN",arguments),this},info(){return i>=_$&&n(t||"log","INFO",arguments),this},debug(){return i>=E$&&n(t||"log","DEBUG",arguments),this}}}var I=Array.isArray;function K(e){return e===Object(e)}const qE=e=>e!=="__proto__";function sl(...e){return e.reduce((t,n)=>{for(const i in n)if(i==="signals")t.signals=DI(t.signals,n.signals);else{const r=i==="legend"?{layout:1}:i==="style"?!0:null;ul(t,i,n[i],r)}return t},{})}function ul(e,t,n,i){if(!qE(t))return;let r,o;if(K(n)&&!I(n)){o=K(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?ul(o,r,n[r]):qE(r)&&(o[r]=n[r])}else e[t]=n}function DI(e,t){if(e==null)return t;const n={},i=[];function r(o){n[o.name]||(n[o.name]=1,i.push(o))}return t.forEach(r),e.forEach(r),i}function ve(e){return e[e.length-1]}function Rt(e){return e==null||e===""?null:+e}const S$=e=>t=>e*Math.exp(t),O$=e=>t=>Math.log(e*t),A$=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),k$=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Fh=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function hp(e,t,n,i){const r=n(e[0]),o=n(ve(e)),a=(o-r)*t;return[i(r-a),i(o-a)]}function C$(e,t){return hp(e,t,Rt,Wt)}function $$(e,t){var n=Math.sign(e[0]);return hp(e,t,O$(n),S$(n))}function F$(e,t,n){return hp(e,t,Fh(n),Fh(1/n))}function T$(e,t,n){return hp(e,t,A$(n),k$(n))}function gp(e,t,n,i,r){const o=i(e[0]),a=i(ve(e)),s=t!=null?i(t):(o+a)/2;return[r(s+(o-s)*n),r(s+(a-s)*n)]}function gb(e,t,n){return gp(e,t,n,Rt,Wt)}function pb(e,t,n){const i=Math.sign(e[0]);return gp(e,t,n,O$(i),S$(i))}function Th(e,t,n,i){return gp(e,t,n,Fh(i),Fh(1/i))}function mb(e,t,n,i){return gp(e,t,n,A$(i),k$(i))}function M$(e){return 1+~~(new Date(e).getMonth()/3)}function D$(e){return 1+~~(new Date(e).getUTCMonth()/3)}function V(e){return e!=null?I(e)?e:[e]:[]}function N$(e,t,n){let i=e[0],r=e[1],o;return r<i&&(o=r,r=i,i=o),o=r-i,o>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-o),i+o]}function fe(e){return typeof e=="function"}const NI="descending";function yb(e,t,n){n=n||{},t=V(t)||[];const i=[],r=[],o={},a=n.comparator||jI;return V(e).forEach((s,u)=>{s!=null&&(i.push(t[u]===NI?-1:1),r.push(s=fe(s)?s:wn(s,null,n)),(Lt(s)||[]).forEach(l=>o[l]=1))}),r.length===0?null:Cn(a(r,i),Object.keys(o))}const pp=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),jI=(e,t)=>e.length===1?RI(e[0],t[0]):PI(e,t,e.length),RI=(e,t)=>function(n,i){return pp(e(n),e(i))*t},PI=(e,t,n)=>(t.push(0),function(i,r){let o,a=0,s=-1;for(;a===0&&++s<n;)o=e[s],a=pp(o(i),o(r));return a*t[s]});function Gt(e){return fe(e)?e:()=>e}function vb(e,t){let n;return i=>{n&&clearTimeout(n),n=setTimeout(()=>(t(i),n=null),e)}}function ce(e){for(let t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function lr(e,t){let n=0,i,r,o,a;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(o=a=r;n<i;++n)r=e[n],r!=null&&(r<o&&(o=r),r>a&&(a=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(o=a=r;n<i;++n)r=t(e[n]),r!=null&&(r<o&&(o=r),r>a&&(a=r))}return[o,a]}function j$(e,t){const n=e.length;let i=-1,r,o,a,s,u;if(t==null){for(;++i<n;)if(o=e[i],o!=null&&o>=o){r=a=o;break}if(i===n)return[-1,-1];for(s=u=i;++i<n;)o=e[i],o!=null&&(r>o&&(r=o,s=i),a<o&&(a=o,u=i))}else{for(;++i<n;)if(o=t(e[i],i,e),o!=null&&o>=o){r=a=o;break}if(i===n)return[-1,-1];for(s=u=i;++i<n;)o=t(e[i],i,e),o!=null&&(r>o&&(r=o,s=i),a<o&&(a=o,u=i))}return[s,u]}const II=Object.prototype.hasOwnProperty;function ee(e,t){return II.call(e,t)}const md={};function ll(e){let t={},n;function i(o){return ee(t,o)&&t[o]!==md}const r={size:0,empty:0,object:t,has:i,get(o){return i(o)?t[o]:void 0},set(o,a){return i(o)||(++r.size,t[o]===md&&--r.empty),t[o]=a,this},delete(o){return i(o)&&(--r.size,++r.empty,t[o]=md),this},clear(){r.size=r.empty=0,r.object=t={}},test(o){return arguments.length?(n=o,r):n},clean(){const o={};let a=0;for(const s in t){const u=t[s];u!==md&&(!n||!n(u))&&(o[s]=u,++a)}r.size=a,r.empty=0,r.object=t=o}};return e&&Object.keys(e).forEach(o=>{r.set(o,e[o])}),r}function R$(e,t,n,i,r,o){if(!n&&n!==0)return o;const a=+n;let s=e[0],u=ve(e),l;u<s&&(l=s,s=u,u=l),l=Math.abs(t-s);const c=Math.abs(u-t);return l<c&&l<=a?i:c<=a?r:o}function W(e,t,n){const i=e.prototype=Object.create(t.prototype);return Object.defineProperty(i,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),ce(i,n)}function su(e,t,n,i){let r=t[0],o=t[t.length-1],a;return r>o&&(a=r,r=o,o=a),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=o:e<o)}function ua(e){return typeof e=="boolean"}function Po(e){return Object.prototype.toString.call(e)==="[object Date]"}function P$(e){return e&&fe(e[Symbol.iterator])}function De(e){return typeof e=="number"}function I$(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Y(e){return typeof e=="string"}function bb(e,t,n){e&&(e=t?V(e).map(s=>s.replace(/\\(.)/g,"$1")):V(e));const i=e&&e.length,r=n&&n.get||x$,o=s=>r(t?[s]:br(s));let a;if(!i)a=function(){return""};else if(i===1){const s=o(e[0]);a=function(u){return""+s(u)}}else{const s=e.map(o);a=function(u){let l=""+s[0](u),c=0;for(;++c<i;)l+="|"+s[c](u);return l}}return Cn(a,e,"key")}function L$(e,t){const n=e[0],i=ve(e),r=+t;return r?r===1?i:n+r*(i-n):n}const LI=1e4;function z$(e){e=+e||LI;let t,n,i;const r=()=>{t={},n={},i=0},o=(a,s)=>(++i>e&&(n=t,t={},i=1),t[a]=s);return r(),{clear:r,has:a=>ee(t,a)||ee(n,a),get:a=>ee(t,a)?t[a]:ee(n,a)?o(a,n[a]):void 0,set:(a,s)=>ee(t,a)?t[a]=s:o(a,s)}}function B$(e,t,n,i){const r=t.length,o=n.length;if(!o)return t;if(!r)return n;const a=i||new t.constructor(r+o);let s=0,u=0,l=0;for(;s<r&&u<o;++l)a[l]=e(t[s],n[u])>0?n[u++]:t[s++];for(;s<r;++s,++l)a[l]=t[s];for(;u<o;++u,++l)a[l]=n[u];return a}function oc(e,t){let n="";for(;--t>=0;)n+=e;return n}function U$(e,t,n,i){const r=n||" ",o=e+"",a=t-o.length;return a<=0?o:i==="left"?oc(r,a)+o:i==="center"?oc(r,~~(a/2))+o+oc(r,Math.ceil(a/2)):o+oc(r,a)}function Sf(e){return e&&ve(e)-e[0]||0}function G(e){return I(e)?"["+e.map(G)+"]":K(e)||Y(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function xb(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const zI=e=>De(e)||Po(e)?e:Date.parse(e);function wb(e,t){return t=t||zI,e==null||e===""?null:t(e)}function _b(e){return e==null||e===""?null:e+""}function Mi(e){const t={},n=e.length;for(let i=0;i<n;++i)t[e[i]]=!0;return t}function q$(e,t,n,i){const r=i!=null?i:"\u2026",o=e+"",a=o.length,s=Math.max(0,t-r.length);return a<=t?o:n==="left"?r+o.slice(a-s):n==="center"?o.slice(0,Math.ceil(s/2))+r+o.slice(a-~~(s/2)):o.slice(0,s)+r}function _o(e,t,n){if(e)if(t){const i=e.length;for(let r=0;r<i;++r){const o=t(e[r]);o&&n(o,r,e)}}else e.forEach(n)}var W$={exports:{}};(function(e){var t=function(){function n(d,h){return h!=null&&d instanceof h}var i;try{i=Map}catch{i=function(){}}var r;try{r=Set}catch{r=function(){}}var o;try{o=Promise}catch{o=function(){}}function a(d,h,g,p,m){typeof h=="object"&&(g=h.depth,p=h.prototype,m=h.includeNonEnumerable,h=h.circular);var y=[],v=[],b=typeof Buffer!="undefined";typeof h=="undefined"&&(h=!0),typeof g=="undefined"&&(g=1/0);function x(_,E){if(_===null)return null;if(E===0)return _;var w,S;if(typeof _!="object")return _;if(n(_,i))w=new i;else if(n(_,r))w=new r;else if(n(_,o))w=new o(function(D,R){_.then(function(L){D(x(L,E-1))},function(L){R(x(L,E-1))})});else if(a.__isArray(_))w=[];else if(a.__isRegExp(_))w=new RegExp(_.source,f(_)),_.lastIndex&&(w.lastIndex=_.lastIndex);else if(a.__isDate(_))w=new Date(_.getTime());else{if(b&&Buffer.isBuffer(_))return Buffer.allocUnsafe?w=Buffer.allocUnsafe(_.length):w=new Buffer(_.length),_.copy(w),w;n(_,Error)?w=Object.create(_):typeof p=="undefined"?(S=Object.getPrototypeOf(_),w=Object.create(S)):(w=Object.create(p),S=p)}if(h){var C=y.indexOf(_);if(C!=-1)return v[C];y.push(_),v.push(w)}n(_,i)&&_.forEach(function(D,R){var L=x(R,E-1),J=x(D,E-1);w.set(L,J)}),n(_,r)&&_.forEach(function(D){var R=x(D,E-1);w.add(R)});for(var A in _){var O;S&&(O=Object.getOwnPropertyDescriptor(S,A)),!(O&&O.set==null)&&(w[A]=x(_[A],E-1))}if(Object.getOwnPropertySymbols)for(var F=Object.getOwnPropertySymbols(_),A=0;A<F.length;A++){var k=F[A],M=Object.getOwnPropertyDescriptor(_,k);M&&!M.enumerable&&!m||(w[k]=x(_[k],E-1),M.enumerable||Object.defineProperty(w,k,{enumerable:!1}))}if(m)for(var $=Object.getOwnPropertyNames(_),A=0;A<$.length;A++){var T=$[A],M=Object.getOwnPropertyDescriptor(_,T);M&&M.enumerable||(w[T]=x(_[T],E-1),Object.defineProperty(w,T,{enumerable:!1}))}return w}return x(d,g)}a.clonePrototype=function(h){if(h===null)return null;var g=function(){};return g.prototype=h,new g};function s(d){return Object.prototype.toString.call(d)}a.__objToStr=s;function u(d){return typeof d=="object"&&s(d)==="[object Date]"}a.__isDate=u;function l(d){return typeof d=="object"&&s(d)==="[object Array]"}a.__isArray=l;function c(d){return typeof d=="object"&&s(d)==="[object RegExp]"}a.__isRegExp=c;function f(d){var h="";return d.global&&(h+="g"),d.ignoreCase&&(h+="i"),d.multiline&&(h+="m"),h}return a.__getRegExpFlags=f,a}();e.exports&&(e.exports=t)})(W$);var BI=W$.exports,UI=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,o;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(o=Object.keys(t),i=o.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,o[r]))return!1;for(r=i;r--!==0;){var a=o[r];if(!e(t[a],n[a]))return!1}return!0}return t!==t&&n!==n},Eb=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(o){return function(a){return function(s,u){var l={key:s,value:a[s]},c={key:u,value:a[u]};return o(l,c)}}}(t.cmp),r=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a!==void 0){if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);var s,u;if(Array.isArray(a)){for(u="[",s=0;s<a.length;s++)s&&(u+=","),u+=o(a[s])||"null";return u+"]"}if(a===null)return"null";if(r.indexOf(a)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=r.push(a)-1,c=Object.keys(a).sort(i&&i(a));for(u="",s=0;s<c.length;s++){var f=c[s],d=o(a[f]);!d||(u&&(u+=","),u+=JSON.stringify(f)+":"+d)}return r.splice(l,1),"{"+u+"}"}}(e)};function Sb(e){return!!e.or}function Ob(e){return!!e.and}function Ab(e){return!!e.not}function oh(e,t){if(Ab(e))oh(e.not,t);else if(Ob(e))for(const n of e.and)oh(n,t);else if(Sb(e))for(const n of e.or)oh(n,t);else t(e)}function gu(e,t){return Ab(e)?{not:gu(e.not,t)}:Ob(e)?{and:e.and.map(n=>gu(n,t))}:Sb(e)?{or:e.or.map(n=>gu(n,t))}:t(e)}const Zi=UI,le=BI;function G$(e){throw new Error(e)}function Ou(e,t){const n={};for(const i of t)ee(e,i)&&(n[i]=e[i]);return n}function yn(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Eb(e)).join(",")})`};const Ie=Eb;function be(e){if(De(e))return e;const t=Y(e)?e:Eb(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function H1(e){return e===!1||e===null}function me(e,t){return e.includes(t)}function os(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function kb(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function H$(e,...t){for(const n of t)qI(e,n!=null?n:{});return e}function qI(e,t){for(const n of z(t))ul(e,n,t[n],!0)}function er(e,t){const n=[],i={};let r;for(const o of e)r=t(o),!(r in i)&&(i[r]=1,n.push(o));return n}function WI(e,t){const n=z(e),i=z(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function Y$(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Cb(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Y1(e){const t=new Set;for(const n of e){const r=br(n).map((a,s)=>s===0?a:`[${a}]`),o=r.map((a,s)=>r.slice(0,s+1).join(""));for(const a of o)t.add(a)}return t}function $b(e,t){return e===void 0||t===void 0?!0:Cb(Y1(e),Y1(t))}function Me(e){return z(e).length===0}const z=Object.keys,zt=Object.values,Go=Object.entries;function qc(e){return e===!0||e===!1}function qe(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Cc(e,t){return Ab(e)?`!(${Cc(e.not,t)})`:Ob(e)?`(${e.and.map(n=>Cc(n,t)).join(") && (")})`:Sb(e)?`(${e.or.map(n=>Cc(n,t)).join(") || (")})`:t(e)}function Mh(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&Mh(e[n],t)&&delete e[n],Me(e)}function Of(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Fb(e,t="datum"){const n=br(e),i=[];for(let r=1;r<=n.length;r++){const o=`[${n.slice(0,r).map(G).join("][")}]`;i.push(`${t}${o}`)}return i.join(" && ")}function X$(e,t="datum"){return`${t}[${G(br(e).join("."))}]`}function GI(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function ei(e){return`${br(e).map(GI).join("\\.")}`}function as(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Tb(e){return`${br(e).join(".")}`}function Au(e){return e?br(e).length:0}function nt(...e){for(const t of e)if(t!==void 0)return t}let V$=42;function K$(e){const t=++V$;return e?String(e)+t:t}function HI(){V$=42}function J$(e){return Q$(e)?e:`__${e}`}function Q$(e){return e.startsWith("__")}function Wc(e){if(e!==void 0)return(e%360+360)%360}function mp(e){return De(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}var Af=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Vr="row",Kr="column",yp="facet",He="x",bt="y",Ri="x2",xr="y2",la="xOffset",cl="yOffset",Pi="radius",ao="radius2",ai="theta",so="theta2",wr="latitude",_r="longitude",Ii="latitude2",ti="longitude2",_n="color",Er="fill",Sr="stroke",En="shape",uo="size",ks="angle",lo="opacity",ca="fillOpacity",fa="strokeOpacity",da="strokeWidth",ha="strokeDash",kf="text",Cf="order",$f="detail",vp="key",ss="tooltip",bp="href",xp="url",wp="description",YI={x:1,y:1,x2:1,y2:1},Z$={theta:1,theta2:1,radius:1,radius2:1};function eF(e){return e in Z$}const Mb={longitude:1,longitude2:1,latitude:1,latitude2:1};function XI(e){switch(e){case wr:return"y";case Ii:return"y2";case _r:return"x";case ti:return"x2"}}function VI(e){return e in Mb}const KI=z(Mb),Db=Object.assign(Object.assign(Object.assign(Object.assign({},YI),Z$),Mb),{xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function pu(e){return e===_n||e===Er||e===Sr}const tF={row:1,column:1,facet:1},Yn=z(tF),Nb=Object.assign(Object.assign({},Db),tF),JI=z(Nb),QI=Af(Nb,["order","detail","tooltip"]),ZI=Af(QI,["row","column","facet"]);function eL(e){return!!ZI[e]}function nF(e){return!!Nb[e]}const tL=[Ri,xr,Ii,ti,so,ao];function iF(e){return Cs(e)!==e}function Cs(e){switch(e){case Ri:return He;case xr:return bt;case Ii:return wr;case ti:return _r;case so:return ai;case ao:return Pi}return e}function Ho(e){if(eF(e))switch(e){case ai:return"startAngle";case so:return"endAngle";case Pi:return"outerRadius";case ao:return"innerRadius"}return e}function Or(e){switch(e){case He:return Ri;case bt:return xr;case wr:return Ii;case _r:return ti;case ai:return so;case Pi:return ao}}function Sn(e){switch(e){case He:case Ri:return"width";case bt:case xr:return"height"}}function nL(e){switch(e){case He:return"xOffset";case bt:return"yOffset";case Ri:return"x2Offset";case xr:return"y2Offset";case ai:return"thetaOffset";case Pi:return"radiusOffset";case so:return"theta2Offset";case ao:return"radius2Offset"}}function rF(e){switch(e){case He:return"xOffset";case bt:return"yOffset"}}function oF(e){switch(e){case"xOffset":return"x";case"yOffset":return"y"}}const iL=z(Db),jb=Af(Db,["x","y","x2","y2","xOffset","yOffset","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),rL=z(jb),Rb={x:1,y:1},Ar=z(Rb);function xt(e){return e in Rb}const Pb={theta:1,radius:1},oL=z(Pb);function _p(e){return e==="width"?He:bt}const aF={xOffset:1,yOffset:1};function fl(e){return e in aF}const sF=Af(jb,["text","tooltip","href","url","description","detail","key","order"]),aL=z(sF);function sL(e){return!!jb[e]}function uL(e){switch(e){case _n:case Er:case Sr:case uo:case En:case lo:case da:case ha:return!0;case ca:case fa:case ks:return!1}}const uF=Object.assign(Object.assign(Object.assign(Object.assign({},Rb),Pb),aF),sF),Ep=z(uF);function ga(e){return!!uF[e]}function lL(e,t){return fL(e)[t]}const lF={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},cL=Af(lF,["geoshape"]);function fL(e){switch(e){case _n:case Er:case Sr:case wp:case $f:case vp:case ss:case bp:case Cf:case lo:case ca:case fa:case da:case yp:case Vr:case Kr:return lF;case He:case bt:case la:case cl:case wr:case _r:return cL;case Ri:case xr:case Ii:case ti:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case uo:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case ha:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case En:return{point:"always",geoshape:"always"};case kf:return{text:"always"};case ks:return{point:"always",square:"always",text:"always"};case xp:return{image:"always"};case ai:return{text:"always",arc:"always"};case Pi:return{text:"always",arc:"always"};case so:case ao:return{arc:"always"}}}function vm(e){switch(e){case He:case bt:case ai:case Pi:case la:case cl:case uo:case ks:case da:case lo:case ca:case fa:case Ri:case xr:case so:case ao:return;case yp:case Vr:case Kr:case En:case ha:case kf:case ss:case bp:case xp:case wp:return"discrete";case _n:case Er:case Sr:return"flexible";case wr:case _r:case Ii:case ti:case $f:case vp:case Cf:return}}const dL={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},hL={count:1,min:1,max:1};function no(e){return!!e&&!!e.argmin}function pa(e){return!!e&&!!e.argmax}function Ib(e){return Y(e)&&!!dL[e]}const gL=new Set(["count","valid","missing","distinct"]);function cF(e){return Y(e)&&gL.has(e)}function pL(e){return Y(e)&&me(["min","max"],e)}const mL=new Set(["count","sum","distinct","valid","missing"]),yL=new Set(["mean","average","median","q1","q3","min","max"]);function fF(e){return ua(e)&&(e=G0(e,void 0)),"bin"+z(e).map(t=>Sp(e[t])?qe(`_${t}_${Go(e[t])}`):qe(`_${t}_${e[t]}`)).join("")}function Le(e){return e===!0||$s(e)&&!e.binned}function Et(e){return e==="binned"||$s(e)&&e.binned===!0}function $s(e){return K(e)}function Sp(e){return e==null?void 0:e.param}function WE(e){switch(e){case Vr:case Kr:case uo:case _n:case Er:case Sr:case da:case lo:case ca:case fa:case En:return 6;case ha:return 4;default:return 10}}function Ff(e){return!!(e!=null&&e.expr)}function dn(e){const t=z(e||{}),n={};for(const i of t)n[i]=Nn(e[i]);return n}var vL=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function dF(e){const{anchor:t,frame:n,offset:i,orient:r,angle:o,limit:a,color:s,subtitleColor:u,subtitleFont:l,subtitleFontSize:c,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:h,subtitlePadding:g}=e,p=vL(e,["anchor","frame","offset","orient","angle","limit","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),m=Object.assign(Object.assign({},p),s?{fill:s}:{}),y=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),o!==void 0?{angle:o}:{}),a!==void 0?{limit:a}:{}),v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{subtitleColor:u}:{}),l?{subtitleFont:l}:{}),c?{subtitleFontSize:c}:{}),f?{subtitleFontStyle:f}:{}),d?{subtitleFontWeight:d}:{}),h?{subtitleLineHeight:h}:{}),g?{subtitlePadding:g}:{}),b=Ou(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:m,subtitleMarkConfig:b,nonMarkTitleProperties:y,subtitle:v}}function Eo(e){return Y(e)||I(e)&&Y(e[0])}function Z(e){return!!(e!=null&&e.signal)}function ma(e){return!!e.step}function bL(e){return I(e)?!1:"fields"in e&&!("data"in e)}function xL(e){return I(e)?!1:"fields"in e&&"data"in e}function qr(e){return I(e)?!1:"field"in e&&"data"in e}const wL={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},_L=z(wL),EL={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},X1=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];var Lb=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function hF(e){const t=I(e.condition)?e.condition.map(GE):GE(e.condition);return Object.assign(Object.assign({},Nn(e)),{condition:t})}function Nn(e){if(Ff(e)){const{expr:t}=e,n=Lb(e,["expr"]);return Object.assign({signal:t},n)}return e}function GE(e){if(Ff(e)){const{expr:t}=e,n=Lb(e,["expr"]);return Object.assign({signal:t},n)}return e}function ze(e){if(Ff(e)){const{expr:t}=e,n=Lb(e,["expr"]);return Object.assign({signal:t},n)}return Z(e)?e:e!==void 0?{value:e}:void 0}function SL(e){return Z(e)?e.signal:G(e)}function HE(e){return Z(e)?e.signal:G(e.value)}function Jr(e){return Z(e)?e.signal:e==null?null:G(e)}function OL(e,t,n){for(const i of n){const r=us(i,t.markDef,t.config);r!==void 0&&(e[i]=ze(r))}return e}function gF(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Fe(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:o}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:o&&(!r||r===e)?void 0:us(e,t,n,i)}function us(e,t,n,{vgChannel:i}={}){return nt(i?Dh(e,t,n.style):void 0,Dh(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function Dh(e,t,n){return pF(e,gF(t),n)}function pF(e,t,n){t=V(t);let i;for(const r of t){const o=n[r];o&&o[e]!==void 0&&(i=o[e])}return i}function mF(e,t){return V(e).reduce((n,i)=>{var r;return n.field.push(H(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function yF(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Zi(r,i))return;n.push(i)}),n}function vF(e,t){return Zi(e,t)||!t?e:e?[...V(e),...V(t)].join(", "):t}function bF(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((Eo(n)||Z(n))&&(Eo(i)||Z(i)))return{explicit:e.explicit,value:vF(n,i)};if(Eo(n)||Z(n))return{explicit:e.explicit,value:n};if(Eo(i)||Z(i))return{explicit:e.explicit,value:i};if(!Eo(n)&&!Z(n)&&!Eo(i)&&!Z(i))return{explicit:e.explicit,value:yF(n,i)};throw new Error("It should never reach here")}function zb(e){return`Invalid specification ${Ie(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const AL='Autosize "fit" only works for single views and layered views.';function YE(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function XE(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function VE(e){return e?`Dropping "fit-${e}" because spec has discrete ${Sn(e)}.`:'Dropping "fit" because spec has discrete size.'}function Bb(e){return`Unknown field for ${e}. Cannot calculate view size.`}function KE(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function kL(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function CL(e){return`The "nearest" transform is not supported for ${e} marks.`}function xF(e){return`Selection not supported for ${e} yet.`}function $L(e){return`Cannot find a selection named "${e}".`}const FL="Scale bindings are currently only supported for scales with unbinned, continuous domains.",TL="Legend bindings are only supported for selections over an individual field or encoding channel.";function ML(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function DL(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const NL="The same selection must be used to override scale domains in a layered view.",jL='Interval selections should be initialized using "x" and/or "y" keys.';function RL(e){return`Unknown repeated value "${e}".`}function JE(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const PL="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function IL(e){return`Unrecognized parse "${e}".`}function QE(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const LL="Attempt to add the same child twice.";function zL(e){return`Ignoring an invalid transform: ${Ie(e)}.`}const BL='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function ZE(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function UL(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Ie(t)} is overridden by a child projection ${Ie(n)}.`}const qL="Arc marks uses theta channel rather than angle, replacing angle with theta.";function WL(e){return`${e}Offset dropped because ${e} is continuous`}function GL(e){return`There is no ${e} encoding. Replacing ${e}Offset encoding as ${e}.`}function HL(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Ie(n)}}.`}function wF(e){return`Invalid field type "${e}".`}function YL(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function XL(e){return`Invalid aggregation operator "${e}".`}function _F(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function VL(e){return`Position range does not support relative band size for ${e}.`}function V1(e,t){return`Dropping ${Ie(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const KL="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Op(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function JL(e){return`${e} encoding has no scale, so specified scale is ignored.`}function QL(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function ZL(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function e4(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function t4(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function bm(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function n4(e){return`The ${e} for range marks cannot be an expression`}function i4(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function r4(e,t){return`Specified orient "${e}" overridden with "${t}".`}function o4(e){return`Cannot use the scale property "${e}" with non-color channel.`}function a4(e){return`Cannot use the relative band size with ${e} scale.`}function s4(e){return`Using unaggregated domain with raw field has no effect (${Ie(e)}).`}function u4(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function l4(e){return`Unaggregated domain is currently unsupported for log scale (${Ie(e)}).`}function c4(e){return`Cannot apply size to non-oriented mark "${e}".`}function f4(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function d4(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function EF(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function SF(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function h4(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ie(n)} and ${Ie(i)}). Using ${Ie(n)}.`}function g4(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ie(n)} and ${Ie(i)}). Using the union of the two domains.`}function p4(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function m4(e){return`Dropping sort property ${Ie(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const eS="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",y4="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",v4="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",b4="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function x4(e){return`Cannot stack "${e}" if there is already "${e}2".`}function w4(e){return`Cannot stack non-linear scale (${e}).`}function _4(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Nh(e,t){return`Invalid ${e}: ${Ie(t)}.`}function E4(e){return`Dropping day from datetime ${Ie(e)} as day cannot be combined with other units.`}function S4(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function O4(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function A4(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function tS(e){return`1D error band does not support ${e}.`}function OF(e){return`Channel ${e} is required for "binned" bin.`}function k4(e){return`Channel ${e} should not be used with "binned" bin.`}function C4(e){return`Domain for ${e} is required for threshold scale.`}globalThis&&globalThis.__classPrivateFieldSet;globalThis&&globalThis.__classPrivateFieldGet;const AF=hb(db);let ku=AF;function $4(e){return ku=e,ku}function F4(){return ku=AF,ku}function U(...e){ku.warn(...e)}function T4(...e){ku.debug(...e)}function Fs(e){if(e&&K(e)){for(const t of qb)if(t in e)return!0}return!1}const kF=["january","february","march","april","may","june","july","august","september","october","november","december"],M4=kF.map(e=>e.substr(0,3)),CF=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],D4=CF.map(e=>e.substr(0,3));function N4(e){if(mp(e)&&(e=+e),De(e))return e>4&&U(Nh("quarter",e)),e-1;throw new Error(Nh("quarter",e))}function j4(e){if(mp(e)&&(e=+e),De(e))return e-1;{const t=e.toLowerCase(),n=kF.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=M4.indexOf(i);if(r!==-1)return r;throw new Error(Nh("month",e))}}function R4(e){if(mp(e)&&(e=+e),De(e))return e%7;{const t=e.toLowerCase(),n=CF.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=D4.indexOf(i);if(r!==-1)return r;throw new Error(Nh("day",e))}}function Ub(e,t){const n=[];if(t&&e.day!==void 0&&z(e).length>1&&(U(E4(e)),e=le(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?j4(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?N4(e.quarter):e.quarter;n.push(De(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?R4(e.day):e.day;n.push(De(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function Gc(e){const n=Ub(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function P4(e){const n=Ub(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function I4(e){const t=Ub(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var L4=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const $F={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},qb=z($F);function z4(e){return!!$F[e]}function Wb(e){return e.startsWith("utc")}function B4(e){return e.substr(3)}const U4={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Gb(e){return qb.filter(t=>FF(e,t))}function FF(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function q4(e,t,{end:n}={end:!1}){const i=Fb(t),r=Wb(e)?"utc":"";function o(u){return u==="quarter"?`(${r}quarter(${i})-1)`:`${r}${u}(${i})`}let a;const s={};for(const u of qb)FF(e,u)&&(s[u]=o(u),a=u);return n&&(s[a]+="+1"),P4(s)}function TF(e){if(!e)return;const t=Gb(e);return`timeUnitSpecifier(${Ie(t)}, ${Ie(U4)})`}function W4(e,t,n){if(!e)return;const i=TF(e);return`${n||Wb(e)?"utc":"time"}Format(${t}, ${i})`}function Ht(e){if(!e)return;let t;return Y(e)?t={unit:e}:K(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Wb(t.unit)&&(t.utc=!0,t.unit=B4(t.unit)),t}function G4(e){const t=Ht(e),{utc:n}=t,i=L4(t,["utc"]);return i.unit?(n?"utc":"")+z(i).map(r=>qe(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+z(i).map(r=>qe(`_${r}_${i[r]}`)).join("")}function H4(e){return e==null?void 0:e.param}function Hb(e){return!!(e!=null&&e.field)&&e.equal!==void 0}function Yb(e){return!!(e!=null&&e.field)&&e.lt!==void 0}function Xb(e){return!!(e!=null&&e.field)&&e.lte!==void 0}function Vb(e){return!!(e!=null&&e.field)&&e.gt!==void 0}function Kb(e){return!!(e!=null&&e.field)&&e.gte!==void 0}function Jb(e){if(e!=null&&e.field){if(I(e.range)&&e.range.length===2)return!0;if(Z(e.range))return!0}return!1}function Qb(e){return!!(e!=null&&e.field)&&(I(e.oneOf)||I(e.in))}function Y4(e){return!!(e!=null&&e.field)&&e.valid!==void 0}function MF(e){return Qb(e)||Hb(e)||Jb(e)||Yb(e)||Vb(e)||Xb(e)||Kb(e)}function Wi(e,t){return H0(e,{timeUnit:t,wrapTime:!0})}function X4(e,t){return e.map(n=>Wi(n,t))}function DF(e,t=!0){var n;const{field:i}=e,r=(n=Ht(e.timeUnit))===null||n===void 0?void 0:n.unit,o=r?`time(${q4(r,i)})`:H(e,{expr:"datum"});if(Hb(e))return`${o}===${Wi(e.equal,r)}`;if(Yb(e)){const a=e.lt;return`${o}<${Wi(a,r)}`}else if(Vb(e)){const a=e.gt;return`${o}>${Wi(a,r)}`}else if(Xb(e)){const a=e.lte;return`${o}<=${Wi(a,r)}`}else if(Kb(e)){const a=e.gte;return`${o}>=${Wi(a,r)}`}else{if(Qb(e))return`indexof([${X4(e.oneOf,r).join(",")}], ${o}) !== -1`;if(Y4(e))return Zb(o,e.valid);if(Jb(e)){const{range:a}=e,s=Z(a)?{signal:`${a.signal}[0]`}:a[0],u=Z(a)?{signal:`${a.signal}[1]`}:a[1];if(s!==null&&u!==null&&t)return"inrange("+o+", ["+Wi(s,r)+", "+Wi(u,r)+"])";const l=[];return s!==null&&l.push(`${o} >= ${Wi(s,r)}`),u!==null&&l.push(`${o} <= ${Wi(u,r)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${Ie(e)}`)}function Zb(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function V4(e){var t;return MF(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=Ht(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}var nS={},xm={},wm=34,Dl=10,_m=13;function NF(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function K4(e,t){var n=NF(e);return function(i,r){return t(n(i),r,e)}}function iS(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function cn(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function J4(e){return e<0?"-"+cn(-e,6):e>9999?"+"+cn(e,6):cn(e,4)}function Q4(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":J4(e.getUTCFullYear())+"-"+cn(e.getUTCMonth()+1,2)+"-"+cn(e.getUTCDate(),2)+(r?"T"+cn(t,2)+":"+cn(n,2)+":"+cn(i,2)+"."+cn(r,3)+"Z":i?"T"+cn(t,2)+":"+cn(n,2)+":"+cn(i,2)+"Z":n||t?"T"+cn(t,2)+":"+cn(n,2)+"Z":"")}function Z4(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(f,d){var h,g,p=r(f,function(m,y){if(h)return h(m,y-1);g=m,h=d?K4(m,d):NF(m)});return p.columns=g||[],p}function r(f,d){var h=[],g=f.length,p=0,m=0,y,v=g<=0,b=!1;f.charCodeAt(g-1)===Dl&&--g,f.charCodeAt(g-1)===_m&&--g;function x(){if(v)return xm;if(b)return b=!1,nS;var E,w=p,S;if(f.charCodeAt(w)===wm){for(;p++<g&&f.charCodeAt(p)!==wm||f.charCodeAt(++p)===wm;);return(E=p)>=g?v=!0:(S=f.charCodeAt(p++))===Dl?b=!0:S===_m&&(b=!0,f.charCodeAt(p)===Dl&&++p),f.slice(w+1,E-1).replace(/""/g,'"')}for(;p<g;){if((S=f.charCodeAt(E=p++))===Dl)b=!0;else if(S===_m)b=!0,f.charCodeAt(p)===Dl&&++p;else if(S!==n)continue;return f.slice(w,E)}return v=!0,f.slice(w,g)}for(;(y=x())!==xm;){for(var _=[];y!==nS&&y!==xm;)_.push(y),y=x();d&&(_=d(_,m++))==null||h.push(_)}return h}function o(f,d){return f.map(function(h){return d.map(function(g){return c(h[g])}).join(e)})}function a(f,d){return d==null&&(d=iS(f)),[d.map(c).join(e)].concat(o(f,d)).join(`
`)}function s(f,d){return d==null&&(d=iS(f)),o(f,d).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?Q4(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:a,formatBody:s,formatRows:u,formatRow:l,formatValue:c}}function e8(e){return e}function t8(e){if(e==null)return e8;var t,n,i=e.scale[0],r=e.scale[1],o=e.translate[0],a=e.translate[1];return function(s,u){u||(t=n=0);var l=2,c=s.length,f=new Array(c);for(f[0]=(t+=s[0])*i+o,f[1]=(n+=s[1])*r+a;l<c;)f[l]=s[l],++l;return f}}function n8(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}function i8(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return rS(e,n)})}:rS(e,t)}function rS(e,t){var n=t.id,i=t.bbox,r=t.properties==null?{}:t.properties,o=jF(e,t);return n==null&&i==null?{type:"Feature",properties:r,geometry:o}:i==null?{type:"Feature",id:n,properties:r,geometry:o}:{type:"Feature",id:n,bbox:i,properties:r,geometry:o}}function jF(e,t){var n=t8(e.transform),i=e.arcs;function r(c,f){f.length&&f.pop();for(var d=i[c<0?~c:c],h=0,g=d.length;h<g;++h)f.push(n(d[h],h));c<0&&n8(f,g)}function o(c){return n(c)}function a(c){for(var f=[],d=0,h=c.length;d<h;++d)r(c[d],f);return f.length<2&&f.push(f[0]),f}function s(c){for(var f=a(c);f.length<4;)f.push(f[0]);return f}function u(c){return c.map(s)}function l(c){var f=c.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(l)};case"Point":d=o(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(o);break;case"LineString":d=a(c.arcs);break;case"MultiLineString":d=c.arcs.map(a);break;case"Polygon":d=u(c.arcs);break;case"MultiPolygon":d=c.arcs.map(u);break;default:return null}return{type:f,coordinates:d}}return l(t)}function r8(e,t){var n={},i={},r={},o=[],a=-1;t.forEach(function(l,c){var f=e.arcs[l<0?~l:l],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=t[++a],t[a]=l,t[c]=d)}),t.forEach(function(l){var c=s(l),f=c[0],d=c[1],h,g;if(h=r[f])if(delete r[h.end],h.push(l),h.end=d,g=i[d]){delete i[g.start];var p=g===h?h:h.concat(g);i[p.start=h.start]=r[p.end=g.end]=p}else i[h.start]=r[h.end]=h;else if(h=i[d])if(delete i[h.start],h.unshift(l),h.start=f,g=r[f]){delete r[g.end];var m=g===h?h:g.concat(h);i[m.start=g.start]=r[m.end=h.end]=m}else i[h.start]=r[h.end]=h;else h=[l],i[h.start=f]=r[h.end=d]=h});function s(l){var c=e.arcs[l<0?~l:l],f=c[0],d;return e.transform?(d=[0,0],c.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=c[c.length-1],l<0?[d,f]:[f,d]}function u(l,c){for(var f in l){var d=l[f];delete c[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),o.push(d)}}return u(r,i),u(i,r),t.forEach(function(l){n[l<0?~l:l]||o.push([l])}),o}function o8(e){return jF(e,a8.apply(this,arguments))}function a8(e,t,n){var i,r,o;if(arguments.length>1)i=s8(e,t,n);else for(r=0,i=new Array(o=e.arcs.length);r<o;++r)i[r]=r;return{type:"MultiLineString",arcs:r8(e,i)}}function s8(e,t,n){var i=[],r=[],o;function a(f){var d=f<0?~f:f;(r[d]||(r[d]=[])).push({i:f,g:o})}function s(f){f.forEach(a)}function u(f){f.forEach(s)}function l(f){f.forEach(u)}function c(f){switch(o=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":s(f.arcs);break;case"MultiLineString":case"Polygon":u(f.arcs);break;case"MultiPolygon":l(f.arcs);break}}return c(t),r.forEach(n==null?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}function Qr(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function u8(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Tf(e){let t,n,i;e.length!==2?(t=Qr,n=(s,u)=>Qr(e(s),u),i=(s,u)=>e(s)-u):(t=e===Qr||e===u8?e:l8,n=e,i=e);function r(s,u,l=0,c=s.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(s[f],u)<0?l=f+1:c=f}while(l<c)}return l}function o(s,u,l=0,c=s.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(s[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function a(s,u,l=0,c=s.length){const f=r(s,u,l,c-1);return f>l&&i(s[f-1],u)>-i(s[f],u)?f-1:f}return{left:r,center:a,right:o}}function l8(){return 0}function RF(e){return e===null?NaN:+e}function*c8(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(i=+i)>=i&&(yield i)}}const PF=Tf(Qr),jh=PF.right,f8=PF.left;Tf(RF).center;var Mf=jh;function d8(e,t){let n=0,i,r=0,o=0;if(t===void 0)for(let a of e)a!=null&&(a=+a)>=a&&(i=a-r,r+=i/++n,o+=i*(a-r));else{let a=-1;for(let s of e)(s=t(s,++a,e))!=null&&(s=+s)>=s&&(i=s-r,r+=i/++n,o+=i*(s-r))}if(n>1)return o/(n-1)}function h8(e,t){const n=d8(e,t);return n&&Math.sqrt(n)}class nn{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const o=n[r],a=t+o,s=Math.abs(t)<Math.abs(o)?t-(a-o):o-(a-t);s&&(n[i++]=s),t=a}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let n=this._n,i,r,o,a=0;if(n>0){for(a=t[--n];n>0&&(i=a,r=t[--n],a=i+r,o=r-(a-i),!o););n>0&&(o<0&&t[n-1]<0||o>0&&t[n-1]>0)&&(r=o*2,i=a+r,r==i-a&&(a=i))}return a}}class oS extends Map{constructor(t,n=zF){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,r]of t)this.set(i,r)}get(t){return super.get(K1(this,t))}has(t){return super.has(K1(this,t))}set(t,n){return super.set(IF(this,t),n)}delete(t){return super.delete(LF(this,t))}}class Rh extends Set{constructor(t,n=zF){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const i of t)this.add(i)}has(t){return super.has(K1(this,t))}add(t){return super.add(IF(this,t))}delete(t){return super.delete(LF(this,t))}}function K1({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function IF({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function LF({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function zF(e){return e!==null&&typeof e=="object"?e.valueOf():e}function g8(e,t){return Array.from(t,n=>e[n])}function p8(e=Qr){if(e===Qr)return BF;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{const i=e(t,n);return i||i===0?i:(e(n,n)===0)-(e(t,t)===0)}}function BF(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const m8=Math.sqrt(50),y8=Math.sqrt(10),v8=Math.sqrt(2);function Ph(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),a=o>=m8?10:o>=y8?5:o>=v8?2:1;let s,u,l;return r<0?(l=Math.pow(10,-r)/a,s=Math.round(e*l),u=Math.round(t*l),s/l<e&&++s,u/l>t&&--u,l=-l):(l=Math.pow(10,r)*a,s=Math.round(e/l),u=Math.round(t/l),s*l<e&&++s,u*l>t&&--u),u<s&&.5<=n&&n<2?Ph(e,t,n*2):[s,u,l]}function J1(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const i=t<e,[r,o,a]=i?Ph(t,e,n):Ph(e,t,n);if(!(o>=r))return[];const s=o-r+1,u=new Array(s);if(i)if(a<0)for(let l=0;l<s;++l)u[l]=(o-l)/-a;else for(let l=0;l<s;++l)u[l]=(o-l)*a;else if(a<0)for(let l=0;l<s;++l)u[l]=(r+l)/-a;else for(let l=0;l<s;++l)u[l]=(r+l)*a;return u}function Q1(e,t,n){return t=+t,e=+e,n=+n,Ph(e,t,n)[2]}function Yo(e,t,n){t=+t,e=+e,n=+n;const i=t<e,r=i?Q1(t,e,n):Q1(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}function Ka(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function Z1(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function UF(e,t,n=0,i=1/0,r){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),i=Math.floor(Math.min(e.length-1,i)),!(n<=t&&t<=i))return e;for(r=r===void 0?BF:p8(r);i>n;){if(i-n>600){const u=i-n+1,l=t-n+1,c=Math.log(u),f=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1),h=Math.max(n,Math.floor(t-l*f/u+d)),g=Math.min(i,Math.floor(t+(u-l)*f/u+d));UF(e,t,h,g,r)}const o=e[t];let a=n,s=i;for(Nl(e,n,t),r(e[i],o)>0&&Nl(e,n,i);a<s;){for(Nl(e,a,s),++a,--s;r(e[a],o)<0;)++a;for(;r(e[s],o)>0;)--s}r(e[n],o)===0?Nl(e,n,s):(++s,Nl(e,s,i)),s<=t&&(n=s+1),t<=s&&(i=s-1)}return e}function Nl(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function ey(e,t,n){if(e=Float64Array.from(c8(e,n)),!(!(i=e.length)||isNaN(t=+t))){if(t<=0||i<2)return Z1(e);if(t>=1)return Ka(e);var i,r=(i-1)*t,o=Math.floor(r),a=Ka(UF(e,o).subarray(0,o+1)),s=Z1(e.subarray(o+1));return a+(s-a)*(r-o)}}function qF(e,t,n=RF){if(!(!(i=e.length)||isNaN(t=+t))){if(t<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,o=Math.floor(r),a=+n(e[o],o,e),s=+n(e[o+1],o+1,e);return a+(s-a)*(r-o)}}function b8(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let o of e)(o=t(o,++r,e))!=null&&(o=+o)>=o&&(++n,i+=o)}if(n)return i/n}function WF(e,t){return ey(e,.5,t)}function*x8(e){for(const t of e)yield*t}function GF(e){return Array.from(x8(e))}function jn(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(r);++i<r;)o[i]=e+i*n;return o}function HF(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function w8(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ih(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Cu(e){return e=Ih(Math.abs(e)),e?e[1]:NaN}function _8(e,t){return function(n,i){for(var r=n.length,o=[],a=0,s=e[0],u=0;r>0&&s>0&&(u+s+1>i&&(s=Math.max(1,i-u)),o.push(n.substring(r-=s,r+s)),!((u+=s+1)>i));)s=e[a=(a+1)%e.length];return o.reverse().join(t)}}function E8(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var S8=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ls(e){if(!(t=S8.exec(e)))throw new Error("invalid format: "+e);var t;return new ex({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}ls.prototype=ex.prototype;function ex(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ex.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function O8(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var YF;function A8(e,t){var n=Ih(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(YF=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Ih(e,Math.max(0,t+o-1))[0]}function aS(e,t){var n=Ih(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}var sS={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:w8,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>aS(e*100,t),r:aS,s:A8,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function uS(e){return e}var lS=Array.prototype.map,cS=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function XF(e){var t=e.grouping===void 0||e.thousands===void 0?uS:_8(lS.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?uS:E8(lS.call(e.numerals,String)),a=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"\u2212":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=ls(f);var d=f.fill,h=f.align,g=f.sign,p=f.symbol,m=f.zero,y=f.width,v=f.comma,b=f.precision,x=f.trim,_=f.type;_==="n"?(v=!0,_="g"):sS[_]||(b===void 0&&(b=12),x=!0,_="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var E=p==="$"?n:p==="#"&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",w=p==="$"?i:/[%p]/.test(_)?a:"",S=sS[_],C=/[defgprs%]/.test(_);b=b===void 0?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function A(O){var F=E,k=w,M,$,T;if(_==="c")k=S(O)+k,O="";else{O=+O;var D=O<0||1/O<0;if(O=isNaN(O)?u:S(Math.abs(O),b),x&&(O=O8(O)),D&&+O==0&&g!=="+"&&(D=!1),F=(D?g==="("?g:s:g==="-"||g==="("?"":g)+F,k=(_==="s"?cS[8+YF/3]:"")+k+(D&&g==="("?")":""),C){for(M=-1,$=O.length;++M<$;)if(T=O.charCodeAt(M),48>T||T>57){k=(T===46?r+O.slice(M+1):O.slice(M))+k,O=O.slice(0,M);break}}}v&&!m&&(O=t(O,1/0));var R=F.length+O.length+k.length,L=R<y?new Array(y-R+1).join(d):"";switch(v&&m&&(O=t(L+O,L.length?y-k.length:1/0),L=""),h){case"<":O=F+O+k+L;break;case"=":O=F+L+O+k;break;case"^":O=L.slice(0,R=L.length>>1)+F+O+k+L.slice(R);break;default:O=L+F+O+k;break}return o(O)}return A.toString=function(){return f+""},A}function c(f,d){var h=l((f=ls(f),f.type="f",f)),g=Math.max(-8,Math.min(8,Math.floor(Cu(d)/3)))*3,p=Math.pow(10,-g),m=cS[8+g/3];return function(y){return h(p*y)+m}}return{format:l,formatPrefix:c}}var yd,Ap,tx;k8({thousands:",",grouping:[3],currency:["$",""]});function k8(e){return yd=XF(e),Ap=yd.format,tx=yd.formatPrefix,yd}function VF(e){return Math.max(0,-Cu(Math.abs(e)))}function KF(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Cu(t)/3)))*3-Cu(Math.abs(e)))}function JF(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Cu(t)-Cu(e))+1}const Em=new Date,Sm=new Date;function lt(e,t,n,i){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=o=>(e(o=new Date(+o)),o),r.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),r.round=o=>{const a=r(o),s=r.ceil(o);return o-a<s-o?a:s},r.offset=(o,a)=>(t(o=new Date(+o),a==null?1:Math.floor(a)),o),r.range=(o,a,s)=>{const u=[];if(o=r.ceil(o),s=s==null?1:Math.floor(s),!(o<a)||!(s>0))return u;let l;do u.push(l=new Date(+o)),t(o,s),e(o);while(l<o&&o<a);return u},r.filter=o=>lt(a=>{if(a>=a)for(;e(a),!o(a);)a.setTime(a-1)},(a,s)=>{if(a>=a)if(s<0)for(;++s<=0;)for(;t(a,-1),!o(a););else for(;--s>=0;)for(;t(a,1),!o(a););}),n&&(r.count=(o,a)=>(Em.setTime(+o),Sm.setTime(+a),e(Em),e(Sm),Math.floor(n(Em,Sm))),r.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(i?a=>i(a)%o===0:a=>r.count(0,a)%o===0):r)),r}const $u=lt(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);$u.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?lt(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):$u);$u.range;const Wr=1e3,Xn=Wr*60,Gr=Xn*60,io=Gr*24,nx=io*7,fS=io*30,Om=io*365,Hr=lt(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Wr)},(e,t)=>(t-e)/Wr,e=>e.getUTCSeconds());Hr.range;const kp=lt(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Wr)},(e,t)=>{e.setTime(+e+t*Xn)},(e,t)=>(t-e)/Xn,e=>e.getMinutes());kp.range;const Cp=lt(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Xn)},(e,t)=>(t-e)/Xn,e=>e.getUTCMinutes());Cp.range;const $p=lt(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Wr-e.getMinutes()*Xn)},(e,t)=>{e.setTime(+e+t*Gr)},(e,t)=>(t-e)/Gr,e=>e.getHours());$p.range;const Fp=lt(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Gr)},(e,t)=>(t-e)/Gr,e=>e.getUTCHours());Fp.range;const Zr=lt(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Xn)/io,e=>e.getDate()-1);Zr.range;const Io=lt(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/io,e=>e.getUTCDate()-1);Io.range;const QF=lt(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/io,e=>Math.floor(e/io));QF.range;function Ts(e){return lt(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Xn)/nx)}const dl=Ts(0),Lh=Ts(1),C8=Ts(2),$8=Ts(3),Fu=Ts(4),F8=Ts(5),T8=Ts(6);dl.range;Lh.range;C8.range;$8.range;Fu.range;F8.range;T8.range;function Ms(e){return lt(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/nx)}const hl=Ms(0),zh=Ms(1),M8=Ms(2),D8=Ms(3),Tu=Ms(4),N8=Ms(5),j8=Ms(6);hl.range;zh.range;M8.range;D8.range;Tu.range;N8.range;j8.range;const Hc=lt(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());Hc.range;const Yc=lt(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Yc.range;const cr=lt(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());cr.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:lt(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});cr.range;const fr=lt(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());fr.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:lt(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});fr.range;function ZF(e,t,n,i,r,o){const a=[[Hr,1,Wr],[Hr,5,5*Wr],[Hr,15,15*Wr],[Hr,30,30*Wr],[o,1,Xn],[o,5,5*Xn],[o,15,15*Xn],[o,30,30*Xn],[r,1,Gr],[r,3,3*Gr],[r,6,6*Gr],[r,12,12*Gr],[i,1,io],[i,2,2*io],[n,1,nx],[t,1,fS],[t,3,3*fS],[e,1,Om]];function s(l,c,f){const d=c<l;d&&([l,c]=[c,l]);const h=f&&typeof f.range=="function"?f:u(l,c,f),g=h?h.range(l,+c+1):[];return d?g.reverse():g}function u(l,c,f){const d=Math.abs(c-l)/f,h=Tf(([,,m])=>m).right(a,d);if(h===a.length)return e.every(Yo(l/Om,c/Om,f));if(h===0)return $u.every(Math.max(Yo(l,c,f),1));const[g,p]=a[d/a[h-1][2]<a[h][2]/d?h-1:h];return g.every(p)}return[s,u]}const[R8,P8]=ZF(fr,Yc,hl,QF,Fp,Cp),[I8,L8]=ZF(cr,Hc,dl,Zr,$p,kp),At="year",On="quarter",Bt="month",at="week",An="date",jt="day",dr="dayofyear",In="hours",Ln="minutes",ni="seconds",Di="milliseconds",ix=[At,On,Bt,at,An,jt,dr,In,Ln,ni,Di],Am=ix.reduce((e,t,n)=>(e[t]=1+n,e),{});function rx(e){const t=V(e).slice(),n={};return t.length||P("Missing time unit."),t.forEach(r=>{ee(Am,r)?n[r]=1:P("Invalid time unit: ".concat(r,"."))}),(n[at]||n[jt]?1:0)+(n[On]||n[Bt]||n[An]?1:0)+(n[dr]?1:0)>1&&P("Incompatible time units: ".concat(e)),t.sort((r,o)=>Am[r]-Am[o]),t}const z8={[At]:"%Y ",[On]:"Q%q ",[Bt]:"%b ",[An]:"%d ",[at]:"W%U ",[jt]:"%a ",[dr]:"%j ",[In]:"%H:00",[Ln]:"00:%M",[ni]:":%S",[Di]:".%L",["".concat(At,"-").concat(Bt)]:"%Y-%m ",["".concat(At,"-").concat(Bt,"-").concat(An)]:"%Y-%m-%d ",["".concat(In,"-").concat(Ln)]:"%H:%M"};function eT(e,t){const n=ce({},z8,t),i=rx(e),r=i.length;let o="",a=0,s,u;for(a=0;a<r;)for(s=i.length;s>a;--s)if(u=i.slice(a,s).join("-"),n[u]!=null){o+=n[u],a=s;break}return o.trim()}const Ia=new Date;function ox(e){return Ia.setFullYear(e),Ia.setMonth(0),Ia.setDate(1),Ia.setHours(0,0,0,0),Ia}function tT(e){return iT(new Date(e))}function nT(e){return ty(new Date(e))}function iT(e){return Zr.count(ox(e.getFullYear())-1,e)}function ty(e){return dl.count(ox(e.getFullYear())-1,e)}function ny(e){return ox(e).getDay()}function B8(e,t,n,i,r,o,a){if(0<=e&&e<100){const s=new Date(-1,t,n,i,r,o,a);return s.setFullYear(e),s}return new Date(e,t,n,i,r,o,a)}function rT(e){return aT(new Date(e))}function oT(e){return iy(new Date(e))}function aT(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Io.count(t-1,e)}function iy(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return hl.count(t-1,e)}function ry(e){return Ia.setTime(Date.UTC(e,0,1)),Ia.getUTCDay()}function U8(e,t,n,i,r,o,a){if(0<=e&&e<100){const s=new Date(Date.UTC(-1,t,n,i,r,o,a));return s.setUTCFullYear(n.y),s}return new Date(Date.UTC(e,t,n,i,r,o,a))}function sT(e,t,n,i,r){const o=t||1,a=ve(e),s=(y,v,b)=>(b=b||y,q8(n[b],i[b],y===a&&o,v)),u=new Date,l=Mi(e),c=l[At]?s(At):Gt(2012),f=l[Bt]?s(Bt):l[On]?s(On):ko,d=l[at]&&l[jt]?s(jt,1,at+jt):l[at]?s(at,1):l[jt]?s(jt,1):l[An]?s(An,1):l[dr]?s(dr,1):al,h=l[In]?s(In):ko,g=l[Ln]?s(Ln):ko,p=l[ni]?s(ni):ko,m=l[Di]?s(Di):ko;return function(y){u.setTime(+y);const v=c(u);return r(v,f(u),d(u,v),h(u),g(u),p(u),m(u))}}function q8(e,t,n,i){const r=n<=1?e:i?(o,a)=>i+n*Math.floor((e(o,a)-i)/n):(o,a)=>n*Math.floor(e(o,a)/n);return t?(o,a)=>t(r(o,a),a):r}function Mu(e,t,n){return t+e*7-(n+6)%7}const W8={[At]:e=>e.getFullYear(),[On]:e=>Math.floor(e.getMonth()/3),[Bt]:e=>e.getMonth(),[An]:e=>e.getDate(),[In]:e=>e.getHours(),[Ln]:e=>e.getMinutes(),[ni]:e=>e.getSeconds(),[Di]:e=>e.getMilliseconds(),[dr]:e=>iT(e),[at]:e=>ty(e),[at+jt]:(e,t)=>Mu(ty(e),e.getDay(),ny(t)),[jt]:(e,t)=>Mu(1,e.getDay(),ny(t))},G8={[On]:e=>3*e,[at]:(e,t)=>Mu(e,0,ny(t))};function uT(e,t){return sT(e,t||1,W8,G8,B8)}const H8={[At]:e=>e.getUTCFullYear(),[On]:e=>Math.floor(e.getUTCMonth()/3),[Bt]:e=>e.getUTCMonth(),[An]:e=>e.getUTCDate(),[In]:e=>e.getUTCHours(),[Ln]:e=>e.getUTCMinutes(),[ni]:e=>e.getUTCSeconds(),[Di]:e=>e.getUTCMilliseconds(),[dr]:e=>aT(e),[at]:e=>iy(e),[jt]:(e,t)=>Mu(1,e.getUTCDay(),ry(t)),[at+jt]:(e,t)=>Mu(iy(e),e.getUTCDay(),ry(t))},Y8={[On]:e=>3*e,[at]:(e,t)=>Mu(e,0,ry(t))};function lT(e,t){return sT(e,t||1,H8,Y8,U8)}const X8={[At]:cr,[On]:Hc.every(3),[Bt]:Hc,[at]:dl,[An]:Zr,[jt]:Zr,[dr]:Zr,[In]:$p,[Ln]:kp,[ni]:Hr,[Di]:$u},V8={[At]:fr,[On]:Yc.every(3),[Bt]:Yc,[at]:hl,[An]:Io,[jt]:Io,[dr]:Io,[In]:Fp,[Ln]:Cp,[ni]:Hr,[Di]:$u};function gl(e){return X8[e]}function pl(e){return V8[e]}function cT(e,t,n){return e?e.offset(t,n):void 0}function fT(e,t,n){return cT(gl(e),t,n)}function dT(e,t,n){return cT(pl(e),t,n)}function hT(e,t,n,i){return e?e.range(t,n,i):void 0}function gT(e,t,n,i){return hT(gl(e),t,n,i)}function pT(e,t,n,i){return hT(pl(e),t,n,i)}const ac=1e3,sc=ac*60,uc=sc*60,Tp=uc*24,K8=Tp*7,dS=Tp*30,oy=Tp*365,mT=[At,Bt,An,In,Ln,ni,Di],lc=mT.slice(0,-1),cc=lc.slice(0,-1),fc=cc.slice(0,-1),J8=fc.slice(0,-1),Q8=[At,at],hS=[At,Bt],yT=[At],jl=[[lc,1,ac],[lc,5,5*ac],[lc,15,15*ac],[lc,30,30*ac],[cc,1,sc],[cc,5,5*sc],[cc,15,15*sc],[cc,30,30*sc],[fc,1,uc],[fc,3,3*uc],[fc,6,6*uc],[fc,12,12*uc],[J8,1,Tp],[Q8,1,K8],[hS,1,dS],[hS,3,3*dS],[yT,1,oy]];function vT(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(Sf(t))/n;let r=Tf(s=>s[2]).right(jl,i),o,a;return r===jl.length?(o=yT,a=Yo(t[0]/oy,t[1]/oy,n)):r?(r=jl[i/jl[r-1][2]<jl[r][2]/i?r-1:r],o=r[0],a=r[1]):(o=mT,a=Math.max(Yo(t[0],t[1],n),1)),{units:o,step:a}}function km(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Cm(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Rl(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function bT(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,l=Pl(r),c=Il(r),f=Pl(o),d=Il(o),h=Pl(a),g=Il(a),p=Pl(s),m=Il(s),y=Pl(u),v=Il(u),b={a:D,A:R,b:L,B:J,c:null,d:bS,e:bS,f:wz,g:Tz,G:Dz,H:vz,I:bz,j:xz,L:xT,m:_z,M:Ez,p:ue,q:_e,Q:_S,s:ES,S:Sz,u:Oz,U:Az,V:kz,w:Cz,W:$z,x:null,X:null,y:Fz,Y:Mz,Z:Nz,"%":wS},x={a:Ee,A:Ye,b:pe,B:ft,c:null,d:xS,e:xS,f:Iz,g:Xz,G:Kz,H:jz,I:Rz,j:Pz,L:_T,m:Lz,M:zz,p:li,q:$t,Q:_S,s:ES,S:Bz,u:Uz,U:qz,V:Wz,w:Gz,W:Hz,x:null,X:null,y:Yz,Y:Vz,Z:Jz,"%":wS},_={a:A,A:O,b:F,B:k,c:M,d:yS,e:yS,f:gz,g:mS,G:pS,H:vS,I:vS,j:cz,L:hz,m:lz,M:fz,p:C,q:uz,Q:mz,s:yz,S:dz,u:iz,U:rz,V:oz,w:nz,W:az,x:$,X:T,y:mS,Y:pS,Z:sz,"%":pz};b.x=E(n,b),b.X=E(i,b),b.c=E(t,b),x.x=E(n,x),x.X=E(i,x),x.c=E(t,x);function E(X,ae){return function(de){var B=[],We=-1,we=0,Ze=X.length,Xe,qn,mo;for(de instanceof Date||(de=new Date(+de));++We<Ze;)X.charCodeAt(We)===37&&(B.push(X.slice(we,We)),(qn=gS[Xe=X.charAt(++We)])!=null?Xe=X.charAt(++We):qn=Xe==="e"?" ":"0",(mo=ae[Xe])&&(Xe=mo(de,qn)),B.push(Xe),we=We+1);return B.push(X.slice(we,We)),B.join("")}}function w(X,ae){return function(de){var B=Rl(1900,void 0,1),We=S(B,X,de+="",0),we,Ze;if(We!=de.length)return null;if("Q"in B)return new Date(B.Q);if("s"in B)return new Date(B.s*1e3+("L"in B?B.L:0));if(ae&&!("Z"in B)&&(B.Z=0),"p"in B&&(B.H=B.H%12+B.p*12),B.m===void 0&&(B.m="q"in B?B.q:0),"V"in B){if(B.V<1||B.V>53)return null;"w"in B||(B.w=1),"Z"in B?(we=Cm(Rl(B.y,0,1)),Ze=we.getUTCDay(),we=Ze>4||Ze===0?zh.ceil(we):zh(we),we=Io.offset(we,(B.V-1)*7),B.y=we.getUTCFullYear(),B.m=we.getUTCMonth(),B.d=we.getUTCDate()+(B.w+6)%7):(we=km(Rl(B.y,0,1)),Ze=we.getDay(),we=Ze>4||Ze===0?Lh.ceil(we):Lh(we),we=Zr.offset(we,(B.V-1)*7),B.y=we.getFullYear(),B.m=we.getMonth(),B.d=we.getDate()+(B.w+6)%7)}else("W"in B||"U"in B)&&("w"in B||(B.w="u"in B?B.u%7:"W"in B?1:0),Ze="Z"in B?Cm(Rl(B.y,0,1)).getUTCDay():km(Rl(B.y,0,1)).getDay(),B.m=0,B.d="W"in B?(B.w+6)%7+B.W*7-(Ze+5)%7:B.w+B.U*7-(Ze+6)%7);return"Z"in B?(B.H+=B.Z/100|0,B.M+=B.Z%100,Cm(B)):km(B)}}function S(X,ae,de,B){for(var We=0,we=ae.length,Ze=de.length,Xe,qn;We<we;){if(B>=Ze)return-1;if(Xe=ae.charCodeAt(We++),Xe===37){if(Xe=ae.charAt(We++),qn=_[Xe in gS?ae.charAt(We++):Xe],!qn||(B=qn(X,de,B))<0)return-1}else if(Xe!=de.charCodeAt(B++))return-1}return B}function C(X,ae,de){var B=l.exec(ae.slice(de));return B?(X.p=c.get(B[0].toLowerCase()),de+B[0].length):-1}function A(X,ae,de){var B=h.exec(ae.slice(de));return B?(X.w=g.get(B[0].toLowerCase()),de+B[0].length):-1}function O(X,ae,de){var B=f.exec(ae.slice(de));return B?(X.w=d.get(B[0].toLowerCase()),de+B[0].length):-1}function F(X,ae,de){var B=y.exec(ae.slice(de));return B?(X.m=v.get(B[0].toLowerCase()),de+B[0].length):-1}function k(X,ae,de){var B=p.exec(ae.slice(de));return B?(X.m=m.get(B[0].toLowerCase()),de+B[0].length):-1}function M(X,ae,de){return S(X,t,ae,de)}function $(X,ae,de){return S(X,n,ae,de)}function T(X,ae,de){return S(X,i,ae,de)}function D(X){return a[X.getDay()]}function R(X){return o[X.getDay()]}function L(X){return u[X.getMonth()]}function J(X){return s[X.getMonth()]}function ue(X){return r[+(X.getHours()>=12)]}function _e(X){return 1+~~(X.getMonth()/3)}function Ee(X){return a[X.getUTCDay()]}function Ye(X){return o[X.getUTCDay()]}function pe(X){return u[X.getUTCMonth()]}function ft(X){return s[X.getUTCMonth()]}function li(X){return r[+(X.getUTCHours()>=12)]}function $t(X){return 1+~~(X.getUTCMonth()/3)}return{format:function(X){var ae=E(X+="",b);return ae.toString=function(){return X},ae},parse:function(X){var ae=w(X+="",!1);return ae.toString=function(){return X},ae},utcFormat:function(X){var ae=E(X+="",x);return ae.toString=function(){return X},ae},utcParse:function(X){var ae=w(X+="",!0);return ae.toString=function(){return X},ae}}}var gS={"-":"",_:" ",0:"0"},_t=/^\s*\d+/,Z8=/^%/,ez=/[\\^$*+?|[\]().{}]/g;function Oe(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",o=r.length;return i+(o<n?new Array(n-o+1).join(t)+r:r)}function tz(e){return e.replace(ez,"\\$&")}function Pl(e){return new RegExp("^(?:"+e.map(tz).join("|")+")","i")}function Il(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function nz(e,t,n){var i=_t.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function iz(e,t,n){var i=_t.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function rz(e,t,n){var i=_t.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function oz(e,t,n){var i=_t.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function az(e,t,n){var i=_t.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function pS(e,t,n){var i=_t.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function mS(e,t,n){var i=_t.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function sz(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function uz(e,t,n){var i=_t.exec(t.slice(n,n+1));return i?(e.q=i[0]*3-3,n+i[0].length):-1}function lz(e,t,n){var i=_t.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function yS(e,t,n){var i=_t.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function cz(e,t,n){var i=_t.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function vS(e,t,n){var i=_t.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function fz(e,t,n){var i=_t.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function dz(e,t,n){var i=_t.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function hz(e,t,n){var i=_t.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function gz(e,t,n){var i=_t.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function pz(e,t,n){var i=Z8.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function mz(e,t,n){var i=_t.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function yz(e,t,n){var i=_t.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function bS(e,t){return Oe(e.getDate(),t,2)}function vz(e,t){return Oe(e.getHours(),t,2)}function bz(e,t){return Oe(e.getHours()%12||12,t,2)}function xz(e,t){return Oe(1+Zr.count(cr(e),e),t,3)}function xT(e,t){return Oe(e.getMilliseconds(),t,3)}function wz(e,t){return xT(e,t)+"000"}function _z(e,t){return Oe(e.getMonth()+1,t,2)}function Ez(e,t){return Oe(e.getMinutes(),t,2)}function Sz(e,t){return Oe(e.getSeconds(),t,2)}function Oz(e){var t=e.getDay();return t===0?7:t}function Az(e,t){return Oe(dl.count(cr(e)-1,e),t,2)}function wT(e){var t=e.getDay();return t>=4||t===0?Fu(e):Fu.ceil(e)}function kz(e,t){return e=wT(e),Oe(Fu.count(cr(e),e)+(cr(e).getDay()===4),t,2)}function Cz(e){return e.getDay()}function $z(e,t){return Oe(Lh.count(cr(e)-1,e),t,2)}function Fz(e,t){return Oe(e.getFullYear()%100,t,2)}function Tz(e,t){return e=wT(e),Oe(e.getFullYear()%100,t,2)}function Mz(e,t){return Oe(e.getFullYear()%1e4,t,4)}function Dz(e,t){var n=e.getDay();return e=n>=4||n===0?Fu(e):Fu.ceil(e),Oe(e.getFullYear()%1e4,t,4)}function Nz(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Oe(t/60|0,"0",2)+Oe(t%60,"0",2)}function xS(e,t){return Oe(e.getUTCDate(),t,2)}function jz(e,t){return Oe(e.getUTCHours(),t,2)}function Rz(e,t){return Oe(e.getUTCHours()%12||12,t,2)}function Pz(e,t){return Oe(1+Io.count(fr(e),e),t,3)}function _T(e,t){return Oe(e.getUTCMilliseconds(),t,3)}function Iz(e,t){return _T(e,t)+"000"}function Lz(e,t){return Oe(e.getUTCMonth()+1,t,2)}function zz(e,t){return Oe(e.getUTCMinutes(),t,2)}function Bz(e,t){return Oe(e.getUTCSeconds(),t,2)}function Uz(e){var t=e.getUTCDay();return t===0?7:t}function qz(e,t){return Oe(hl.count(fr(e)-1,e),t,2)}function ET(e){var t=e.getUTCDay();return t>=4||t===0?Tu(e):Tu.ceil(e)}function Wz(e,t){return e=ET(e),Oe(Tu.count(fr(e),e)+(fr(e).getUTCDay()===4),t,2)}function Gz(e){return e.getUTCDay()}function Hz(e,t){return Oe(zh.count(fr(e)-1,e),t,2)}function Yz(e,t){return Oe(e.getUTCFullYear()%100,t,2)}function Xz(e,t){return e=ET(e),Oe(e.getUTCFullYear()%100,t,2)}function Vz(e,t){return Oe(e.getUTCFullYear()%1e4,t,4)}function Kz(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Tu(e):Tu.ceil(e),Oe(e.getUTCFullYear()%1e4,t,4)}function Jz(){return"+0000"}function wS(){return"%"}function _S(e){return+e}function ES(e){return Math.floor(+e/1e3)}var Gs,ax,ST,sx,OT;Qz({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Qz(e){return Gs=bT(e),ax=Gs.format,ST=Gs.parse,sx=Gs.utcFormat,OT=Gs.utcParse,Gs}function dc(e){const t={};return n=>t[n]||(t[n]=e(n))}function Zz(e,t){return n=>{const i=e(n),r=i.indexOf(t);if(r<0)return i;let o=e9(i,r);const a=o<i.length?i.slice(o):"";for(;--o>r;)if(i[o]!=="0"){++o;break}return i.slice(0,o)+a}}function e9(e,t){let n=e.lastIndexOf("e"),i;if(n>0)return n;for(n=e.length;--n>t;)if(i=e.charCodeAt(n),i>=48&&i<=57)return n+1}function AT(e){const t=dc(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(i){const r=ls(i||",");if(r.precision==null){switch(r.precision=12,r.type){case"%":r.precision-=2;break;case"e":r.precision-=1;break}return Zz(t(r),t(".1f")(1)[1])}else return t(r)},formatSpan(i,r,o,a){a=ls(a==null?",f":a);const s=Yo(i,r,o),u=Math.max(Math.abs(i),Math.abs(r));let l;if(a.precision==null)switch(a.type){case"s":return isNaN(l=KF(s,u))||(a.precision=l),n(a,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=JF(s,u))||(a.precision=l-(a.type==="e"));break}case"f":case"%":{isNaN(l=VF(s))||(a.precision=l-(a.type==="%")*2);break}}return t(a)}}}let ay;kT();function kT(){return ay=AT({format:Ap,formatPrefix:tx})}function CT(e){return AT(XF(e))}function Bh(e){return arguments.length?ay=CT(e):ay}function SS(e,t,n){n=n||{},K(n)||P("Invalid time multi-format specifier: ".concat(n));const i=t(ni),r=t(Ln),o=t(In),a=t(An),s=t(at),u=t(Bt),l=t(On),c=t(At),f=e(n[Di]||".%L"),d=e(n[ni]||":%S"),h=e(n[Ln]||"%I:%M"),g=e(n[In]||"%I %p"),p=e(n[An]||n[jt]||"%a %d"),m=e(n[at]||"%b %d"),y=e(n[Bt]||"%B"),v=e(n[On]||"%B"),b=e(n[At]||"%Y");return x=>(i(x)<x?f:r(x)<x?d:o(x)<x?h:a(x)<x?g:u(x)<x?s(x)<x?p:m:c(x)<x?l(x)<x?y:v:b)(x)}function $T(e){const t=dc(e.format),n=dc(e.utcFormat);return{timeFormat:i=>Y(i)?t(i):SS(t,gl,i),utcFormat:i=>Y(i)?n(i):SS(n,pl,i),timeParse:dc(e.parse),utcParse:dc(e.utcParse)}}let sy;FT();function FT(){return sy=$T({format:ax,parse:ST,utcFormat:sx,utcParse:OT})}function TT(e){return $T(bT(e))}function Xc(e){return arguments.length?sy=TT(e):sy}const uy=(e,t)=>ce({},e,t);function MT(e,t){const n=e?CT(e):Bh(),i=t?TT(t):Xc();return uy(n,i)}function ux(e,t){const n=arguments.length;return n&&n!==2&&P("defaultLocale expects either zero or two arguments."),n?uy(Bh(e),Xc(t)):uy(Bh(),Xc())}function t9(){return kT(),FT(),ux()}const n9=/^(data:|([A-Za-z]+:)?\/\/)/,i9=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,r9=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,OS="file://";function o9(e,t){return n=>({options:n||{},sanitize:s9,load:a9,fileAccess:!!t,file:u9(t),http:c9(e)})}async function a9(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function s9(e,t){t=ce({},this.options,t);const n=this.fileAccess,i={href:null};let r,o,a;const s=i9.test(e.replace(r9,""));(e==null||typeof e!="string"||!s)&&P("Sanitize failure, invalid URI: "+G(e));const u=n9.test(e);return(a=t.baseURL)&&!u&&(!e.startsWith("/")&&!a.endsWith("/")&&(e="/"+e),e=a+e),o=(r=e.startsWith(OS))||t.mode==="file"||t.mode!=="http"&&!u&&n,r?e=e.slice(OS.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),o=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!o}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i}function u9(e){return e?t=>new Promise((n,i)=>{e.readFile(t,(r,o)=>{r?i(r):n(o)})}):l9}async function l9(){P("No file system access.")}function c9(e){return e?async function(t,n){const i=ce({},this.options.http,n),r=n&&n.response,o=await e(t,i);return o.ok?fe(o[r])?o[r]():o.text():P(o.status+""+o.statusText)}:f9}async function f9(){P("No HTTP fetch method available.")}const d9=e=>e!=null&&e===e,h9=e=>e==="true"||e==="false"||e===!0||e===!1,g9=e=>!Number.isNaN(Date.parse(e)),DT=e=>!Number.isNaN(+e)&&!(e instanceof Date),p9=e=>DT(e)&&Number.isInteger(+e),ly={boolean:xb,integer:Rt,number:Rt,date:wb,string:_b,unknown:Wt},vd=[h9,p9,DT,g9],m9=["boolean","integer","number","date"];function NT(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=vd.length,r=vd.map((o,a)=>a+1);for(let o=0,a=0,s,u;o<n;++o)for(u=t?e[o][t]:e[o],s=0;s<i;++s)if(r[s]&&d9(u)&&!vd[s](u)&&(r[s]=0,++a,a===vd.length))return"string";return m9[r.reduce((o,a)=>o===0?a:o,0)-1]}function jT(e,t){return t.reduce((n,i)=>(n[i]=NT(e,i),n),{})}function AS(e){const t=function(n,i){const r={delimiter:e};return lx(n,i?ce(i,r):r)};return t.responseType="text",t}function lx(e,t){return t.header&&(e=t.header.map(G).join(t.delimiter)+`
`+e),Z4(t.delimiter).parse(e+"")}lx.responseType="text";function y9(e){return typeof Buffer=="function"&&fe(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function cx(e,t){const n=t&&t.property?wn(t.property):Wt;return K(e)&&!y9(e)?v9(n(e),t):n(JSON.parse(e))}cx.responseType="json";function v9(e,t){return!I(e)&&P$(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const b9={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function RT(e,t){let n,i,r,o;return e=cx(e,t),t&&t.feature?(n=i8,r=t.feature):t&&t.mesh?(n=o8,r=t.mesh,o=b9[t.filter]):P("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,o):P("Invalid TopoJSON object: "+r),i&&i.features||[i]}RT.responseType="json";const ah={dsv:lx,csv:AS(","),tsv:AS("	"),json:cx,topojson:RT};function fx(e,t){return arguments.length>1?(ah[e]=t,this):ee(ah,e)?ah[e]:null}function PT(e){const t=fx(e);return t&&t.responseType||"text"}function IT(e,t,n,i){t=t||{};const r=fx(t.type||"json");return r||P("Unknown data format type: "+t.type),e=r(e,t),t.parse&&x9(e,t.parse,n,i),ee(e,"columns")&&delete e.columns,e}function x9(e,t,n,i){if(!e.length)return;const r=Xc();n=n||r.timeParse,i=i||r.utcParse;let o=e.columns||Object.keys(e[0]),a,s,u,l,c,f;t==="auto"&&(t=jT(e,o)),o=Object.keys(t);const d=o.map(h=>{const g=t[h];let p,m;if(g&&(g.startsWith("date:")||g.startsWith("utc:")))return p=g.split(/:(.+)?/,2),m=p[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(p[0]==="utc"?i:n)(m);if(!ly[g])throw Error("Illegal format pattern: "+h+":"+g);return ly[g]});for(u=0,c=e.length,f=o.length;u<c;++u)for(a=e[u],l=0;l<f;++l)s=o[l],a[s]=d[l](a[s])}const Mp=o9(typeof fetch!="undefined"&&fetch,null);function Dp(e){const t=e||Wt,n=[],i={};return n.add=r=>{const o=t(r);return i[o]||(i[o]=1,n.push(r)),n},n.remove=r=>{const o=t(r);if(i[o]){i[o]=0;const a=n.indexOf(r);a>=0&&n.splice(a,1)}return n},n}async function sh(e,t){try{await t(e)}catch(n){e.error(n)}}const LT=Symbol("vega_id");let w9=1;function Np(e){return!!(e&&ne(e))}function ne(e){return e[LT]}function zT(e,t){return e[LT]=t,e}function Ce(e){const t=e===Object(e)?e:{data:e};return ne(t)?t:zT(t,w9++)}function dx(e){return jp(e,Ce({}))}function jp(e,t){for(const n in e)t[n]=e[n];return t}function BT(e,t){return zT(t,ne(e))}function Ds(e,t){return e?t?(n,i)=>e(n,i)||ne(t(n))-ne(t(i)):(n,i)=>e(n,i)||ne(n)-ne(i):null}function UT(e){return e&&e.constructor===Ns}function Ns(){const e=[],t=[],n=[],i=[],r=[];let o=null,a=!1;return{constructor:Ns,insert(s){const u=V(s),l=u.length;for(let c=0;c<l;++c)e.push(u[c]);return this},remove(s){const u=fe(s)?i:t,l=V(s),c=l.length;for(let f=0;f<c;++f)u.push(l[f]);return this},modify(s,u,l){const c={field:u,value:Gt(l)};return fe(s)?(c.filter=s,r.push(c)):(c.tuple=s,n.push(c)),this},encode(s,u){return fe(s)?r.push({filter:s,field:u}):n.push({tuple:s,field:u}),this},clean(s){return o=s,this},reflow(){return a=!0,this},pulse(s,u){const l={},c={};let f,d,h,g,p,m;for(f=0,d=u.length;f<d;++f)l[ne(u[f])]=1;for(f=0,d=t.length;f<d;++f)p=t[f],l[ne(p)]=-1;for(f=0,d=i.length;f<d;++f)g=i[f],u.forEach(v=>{g(v)&&(l[ne(v)]=-1)});for(f=0,d=e.length;f<d;++f)p=e[f],m=ne(p),l[m]?l[m]=1:s.add.push(Ce(e[f]));for(f=0,d=u.length;f<d;++f)p=u[f],l[ne(p)]<0&&s.rem.push(p);function y(v,b,x){x?v[b]=x(v):s.encode=b,a||(c[ne(v)]=v)}for(f=0,d=n.length;f<d;++f)h=n[f],p=h.tuple,g=h.field,m=l[ne(p)],m>0&&(y(p,g,h.value),s.modifies(g));for(f=0,d=r.length;f<d;++f)h=r[f],g=h.filter,u.forEach(v=>{g(v)&&l[ne(v)]>0&&y(v,h.field,h.value)}),s.modifies(h.field);if(a)s.mod=t.length||i.length?u.filter(v=>l[ne(v)]>0):u.slice();else for(m in c)s.mod.push(c[m]);return(o||o==null&&(t.length||i.length))&&s.clean(!0),s}}}const uh="_:mod:_";function Rp(){Object.defineProperty(this,uh,{writable:!0,value:{}})}Rp.prototype={set(e,t,n,i){const r=this,o=r[e],a=r[uh];return t!=null&&t>=0?(o[t]!==n||i)&&(o[t]=n,a[t+":"+e]=-1,a[e]=-1):(o!==n||i)&&(r[e]=n,a[e]=I(n)?1+n.length:-1),r},modified(e,t){const n=this[uh];if(arguments.length){if(I(e)){for(let i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}}else{for(const i in n)if(n[i])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[uh]={},this}};let _9=0;const E9="pulse",S9=new Rp,O9=1,A9=2;function Re(e,t,n,i){this.id=++_9,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}function kS(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Re.prototype={targets(){return this._targets||(this._targets=Dp(Ef))},set(e){return this.value!==e?(this.value=e,1):0},skip:kS(O9),modified:kS(A9),parameters(e,t,n){t=t!==!1;const i=this._argval=this._argval||new Rp,r=this._argops=this._argops||[],o=[];let a,s,u,l;const c=(f,d,h)=>{h instanceof Re?(h!==this&&(t&&h.targets().add(this),o.push(h)),r.push({op:h,name:f,index:d})):i.set(f,d,h)};for(a in e)if(s=e[a],a===E9)V(s).forEach(f=>{f instanceof Re?f!==this&&(f.targets().add(this),o.push(f)):P("Pulse parameters must be operator instances.")}),this.source=s;else if(I(s))for(i.set(a,-1,Array(u=s.length)),l=0;l<u;++l)c(a,l,s[l]);else c(a,-1,s);return this.marshall().clear(),n&&(r.initonly=!0),o},marshall(e){const t=this._argval||S9,n=this._argops;let i,r,o,a;if(n){const s=n.length;for(r=0;r<s;++r)i=n[r],o=i.op,a=o.modified()&&o.stamp===e,t.set(i.name,i.index,o.value,a);if(n.initonly){for(r=0;r<s;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};function k9(e,t,n,i){let r=1,o;return e instanceof Re?o=e:e&&e.prototype instanceof Re?o=new e:fe(e)?o=new Re(null,e):(r=0,o=new Re(e,t)),this.rank(o),r&&(i=n,n=t),n&&this.connect(o,o.parameters(n,i)),this.touch(o),o}function C9(e,t){const n=e.rank,i=t.length;for(let r=0;r<i;++r)if(n<t[r].rank){this.rerank(e);return}}let $9=0;function Pp(e,t,n){this.id=++$9,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function xo(e,t,n){return new Pp(e,t,n)}Pp.prototype={_filter:Zn,_apply:Wt,targets(){return this._targets||(this._targets=Dp(Ef))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,i=n?n.length:0;for(let r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=xo(e);return this.targets().add(t),t},apply(e){const t=xo(null,e);return this.targets().add(t),t},merge(){const e=xo();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=xo();return this.targets().add(xo(null,null,vb(e,n=>{const i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},between(e,t){let n=!1;return e.targets().add(xo(null,null,()=>n=!0)),t.targets().add(xo(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=Zn,this._targets=null}};function F9(e,t,n,i){const r=this,o=xo(n,i),a=function(l){l.dataflow=r;try{o.receive(l)}catch(c){r.error(c)}finally{r.run()}};let s;typeof e=="string"&&typeof document!="undefined"?s=document.querySelectorAll(e):s=V(e);const u=s.length;for(let l=0;l<u;++l)s[l].addEventListener(t,a);return o}function T9(e,t){const n=this.locale();return IT(e,t,n.timeParse,n.utcParse)}function M9(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function D9(e,t){const n=this;let i=0,r;try{r=await n.loader().load(e,{context:"dataflow",response:PT(t&&t.type)});try{r=n.parse(r,t)}catch(o){i=-2,n.warn("Data ingestion failed",e,o)}}catch(o){i=-1,n.warn("Loading failed",e,o)}return{data:r,status:i}}async function N9(e,t,n){const i=this,r=i._pending||j9(i);r.requests+=1;const o=await i.request(t,n);return i.pulse(e,i.changeset().remove(Zn).insert(o.data||[])),r.done(),o}function j9(e){let t;const n=new Promise(i=>t=i);return n.requests=0,n.done=()=>{--n.requests===0&&(e._pending=null,t(e))},e._pending=n}const R9={skip:!0};function P9(e,t,n,i,r){return(e instanceof Re?L9:I9)(this,e,t,n,i,r),this}function I9(e,t,n,i,r,o){const a=ce({},o,R9);let s,u;fe(n)||(n=Gt(n)),i===void 0?s=l=>e.touch(n(l)):fe(i)?(u=new Re(null,i,r,!1),s=l=>{u.evaluate(l);const c=n(l),f=u.value;UT(f)?e.pulse(c,f,o):e.update(c,f,a)}):s=l=>e.update(n(l),i,a),t.apply(s)}function L9(e,t,n,i,r,o){if(i===void 0)t.targets().add(n);else{const a=o||{},s=new Re(null,z9(n,i),r,!1);s.modified(a.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}function z9(e,t){return t=fe(t)?t:Gt(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}function B9(e){e.rank=++this._rank}function U9(e){const t=[e];let n,i,r;for(;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&P("Cycle detected in dataflow graph.")}const Uh={},Hi=1<<0,So=1<<1,Pr=1<<2,q9=Hi|So,CS=Hi|Pr,Hs=Hi|So|Pr,$S=1<<3,Ll=1<<4,FS=1<<5,TS=1<<6;function Lo(e,t,n){this.dataflow=e,this.stamp=t==null?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function $m(e,t){const n=[];return _o(e,t,i=>n.push(i)),n}function MS(e,t){const n={};return e.visit(t,i=>{n[ne(i)]=1}),i=>n[ne(i)]?null:i}function bd(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}Lo.prototype={StopPropagation:Uh,ADD:Hi,REM:So,MOD:Pr,ADD_REM:q9,ADD_MOD:CS,ALL:Hs,REFLOW:$S,SOURCE:Ll,NO_SOURCE:FS,NO_FIELDS:TS,fork(e){return new Lo(this.dataflow).init(this,e)},clone(){const e=this.fork(Hs);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(Hs|Ll)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new Lo(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&TS)&&(n.fields=e.fields),t&Hi?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&So?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&Pr?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&FS?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||Hs;return t&Hi&&this.add.length||t&So&&this.rem.length||t&Pr&&this.mod.length},reflow(e){if(e)return this.fork(Hs).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(Pr,MS(this,Hi))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return I(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return(t||this.mod.length)&&n?arguments.length?I(e)?e.some(i=>n[i]):n[e]:!!n:!1},filter(e,t){const n=this;return e&Hi&&(n.addF=bd(n.addF,t)),e&So&&(n.remF=bd(n.remF,t)),e&Pr&&(n.modF=bd(n.modF,t)),e&Ll&&(n.srcF=bd(n.srcF,t)),n},materialize(e){e=e||Hs;const t=this;return e&Hi&&t.addF&&(t.add=$m(t.add,t.addF),t.addF=null),e&So&&t.remF&&(t.rem=$m(t.rem,t.remF),t.remF=null),e&Pr&&t.modF&&(t.mod=$m(t.mod,t.modF),t.modF=null),e&Ll&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,i=t;if(e&Ll)return _o(n.source,n.srcF,i),n;e&Hi&&_o(n.add,n.addF,i),e&So&&_o(n.rem,n.remF,i),e&Pr&&_o(n.mod,n.modF,i);const r=n.source;if(e&$S&&r){const o=n.add.length+n.mod.length;o===r.length||(o?_o(r,MS(n,CS),i):_o(r,n.srcF,i))}return n}};function hx(e,t,n,i){const r=this,o=n.length;let a=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n;for(let s=0;s<o;++s){const u=n[s];if(u.stamp===t){if(u.fields){const l=r.fields||(r.fields={});for(const c in u.fields)l[c]=1}u.changed(r.ADD)&&(a|=r.ADD),u.changed(r.REM)&&(a|=r.REM),u.changed(r.MOD)&&(a|=r.MOD)}}this.changes=a}W(hx,Lo,{fork(e){const t=new Lo(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?I(e)?e.some(i=>n[i]):n[e]:0},filter(){P("MultiPulse does not support filtering.")},materialize(){P("MultiPulse does not support materialization.")},visit(e,t){const n=this,i=n.pulses,r=i.length;let o=0;if(e&n.SOURCE)for(;o<r;++o)i[o].visit(e,t);else for(;o<r;++o)i[o].stamp===n.stamp&&i[o].visit(e,t);return n}});async function W9(e,t,n){const i=this,r=[];if(i._pulse)return qT(i);if(i._pending&&await i._pending,t&&await sh(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const o=++i._clock;i._pulse=new Lo(i,o,e),i._touched.forEach(c=>i._enqueue(c,!0)),i._touched=Dp(Ef);let a=0,s,u,l;try{for(;i._heap.size()>0;){if(s=i._heap.pop(),s.rank!==s.qrank){i._enqueue(s,!0);continue}u=s.run(i._getPulse(s,e)),u.then?u=await u:u.async&&(r.push(u.async),u=Uh),u!==Uh&&s._targets&&s._targets.forEach(c=>i._enqueue(c)),++a}}catch(c){i._heap.clear(),l=c}if(i._input={},i._pulse=null,i.debug(`Pulse ${o}: ${a} operators`),l&&(i._postrun=[],i.error(l)),i._postrun.length){const c=i._postrun.sort((f,d)=>d.priority-f.priority);i._postrun=[];for(let f=0;f<c.length;++f)await sh(i,c[f].callback)}return n&&await sh(i,n),r.length&&Promise.all(r).then(c=>i.runAsync(null,()=>{c.forEach(f=>{try{f(i)}catch(d){i.error(d)}})})),i}async function G9(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}function H9(e,t,n){return this._pulse?qT(this):(this.evaluate(e,t,n),this)}function Y9(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}}function qT(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function X9(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function V9(e,t){const n=e.source,i=this._clock;return n&&I(n)?new hx(this,i,n.map(r=>r.pulse),t):this._input[e.id]||K9(this._pulse,n&&n.pulse)}function K9(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==Uh&&(e.source=t.source),e)}const gx={skip:!1,force:!1};function J9(e,t){const n=t||gx;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function Q9(e,t,n){const i=n||gx;return(e.set(t)||i.force)&&this.touch(e,i),this}function Z9(e,t,n){this.touch(e,n||gx);const i=new Lo(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this}function e7(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),WT(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let i;return t.length?(i=t[0],t[0]=n,t7(t,0,e)):i=n,i}}}function WT(e,t,n,i){let r,o;const a=e[n];for(;n>t;){if(o=n-1>>1,r=e[o],i(a,r)<0){e[n]=r,n=o;continue}break}return e[n]=a}function t7(e,t,n){const i=t,r=e.length,o=e[t];let a=(t<<1)+1,s;for(;a<r;)s=a+1,s<r&&n(e[a],e[s])>=0&&(a=s),e[t]=e[a],t=a,a=(t<<1)+1;return e[t]=o,WT(e,i,t,n)}function mu(){this.logger(hb()),this.logLevel(fb),this._clock=0,this._rank=0,this._locale=ux();try{this._loader=Mp()}catch{}this._touched=Dp(Ef),this._input={},this._pulse=null,this._heap=e7((e,t)=>e.qrank-t.qrank),this._postrun=[]}function zl(e){return function(){return this._log[e].apply(this,arguments)}}mu.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:zl("error"),warn:zl("warn"),info:zl("info"),debug:zl("debug"),logLevel:zl("level"),cleanThreshold:1e4,add:k9,connect:C9,rank:B9,rerank:U9,pulse:Z9,touch:J9,update:Q9,changeset:Ns,ingest:M9,parse:T9,preload:N9,request:D9,events:F9,on:P9,evaluate:W9,run:H9,runAsync:G9,runAfter:Y9,_enqueue:X9,_getPulse:V9};function N(e,t){Re.call(this,e,null,t)}W(N,Re,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const Du={};function GT(e){const t=HT(e);return t&&t.Definition||null}function HT(e){return e=e&&e.toLowerCase(),ee(Du,e)?Du[e]:null}function*YT(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)i=t(i,++n,e),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function px(e,t,n){const i=Float64Array.from(YT(e,n));return i.sort(Qr),t.map(r=>qF(i,r))}function mx(e,t){return px(e,[.25,.5,.75],t)}function yx(e,t){const n=e.length,i=h8(e,t),r=mx(e,t),o=(r[2]-r[0])/1.34,a=Math.min(i,o)||i||Math.abs(r[0])||1;return 1.06*a*Math.pow(n,-.2)}function XT(e){const t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2];let o=e.extent[0],a=e.extent[1],s,u,l,c,f,d;const h=e.span||a-o||Math.abs(o)||1;if(e.step)s=e.step;else if(e.steps){for(c=h/t,f=0,d=e.steps.length;f<d&&e.steps[f]<c;++f);s=e.steps[Math.max(0,f-1)]}else{for(u=Math.ceil(Math.log(t)/i),l=e.minstep||0,s=Math.max(l,Math.pow(n,Math.round(Math.log(h)/i)-u));Math.ceil(h/s)>t;)s*=n;for(f=0,d=r.length;f<d;++f)c=s/r[f],c>=l&&h/c<=t&&(s=c)}c=Math.log(s);const g=c>=0?0:~~(-c/i)+1,p=Math.pow(n,-g-1);return(e.nice||e.nice===void 0)&&(c=Math.floor(o/s+p)*s,o=o<c?c-s:c,a=Math.ceil(a/s)*s),{start:o,stop:a===o?o+s:a,step:s}}var ii=Math.random;function n7(e){ii=e}function VT(e,t,n,i){if(!e.length)return[void 0,void 0];const r=Float64Array.from(YT(e,i)),o=r.length,a=t;let s,u,l,c;for(l=0,c=Array(a);l<a;++l){for(s=0,u=0;u<o;++u)s+=r[~~(ii()*o)];c[l]=s/o}return c.sort(Qr),[ey(c,n/2),ey(c,1-n/2)]}function KT(e,t,n,i){i=i||(d=>d);const r=e.length,o=new Float64Array(r);let a=0,s=1,u=i(e[0]),l=u,c=u+t,f;for(;s<r;++s){if(f=i(e[s]),f>=c){for(l=(u+l)/2;a<s;++a)o[a]=l;c=f+t,u=f}l=f}for(l=(u+l)/2;a<s;++a)o[a]=l;return n?i7(o,t+t/4):o}function i7(e,t){const n=e.length;let i=0,r=1,o,a;for(;e[i]===e[r];)++r;for(;r<n;){for(o=r+1;e[r]===e[o];)++o;if(e[r]-e[r-1]<t){for(a=r+(i+o-r-r>>1);a<r;)e[a++]=e[r];for(;a>r;)e[a--]=e[i]}i=r,r=o}return e}function r7(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function o7(e,t){t==null&&(t=e,e=0);let n,i,r;const o={min(a){return arguments.length?(n=a||0,r=i-n,o):n},max(a){return arguments.length?(i=a||0,r=i-n,o):i},sample(){return n+Math.floor(r*ii())},pdf(a){return a===Math.floor(a)&&a>=n&&a<i?1/r:0},cdf(a){const s=Math.floor(a);return s<n?0:s>=i?1:(s-n+1)/r},icdf(a){return a>=0&&a<=1?n-1+Math.floor(a*r):NaN}};return o.min(e).max(t)}const JT=Math.sqrt(2*Math.PI),a7=Math.SQRT2;let Bl=NaN;function Ip(e,t){e=e||0,t=t==null?1:t;let n=0,i=0,r,o;if(Bl===Bl)n=Bl,Bl=NaN;else{do n=ii()*2-1,i=ii()*2-1,r=n*n+i*i;while(r===0||r>1);o=Math.sqrt(-2*Math.log(r)/r),n*=o,Bl=i*o}return e+n*t}function vx(e,t,n){n=n==null?1:n;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*JT)}function Lp(e,t,n){t=t||0,n=n==null?1:n;const i=(e-t)/n,r=Math.abs(i);let o;if(r>37)o=0;else{const a=Math.exp(-r*r/2);let s;r<7.07106781186547?(s=.0352624965998911*r+.700383064443688,s=s*r+6.37396220353165,s=s*r+33.912866078383,s=s*r+112.079291497871,s=s*r+221.213596169931,s=s*r+220.206867912376,o=a*s,s=.0883883476483184*r+1.75566716318264,s=s*r+16.064177579207,s=s*r+86.7807322029461,s=s*r+296.564248779674,s=s*r+637.333633378831,s=s*r+793.826512519948,s=s*r+440.413735824752,o=o/s):(s=r+.65,s=r+4/s,s=r+3/s,s=r+2/s,s=r+1/s,o=a/s/2.506628274631)}return i>0?1-o:o}function zp(e,t,n){return e<0||e>1?NaN:(t||0)+(n==null?1:n)*a7*s7(2*e-1)}function s7(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=1/0,n*e}function bx(e,t){let n,i;const r={mean(o){return arguments.length?(n=o||0,r):n},stdev(o){return arguments.length?(i=o==null?1:o,r):i},sample:()=>Ip(n,i),pdf:o=>vx(o,n,i),cdf:o=>Lp(o,n,i),icdf:o=>zp(o,n,i)};return r.mean(e).stdev(t)}function xx(e,t){const n=bx();let i=0;const r={data(o){return arguments.length?(e=o,i=o?o.length:0,r.bandwidth(t)):e},bandwidth(o){return arguments.length?(t=o,!t&&e&&(t=yx(e)),r):t},sample(){return e[~~(ii()*i)]+t*n.sample()},pdf(o){let a=0,s=0;for(;s<i;++s)a+=n.pdf((o-e[s])/t);return a/t/i},cdf(o){let a=0,s=0;for(;s<i;++s)a+=n.cdf((o-e[s])/t);return a/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(e)}function wx(e,t){return e=e||0,t=t==null?1:t,Math.exp(e+Ip()*t)}function _x(e,t,n){if(e<=0)return 0;t=t||0,n=n==null?1:n;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*JT*e)}function Ex(e,t,n){return Lp(Math.log(e),t,n)}function Sx(e,t,n){return Math.exp(zp(e,t,n))}function QT(e,t){let n,i;const r={mean(o){return arguments.length?(n=o||0,r):n},stdev(o){return arguments.length?(i=o==null?1:o,r):i},sample:()=>wx(n,i),pdf:o=>_x(o,n,i),cdf:o=>Ex(o,n,i),icdf:o=>Sx(o,n,i)};return r.mean(e).stdev(t)}function ZT(e,t){let n=0,i;function r(a){const s=[];let u=0,l;for(l=0;l<n;++l)u+=s[l]=a[l]==null?1:+a[l];for(l=0;l<n;++l)s[l]/=u;return s}const o={weights(a){return arguments.length?(i=r(t=a||[]),o):t},distributions(a){return arguments.length?(a?(n=a.length,e=a):(n=0,e=[]),o.weights(t)):e},sample(){const a=ii();let s=e[n-1],u=i[0],l=0;for(;l<n-1;u+=i[++l])if(a<u){s=e[l];break}return s.sample()},pdf(a){let s=0,u=0;for(;u<n;++u)s+=i[u]*e[u].pdf(a);return s},cdf(a){let s=0,u=0;for(;u<n;++u)s+=i[u]*e[u].cdf(a);return s},icdf(){throw Error("Mixture icdf not supported.")}};return o.distributions(e).weights(t)}function Ox(e,t){return t==null&&(t=e==null?1:e,e=0),e+(t-e)*ii()}function Ax(e,t,n){return n==null&&(n=t==null?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function kx(e,t,n){return n==null&&(n=t==null?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function Cx(e,t,n){return n==null&&(n=t==null?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function eM(e,t){let n,i;const r={min(o){return arguments.length?(n=o||0,r):n},max(o){return arguments.length?(i=o==null?1:o,r):i},sample:()=>Ox(n,i),pdf:o=>Ax(o,n,i),cdf:o=>kx(o,n,i),icdf:o=>Cx(o,n,i)};return t==null&&(t=e==null?1:e,e=0),r.min(e).max(t)}function Df(e,t,n,i){const r=i-e*e,o=Math.abs(r)<1e-24?0:(n-e*t)/r;return[t-o*e,o]}function Bp(e,t,n,i){e=e.filter(h=>{let g=t(h),p=n(h);return g!=null&&(g=+g)>=g&&p!=null&&(p=+p)>=p}),i&&e.sort((h,g)=>t(h)-t(g));const r=e.length,o=new Float64Array(r),a=new Float64Array(r);let s=0,u=0,l=0,c,f,d;for(d of e)o[s]=c=+t(d),a[s]=f=+n(d),++s,u+=(c-u)/s,l+=(f-l)/s;for(s=0;s<r;++s)o[s]-=u,a[s]-=l;return[o,a,u,l]}function Nf(e,t,n,i){let r=-1,o,a;for(const s of e)o=t(s),a=n(s),o!=null&&(o=+o)>=o&&a!=null&&(a=+a)>=a&&i(o,a,++r)}function ml(e,t,n,i,r){let o=0,a=0;return Nf(e,t,n,(s,u)=>{const l=u-r(s),c=u-i;o+=l*l,a+=c*c}),1-o/a}function $x(e,t,n){let i=0,r=0,o=0,a=0,s=0;Nf(e,t,n,(c,f)=>{++s,i+=(c-i)/s,r+=(f-r)/s,o+=(c*f-o)/s,a+=(c*c-a)/s});const u=Df(i,r,o,a),l=c=>u[0]+u[1]*c;return{coef:u,predict:l,rSquared:ml(e,t,n,r,l)}}function tM(e,t,n){let i=0,r=0,o=0,a=0,s=0;Nf(e,t,n,(c,f)=>{++s,c=Math.log(c),i+=(c-i)/s,r+=(f-r)/s,o+=(c*f-o)/s,a+=(c*c-a)/s});const u=Df(i,r,o,a),l=c=>u[0]+u[1]*Math.log(c);return{coef:u,predict:l,rSquared:ml(e,t,n,r,l)}}function nM(e,t,n){const[i,r,o,a]=Bp(e,t,n);let s=0,u=0,l=0,c=0,f=0,d,h,g;Nf(e,t,n,(v,b)=>{d=i[f++],h=Math.log(b),g=d*b,s+=(b*h-s)/f,u+=(g-u)/f,l+=(g*h-l)/f,c+=(d*g-c)/f});const[p,m]=Df(u/a,s/a,l/a,c/a),y=v=>Math.exp(p+m*(v-o));return{coef:[Math.exp(p-m*o),m],predict:y,rSquared:ml(e,t,n,a,y)}}function iM(e,t,n){let i=0,r=0,o=0,a=0,s=0,u=0;Nf(e,t,n,(f,d)=>{const h=Math.log(f),g=Math.log(d);++u,i+=(h-i)/u,r+=(g-r)/u,o+=(h*g-o)/u,a+=(h*h-a)/u,s+=(d-s)/u});const l=Df(i,r,o,a),c=f=>l[0]*Math.pow(f,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:ml(e,t,n,s,c)}}function Fx(e,t,n){const[i,r,o,a]=Bp(e,t,n),s=i.length;let u=0,l=0,c=0,f=0,d=0,h,g,p,m;for(h=0;h<s;)g=i[h],p=r[h++],m=g*g,u+=(m-u)/h,l+=(m*g-l)/h,c+=(m*m-c)/h,f+=(g*p-f)/h,d+=(m*p-d)/h;const y=c-u*u,v=u*y-l*l,b=(d*u-f*l)/v,x=(f*y-d*l)/v,_=-b*u,E=w=>(w=w-o,b*w*w+x*w+_+a);return{coef:[_-x*o+b*o*o+a,x-2*b*o,b],predict:E,rSquared:ml(e,t,n,a,E)}}function rM(e,t,n,i){if(i===1)return $x(e,t,n);if(i===2)return Fx(e,t,n);const[r,o,a,s]=Bp(e,t,n),u=r.length,l=[],c=[],f=i+1;let d,h,g,p,m;for(d=0;d<f;++d){for(g=0,p=0;g<u;++g)p+=Math.pow(r[g],d)*o[g];for(l.push(p),m=new Float64Array(f),h=0;h<f;++h){for(g=0,p=0;g<u;++g)p+=Math.pow(r[g],d+h);m[h]=p}c.push(m)}c.push(l);const y=l7(c),v=b=>{b-=a;let x=s+y[0]+y[1]*b+y[2]*b*b;for(d=3;d<f;++d)x+=y[d]*Math.pow(b,d);return x};return{coef:u7(f,y,-a,s),predict:v,rSquared:ml(e,t,n,s,v)}}function u7(e,t,n,i){const r=Array(e);let o,a,s,u;for(o=0;o<e;++o)r[o]=0;for(o=e-1;o>=0;--o)for(s=t[o],u=1,r[o]+=s,a=1;a<=o;++a)u*=(o+1-a)/a,r[o-a]+=s*Math.pow(n,a)*u;return r[0]+=i,r}function l7(e){const t=e.length-1,n=[];let i,r,o,a,s;for(i=0;i<t;++i){for(a=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][a])&&(a=r);for(o=i;o<t+1;++o)s=e[o][i],e[o][i]=e[o][a],e[o][a]=s;for(r=i+1;r<t;++r)for(o=t;o>=i;o--)e[o][r]-=e[o][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(s=0,o=r+1;o<t;++o)s+=e[o][r]*n[o];n[r]=(e[t][r]-s)/e[r][r]}return n}const DS=2,NS=1e-12;function oM(e,t,n,i){const[r,o,a,s]=Bp(e,t,n,!0),u=r.length,l=Math.max(2,~~(i*u)),c=new Float64Array(u),f=new Float64Array(u),d=new Float64Array(u).fill(1);for(let h=-1;++h<=DS;){const g=[0,l-1];for(let m=0;m<u;++m){const y=r[m],v=g[0],b=g[1],x=y-r[v]>r[b]-y?v:b;let _=0,E=0,w=0,S=0,C=0;const A=1/Math.abs(r[x]-y||1);for(let k=v;k<=b;++k){const M=r[k],$=o[k],T=c7(Math.abs(y-M)*A)*d[k],D=M*T;_+=T,E+=D,w+=$*T,S+=$*D,C+=M*D}const[O,F]=Df(E/_,w/_,S/_,C/_);c[m]=O+F*y,f[m]=Math.abs(o[m]-c[m]),f7(r,m+1,g)}if(h===DS)break;const p=WF(f);if(Math.abs(p)<NS)break;for(let m=0,y,v;m<u;++m)y=f[m]/(6*p),d[m]=y>=1?NS:(v=1-y*y)*v}return d7(r,c,a,s)}function c7(e){return(e=1-e*e*e)*e*e}function f7(e,t,n){const i=e[t];let r=n[0],o=n[1]+1;if(!(o>=e.length))for(;t>r&&e[o]-i<=i-e[r];)n[0]=++r,n[1]=o,++o}function d7(e,t,n,i){const r=e.length,o=[];let a=0,s=0,u=[],l;for(;a<r;++a)l=e[a]+n,u[0]===l?u[1]+=(t[a]-u[1])/++s:(s=0,u[1]+=i,u=[l,t[a]],o.push(u));return u[1]+=i,o}const h7=.5*Math.PI/180;function Up(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=p=>[p,e(p)],o=t[0],a=t[1],s=a-o,u=s/i,l=[r(o)],c=[];if(n===i){for(let p=1;p<i;++p)l.push(r(o+p/n*s));return l.push(r(a)),l}else{c.push(r(a));for(let p=n;--p>0;)c.push(r(o+p/n*s))}let f=l[0],d=c[c.length-1];const h=1/s,g=g7(f[1],c);for(;d;){const p=r((f[0]+d[0])/2);p[0]-f[0]>=u&&p7(f,p,d,h,g)>h7?c.push(p):(f=d,l.push(d),c.pop()),d=c[c.length-1]}return l}function g7(e,t){let n=e,i=e;const r=t.length;for(let o=0;o<r;++o){const a=t[o][1];a<n&&(n=a),a>i&&(i=a)}return 1/(i-n)}function p7(e,t,n,i,r){const o=Math.atan2(r*(n[1]-e[1]),i*(n[0]-e[0])),a=Math.atan2(r*(t[1]-e[1]),i*(t[0]-e[0]));return Math.abs(o-a)}function m7(e){return t=>{const n=e.length;let i=1,r=String(e[0](t));for(;i<n;++i)r+="|"+e[i](t);return r}}function cy(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:m7(e)}function aM(e,t,n){return n||e+(t?"_"+t:"")}const Fm=()=>{},y7={init:Fm,add:Fm,rem:Fm,idx:0},Vc={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},jf=Object.keys(Vc);function v7(e,t){return n=>ce({name:e,out:n||e},y7,t)}jf.forEach(e=>{Vc[e]=v7(e,Vc[e])});function sM(e,t){return Vc[e](t)}function uM(e,t){return e.idx-t.idx}function b7(e){const t={};e.forEach(i=>t[i.name]=i);const n=i=>{!i.req||i.req.forEach(r=>{t[r]||n(t[r]=Vc[r]())})};return e.forEach(n),Object.values(t).sort(uM)}function x7(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function w7(e,t){if(e==null||e===""){++this.missing;return}e===e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t)))}function _7(e,t){if(e==null||e===""){--this.missing;return}e===e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t)))}function E7(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function lM(e,t){const n=t||Wt,i=b7(e),r=e.slice().sort(uM);function o(a){this._ops=i,this._out=r,this.cell=a,this.init()}return o.prototype.init=x7,o.prototype.add=w7,o.prototype.rem=_7,o.prototype.set=E7,o.prototype.get=n,o.fields=e.map(a=>a.out),o}function Tx(e){this._key=e?wn(e):ne,this.reset()}const Ct=Tx.prototype;Ct.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null};Ct.add=function(e){this._add.push(e)};Ct.rem=function(e){this._rem.push(e)};Ct.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,o=Array(i-r),a={};let s,u,l;for(s=0;s<r;++s)a[n(t[s])]=1;for(s=0,u=0;s<i;++s)a[n(l=e[s])]?a[n(l)]=0:o[u++]=l;return this._rem=[],this._add=o};Ct.distinct=function(e){const t=this.values(),n={};let i=t.length,r=0,o;for(;--i>=0;)o=e(t[i])+"",ee(n,o)||(n[o]=1,++r);return r};Ct.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=j$(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext};Ct.argmin=function(e){return this.extent(e)[0]||{}};Ct.argmax=function(e){return this.extent(e)[1]||{}};Ct.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0};Ct.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0};Ct.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=mx(this.values(),e),this._get=e),this._q};Ct.q1=function(e){return this.quartile(e)[0]};Ct.q2=function(e){return this.quartile(e)[1]};Ct.q3=function(e){return this.quartile(e)[2]};Ct.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=VT(this.values(),1e3,.05,e),this._get=e),this._ci};Ct.ci0=function(e){return this.ci(e)[0]};Ct.ci1=function(e){return this.ci(e)[1]};function Xo(e){N.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Xo.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:jf},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};W(Xo,N,{transform(e,t){const n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):{},t.visit(t.SOURCE,o=>n.add(o))):(n.value=n.value||n.init(e),t.visit(t.REM,o=>n.rem(o)),t.visit(t.ADD,o=>n.add(o))),i.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},cross(){const e=this,t=e.value,n=e._dnames,i=n.map(()=>({})),r=n.length;function o(s){let u,l,c,f;for(u in s)for(c=s[u].tuple,l=0;l<r;++l)i[l][f=c[n[l]]]=f}o(e._prev),o(t);function a(s,u,l){const c=n[l],f=i[l++];for(const d in f){const h=s?s+"|"+d:d;u[c]=f[d],l<r?a(h,u,l):t[h]||e.cell(h,u)}}a("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],i={};function r(m){const y=V(Lt(m)),v=y.length;let b=0,x;for(;b<v;++b)i[x=y[b]]||(i[x]=1,t.push(x))}this._dims=V(e.groupby),this._dnames=this._dims.map(m=>{const y=Qe(m);return r(m),n.push(y),y}),this.cellkey=e.key?e.key:cy(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const o=e.fields||[null],a=e.ops||["count"],s=e.as||[],u=o.length,l={};let c,f,d,h,g,p;for(u!==a.length&&P("Unmatched number of fields and aggregate ops."),p=0;p<u;++p){if(c=o[p],f=a[p],c==null&&f!=="count"&&P("Null aggregate field specified."),h=Qe(c),g=aM(f,h,s[p]),n.push(g),f==="count"){this._counts.push(g);continue}d=l[h],d||(r(c),d=l[h]=[],d.field=c,this._measures.push(d)),f!=="count"&&(this._countOnly=!1),d.push(sM(f,g))}return this._measures=this._measures.map(m=>lM(m,m.field)),{}},cellkey:cy(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const i=this._measures,r=i.length;n.agg=Array(r);for(let o=0;o<r;++o)n.agg[o]=new i[o](n)}return n.store&&(n.data=new Tx),n},newtuple(e,t){const n=this._dnames,i=this._dims,r=i.length,o={};for(let a=0;a<r;++a)o[n[a]]=i[a](e);return t?BT(t.tuple,o):Ce(o)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const i=n.agg;for(let r=0,o=i.length;r<o;++r)i[r].add(i[r].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const i=n.agg;for(let r=0,o=i.length;r<o;++r)i[r].rem(i[r].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let i=0,r=n.length;i<r;++i)t[n[i]]=e.num;if(!this._countOnly){const i=e.agg;for(let r=0,o=i.length;r<o;++r)i[r].set(t)}return t},changes(e){const t=this._adds,n=this._mods,i=this._prev,r=this._drop,o=e.add,a=e.rem,s=e.mod;let u,l,c,f;if(i)for(l in i)u=i[l],(!r||u.num)&&a.push(u.tuple);for(c=0,f=this._alen;c<f;++c)o.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)u=n[c],(u.num===0&&r?a:s).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});const S7=1e-14;function Mx(e){N.call(this,null,e)}Mx.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};W(Mx,N,{transform(e,t){const n=e.interval!==!1,i=this._bins(e),r=i.start,o=i.step,a=e.as||["bin0","bin1"],s=a[0],u=a[1];let l;return e.modified()?(t=t.reflow(!0),l=t.SOURCE):l=t.modified(Lt(e.field))?t.ADD_MOD:t.ADD,t.visit(l,n?c=>{const f=i(c);c[s]=f,c[u]=f==null?null:r+o*(1+(f-r)/o)}:c=>c[s]=i(c)),t.modifies(n?a:s)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=XT(e),i=n.step;let r=n.start,o=r+Math.ceil((n.stop-r)/i)*i,a,s;(a=e.anchor)!=null&&(s=a-(r+i*Math.floor((a-r)/i)),r+=s,o+=s);const u=function(l){let c=Rt(t(l));return c==null?null:c<r?-1/0:c>o?1/0:(c=Math.max(r,Math.min(c,o-i)),r+i*Math.floor(S7+(c-r)/i))};return u.start=r,u.stop=n.stop,u.step=i,this.value=Cn(u,Lt(t),e.name||"bin_"+Qe(t))}});function cM(e,t,n){const i=e;let r=t||[],o=n||[],a={},s=0;return{add:u=>o.push(u),remove:u=>a[i(u)]=++s,size:()=>r.length,data:(u,l)=>(s&&(r=r.filter(c=>!a[i(c)]),a={},s=0),l&&u&&r.sort(u),o.length&&(r=u?B$(u,r,o.sort(u)):r.concat(o),o=[]),r)}}function Dx(e){N.call(this,[],e)}Dx.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};W(Dx,N,{transform(e,t){const n=t.fork(t.ALL),i=cM(ne,this.value,n.materialize(n.ADD).add),r=e.sort,o=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(o),this.value=n.source=i.data(Ds(r),o),t.source&&t.source.root&&(this.value.root=t.source.root),n}});function fM(e){Re.call(this,null,O7,e)}W(fM,Re);function O7(e){return this.value&&!e.modified()?this.value:yb(e.fields,e.orders)}function Nx(e){N.call(this,null,e)}Nx.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function A7(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}W(Nx,N,{transform(e,t){const n=f=>d=>{for(var h=A7(s(d),e.case,o)||[],g,p=0,m=h.length;p<m;++p)a.test(g=h[p])||f(g)},i=this._parameterCheck(e,t),r=this._counts,o=this._match,a=this._stop,s=e.field,u=e.as||["text","count"],l=n(f=>r[f]=1+(r[f]||0)),c=n(f=>r[f]-=1);return i?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,c)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],o=t[1],a=e.fork(e.NO_SOURCE|e.NO_FIELDS);let s,u,l;for(s in n)u=i[s],l=n[s]||0,!u&&l?(i[s]=u=Ce({}),u[r]=s,u[o]=l,a.add.push(u)):l===0?(u&&a.rem.push(u),n[s]=null,i[s]=null):u[o]!==l&&(u[o]=l,a.mod.push(u));return a.modifies(t)}});function jx(e){N.call(this,null,e)}jx.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};W(jx,N,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.as||["a","b"],r=i[0],o=i[1],a=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let s=this.value;return a?(s&&(n.rem=s),s=t.materialize(t.SOURCE).source,n.add=this.value=k7(s,r,o,e.filter||Zn)):n.mod=s,n.source=this.value,n.modifies(i)}});function k7(e,t,n,i){for(var r=[],o={},a=e.length,s=0,u,l;s<a;++s)for(o[t]=l=e[s],u=0;u<a;++u)o[n]=e[u],i(o)&&(r.push(Ce(o)),o={},o[t]=l);return r}const jS={kde:xx,mixture:ZT,normal:bx,lognormal:QT,uniform:eM},C7="distributions",RS="function",$7="field";function dM(e,t){const n=e[RS];ee(jS,n)||P("Unknown distribution function: "+n);const i=jS[n]();for(const r in e)r===$7?i.data((e.from||t()).map(e[r])):r===C7?i[r](e[r].map(o=>dM(o,t))):typeof i[r]===RS&&i[r](e[r]);return i}function Rx(e){N.call(this,null,e)}const hM=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],F7={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:hM},{name:"weights",type:"number",array:!0}]};Rx.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:hM.concat(F7)},{name:"as",type:"string",array:!0,default:["value","density"]}]};W(Rx,N,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=dM(e.distribution,T7(t)),r=e.steps||e.minsteps||25,o=e.steps||e.maxsteps||200;let a=e.method||"pdf";a!=="pdf"&&a!=="cdf"&&P("Invalid density method: "+a),!e.extent&&!i.data&&P("Missing density extent parameter."),a=i[a];const s=e.as||["value","density"],u=e.extent||lr(i.data()),l=Up(a,u,r,o).map(c=>{const f={};return f[s[0]]=c[0],f[s[1]]=c[1],Ce(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function T7(e){return()=>e.materialize(e.SOURCE).source}function gM(e,t){return e?e.map((n,i)=>t[i]||Qe(n)):null}function Px(e,t,n){const i=[],r=f=>f(u);let o,a,s,u,l,c;if(t==null)i.push(e.map(n));else for(o={},a=0,s=e.length;a<s;++a)u=e[a],l=t.map(r),c=o[l],c||(o[l]=c=[],c.dims=l,i.push(c)),c.push(n(u));return i}const pM="bin";function Ix(e){N.call(this,null,e)}Ix.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:pM}]};const M7=(e,t)=>Sf(lr(e,t))/30;W(Ix,N,{transform(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,i=Px(t.source,e.groupby,Wt),r=e.smooth||!1,o=e.field,a=e.step||M7(n,o),s=Ds((g,p)=>o(g)-o(p)),u=e.as||pM,l=i.length;let c=1/0,f=-1/0,d=0,h;for(;d<l;++d){const g=i[d].sort(s);h=-1;for(const p of KT(g,a,r,o))p<c&&(c=p),p>f&&(f=p),g[++h][u]=p}return this.value={start:c,stop:f,step:a},t.reflow(!0).modifies(u)}});function mM(e){Re.call(this,null,D7,e),this.modified(!0)}W(mM,Re);function D7(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Cn(n=>t(n,e),Lt(t),Qe(t))}function Lx(e){N.call(this,[void 0,void 0],e)}Lx.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};W(Lx,N,{transform(e,t){const n=this.value,i=e.field,r=t.changed()||t.modified(i.fields)||e.modified("field");let o=n[0],a=n[1];if((r||o==null)&&(o=1/0,a=-1/0),t.visit(r?t.SOURCE:t.ADD,s=>{const u=Rt(i(s));u!=null&&(u<o&&(o=u),u>a&&(a=u))}),!Number.isFinite(o)||!Number.isFinite(a)){let s=Qe(i);s&&(s=' for field "'.concat(s,'"')),t.dataflow.warn("Infinite extent".concat(s,": [").concat(o,", ").concat(a,"]")),o=a=void 0}this.value=[o,a]}});function zx(e,t){Re.call(this,e),this.parent=t,this.count=0}W(zx,Re,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}});function qp(e){N.call(this,{},e),this._keys=ll();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,r=t.active;i<r;++i)n(t[i],i,t)}}W(qp,N,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,i){const r=this.value;let o=ee(r,e)&&r[e],a,s;return o?o.value.stamp<n.stamp&&(o.init(n),this.activate(o)):(s=i||(s=this._group[e])&&s.tuple,a=n.dataflow,o=new zx(n.fork(n.NO_SOURCE),this),a.add(o).connect(t(a,e,s)),r[e]=o,this.activate(o)),o},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const i=e[n].detachSubflow;i&&i(),delete e[n],++t}if(t){const n=this._targets.filter(i=>i&&i.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,i=e?e.length:0;let r=0;for(;r<i;++r)t[r]=e[r];for(;r<n&&t[r]!=null;++r)t[r]=null;t.active=i},transform(e,t){const n=t.dataflow,i=e.key,r=e.subflow,o=this._keys,a=e.modified("key"),s=u=>this.subflow(u,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,u=>{const l=ne(u),c=o.get(l);c!==void 0&&(o.delete(l),s(c).rem(u))}),t.visit(t.ADD,u=>{const l=i(u);o.set(ne(u),l),s(l).add(u)}),a||t.modified(i.fields)?t.visit(t.MOD,u=>{const l=ne(u),c=o.get(l),f=i(u);c===f?s(f).mod(u):(o.set(l,f),s(c).rem(u),s(f).add(u))}):t.changed(t.MOD)&&t.visit(t.MOD,u=>{s(o.get(ne(u))).mod(u)}),a&&t.visit(t.REFLOW,u=>{const l=ne(u),c=o.get(l),f=i(u);c!==f&&(o.set(l,f),s(c).rem(u),s(f).add(u))}),t.clean()?n.runAfter(()=>{this.clean(),o.clean()}):o.empty>n.cleanThreshold&&n.runAfter(o.clean),t}});function yM(e){Re.call(this,null,N7,e)}W(yM,Re);function N7(e){return this.value&&!e.modified()?this.value:I(e.name)?V(e.name).map(t=>wn(t)):wn(e.name,e.as)}function Bx(e){N.call(this,ll(),e)}Bx.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};W(Bx,N,{transform(e,t){const n=t.dataflow,i=this.value,r=t.fork(),o=r.add,a=r.rem,s=r.mod,u=e.expr;let l=!0;t.visit(t.REM,f=>{const d=ne(f);i.has(d)?i.delete(d):a.push(f)}),t.visit(t.ADD,f=>{u(f,e)?o.push(f):i.set(ne(f),1)});function c(f){const d=ne(f),h=u(f,e),g=i.get(d);h&&g?(i.delete(d),o.push(f)):!h&&!g?(i.set(d,1),a.push(f)):l&&h&&!g&&s.push(f)}return t.visit(t.MOD,c),e.modified()&&(l=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}});function Ux(e){N.call(this,[],e)}Ux.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};W(Ux,N,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=gM(i,e.as||[]),o=e.index||null,a=r.length;return n.rem=this.value,t.visit(t.SOURCE,s=>{const u=i.map(g=>g(s)),l=u.reduce((g,p)=>Math.max(g,p.length),0);let c=0,f,d,h;for(;c<l;++c){for(d=dx(s),f=0;f<a;++f)d[r[f]]=(h=u[f][c])==null?null:h;o&&(d[o]=c),n.add.push(d)}}),this.value=n.source=n.add,o&&n.modifies(o),n.modifies(r)}});function qx(e){N.call(this,[],e)}qx.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};W(qx,N,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(Qe),o=e.as||["key","value"],a=o[0],s=o[1],u=i.length;return n.rem=this.value,t.visit(t.SOURCE,l=>{for(let c=0,f;c<u;++c)f=dx(l),f[a]=r[c],f[s]=i[c](l),n.add.push(f)}),this.value=n.source=n.add,n.modifies(o)}});function Wx(e){N.call(this,null,e)}Wx.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};W(Wx,N,{transform(e,t){const n=e.expr,i=e.as,r=e.modified(),o=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(o,a=>a[i]=n(a,e))}});function vM(e){N.call(this,[],e)}W(vM,N,{transform(e,t){const n=t.fork(t.ALL),i=e.generator;let r=this.value,o=e.size-r.length,a,s,u;if(o>0){for(a=[];--o>=0;)a.push(u=Ce(i(e))),r.push(u);n.add=n.add.length?n.materialize(n.ADD).add.concat(a):a}else s=r.slice(0,-o),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(s):s,r=r.slice(-o);return n.source=this.value=r,n}});const xd={value:"value",median:WF,mean:b8,min:Z1,max:Ka},j7=[];function Gx(e){N.call(this,[],e)}Gx.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function R7(e){var t=e.method||xd.value,n;if(xd[t]==null)P("Unrecognized imputation method: "+t);else return t===xd.value?(n=e.value!==void 0?e.value:0,()=>n):xd[t]}function P7(e){const t=e.field;return n=>n?t(n):NaN}W(Gx,N,{transform(e,t){var n=t.fork(t.ALL),i=R7(e),r=P7(e),o=Qe(e.field),a=Qe(e.key),s=(e.groupby||[]).map(Qe),u=I7(t.source,e.groupby,e.key,e.keyvals),l=[],c=this.value,f=u.domain.length,d,h,g,p,m,y,v,b,x,_;for(m=0,b=u.length;m<b;++m)for(d=u[m],g=d.values,h=NaN,v=0;v<f;++v)if(d[v]==null){for(p=u.domain[v],_={_impute:!0},y=0,x=g.length;y<x;++y)_[s[y]]=g[y];_[a]=p,_[o]=Number.isNaN(h)?h=i(d,r):h,l.push(Ce(_))}return l.length&&(n.add=n.materialize(n.ADD).add.concat(l)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=l,n}});function I7(e,t,n,i){var r=y=>y(m),o=[],a=i?i.slice():[],s={},u={},l,c,f,d,h,g,p,m;for(a.forEach((y,v)=>s[y]=v+1),d=0,p=e.length;d<p;++d)m=e[d],g=n(m),h=s[g]||(s[g]=a.push(g)),c=(l=t?t.map(r):j7)+"",(f=u[c])||(f=u[c]=[],o.push(f),f.values=l),f[h-1]=m;return o.domain=a,o}function Hx(e){Xo.call(this,e)}Hx.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:jf},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};W(Hx,Xo,{transform(e,t){const n=this,i=e.modified();let r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,o=>n.add(o))):(r=n.value=n.value||this.init(e),t.visit(t.REM,o=>n.rem(o)),t.visit(t.ADD,o=>n.add(o))),n.changes(),t.visit(t.SOURCE,o=>{ce(o,r[n.cellkey(o)].tuple)}),t.reflow(i).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}});function Yx(e){N.call(this,null,e)}Yx.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};W(Yx,N,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=Px(i,e.groupby,e.field),o=(e.groupby||[]).map(Qe),a=e.bandwidth,s=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;s!=="pdf"&&s!=="cdf"&&P("Invalid density method: "+s),e.resolve==="shared"&&(c||(c=lr(i,e.field)),f=d=e.steps||d),r.forEach(h=>{const g=xx(h,a)[s],p=e.counts?h.length:1,m=c||lr(h);Up(g,m,f,d).forEach(y=>{const v={};for(let b=0;b<o.length;++b)v[o[b]]=h.dims[b];v[u[0]]=y[0],v[u[1]]=y[1]*p,l.push(Ce(v))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function bM(e){Re.call(this,null,L7,e)}W(bM,Re);function L7(e){return this.value&&!e.modified()?this.value:bb(e.fields,e.flat)}function xM(e){N.call(this,[],e),this._pending=null}W(xM,N,{transform(e,t){const n=t.dataflow;return this._pending?Tm(this,t,this._pending):z7(e)?t.StopPropagation:e.values?Tm(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(r=>(this._pending=V(r.data),o=>o.touch(this)))}:n.request(e.url,e.format).then(i=>Tm(this,t,V(i.data)))}});function z7(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function Tm(e,t,n){n.forEach(Ce);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function Xx(e){N.call(this,{},e)}Xx.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};W(Xx,N,{transform(e,t){const n=e.fields,i=e.index,r=e.values,o=e.default==null?null:e.default,a=e.modified(),s=n.length;let u=a?t.SOURCE:t.ADD,l=t,c=e.as,f,d,h;return r?(d=r.length,s>1&&!c&&P('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==s*d&&P('The "as" parameter has too few output field names.'),c=c||r.map(Qe),f=function(g){for(var p=0,m=0,y,v;p<s;++p)if(v=i.get(n[p](g)),v==null)for(y=0;y<d;++y,++m)g[c[m]]=o;else for(y=0;y<d;++y,++m)g[c[m]]=r[y](v)}):(c||P("Missing output field names."),f=function(g){for(var p=0,m;p<s;++p)m=i.get(n[p](g)),g[c[p]]=m==null?o:m}),a?l=t.reflow(!0):(h=n.some(g=>t.modified(g.fields)),u|=h?t.MOD:0),t.visit(u,f),l.modifies(c)}});function wM(e){Re.call(this,null,B7,e)}W(wM,Re);function B7(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let i=1/0,r=-1/0,o,a;for(o=0;o<n;++o)a=t[o],a[0]<i&&(i=a[0]),a[1]>r&&(r=a[1]);return[i,r]}function _M(e){Re.call(this,null,U7,e)}W(_M,Re);function U7(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function EM(e){N.call(this,null,e)}W(EM,N,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function Vx(e){Xo.call(this,e)}Vx.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:jf,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};W(Vx,Xo,{_transform:Xo.prototype.transform,transform(e,t){return this._transform(q7(e,t),t)}});function q7(e,t){const n=e.field,i=e.value,r=(e.op==="count"?"__count__":e.op)||"sum",o=Lt(n).concat(Lt(i)),a=G7(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:a.map(()=>r),fields:a.map(s=>W7(s,n,i,o)),as:a.map(s=>s+""),modified:e.modified.bind(e)}}function W7(e,t,n,i){return Cn(r=>t(r)===e?n(r):NaN,i,e+"")}function G7(e,t,n){const i={},r=[];return n.visit(n.SOURCE,o=>{const a=e(o);i[a]||(i[a]=1,r.push(a))}),r.sort(pp),t?r.slice(0,t):r}function SM(e){qp.call(this,e)}W(SM,qp,{transform(e,t){const n=e.subflow,i=e.field,r=o=>this.subflow(ne(o),n,t,o);return(e.modified("field")||i&&t.modified(Lt(i)))&&P("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,o=>{const a=r(o);i(o).forEach(s=>a.mod(s))}),t.visit(t.ADD,o=>{const a=r(o);i(o).forEach(s=>a.add(Ce(s)))}),t.visit(t.REM,o=>{const a=r(o);i(o).forEach(s=>a.rem(s))})):(t.visit(t.MOD,o=>r(o).mod(o)),t.visit(t.ADD,o=>r(o).add(o)),t.visit(t.REM,o=>r(o).rem(o))),t.clean()&&t.runAfter(()=>this.clean()),t}});function Kx(e){N.call(this,null,e)}Kx.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};W(Kx,N,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=gM(e.fields,e.as||[]),o=i?(s,u)=>H7(s,u,i,r):jp;let a;return this.value?a=this.value:(t=t.addAll(),a=this.value={}),t.visit(t.REM,s=>{const u=ne(s);n.rem.push(a[u]),a[u]=null}),t.visit(t.ADD,s=>{const u=o(s,Ce({}));a[ne(s)]=u,n.add.push(u)}),t.visit(t.MOD,s=>{n.mod.push(o(s,a[ne(s)]))}),n}});function H7(e,t,n,i){for(let r=0,o=n.length;r<o;++r)t[i[r]]=n[r](e);return t}function OM(e){N.call(this,null,e)}W(OM,N,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function Jx(e){N.call(this,null,e)}Jx.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const Y7=1e-14;W(Jx,N,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=t.materialize(t.SOURCE).source,o=Px(r,e.groupby,e.field),a=(e.groupby||[]).map(Qe),s=[],u=e.step||.01,l=e.probs||jn(u/2,1-Y7,u),c=l.length;return o.forEach(f=>{const d=px(f,l);for(let h=0;h<c;++h){const g={};for(let p=0;p<a.length;++p)g[a[p]]=f.dims[p];g[i[0]]=l[h],g[i[1]]=d[h],s.push(Ce(g))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=s,n}});function AM(e){N.call(this,null,e)}W(AM,N,{transform(e,t){let n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,r=>{const o=ne(r);n.rem.push(i[o]),i[o]=null}),t.visit(t.ADD,r=>{const o=dx(r);i[ne(r)]=o,n.add.push(o)}),t.visit(t.MOD,r=>{const o=i[ne(r)];for(const a in r)o[a]=r[a],n.modifies(a);n.mod.push(o)})),n}});function Qx(e){N.call(this,[],e),this.count=0}Qx.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};W(Qx,N,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,o=this.value.reduce((c,f)=>(c[ne(f)]=1,c),{});let a=this.value,s=this.count,u=0;function l(c){let f,d;a.length<r?a.push(c):(d=~~((s+1)*ii()),d<a.length&&d>=u&&(f=a[d],o[ne(f)]&&n.rem.push(f),a[d]=c)),++s}if(t.rem.length&&(t.visit(t.REM,c=>{const f=ne(c);o[f]&&(o[f]=-1,n.rem.push(c)),--s}),a=a.filter(c=>o[ne(c)]!==-1)),(t.rem.length||i)&&a.length<r&&t.source&&(u=s=a.length,t.visit(t.SOURCE,c=>{o[ne(c)]||l(c)}),u=-1),i&&a.length>r){const c=a.length-r;for(let f=0;f<c;++f)o[ne(a[f])]=-1,n.rem.push(a[f]);a=a.slice(c)}return t.mod.length&&t.visit(t.MOD,c=>{o[ne(c)]&&n.mod.push(c)}),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(n.add=a.filter(c=>!o[ne(c)])),this.count=s,this.value=n.source=a,n}});function Zx(e){N.call(this,null,e)}Zx.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};W(Zx,N,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=jn(e.start,e.stop,e.step||1).map(r=>{const o={};return o[i]=r,Ce(o)}),n.add=t.add.concat(this.value),n}});function kM(e){N.call(this,null,e),this.modified(!0)}W(kM,N,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function e2(e){N.call(this,null,e)}const CM=["unit0","unit1"];e2.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:ix,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:CM}]};W(e2,N,{transform(e,t){const n=e.field,i=e.interval!==!1,r=e.timezone==="utc",o=this._floor(e,t),a=(r?pl:gl)(o.unit).offset,s=e.as||CM,u=s[0],l=s[1],c=o.step;let f=o.start||1/0,d=o.stop||-1/0,h=t.ADD;return(e.modified()||t.changed(t.REM)||t.modified(Lt(n)))&&(t=t.reflow(!0),h=t.SOURCE,f=1/0,d=-1/0),t.visit(h,g=>{const p=n(g);let m,y;p==null?(g[u]=null,i&&(g[l]=null)):(g[u]=m=y=o(p),i&&(g[l]=y=a(m,c)),m<f&&(f=m),y>d&&(d=y))}),o.start=f,o.stop=d,t.modifies(i?s:u)},_floor(e,t){const n=e.timezone==="utc",{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:vT({extent:e.extent||lr(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),o=rx(i),a=this.value||{},s=(n?lT:uT)(o,r);return s.unit=ve(o),s.units=o,s.step=r,s.start=a.start,s.stop=a.stop,this.value=s}});function $M(e){N.call(this,ll(),e)}W($M,N,{transform(e,t){const n=t.dataflow,i=e.field,r=this.value,o=s=>r.set(i(s),s);let a=!0;return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,o)):t.changed()?(t.visit(t.REM,s=>r.delete(i(s))),t.visit(t.ADD,o)):a=!1,this.modified(a),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()}});function FM(e){N.call(this,null,e)}W(FM,N,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Ds(e.sort)):t.source).map(e.field))}});function X7(e,t,n,i){const r=Kc[e](t,n);return{init:r.init||ko,update:function(o,a){a[i]=r.next(o)}}}const Kc={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){const e=Kc.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,i=t.compare;let r=t.index;if(e<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;e=r}return(1+e)/n.length}}},ntile:function(e,t){t=+t,t>0||P("ntile num must be greater than zero.");const n=Kc.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(t*i(r))}},lag:function(e,t){return t=+t||1,{next:n=>{const i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||P("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const i=e(n.data[n.index]);return i!=null?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{const r=i.data;return i.index<=n?t:(n=V7(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}};function V7(e,t,n){for(let i=t.length;n<i;++n)if(e(t[n])!=null)return n;return-1}const K7=Object.keys(Kc);function TM(e){const t=V(e.ops),n=V(e.fields),i=V(e.params),r=V(e.as),o=this.outputs=[],a=this.windows=[],s={},u={},l=[],c=[];let f=!0;function d(h){V(Lt(h)).forEach(g=>s[g]=1)}d(e.sort),t.forEach((h,g)=>{const p=n[g],m=Qe(p),y=aM(h,m,r[g]);if(d(p),o.push(y),ee(Kc,h))a.push(X7(h,n[g],i[g],y));else{if(p==null&&h!=="count"&&P("Null aggregate field specified."),h==="count"){l.push(y);return}f=!1;let v=u[m];v||(v=u[m]=[],v.field=p,c.push(v)),v.push(sM(h,y))}}),(l.length||c.length)&&(this.cell=J7(c,l,f)),this.inputs=Object.keys(s)}const MM=TM.prototype;MM.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()};MM.update=function(e,t){const n=this.cell,i=this.windows,r=e.data,o=i&&i.length;let a;if(n){for(a=e.p0;a<e.i0;++a)n.rem(r[a]);for(a=e.p1;a<e.i1;++a)n.add(r[a]);n.set(t)}for(a=0;a<o;++a)i[a].update(e,t)};function J7(e,t,n){e=e.map(u=>lM(u,u.field));const i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,o=i.agg=Array(r),a=0;a<r;++a)o[a]=new e[a](i);if(i.store)var s=i.data=new Tx;return i.add=function(u){if(i.num+=1,!n){s&&s.add(u);for(let l=0;l<r;++l)o[l].add(o[l].get(u),u)}},i.rem=function(u){if(i.num-=1,!n){s&&s.rem(u);for(let l=0;l<r;++l)o[l].rem(o[l].get(u),u)}},i.set=function(u){let l,c;for(s&&s.values(),l=0,c=t.length;l<c;++l)u[t[l]]=i.num;if(!n)for(l=0,c=o.length;l<c;++l)o[l].set(u)},i.init=function(){i.num=0,s&&s.reset();for(let u=0;u<r;++u)o[u].init()},i}function t2(e){N.call(this,{},e),this._mlen=0,this._mods=[]}t2.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:K7.concat(jf)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};W(t2,N,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),i=Ds(e.sort),r=cy(e.groupby),o=s=>this.group(r(s));let a=this.state;(!a||n)&&(a=this.state=new TM(e)),n||t.modified(a.inputs)?(this.value={},t.visit(t.SOURCE,s=>o(s).add(s))):(t.visit(t.REM,s=>o(s).remove(s)),t.visit(t.ADD,s=>o(s).add(s)));for(let s=0,u=this._mlen;s<u;++s)Q7(this._mods[s],a,i,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(a.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=cM(ne),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});function Q7(e,t,n,i){const r=i.sort,o=r&&!i.ignorePeers,a=i.frame||[null,0],s=e.data(n),u=s.length,l=o?Tf(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:r||Gt(-1)};t.init();for(let f=0;f<u;++f)Z7(c,a,f,u),o&&eB(c,l),t.update(c,s[f])}function Z7(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function eB(e,t){const n=e.i0,i=e.i1-1,r=e.compare,o=e.data,a=o.length-1;n>0&&!r(o[n],o[n-1])&&(e.i0=t.left(o,o[n])),i<a&&!r(o[i],o[i+1])&&(e.i1=t.right(o,o[i]))}var tB=Object.freeze(Object.defineProperty({__proto__:null,aggregate:Xo,bin:Mx,collect:Dx,compare:fM,countpattern:Nx,cross:jx,density:Rx,dotbin:Ix,expression:mM,extent:Lx,facet:qp,field:yM,filter:Bx,flatten:Ux,fold:qx,formula:Wx,generate:vM,impute:Gx,joinaggregate:Hx,kde:Yx,key:bM,load:xM,lookup:Xx,multiextent:wM,multivalues:_M,params:EM,pivot:Vx,prefacet:SM,project:Kx,proxy:OM,quantile:Jx,relay:AM,sample:Qx,sequence:Zx,sieve:kM,subflow:zx,timeunit:e2,tupleindex:$M,values:FM,window:t2},Symbol.toStringTag,{value:"Module"}));function $e(e){return function(){return e}}const PS=Math.abs,Ft=Math.atan2,Sa=Math.cos,nB=Math.max,Mm=Math.min,Ui=Math.sin,Wa=Math.sqrt,Mt=1e-12,Nu=Math.PI,qh=Nu/2,DM=2*Nu;function iB(e){return e>1?0:e<-1?Nu:Math.acos(e)}function IS(e){return e>=1?qh:e<=-1?-qh:Math.asin(e)}const fy=Math.PI,dy=2*fy,ja=1e-6,rB=dy-ja;function NM(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function oB(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return NM;const n=10**t;return function(i){this._+=i[0];for(let r=1,o=i.length;r<o;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}class n2{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?NM:oB(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,o,a){this._append`C${+t},${+n},${+i},${+r},${this._x1=+o},${this._y1=+a}`}arcTo(t,n,i,r,o){if(t=+t,n=+n,i=+i,r=+r,o=+o,o<0)throw new Error(`negative radius: ${o}`);let a=this._x1,s=this._y1,u=i-t,l=r-n,c=a-t,f=s-n,d=c*c+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(d>ja)if(!(Math.abs(f*u-l*c)>ja)||!o)this._append`L${this._x1=t},${this._y1=n}`;else{let h=i-a,g=r-s,p=u*u+l*l,m=h*h+g*g,y=Math.sqrt(p),v=Math.sqrt(d),b=o*Math.tan((fy-Math.acos((p+d-m)/(2*y*v)))/2),x=b/v,_=b/y;Math.abs(x-1)>ja&&this._append`L${t+x*c},${n+x*f}`,this._append`A${o},${o},0,0,${+(f*h>c*g)},${this._x1=t+_*u},${this._y1=n+_*l}`}}arc(t,n,i,r,o,a){if(t=+t,n=+n,i=+i,a=!!a,i<0)throw new Error(`negative radius: ${i}`);let s=i*Math.cos(r),u=i*Math.sin(r),l=t+s,c=n+u,f=1^a,d=a?r-o:o-r;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>ja||Math.abs(this._y1-c)>ja)&&this._append`L${l},${c}`,i&&(d<0&&(d=d%dy+dy),d>rB?this._append`A${i},${i},0,1,${f},${t-s},${n-u}A${i},${i},0,1,${f},${this._x1=l},${this._y1=c}`:d>ja&&this._append`A${i},${i},0,${+(d>=fy)},${f},${this._x1=t+i*Math.cos(o)},${this._y1=n+i*Math.sin(o)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function Wp(){return new n2}Wp.prototype=n2.prototype;function Gp(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new n2(t)}function aB(e){return e.innerRadius}function sB(e){return e.outerRadius}function uB(e){return e.startAngle}function lB(e){return e.endAngle}function cB(e){return e&&e.padAngle}function fB(e,t,n,i,r,o,a,s){var u=n-e,l=i-t,c=a-r,f=s-o,d=f*u-c*l;if(!(d*d<Mt))return d=(c*(t-o)-f*(e-r))/d,[e+d*u,t+d*l]}function wd(e,t,n,i,r,o,a){var s=e-n,u=t-i,l=(a?o:-o)/Wa(s*s+u*u),c=l*u,f=-l*s,d=e+c,h=t+f,g=n+c,p=i+f,m=(d+g)/2,y=(h+p)/2,v=g-d,b=p-h,x=v*v+b*b,_=r-o,E=d*p-g*h,w=(b<0?-1:1)*Wa(nB(0,_*_*x-E*E)),S=(E*b-v*w)/x,C=(-E*v-b*w)/x,A=(E*b+v*w)/x,O=(-E*v+b*w)/x,F=S-m,k=C-y,M=A-m,$=O-y;return F*F+k*k>M*M+$*$&&(S=A,C=O),{cx:S,cy:C,x01:-c,y01:-f,x11:S*(r/_-1),y11:C*(r/_-1)}}function dB(){var e=aB,t=sB,n=$e(0),i=null,r=uB,o=lB,a=cB,s=null,u=Gp(l);function l(){var c,f,d=+e.apply(this,arguments),h=+t.apply(this,arguments),g=r.apply(this,arguments)-qh,p=o.apply(this,arguments)-qh,m=PS(p-g),y=p>g;if(s||(s=c=u()),h<d&&(f=h,h=d,d=f),!(h>Mt))s.moveTo(0,0);else if(m>DM-Mt)s.moveTo(h*Sa(g),h*Ui(g)),s.arc(0,0,h,g,p,!y),d>Mt&&(s.moveTo(d*Sa(p),d*Ui(p)),s.arc(0,0,d,p,g,y));else{var v=g,b=p,x=g,_=p,E=m,w=m,S=a.apply(this,arguments)/2,C=S>Mt&&(i?+i.apply(this,arguments):Wa(d*d+h*h)),A=Mm(PS(h-d)/2,+n.apply(this,arguments)),O=A,F=A,k,M;if(C>Mt){var $=IS(C/d*Ui(S)),T=IS(C/h*Ui(S));(E-=$*2)>Mt?($*=y?1:-1,x+=$,_-=$):(E=0,x=_=(g+p)/2),(w-=T*2)>Mt?(T*=y?1:-1,v+=T,b-=T):(w=0,v=b=(g+p)/2)}var D=h*Sa(v),R=h*Ui(v),L=d*Sa(_),J=d*Ui(_);if(A>Mt){var ue=h*Sa(b),_e=h*Ui(b),Ee=d*Sa(x),Ye=d*Ui(x),pe;if(m<Nu)if(pe=fB(D,R,Ee,Ye,ue,_e,L,J)){var ft=D-pe[0],li=R-pe[1],$t=ue-pe[0],X=_e-pe[1],ae=1/Ui(iB((ft*$t+li*X)/(Wa(ft*ft+li*li)*Wa($t*$t+X*X)))/2),de=Wa(pe[0]*pe[0]+pe[1]*pe[1]);O=Mm(A,(d-de)/(ae-1)),F=Mm(A,(h-de)/(ae+1))}else O=F=0}w>Mt?F>Mt?(k=wd(Ee,Ye,D,R,h,F,y),M=wd(ue,_e,L,J,h,F,y),s.moveTo(k.cx+k.x01,k.cy+k.y01),F<A?s.arc(k.cx,k.cy,F,Ft(k.y01,k.x01),Ft(M.y01,M.x01),!y):(s.arc(k.cx,k.cy,F,Ft(k.y01,k.x01),Ft(k.y11,k.x11),!y),s.arc(0,0,h,Ft(k.cy+k.y11,k.cx+k.x11),Ft(M.cy+M.y11,M.cx+M.x11),!y),s.arc(M.cx,M.cy,F,Ft(M.y11,M.x11),Ft(M.y01,M.x01),!y))):(s.moveTo(D,R),s.arc(0,0,h,v,b,!y)):s.moveTo(D,R),!(d>Mt)||!(E>Mt)?s.lineTo(L,J):O>Mt?(k=wd(L,J,ue,_e,d,-O,y),M=wd(D,R,Ee,Ye,d,-O,y),s.lineTo(k.cx+k.x01,k.cy+k.y01),O<A?s.arc(k.cx,k.cy,O,Ft(k.y01,k.x01),Ft(M.y01,M.x01),!y):(s.arc(k.cx,k.cy,O,Ft(k.y01,k.x01),Ft(k.y11,k.x11),!y),s.arc(0,0,d,Ft(k.cy+k.y11,k.cx+k.x11),Ft(M.cy+M.y11,M.cx+M.x11),y),s.arc(M.cx,M.cy,O,Ft(M.y11,M.x11),Ft(M.y01,M.x01),!y))):s.arc(0,0,d,_,x,y)}if(s.closePath(),c)return s=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-Nu/2;return[Sa(f)*c,Ui(f)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:$e(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:$e(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:$e(+c),l):n},l.padRadius=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:$e(+c),l):i},l.startAngle=function(c){return arguments.length?(r=typeof c=="function"?c:$e(+c),l):r},l.endAngle=function(c){return arguments.length?(o=typeof c=="function"?c:$e(+c),l):o},l.padAngle=function(c){return arguments.length?(a=typeof c=="function"?c:$e(+c),l):a},l.context=function(c){return arguments.length?(s=c==null?null:c,l):s},l}function jM(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function RM(e){this._context=e}RM.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function i2(e){return new RM(e)}function PM(e){return e[0]}function IM(e){return e[1]}function LM(e,t){var n=$e(!0),i=null,r=i2,o=null,a=Gp(s);e=typeof e=="function"?e:e===void 0?PM:$e(e),t=typeof t=="function"?t:t===void 0?IM:$e(t);function s(u){var l,c=(u=jM(u)).length,f,d=!1,h;for(i==null&&(o=r(h=a())),l=0;l<=c;++l)!(l<c&&n(f=u[l],l,u))===d&&((d=!d)?o.lineStart():o.lineEnd()),d&&o.point(+e(f,l,u),+t(f,l,u));if(h)return o=null,h+""||null}return s.x=function(u){return arguments.length?(e=typeof u=="function"?u:$e(+u),s):e},s.y=function(u){return arguments.length?(t=typeof u=="function"?u:$e(+u),s):t},s.defined=function(u){return arguments.length?(n=typeof u=="function"?u:$e(!!u),s):n},s.curve=function(u){return arguments.length?(r=u,i!=null&&(o=r(i)),s):r},s.context=function(u){return arguments.length?(u==null?i=o=null:o=r(i=u),s):i},s}function zM(e,t,n){var i=null,r=$e(!0),o=null,a=i2,s=null,u=Gp(l);e=typeof e=="function"?e:e===void 0?PM:$e(+e),t=typeof t=="function"?t:$e(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?IM:$e(+n);function l(f){var d,h,g,p=(f=jM(f)).length,m,y=!1,v,b=new Array(p),x=new Array(p);for(o==null&&(s=a(v=u())),d=0;d<=p;++d){if(!(d<p&&r(m=f[d],d,f))===y)if(y=!y)h=d,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),g=d-1;g>=h;--g)s.point(b[g],x[g]);s.lineEnd(),s.areaEnd()}y&&(b[d]=+e(m,d,f),x[d]=+t(m,d,f),s.point(i?+i(m,d,f):b[d],n?+n(m,d,f):x[d]))}if(v)return s=null,v+""||null}function c(){return LM().defined(r).curve(a).context(o)}return l.x=function(f){return arguments.length?(e=typeof f=="function"?f:$e(+f),i=null,l):e},l.x0=function(f){return arguments.length?(e=typeof f=="function"?f:$e(+f),l):e},l.x1=function(f){return arguments.length?(i=f==null?null:typeof f=="function"?f:$e(+f),l):i},l.y=function(f){return arguments.length?(t=typeof f=="function"?f:$e(+f),n=null,l):t},l.y0=function(f){return arguments.length?(t=typeof f=="function"?f:$e(+f),l):t},l.y1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:$e(+f),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(i).y(t)},l.defined=function(f){return arguments.length?(r=typeof f=="function"?f:$e(!!f),l):r},l.curve=function(f){return arguments.length?(a=f,o!=null&&(s=a(o)),l):a},l.context=function(f){return arguments.length?(f==null?o=s=null:s=a(o=f),l):o},l}var hB={draw(e,t){const n=Wa(t/Nu);e.moveTo(n,0),e.arc(0,0,n,0,DM)}};function gB(e,t){let n=null,i=Gp(r);e=typeof e=="function"?e:$e(e||hB),t=typeof t=="function"?t:$e(t===void 0?64:+t);function r(){let o;if(n||(n=o=i()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),o)return n=null,o+""||null}return r.type=function(o){return arguments.length?(e=typeof o=="function"?o:$e(o),r):e},r.size=function(o){return arguments.length?(t=typeof o=="function"?o:$e(+o),r):t},r.context=function(o){return arguments.length?(n=o==null?null:o,r):n},r}function Vo(){}function Wh(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Hp(e){this._context=e}Hp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Wh(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Wh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function pB(e){return new Hp(e)}function BM(e){this._context=e}BM.prototype={areaStart:Vo,areaEnd:Vo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Wh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function mB(e){return new BM(e)}function UM(e){this._context=e}UM.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:Wh(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function yB(e){return new UM(e)}function qM(e,t){this._basis=new Hp(e),this._beta=t}qM.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i=e[0],r=t[0],o=e[n]-i,a=t[n]-r,s=-1,u;++s<=n;)u=s/n,this._basis.point(this._beta*e[s]+(1-this._beta)*(i+u*o),this._beta*t[s]+(1-this._beta)*(r+u*a));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var vB=function e(t){function n(i){return t===1?new Hp(i):new qM(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function Gh(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function r2(e,t){this._context=e,this._k=(1-t)/6}r2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Gh(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Gh(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var bB=function e(t){function n(i){return new r2(i,t)}return n.tension=function(i){return e(+i)},n}(0);function o2(e,t){this._context=e,this._k=(1-t)/6}o2.prototype={areaStart:Vo,areaEnd:Vo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Gh(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var xB=function e(t){function n(i){return new o2(i,t)}return n.tension=function(i){return e(+i)},n}(0);function a2(e,t){this._context=e,this._k=(1-t)/6}a2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Gh(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var wB=function e(t){function n(i){return new a2(i,t)}return n.tension=function(i){return e(+i)},n}(0);function s2(e,t,n){var i=e._x1,r=e._y1,o=e._x2,a=e._y2;if(e._l01_a>Mt){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,r=(r*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>Mt){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);o=(o*l+e._x1*e._l23_2a-t*e._l12_2a)/c,a=(a*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,o,a,e._x2,e._y2)}function WM(e,t){this._context=e,this._alpha=t}WM.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:s2(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var _B=function e(t){function n(i){return t?new WM(i,t):new r2(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function GM(e,t){this._context=e,this._alpha=t}GM.prototype={areaStart:Vo,areaEnd:Vo,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:s2(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var EB=function e(t){function n(i){return t?new GM(i,t):new o2(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function HM(e,t){this._context=e,this._alpha=t}HM.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:s2(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var SB=function e(t){function n(i){return t?new HM(i,t):new a2(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function YM(e){this._context=e}YM.prototype={areaStart:Vo,areaEnd:Vo,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function OB(e){return new YM(e)}function LS(e){return e<0?-1:1}function zS(e,t,n){var i=e._x1-e._x0,r=t-e._x1,o=(e._y1-e._y0)/(i||r<0&&-0),a=(n-e._y1)/(r||i<0&&-0),s=(o*r+a*i)/(i+r);return(LS(o)+LS(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function BS(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Dm(e,t,n){var i=e._x0,r=e._y0,o=e._x1,a=e._y1,s=(o-i)/3;e._context.bezierCurveTo(i+s,r+s*t,o-s,a-s*n,o,a)}function Hh(e){this._context=e}Hh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Dm(this,this._t0,BS(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Dm(this,BS(this,n=zS(this,e,t)),n);break;default:Dm(this,this._t0,n=zS(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function XM(e){this._context=new VM(e)}(XM.prototype=Object.create(Hh.prototype)).point=function(e,t){Hh.prototype.point.call(this,t,e)};function VM(e){this._context=e}VM.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,o){this._context.bezierCurveTo(t,e,i,n,o,r)}};function AB(e){return new Hh(e)}function kB(e){return new XM(e)}function KM(e){this._context=e}KM.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var i=US(e),r=US(t),o=0,a=1;a<n;++o,++a)this._context.bezierCurveTo(i[0][o],r[0][o],i[1][o],r[1][o],e[a],t[a]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function US(e){var t,n=e.length-1,i,r=new Array(n),o=new Array(n),a=new Array(n);for(r[0]=0,o[0]=2,a[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,o[t]=4,a[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,o[n-1]=7,a[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)i=r[t]/o[t-1],o[t]-=i,a[t]-=i*a[t-1];for(r[n-1]=a[n-1]/o[n-1],t=n-2;t>=0;--t)r[t]=(a[t]-r[t+1])/o[t];for(o[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)o[t]=2*e[t+1]-r[t+1];return[r,o]}function CB(e){return new KM(e)}function Yp(e,t){this._context=e,this._t=t}Yp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function $B(e){return new Yp(e,.5)}function FB(e){return new Yp(e,0)}function TB(e){return new Yp(e,1)}function zo(e,t){if(typeof document!="undefined"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const MB=()=>typeof Image!="undefined"?Image:null;function kr(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function ya(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const hy=Symbol("implicit");function u2(){var e=new oS,t=[],n=[],i=hy;function r(o){let a=e.get(o);if(a===void 0){if(i!==hy)return i;e.set(o,a=t.push(o)-1)}return n[a%n.length]}return r.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new oS;for(const a of o)e.has(a)||e.set(a,t.push(a)-1);return r},r.range=function(o){return arguments.length?(n=Array.from(o),r):n.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return u2(t,n).unknown(i)},kr.apply(r,arguments),r}function yl(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Rf(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function va(){}var cs=.7,ju=1/cs,yu="\\s*([+-]?\\d+)\\s*",Jc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ir="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",DB=/^#([0-9a-f]{3,8})$/,NB=new RegExp(`^rgb\\(${yu},${yu},${yu}\\)$`),jB=new RegExp(`^rgb\\(${ir},${ir},${ir}\\)$`),RB=new RegExp(`^rgba\\(${yu},${yu},${yu},${Jc}\\)$`),PB=new RegExp(`^rgba\\(${ir},${ir},${ir},${Jc}\\)$`),IB=new RegExp(`^hsl\\(${Jc},${ir},${ir}\\)$`),LB=new RegExp(`^hsla\\(${Jc},${ir},${ir},${Jc}\\)$`),qS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};yl(va,Qc,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:WS,formatHex:WS,formatHex8:zB,formatHsl:BB,formatRgb:GS,toString:GS});function WS(){return this.rgb().formatHex()}function zB(){return this.rgb().formatHex8()}function BB(){return JM(this).formatHsl()}function GS(){return this.rgb().formatRgb()}function Qc(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=DB.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?HS(t):n===3?new gt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?_d(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?_d(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=NB.exec(e))?new gt(t[1],t[2],t[3],1):(t=jB.exec(e))?new gt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=RB.exec(e))?_d(t[1],t[2],t[3],t[4]):(t=PB.exec(e))?_d(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=IB.exec(e))?VS(t[1],t[2]/100,t[3]/100,1):(t=LB.exec(e))?VS(t[1],t[2]/100,t[3]/100,t[4]):qS.hasOwnProperty(e)?HS(qS[e]):e==="transparent"?new gt(NaN,NaN,NaN,0):null}function HS(e){return new gt(e>>16&255,e>>8&255,e&255,1)}function _d(e,t,n,i){return i<=0&&(e=t=n=NaN),new gt(e,t,n,i)}function l2(e){return e instanceof va||(e=Qc(e)),e?(e=e.rgb(),new gt(e.r,e.g,e.b,e.opacity)):new gt}function Ko(e,t,n,i){return arguments.length===1?l2(e):new gt(e,t,n,i==null?1:i)}function gt(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}yl(gt,Ko,Rf(va,{brighter(e){return e=e==null?ju:Math.pow(ju,e),new gt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?cs:Math.pow(cs,e),new gt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new gt(Ja(this.r),Ja(this.g),Ja(this.b),Yh(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:YS,formatHex:YS,formatHex8:UB,formatRgb:XS,toString:XS}));function YS(){return`#${Ga(this.r)}${Ga(this.g)}${Ga(this.b)}`}function UB(){return`#${Ga(this.r)}${Ga(this.g)}${Ga(this.b)}${Ga((isNaN(this.opacity)?1:this.opacity)*255)}`}function XS(){const e=Yh(this.opacity);return`${e===1?"rgb(":"rgba("}${Ja(this.r)}, ${Ja(this.g)}, ${Ja(this.b)}${e===1?")":`, ${e})`}`}function Yh(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ja(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ga(e){return e=Ja(e),(e<16?"0":"")+e.toString(16)}function VS(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new vi(e,t,n,i)}function JM(e){if(e instanceof vi)return new vi(e.h,e.s,e.l,e.opacity);if(e instanceof va||(e=Qc(e)),!e)return new vi;if(e instanceof vi)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),a=NaN,s=o-r,u=(o+r)/2;return s?(t===o?a=(n-i)/s+(n<i)*6:n===o?a=(i-t)/s+2:a=(t-n)/s+4,s/=u<.5?o+r:2-o-r,a*=60):s=u>0&&u<1?0:a,new vi(a,s,u,e.opacity)}function Xh(e,t,n,i){return arguments.length===1?JM(e):new vi(e,t,n,i==null?1:i)}function vi(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}yl(vi,Xh,Rf(va,{brighter(e){return e=e==null?ju:Math.pow(ju,e),new vi(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?cs:Math.pow(cs,e),new vi(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new gt(Nm(e>=240?e-240:e+120,r,i),Nm(e,r,i),Nm(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new vi(KS(this.h),Ed(this.s),Ed(this.l),Yh(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Yh(this.opacity);return`${e===1?"hsl(":"hsla("}${KS(this.h)}, ${Ed(this.s)*100}%, ${Ed(this.l)*100}%${e===1?")":`, ${e})`}`}}));function KS(e){return e=(e||0)%360,e<0?e+360:e}function Ed(e){return Math.max(0,Math.min(1,e||0))}function Nm(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const QM=Math.PI/180,ZM=180/Math.PI,Vh=18,e3=.96422,t3=1,n3=.82521,i3=4/29,vu=6/29,r3=3*vu*vu,qB=vu*vu*vu;function o3(e){if(e instanceof rr)return new rr(e.l,e.a,e.b,e.opacity);if(e instanceof Yr)return a3(e);e instanceof gt||(e=l2(e));var t=Im(e.r),n=Im(e.g),i=Im(e.b),r=jm((.2225045*t+.7168786*n+.0606169*i)/t3),o,a;return t===n&&n===i?o=a=r:(o=jm((.4360747*t+.3850649*n+.1430804*i)/e3),a=jm((.0139322*t+.0971045*n+.7141733*i)/n3)),new rr(116*r-16,500*(o-r),200*(r-a),e.opacity)}function Kh(e,t,n,i){return arguments.length===1?o3(e):new rr(e,t,n,i==null?1:i)}function rr(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}yl(rr,Kh,Rf(va,{brighter(e){return new rr(this.l+Vh*(e==null?1:e),this.a,this.b,this.opacity)},darker(e){return new rr(this.l-Vh*(e==null?1:e),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=e3*Rm(t),e=t3*Rm(e),n=n3*Rm(n),new gt(Pm(3.1338561*t-1.6168667*e-.4906146*n),Pm(-.9787684*t+1.9161415*e+.033454*n),Pm(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function jm(e){return e>qB?Math.pow(e,1/3):e/r3+i3}function Rm(e){return e>vu?e*e*e:r3*(e-i3)}function Pm(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Im(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function WB(e){if(e instanceof Yr)return new Yr(e.h,e.c,e.l,e.opacity);if(e instanceof rr||(e=o3(e)),e.a===0&&e.b===0)return new Yr(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*ZM;return new Yr(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Jh(e,t,n,i){return arguments.length===1?WB(e):new Yr(e,t,n,i==null?1:i)}function Yr(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function a3(e){if(isNaN(e.h))return new rr(e.l,0,0,e.opacity);var t=e.h*QM;return new rr(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}yl(Yr,Jh,Rf(va,{brighter(e){return new Yr(this.h,this.c,this.l+Vh*(e==null?1:e),this.opacity)},darker(e){return new Yr(this.h,this.c,this.l-Vh*(e==null?1:e),this.opacity)},rgb(){return a3(this).rgb()}}));var s3=-.14861,c2=1.78277,f2=-.29227,Xp=-.90649,Zc=1.97294,JS=Zc*Xp,QS=Zc*c2,ZS=c2*f2-Xp*s3;function GB(e){if(e instanceof Qa)return new Qa(e.h,e.s,e.l,e.opacity);e instanceof gt||(e=l2(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(ZS*i+JS*t-QS*n)/(ZS+JS-QS),o=i-r,a=(Zc*(n-r)-f2*o)/Xp,s=Math.sqrt(a*a+o*o)/(Zc*r*(1-r)),u=s?Math.atan2(a,o)*ZM-120:NaN;return new Qa(u<0?u+360:u,s,r,e.opacity)}function gy(e,t,n,i){return arguments.length===1?GB(e):new Qa(e,t,n,i==null?1:i)}function Qa(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}yl(Qa,gy,Rf(va,{brighter(e){return e=e==null?ju:Math.pow(ju,e),new Qa(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?cs:Math.pow(cs,e),new Qa(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*QM,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new gt(255*(t+n*(s3*i+c2*r)),255*(t+n*(f2*i+Xp*r)),255*(t+n*(Zc*i)),this.opacity)}}));function u3(e,t,n,i,r){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*n+(1+3*e+3*o-3*a)*i+a*r)/6}function l3(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],o=e[i+1],a=i>0?e[i-1]:2*r-o,s=i<t-1?e[i+2]:2*o-r;return u3((n-i/t)*t,a,r,o,s)}}function c3(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],o=e[i%t],a=e[(i+1)%t],s=e[(i+2)%t];return u3((n-i/t)*t,r,o,a,s)}}var Vp=e=>()=>e;function f3(e,t){return function(n){return e+n*t}}function HB(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Kp(e,t){var n=t-e;return n?f3(e,n>180||n<-180?n-360*Math.round(n/360):n):Vp(isNaN(e)?t:e)}function YB(e){return(e=+e)==1?pt:function(t,n){return n-t?HB(t,n,e):Vp(isNaN(t)?n:t)}}function pt(e,t){var n=t-e;return n?f3(e,n):Vp(isNaN(e)?t:e)}var py=function e(t){var n=YB(t);function i(r,o){var a=n((r=Ko(r)).r,(o=Ko(o)).r),s=n(r.g,o.g),u=n(r.b,o.b),l=pt(r.opacity,o.opacity);return function(c){return r.r=a(c),r.g=s(c),r.b=u(c),r.opacity=l(c),r+""}}return i.gamma=e,i}(1);function d3(e){return function(t){var n=t.length,i=new Array(n),r=new Array(n),o=new Array(n),a,s;for(a=0;a<n;++a)s=Ko(t[a]),i[a]=s.r||0,r[a]=s.g||0,o[a]=s.b||0;return i=e(i),r=e(r),o=e(o),s.opacity=1,function(u){return s.r=i(u),s.g=r(u),s.b=o(u),s+""}}}var XB=d3(l3),VB=d3(c3);function d2(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(o){for(r=0;r<n;++r)i[r]=e[r]*(1-o)+t[r]*o;return i}}function h3(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function KB(e,t){return(h3(t)?d2:g3)(e,t)}function g3(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),o=new Array(n),a;for(a=0;a<i;++a)r[a]=ba(e[a],t[a]);for(;a<n;++a)o[a]=t[a];return function(s){for(a=0;a<i;++a)o[a]=r[a](s);return o}}function p3(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function mi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function m3(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=ba(e[r],t[r]):i[r]=t[r];return function(o){for(r in n)i[r]=n[r](o);return i}}var my=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Lm=new RegExp(my.source,"g");function JB(e){return function(){return e}}function QB(e){return function(t){return e(t)+""}}function y3(e,t){var n=my.lastIndex=Lm.lastIndex=0,i,r,o,a=-1,s=[],u=[];for(e=e+"",t=t+"";(i=my.exec(e))&&(r=Lm.exec(t));)(o=r.index)>n&&(o=t.slice(n,o),s[a]?s[a]+=o:s[++a]=o),(i=i[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:mi(i,r)})),n=Lm.lastIndex;return n<t.length&&(o=t.slice(n),s[a]?s[a]+=o:s[++a]=o),s.length<2?u[0]?QB(u[0].x):JB(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)s[(f=u[c]).i]=f.x(l);return s.join("")})}function ba(e,t){var n=typeof t,i;return t==null||n==="boolean"?Vp(t):(n==="number"?mi:n==="string"?(i=Qc(t))?(t=i,py):y3:t instanceof Qc?py:t instanceof Date?p3:h3(t)?d2:Array.isArray(t)?g3:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?m3:mi)(e,t)}function ZB(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function eU(e,t){var n=Kp(+e,+t);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}function Pf(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var eO=180/Math.PI,yy={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function v3(e,t,n,i,r,o){var a,s,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,u/=s),e*i<t*n&&(e=-e,t=-t,u=-u,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*eO,skewX:Math.atan(u)*eO,scaleX:a,scaleY:s}}var Sd;function tU(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?yy:v3(t.a,t.b,t.c,t.d,t.e,t.f)}function nU(e){return e==null||(Sd||(Sd=document.createElementNS("http://www.w3.org/2000/svg","g")),Sd.setAttribute("transform",e),!(e=Sd.transform.baseVal.consolidate()))?yy:(e=e.matrix,v3(e.a,e.b,e.c,e.d,e.e,e.f))}function b3(e,t,n,i){function r(l){return l.length?l.pop()+" ":""}function o(l,c,f,d,h,g){if(l!==f||c!==d){var p=h.push("translate(",null,t,null,n);g.push({i:p-4,x:mi(l,f)},{i:p-2,x:mi(c,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function a(l,c,f,d){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:mi(l,c)})):c&&f.push(r(f)+"rotate("+c+i)}function s(l,c,f,d){l!==c?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:mi(l,c)}):c&&f.push(r(f)+"skewX("+c+i)}function u(l,c,f,d,h,g){if(l!==f||c!==d){var p=h.push(r(h)+"scale(",null,",",null,")");g.push({i:p-4,x:mi(l,f)},{i:p-2,x:mi(c,d)})}else(f!==1||d!==1)&&h.push(r(h)+"scale("+f+","+d+")")}return function(l,c){var f=[],d=[];return l=e(l),c=e(c),o(l.translateX,l.translateY,c.translateX,c.translateY,f,d),a(l.rotate,c.rotate,f,d),s(l.skewX,c.skewX,f,d),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,d),l=c=null,function(h){for(var g=-1,p=d.length,m;++g<p;)f[(m=d[g]).i]=m.x(h);return f.join("")}}}var iU=b3(tU,"px, ","px)","deg)"),rU=b3(nU,", ",")",")"),oU=1e-12;function tO(e){return((e=Math.exp(e))+1/e)/2}function aU(e){return((e=Math.exp(e))-1/e)/2}function sU(e){return((e=Math.exp(2*e))-1)/(e+1)}var uU=function e(t,n,i){function r(o,a){var s=o[0],u=o[1],l=o[2],c=a[0],f=a[1],d=a[2],h=c-s,g=f-u,p=h*h+g*g,m,y;if(p<oU)y=Math.log(d/l)/t,m=function(w){return[s+w*h,u+w*g,l*Math.exp(t*w*y)]};else{var v=Math.sqrt(p),b=(d*d-l*l+i*p)/(2*l*n*v),x=(d*d-l*l-i*p)/(2*d*n*v),_=Math.log(Math.sqrt(b*b+1)-b),E=Math.log(Math.sqrt(x*x+1)-x);y=(E-_)/t,m=function(w){var S=w*y,C=tO(_),A=l/(n*v)*(C*sU(t*S+_)-aU(_));return[s+A*h,u+A*g,l*C/tO(t*S+_)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return r.rho=function(o){var a=Math.max(.001,+o),s=a*a,u=s*s;return e(a,s,u)},r}(Math.SQRT2,2,4);function x3(e){return function(t,n){var i=e((t=Xh(t)).h,(n=Xh(n)).h),r=pt(t.s,n.s),o=pt(t.l,n.l),a=pt(t.opacity,n.opacity);return function(s){return t.h=i(s),t.s=r(s),t.l=o(s),t.opacity=a(s),t+""}}}var lU=x3(Kp),cU=x3(pt);function fU(e,t){var n=pt((e=Kh(e)).l,(t=Kh(t)).l),i=pt(e.a,t.a),r=pt(e.b,t.b),o=pt(e.opacity,t.opacity);return function(a){return e.l=n(a),e.a=i(a),e.b=r(a),e.opacity=o(a),e+""}}function w3(e){return function(t,n){var i=e((t=Jh(t)).h,(n=Jh(n)).h),r=pt(t.c,n.c),o=pt(t.l,n.l),a=pt(t.opacity,n.opacity);return function(s){return t.h=i(s),t.c=r(s),t.l=o(s),t.opacity=a(s),t+""}}}var dU=w3(Kp),hU=w3(pt);function _3(e){return function t(n){n=+n;function i(r,o){var a=e((r=gy(r)).h,(o=gy(o)).h),s=pt(r.s,o.s),u=pt(r.l,o.l),l=pt(r.opacity,o.opacity);return function(c){return r.h=a(c),r.s=s(c),r.l=u(Math.pow(c,n)),r.opacity=l(c),r+""}}return i.gamma=t,i}(1)}var gU=_3(Kp),pU=_3(pt);function h2(e,t){t===void 0&&(t=e,e=ba);for(var n=0,i=t.length-1,r=t[0],o=new Array(i<0?0:i);n<i;)o[n]=e(r,r=t[++n]);return function(a){var s=Math.max(0,Math.min(i-1,Math.floor(a*=i)));return o[s](a-s)}}function mU(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}var yU=Object.freeze(Object.defineProperty({__proto__:null,interpolate:ba,interpolateArray:KB,interpolateBasis:l3,interpolateBasisClosed:c3,interpolateDate:p3,interpolateDiscrete:ZB,interpolateHue:eU,interpolateNumber:mi,interpolateNumberArray:d2,interpolateObject:m3,interpolateRound:Pf,interpolateString:y3,interpolateTransformCss:iU,interpolateTransformSvg:rU,interpolateZoom:uU,interpolateRgb:py,interpolateRgbBasis:XB,interpolateRgbBasisClosed:VB,interpolateHsl:lU,interpolateHslLong:cU,interpolateLab:fU,interpolateHcl:dU,interpolateHclLong:hU,interpolateCubehelix:gU,interpolateCubehelixLong:pU,piecewise:h2,quantize:mU},Symbol.toStringTag,{value:"Module"}));function vU(e){return function(){return e}}function vy(e){return+e}var nO=[0,1];function mn(e){return e}function by(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:vU(isNaN(t)?NaN:.5)}function bU(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function xU(e,t,n){var i=e[0],r=e[1],o=t[0],a=t[1];return r<i?(i=by(r,i),o=n(a,o)):(i=by(i,r),o=n(o,a)),function(s){return o(i(s))}}function wU(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),o=new Array(i),a=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<i;)r[a]=by(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(s){var u=Mf(e,s,1,i)-1;return o[u](r[u](s))}}function If(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Jp(){var e=nO,t=nO,n=ba,i,r,o,a=mn,s,u,l;function c(){var d=Math.min(e.length,t.length);return a!==mn&&(a=bU(e[0],e[d-1])),s=d>2?wU:xU,u=l=null,f}function f(d){return d==null||isNaN(d=+d)?o:(u||(u=s(e.map(i),t,n)))(i(a(d)))}return f.invert=function(d){return a(r((l||(l=s(t,e.map(i),mi)))(d)))},f.domain=function(d){return arguments.length?(e=Array.from(d,vy),c()):e.slice()},f.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},f.rangeRound=function(d){return t=Array.from(d),n=Pf,c()},f.clamp=function(d){return arguments.length?(a=d?!0:mn,c()):a!==mn},f.interpolate=function(d){return arguments.length?(n=d,c()):n},f.unknown=function(d){return arguments.length?(o=d,f):o},function(d,h){return i=d,r=h,c()}}function E3(){return Jp()(mn,mn)}function S3(e,t,n,i){var r=Yo(e,t,n),o;switch(i=ls(i==null?",f":i),i.type){case"s":{var a=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(o=KF(r,a))&&(i.precision=o),tx(i,a)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=JF(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=VF(r))&&(i.precision=o-(i.type==="%")*2);break}}return Ap(i)}function js(e){var t=e.domain;return e.ticks=function(n){var i=t();return J1(i[0],i[i.length-1],n==null?10:n)},e.tickFormat=function(n,i){var r=t();return S3(r[0],r[r.length-1],n==null?10:n,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,o=i.length-1,a=i[r],s=i[o],u,l,c=10;for(s<a&&(l=a,a=s,s=l,l=r,r=o,o=l);c-- >0;){if(l=Q1(a,s,n),l===u)return i[r]=a,i[o]=s,t(i);if(l>0)a=Math.floor(a/l)*l,s=Math.ceil(s/l)*l;else if(l<0)a=Math.ceil(a*l)/l,s=Math.floor(s*l)/l;else break;u=l}return e},e}function O3(){var e=E3();return e.copy=function(){return If(e,O3())},kr.apply(e,arguments),js(e)}function A3(e){var t;function n(i){return i==null||isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,vy),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return A3(e).unknown(t)},e=arguments.length?Array.from(e,vy):[0,1],js(n)}function k3(e,t){e=e.slice();var n=0,i=e.length-1,r=e[n],o=e[i],a;return o<r&&(a=n,n=i,i=a,a=r,r=o,o=a),e[n]=t.floor(r),e[i]=t.ceil(o),e}function iO(e){return Math.log(e)}function rO(e){return Math.exp(e)}function _U(e){return-Math.log(-e)}function EU(e){return-Math.exp(-e)}function SU(e){return isFinite(e)?+("1e"+e):e<0?0:e}function OU(e){return e===10?SU:e===Math.E?Math.exp:t=>Math.pow(e,t)}function AU(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function oO(e){return(t,n)=>-e(-t,n)}function g2(e){const t=e(iO,rO),n=t.domain;let i=10,r,o;function a(){return r=AU(i),o=OU(i),n()[0]<0?(r=oO(r),o=oO(o),e(_U,EU)):e(iO,rO),t}return t.base=function(s){return arguments.length?(i=+s,a()):i},t.domain=function(s){return arguments.length?(n(s),a()):n()},t.ticks=s=>{const u=n();let l=u[0],c=u[u.length-1];const f=c<l;f&&([l,c]=[c,l]);let d=r(l),h=r(c),g,p;const m=s==null?10:+s;let y=[];if(!(i%1)&&h-d<m){if(d=Math.floor(d),h=Math.ceil(h),l>0){for(;d<=h;++d)for(g=1;g<i;++g)if(p=d<0?g/o(-d):g*o(d),!(p<l)){if(p>c)break;y.push(p)}}else for(;d<=h;++d)for(g=i-1;g>=1;--g)if(p=d>0?g/o(-d):g*o(d),!(p<l)){if(p>c)break;y.push(p)}y.length*2<m&&(y=J1(l,c,m))}else y=J1(d,h,Math.min(h-d,m)).map(o);return f?y.reverse():y},t.tickFormat=(s,u)=>{if(s==null&&(s=10),u==null&&(u=i===10?"s":","),typeof u!="function"&&(!(i%1)&&(u=ls(u)).precision==null&&(u.trim=!0),u=Ap(u)),s===1/0)return u;const l=Math.max(1,i*s/t.ticks().length);return c=>{let f=c/o(Math.round(r(c)));return f*i<i-.5&&(f*=i),f<=l?u(c):""}},t.nice=()=>n(k3(n(),{floor:s=>o(Math.floor(r(s))),ceil:s=>o(Math.ceil(r(s)))})),t}function C3(){const e=g2(Jp()).domain([1,10]);return e.copy=()=>If(e,C3()).base(e.base()),kr.apply(e,arguments),e}function aO(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function sO(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function p2(e){var t=1,n=e(aO(t),sO(t));return n.constant=function(i){return arguments.length?e(aO(t=+i),sO(t)):t},js(n)}function $3(){var e=p2(Jp());return e.copy=function(){return If(e,$3()).constant(e.constant())},kr.apply(e,arguments)}function uO(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function kU(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function CU(e){return e<0?-e*e:e*e}function m2(e){var t=e(mn,mn),n=1;function i(){return n===1?e(mn,mn):n===.5?e(kU,CU):e(uO(n),uO(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,i()):n},js(t)}function y2(){var e=m2(Jp());return e.copy=function(){return If(e,y2()).exponent(e.exponent())},kr.apply(e,arguments),e}function $U(){return y2.apply(null,arguments).exponent(.5)}function F3(){var e=[],t=[],n=[],i;function r(){var a=0,s=Math.max(1,t.length);for(n=new Array(s-1);++a<s;)n[a-1]=qF(e,a/s);return o}function o(a){return a==null||isNaN(a=+a)?i:t[Mf(n,a)]}return o.invertExtent=function(a){var s=t.indexOf(a);return s<0?[NaN,NaN]:[s>0?n[s-1]:e[0],s<n.length?n[s]:e[e.length-1]]},o.domain=function(a){if(!arguments.length)return e.slice();e=[];for(let s of a)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(Qr),r()},o.range=function(a){return arguments.length?(t=Array.from(a),r()):t.slice()},o.unknown=function(a){return arguments.length?(i=a,o):i},o.quantiles=function(){return n.slice()},o.copy=function(){return F3().domain(e).range(t).unknown(i)},kr.apply(o,arguments)}function T3(){var e=0,t=1,n=1,i=[.5],r=[0,1],o;function a(u){return u!=null&&u<=u?r[Mf(i,u,0,n)]:o}function s(){var u=-1;for(i=new Array(n);++u<n;)i[u]=((u+1)*t-(u-n)*e)/(n+1);return a}return a.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,s()):[e,t]},a.range=function(u){return arguments.length?(n=(r=Array.from(u)).length-1,s()):r.slice()},a.invertExtent=function(u){var l=r.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,i[0]]:l>=n?[i[n-1],t]:[i[l-1],i[l]]},a.unknown=function(u){return arguments.length&&(o=u),a},a.thresholds=function(){return i.slice()},a.copy=function(){return T3().domain([e,t]).range(r).unknown(o)},kr.apply(js(a),arguments)}function M3(){var e=[.5],t=[0,1],n,i=1;function r(o){return o!=null&&o<=o?t[Mf(e,o,0,i)]:n}return r.domain=function(o){return arguments.length?(e=Array.from(o),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(o){return arguments.length?(t=Array.from(o),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(o){var a=t.indexOf(o);return[e[a-1],e[a]]},r.unknown=function(o){return arguments.length?(n=o,r):n},r.copy=function(){return M3().domain(e).range(t).unknown(n)},kr.apply(r,arguments)}function FU(e){return new Date(e)}function TU(e){return e instanceof Date?+e:+new Date(+e)}function v2(e,t,n,i,r,o,a,s,u,l){var c=E3(),f=c.invert,d=c.domain,h=l(".%L"),g=l(":%S"),p=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),v=l("%b %d"),b=l("%B"),x=l("%Y");function _(E){return(u(E)<E?h:s(E)<E?g:a(E)<E?p:o(E)<E?m:i(E)<E?r(E)<E?y:v:n(E)<E?b:x)(E)}return c.invert=function(E){return new Date(f(E))},c.domain=function(E){return arguments.length?d(Array.from(E,TU)):d().map(FU)},c.ticks=function(E){var w=d();return e(w[0],w[w.length-1],E==null?10:E)},c.tickFormat=function(E,w){return w==null?_:l(w)},c.nice=function(E){var w=d();return(!E||typeof E.range!="function")&&(E=t(w[0],w[w.length-1],E==null?10:E)),E?d(k3(w,E)):c},c.copy=function(){return If(c,v2(e,t,n,i,r,o,a,s,u,l))},c}function MU(){return kr.apply(v2(I8,L8,cr,Hc,dl,Zr,$p,kp,Hr,ax).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function DU(){return kr.apply(v2(R8,P8,fr,Yc,hl,Io,Fp,Cp,Hr,sx).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Qp(){var e=0,t=1,n,i,r,o,a=mn,s=!1,u;function l(f){return f==null||isNaN(f=+f)?u:a(r===0?.5:(f=(o(f)-n)*r,s?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=o(e=+e),i=o(t=+t),r=n===i?0:1/(i-n),l):[e,t]},l.clamp=function(f){return arguments.length?(s=!!f,l):s},l.interpolator=function(f){return arguments.length?(a=f,l):a};function c(f){return function(d){var h,g;return arguments.length?([h,g]=d,a=f(h,g),l):[a(0),a(1)]}}return l.range=c(ba),l.rangeRound=c(Pf),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return o=f,n=f(e),i=f(t),r=n===i?0:1/(i-n),l}}function xa(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function b2(){var e=js(Qp()(mn));return e.copy=function(){return xa(e,b2())},ya.apply(e,arguments)}function D3(){var e=g2(Qp()).domain([1,10]);return e.copy=function(){return xa(e,D3()).base(e.base())},ya.apply(e,arguments)}function N3(){var e=p2(Qp());return e.copy=function(){return xa(e,N3()).constant(e.constant())},ya.apply(e,arguments)}function x2(){var e=m2(Qp());return e.copy=function(){return xa(e,x2()).exponent(e.exponent())},ya.apply(e,arguments)}function NU(){return x2.apply(null,arguments).exponent(.5)}function Zp(){var e=0,t=.5,n=1,i=1,r,o,a,s,u,l=mn,c,f=!1,d;function h(p){return isNaN(p=+p)?d:(p=.5+((p=+c(p))-o)*(i*p<i*o?s:u),l(f?Math.max(0,Math.min(1,p)):p))}h.domain=function(p){return arguments.length?([e,t,n]=p,r=c(e=+e),o=c(t=+t),a=c(n=+n),s=r===o?0:.5/(o-r),u=o===a?0:.5/(a-o),i=o<r?-1:1,h):[e,t,n]},h.clamp=function(p){return arguments.length?(f=!!p,h):f},h.interpolator=function(p){return arguments.length?(l=p,h):l};function g(p){return function(m){var y,v,b;return arguments.length?([y,v,b]=m,l=h2(p,[y,v,b]),h):[l(0),l(.5),l(1)]}}return h.range=g(ba),h.rangeRound=g(Pf),h.unknown=function(p){return arguments.length?(d=p,h):d},function(p){return c=p,r=p(e),o=p(t),a=p(n),s=r===o?0:.5/(o-r),u=o===a?0:.5/(a-o),i=o<r?-1:1,h}}function j3(){var e=js(Zp()(mn));return e.copy=function(){return xa(e,j3())},ya.apply(e,arguments)}function R3(){var e=g2(Zp()).domain([.1,1,10]);return e.copy=function(){return xa(e,R3()).base(e.base())},ya.apply(e,arguments)}function P3(){var e=p2(Zp());return e.copy=function(){return xa(e,P3()).constant(e.constant())},ya.apply(e,arguments)}function w2(){var e=m2(Zp());return e.copy=function(){return xa(e,w2()).exponent(e.exponent())},ya.apply(e,arguments)}function jU(){return w2.apply(null,arguments).exponent(.5)}function _2(e,t,n){const i=e-t+n*2;return e?i>0?i:1:0}const RU="identity",Ru="linear",ro="log",Lf="pow",zf="sqrt",e0="symlog",fs="time",ds="utc",or="sequential",vl="diverging",Pu="quantile",t0="quantize",n0="threshold",E2="ordinal",xy="point",I3="band",S2="bin-ordinal",ct="continuous",Bf="discrete",Uf="discretizing",si="interpolating",O2="temporal";function PU(e){return function(t){let n=t[0],i=t[1],r;return i<n&&(r=n,n=i,i=r),[e.invert(n),e.invert(i)]}}function IU(e){return function(t){const n=e.range();let i=t[0],r=t[1],o=-1,a,s,u,l;for(r<i&&(s=i,i=r,r=s),u=0,l=n.length;u<l;++u)n[u]>=i&&n[u]<=r&&(o<0&&(o=u),a=u);if(!(o<0))return i=e.invertExtent(n[o]),r=e.invertExtent(n[a]),[i[0]===void 0?i[1]:i[0],r[1]===void 0?r[0]:r[1]]}}function A2(){const e=u2().unknown(void 0),t=e.domain,n=e.range;let i=[0,1],r,o,a=!1,s=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,d=i[1]<i[0],h=i[1-d],g=_2(f,s,u);let p=i[d-0];r=(h-p)/(g||1),a&&(r=Math.floor(r)),p+=(h-p-r*(f-s))*l,o=r*(1-s),a&&(p=Math.round(p),o=Math.round(o));const m=jn(f).map(y=>p+r*y);return n(d?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(i=[+f[0],+f[1]],c()):i.slice()},e.rangeRound=function(f){return i=[+f[0],+f[1]],a=!0,c()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(f){return arguments.length?(a=!!f,c()):a},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),s=u,c()):s},e.paddingInner=function(f){return arguments.length?(s=Math.max(0,Math.min(1,f)),c()):s},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const d=i[1]<i[0],h=d?n().reverse():n(),g=h.length-1;let p=+f[0],m=+f[1],y,v,b;if(!(p!==p||m!==m)&&(m<p&&(b=p,p=m,m=b),!(m<h[0]||p>i[1-d])))return y=Math.max(0,jh(h,p)-1),v=p===m?y:jh(h,m)-1,p-h[y]>o+1e-10&&++y,d&&(b=y,y=g-v,v=g-b),y>v?void 0:t().slice(y,v+1)},e.invert=function(f){const d=e.invertRange([f,f]);return d&&d[0]},e.copy=function(){return A2().domain(t()).range(i).round(a).paddingInner(s).paddingOuter(u).align(l)},c()}function L3(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return L3(t())},e}function LU(){return L3(A2().paddingInner(1))}var zU=Array.prototype.map;function BU(e){return zU.call(e,Rt)}const UU=Array.prototype.slice;function z3(){let e=[],t=[];function n(i){return i==null||i!==i?void 0:t[(Mf(e,i)-1)%t.length]}return n.domain=function(i){return arguments.length?(e=BU(i),n):e.slice()},n.range=function(i){return arguments.length?(t=UU.call(i),n):t.slice()},n.tickFormat=function(i,r){return S3(e[0],ve(e),i==null?10:i,r)},n.copy=function(){return z3().domain(n.domain()).range(n.range())},n}const Qh={};function qU(e,t,n){const i=function(){const o=t();return o.invertRange||(o.invertRange=o.invert?PU(o):o.invertExtent?IU(o):void 0),o.type=e,o};return i.metadata=Mi(V(n)),i}function Ae(e,t,n){return arguments.length>1?(Qh[e]=qU(e,t,n),this):B3(e)?Qh[e]:void 0}Ae(RU,A3);Ae(Ru,O3,ct);Ae(ro,C3,[ct,ro]);Ae(Lf,y2,ct);Ae(zf,$U,ct);Ae(e0,$3,ct);Ae(fs,MU,[ct,O2]);Ae(ds,DU,[ct,O2]);Ae(or,b2,[ct,si]);Ae("".concat(or,"-").concat(Ru),b2,[ct,si]);Ae("".concat(or,"-").concat(ro),D3,[ct,si,ro]);Ae("".concat(or,"-").concat(Lf),x2,[ct,si]);Ae("".concat(or,"-").concat(zf),NU,[ct,si]);Ae("".concat(or,"-").concat(e0),N3,[ct,si]);Ae("".concat(vl,"-").concat(Ru),j3,[ct,si]);Ae("".concat(vl,"-").concat(ro),R3,[ct,si,ro]);Ae("".concat(vl,"-").concat(Lf),w2,[ct,si]);Ae("".concat(vl,"-").concat(zf),jU,[ct,si]);Ae("".concat(vl,"-").concat(e0),P3,[ct,si]);Ae(Pu,F3,[Uf,Pu]);Ae(t0,T3,Uf);Ae(n0,M3,Uf);Ae(S2,z3,[Bf,Uf]);Ae(E2,u2,Bf);Ae(I3,A2,Bf);Ae(xy,LU,Bf);function B3(e){return ee(Qh,e)}function Rs(e,t){const n=Qh[e];return n&&n.metadata[t]}function k2(e){return Rs(e,ct)}function Iu(e){return Rs(e,Bf)}function wy(e){return Rs(e,Uf)}function U3(e){return Rs(e,ro)}function WU(e){return Rs(e,O2)}function q3(e){return Rs(e,si)}function W3(e){return Rs(e,Pu)}const GU=["clamp","base","constant","exponent"];function G3(e,t){const n=t[0],i=ve(t)-n;return function(r){return e(n+r*i)}}function i0(e,t,n){return h2(C2(t||"rgb",n),e)}function H3(e,t){const n=new Array(t),i=t+1;for(let r=0;r<t;)n[r]=e(++r/i);return n}function Y3(e,t,n){const i=n-t;let r,o,a;return!i||!Number.isFinite(i)?Gt(.5):(r=(o=e.type).indexOf("-"),o=r<0?o:o.slice(r+1),a=Ae(o)().domain([t,n]).range([0,1]),GU.forEach(s=>e[s]?a[s](e[s]()):0),a)}function C2(e,t){const n=yU[HU(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function HU(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const YU={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},XU={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function X3(e){const t=e.length/6|0,n=new Array(t);for(let i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}function V3(e,t){for(const n in e)$2(n,t(e[n]))}const lO={};V3(XU,X3);V3(YU,e=>i0(X3(e)));function $2(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(lO[e]=t,this):lO[e]}const lh="symbol",VU="discrete",KU="gradient",JU=e=>I(e)?e.map(t=>String(t)):String(e),QU=(e,t)=>e[1]-t[1],ZU=(e,t)=>t[1]-e[1];function F2(e,t,n){let i;return De(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(Sf(e.domain())/n||1)))),K(t)&&(i=t.step,t=t.interval),Y(t)&&(t=e.type===fs?gl(t):e.type==ds?pl(t):P("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function K3(e,t,n){let i=e.range(),r=i[0],o=ve(i),a=QU;if(r>o&&(i=o,o=r,r=i,a=ZU),r=Math.floor(r),o=Math.ceil(o),t=t.map(s=>[s,e(s)]).filter(s=>r<=s[1]&&s[1]<=o).sort(a).map(s=>s[0]),n>0&&t.length>1){const s=[t[0],ve(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=s)}return t}function T2(e,t){return e.bins?K3(e,e.bins):e.ticks?e.ticks(t):e.domain()}function J3(e,t,n,i,r,o){const a=t.type;let s=JU;if(a===fs||r===fs)s=e.timeFormat(i);else if(a===ds||r===ds)s=e.utcFormat(i);else if(U3(a)){const u=e.formatFloat(i);if(o||t.bins)s=u;else{const l=Q3(t,n,!1);s=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();s=e.formatSpan(u[0],u[u.length-1],n,i)}else i&&(s=e.format(i));return s}function Q3(e,t,n){const i=T2(e,t),r=e.base(),o=Math.log(r),a=Math.max(1,r*t/i.length),s=u=>{let l=u/Math.pow(r,Math.round(Math.log(u)/o));return l*r<r-.5&&(l*=r),l<=a};return n?i.filter(s):s}const _y={[Pu]:"quantiles",[t0]:"thresholds",[n0]:"domain"},Z3={[Pu]:"quantiles",[t0]:"domain"};function eD(e,t){return e.bins?nq(e.bins):e.type===ro?Q3(e,t,!0):_y[e.type]?tq(e[_y[e.type]]()):T2(e,t)}function eq(e,t,n){const i=t[Z3[t.type]](),r=i.length;let o=r>1?i[1]-i[0]:i[0],a;for(a=1;a<r;++a)o=Math.min(o,i[a]-i[a-1]);return e.formatSpan(0,o,3*10,n)}function tq(e){const t=[-1/0].concat(e);return t.max=1/0,t}function nq(e){const t=e.slice(0,-1);return t.max=ve(e),t}const iq=e=>_y[e.type]||e.bins;function tD(e,t,n,i,r,o,a){const s=Z3[t.type]&&o!==fs&&o!==ds?eq(e,t,r):J3(e,t,n,r,o,a);return i===lh&&iq(t)?rq(s):i===VU?oq(s):aq(s)}const rq=e=>(t,n,i)=>{const r=cO(i[n+1],cO(i.max,1/0)),o=fO(t,e),a=fO(r,e);return o&&a?o+" \u2013 "+a:a?"< "+a:"\u2265 "+o},cO=(e,t)=>e!=null?e:t,oq=e=>(t,n)=>n?e(t):null,aq=e=>t=>e(t),fO=(e,t)=>Number.isFinite(e)?t(e):null;function sq(e){const t=e.domain(),n=t.length-1;let i=+t[0],r=+ve(t),o=r-i;if(e.type===n0){const a=n?o/n:.1;i-=a,r+=a,o=r-i}return a=>(a-i)/o}function uq(e,t,n,i){const r=i||t.type;return Y(n)&&WU(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&r===fs?e.timeFormat("%A, %d %B %Y, %X"):!n&&r===ds?e.utcFormat("%A, %d %B %Y, %X UTC"):tD(e,t,5,null,n,i,!0)}function nD(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=uq(e,t,n.format,n.formatType);if(wy(t.type)){const o=eD(t).slice(1).map(r),a=o.length;return"".concat(a," boundar").concat(a===1?"y":"ies",": ").concat(o.join(", "))}else if(Iu(t.type)){const o=t.domain(),a=o.length,s=a>i?o.slice(0,i-2).map(r).join(", ")+", ending with "+o.slice(-1).map(r):o.map(r).join(", ");return"".concat(a," value").concat(a===1?"":"s",": ").concat(s)}else{const o=t.domain();return"values from ".concat(r(o[0])," to ").concat(r(ve(o)))}}let iD=0;function lq(){iD=0}const Zh="p_";function M2(e){return e&&e.gradient}function rD(e,t,n){const i=e.gradient;let r=e.id,o=i==="radial"?Zh:"";return r||(r=e.id="gradient_"+iD++,i==="radial"?(e.x1=qi(e.x1,.5),e.y1=qi(e.y1,.5),e.r1=qi(e.r1,0),e.x2=qi(e.x2,.5),e.y2=qi(e.y2,.5),e.r2=qi(e.r2,.5),o=Zh):(e.x1=qi(e.x1,0),e.y1=qi(e.y1,0),e.x2=qi(e.x2,1),e.y2=qi(e.y2,0))),t[r]=e,"url("+(n||"")+"#"+o+r+")"}function qi(e,t){return e!=null?e:t}function oD(e,t){var n=[],i;return i={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(r,o){return n.push({offset:r,color:o}),i}}}const dO={basis:{curve:pB},"basis-closed":{curve:mB},"basis-open":{curve:yB},bundle:{curve:vB,tension:"beta",value:.85},cardinal:{curve:bB,tension:"tension",value:0},"cardinal-open":{curve:wB,tension:"tension",value:0},"cardinal-closed":{curve:xB,tension:"tension",value:0},"catmull-rom":{curve:_B,tension:"alpha",value:.5},"catmull-rom-closed":{curve:EB,tension:"alpha",value:.5},"catmull-rom-open":{curve:SB,tension:"alpha",value:.5},linear:{curve:i2},"linear-closed":{curve:OB},monotone:{horizontal:kB,vertical:AB},natural:{curve:CB},step:{curve:$B},"step-after":{curve:TB},"step-before":{curve:FB}};function D2(e,t,n){var i=ee(dO,e)&&dO[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&n!=null&&(r=r[i.tension](n))),r}const cq={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},fq=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,dq=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,hq=/^((\s+,?\s*)|(,\s*))/,gq=/^[01]/;function Lu(e){const t=[];return(e.match(fq)||[]).forEach(i=>{let r=i[0];const o=r.toLowerCase(),a=cq[o],s=pq(o,a,i.slice(1).trim()),u=s.length;if(u<a||u&&u%a!==0)throw Error("Invalid SVG path, incorrect parameter count");if(t.push([r,...s.slice(0,a)]),u!==a){o==="m"&&(r=r==="M"?"L":"l");for(let l=a;l<u;l+=a)t.push([r,...s.slice(l,l+a)])}}),t}function pq(e,t,n){const i=[];for(let r=0;t&&r<n.length;)for(let o=0;o<t;++o){const a=e==="a"&&(o===3||o===4)?gq:dq,s=n.slice(r).match(a);if(s===null)throw Error("Invalid SVG path, incorrect parameter type");r+=s[0].length,i.push(+s[0]);const u=n.slice(r).match(hq);u!==null&&(r+=u[0].length)}return i}const Jo=Math.PI/180,mq=1e-14,La=Math.PI/2,Vi=Math.PI*2,Ys=Math.sqrt(3)/2;var zm={},Bm={},aD=[].join;function yq(e,t,n,i,r,o,a,s,u){const l=aD.call(arguments);if(zm[l])return zm[l];const c=a*Jo,f=Math.sin(c),d=Math.cos(c);n=Math.abs(n),i=Math.abs(i);const h=d*(s-e)*.5+f*(u-t)*.5,g=d*(u-t)*.5-f*(s-e)*.5;let p=h*h/(n*n)+g*g/(i*i);p>1&&(p=Math.sqrt(p),n*=p,i*=p);const m=d/n,y=f/n,v=-f/i,b=d/i,x=m*s+y*u,_=v*s+b*u,E=m*e+y*t,w=v*e+b*t,S=(E-x)*(E-x)+(w-_)*(w-_);let C=1/S-.25;C<0&&(C=0);let A=Math.sqrt(C);o==r&&(A=-A);const O=.5*(x+E)-A*(w-_),F=.5*(_+w)+A*(E-x),k=Math.atan2(_-F,x-O);let $=Math.atan2(w-F,E-O)-k;$<0&&o===1?$+=Vi:$>0&&o===0&&($-=Vi);const T=Math.ceil(Math.abs($/(La+.001))),D=[];for(let R=0;R<T;++R){const L=k+R*$/T,J=k+(R+1)*$/T;D[R]=[O,F,L,J,n,i,f,d]}return zm[l]=D}function vq(e){const t=aD.call(e);if(Bm[t])return Bm[t];var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7];const c=l*a,f=-u*s,d=u*a,h=l*s,g=Math.cos(r),p=Math.sin(r),m=Math.cos(o),y=Math.sin(o),v=.5*(o-r),b=Math.sin(v*.5),x=8/3*b*b/Math.sin(v),_=n+g-x*p,E=i+p+x*g,w=n+m,S=i+y,C=w+x*y,A=S-x*m;return Bm[t]=[c*_+f*E,d*_+h*E,c*C+f*A,d*C+h*A,c*w+f*S,d*w+h*S]}const Gn=["l",0,0,0,0,0,0,0];function bq(e,t,n){const i=Gn[0]=e[0];if(i==="a"||i==="A")Gn[1]=t*e[1],Gn[2]=n*e[2],Gn[3]=e[3],Gn[4]=e[4],Gn[5]=e[5],Gn[6]=t*e[6],Gn[7]=n*e[7];else if(i==="h"||i==="H")Gn[1]=t*e[1];else if(i==="v"||i==="V")Gn[1]=n*e[1];else for(var r=1,o=e.length;r<o;++r)Gn[r]=(r%2==1?t:n)*e[r];return Gn}function ef(e,t,n,i,r,o){var a,s=null,u=0,l=0,c=0,f=0,d,h,g,p,m=0,y=0;n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),o==null&&(o=r),e.beginPath&&e.beginPath();for(var v=0,b=t.length;v<b;++v){switch(a=t[v],(r!==1||o!==1)&&(a=bq(a,r,o)),a[0]){case"l":u+=a[1],l+=a[2],e.lineTo(u+n,l+i);break;case"L":u=a[1],l=a[2],e.lineTo(u+n,l+i);break;case"h":u+=a[1],e.lineTo(u+n,l+i);break;case"H":u=a[1],e.lineTo(u+n,l+i);break;case"v":l+=a[1],e.lineTo(u+n,l+i);break;case"V":l=a[1],e.lineTo(u+n,l+i);break;case"m":u+=a[1],l+=a[2],m=u,y=l,e.moveTo(u+n,l+i);break;case"M":u=a[1],l=a[2],m=u,y=l,e.moveTo(u+n,l+i);break;case"c":d=u+a[5],h=l+a[6],c=u+a[3],f=l+a[4],e.bezierCurveTo(u+a[1]+n,l+a[2]+i,c+n,f+i,d+n,h+i),u=d,l=h;break;case"C":u=a[5],l=a[6],c=a[3],f=a[4],e.bezierCurveTo(a[1]+n,a[2]+i,c+n,f+i,u+n,l+i);break;case"s":d=u+a[3],h=l+a[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+i,u+a[1]+n,l+a[2]+i,d+n,h+i),c=u+a[1],f=l+a[2],u=d,l=h;break;case"S":d=a[3],h=a[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+i,a[1]+n,a[2]+i,d+n,h+i),u=d,l=h,c=a[1],f=a[2];break;case"q":d=u+a[3],h=l+a[4],c=u+a[1],f=l+a[2],e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h;break;case"Q":d=a[3],h=a[4],e.quadraticCurveTo(a[1]+n,a[2]+i,d+n,h+i),u=d,l=h,c=a[1],f=a[2];break;case"t":d=u+a[1],h=l+a[2],s[0].match(/[QqTt]/)===null?(c=u,f=l):s[0]==="t"?(c=2*u-g,f=2*l-p):s[0]==="q"&&(c=2*u-c,f=2*l-f),g=c,p=f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h,c=u+a[1],f=l+a[2];break;case"T":d=a[1],h=a[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h;break;case"a":hO(e,u+n,l+i,[a[1],a[2],a[3],a[4],a[5],a[6]+u+n,a[7]+l+i]),u+=a[6],l+=a[7];break;case"A":hO(e,u+n,l+i,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+i]),u=a[6],l=a[7];break;case"z":case"Z":u=m,l=y,e.closePath();break}s=a}}function hO(e,t,n,i){const r=yq(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n);for(let o=0;o<r.length;++o){const a=vq(r[o]);e.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])}}const gO=.5773502691896257,pO={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Vi)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,o=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-o),e.lineTo(r,-o),e.lineTo(0,-n),e.lineTo(-r,-o),e.lineTo(-i,-o),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n,r=i-n*gO,o=n/4;e.moveTo(0,-i-r),e.lineTo(-o,i-r),e.lineTo(o,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n,r=i-n*gO;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ys*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function sD(e){return ee(pO,e)?pO[e]:xq(e)}var Um={};function xq(e){if(!ee(Um,e)){const t=Lu(e);Um[e]={draw:function(n,i){ef(n,t,0,0,Math.sqrt(i)/2)}}}return Um[e]}const yo=.448084975506;function wq(e){return e.x}function _q(e){return e.y}function Eq(e){return e.width}function Sq(e){return e.height}function Dr(e){return typeof e=="function"?e:()=>+e}function Od(e,t,n){return Math.max(t,Math.min(e,n))}function uD(){var e=wq,t=_q,n=Eq,i=Sq,r=Dr(0),o=r,a=r,s=r,u=null;function l(c,f,d){var h,g=f!=null?f:+e.call(this,c),p=d!=null?d:+t.call(this,c),m=+n.call(this,c),y=+i.call(this,c),v=Math.min(m,y)/2,b=Od(+r.call(this,c),0,v),x=Od(+o.call(this,c),0,v),_=Od(+a.call(this,c),0,v),E=Od(+s.call(this,c),0,v);if(u||(u=h=Wp()),b<=0&&x<=0&&_<=0&&E<=0)u.rect(g,p,m,y);else{var w=g+m,S=p+y;u.moveTo(g+b,p),u.lineTo(w-x,p),u.bezierCurveTo(w-yo*x,p,w,p+yo*x,w,p+x),u.lineTo(w,S-E),u.bezierCurveTo(w,S-yo*E,w-yo*E,S,w-E,S),u.lineTo(g+_,S),u.bezierCurveTo(g+yo*_,S,g,S-yo*_,g,S-_),u.lineTo(g,p+b),u.bezierCurveTo(g,p+yo*b,g+yo*b,p,g+b,p),u.closePath()}if(h)return u=null,h+""||null}return l.x=function(c){return arguments.length?(e=Dr(c),l):e},l.y=function(c){return arguments.length?(t=Dr(c),l):t},l.width=function(c){return arguments.length?(n=Dr(c),l):n},l.height=function(c){return arguments.length?(i=Dr(c),l):i},l.cornerRadius=function(c,f,d,h){return arguments.length?(r=Dr(c),o=f!=null?Dr(f):r,s=d!=null?Dr(d):r,a=h!=null?Dr(h):o,l):r},l.context=function(c){return arguments.length?(u=c==null?null:c,l):u},l}function lD(){var e,t,n,i,r=null,o,a,s,u;function l(f,d,h){const g=h/2;if(o){var p=s-d,m=f-a;if(p||m){var y=Math.sqrt(p*p+m*m),v=(p/=y)*u,b=(m/=y)*u,x=Math.atan2(m,p);r.moveTo(a-v,s-b),r.lineTo(f-p*g,d-m*g),r.arc(f,d,g,x-Math.PI,x),r.lineTo(a+v,s+b),r.arc(a,s,u,x,x+Math.PI)}else r.arc(f,d,g,0,Vi);r.closePath()}else o=1;a=f,s=d,u=g}function c(f){var d,h=f.length,g,p=!1,m;for(r==null&&(r=m=Wp()),d=0;d<=h;++d)!(d<h&&i(g=f[d],d,f))===p&&(p=!p)&&(o=0),p&&l(+e(g,d,f),+t(g,d,f),+n(g,d,f));if(m)return r=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(i=f,c):i},c.context=function(f){return arguments.length?(f==null?r=null:r=f,c):r},c}function qf(e,t){return e!=null?e:t}const Wf=e=>e.x||0,Gf=e=>e.y||0,Oq=e=>e.width||0,Aq=e=>e.height||0,kq=e=>(e.x||0)+(e.width||0),Cq=e=>(e.y||0)+(e.height||0),$q=e=>e.startAngle||0,Fq=e=>e.endAngle||0,Tq=e=>e.padAngle||0,Mq=e=>e.innerRadius||0,Dq=e=>e.outerRadius||0,Nq=e=>e.cornerRadius||0,jq=e=>qf(e.cornerRadiusTopLeft,e.cornerRadius)||0,Rq=e=>qf(e.cornerRadiusTopRight,e.cornerRadius)||0,Pq=e=>qf(e.cornerRadiusBottomRight,e.cornerRadius)||0,Iq=e=>qf(e.cornerRadiusBottomLeft,e.cornerRadius)||0,Lq=e=>qf(e.size,64),zq=e=>e.size||1,r0=e=>e.defined!==!1,Bq=e=>sD(e.shape||"circle"),Uq=dB().startAngle($q).endAngle(Fq).padAngle(Tq).innerRadius(Mq).outerRadius(Dq).cornerRadius(Nq),qq=zM().x(Wf).y1(Gf).y0(Cq).defined(r0),Wq=zM().y(Gf).x1(Wf).x0(kq).defined(r0),Gq=LM().x(Wf).y(Gf).defined(r0),Hq=uD().x(Wf).y(Gf).width(Oq).height(Aq).cornerRadius(jq,Rq,Pq,Iq),Yq=gB().type(Bq).size(Lq),Xq=lD().x(Wf).y(Gf).defined(r0).size(zq);function N2(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function Vq(e,t){return Uq.context(e)(t)}function Kq(e,t){const n=t[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?Wq:qq).curve(D2(i,n.orient,n.tension)).context(e)(t)}function Jq(e,t){const n=t[0],i=n.interpolate||"linear";return Gq.curve(D2(i,n.orient,n.tension)).context(e)(t)}function bl(e,t,n,i){return Hq.context(e)(t,n,i)}function Qq(e,t){return(t.mark.shape||t.shape).context(e)(t)}function Zq(e,t){return Yq.context(e)(t)}function eW(e,t){return Xq.context(e)(t)}var cD=1;function fD(){cD=1}function j2(e,t,n){var i=t.clip,r=e._defs,o=t.clip_id||(t.clip_id="clip"+cD++),a=r.clipping[o]||(r.clipping[o]={id:o});return fe(i)?a.path=i(null):N2(n)?a.path=bl(null,n,0,0):(a.width=n.width||0,a.height=n.height||0),"url(#"+o+")"}function it(e){this.clear(),e&&this.union(e)}it.prototype={clone(){return new it(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(e,t,n){var{x1:i,y1:r,x2:o,y2:a}=this,s=Math.cos(e),u=Math.sin(e),l=t-t*s+n*u,c=n-t*u-n*s;return[s*i-u*r+l,u*i+s*r+c,s*i-u*a+l,u*i+s*a+c,s*o-u*r+l,u*o+s*r+c,s*o-u*a+l,u*o+s*a+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function o0(e){this.mark=e,this.bounds=this.bounds||new it}function a0(e){o0.call(this,e),this.items=this.items||[]}W(a0,o0);function R2(e){this._pending=0,this._loader=e||Mp()}function mO(e){e._pending+=1}function Ul(e){e._pending-=1}R2.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return mO(t),t._loader.sanitize(e,{context:"href"}).then(n=>(Ul(t),n)).catch(()=>(Ul(t),null))},loadImage(e){const t=this,n=MB();return mO(t),t._loader.sanitize(e,{context:"image"}).then(i=>{const r=i.href;if(!r||!n)throw{url:r};const o=new n,a=ee(i,"crossOrigin")?i.crossOrigin:"anonymous";return a!=null&&(o.crossOrigin=a),o.onload=()=>Ul(t),o.onerror=()=>Ul(t),o.src=r,o}).catch(i=>(Ul(t),{complete:!1,width:0,height:0,src:i&&i.url||""}))},ready(){const e=this;return new Promise(t=>{function n(i){e.pending()?setTimeout(()=>{n(!0)},10):t(i)}n(!1)})}};function co(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const i=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(i+(n?tW(t,i):0))}return e}function tW(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const nW=Vi-1e-8;let s0,ch,fh,Ha,Ey,dh,Sy,Oy;const $o=(e,t)=>s0.add(e,t),hh=(e,t)=>$o(ch=e,fh=t),yO=e=>$o(e,s0.y1),vO=e=>$o(s0.x1,e),za=(e,t)=>Ey*e+Sy*t,Ba=(e,t)=>dh*e+Oy*t,qm=(e,t)=>$o(za(e,t),Ba(e,t)),Wm=(e,t)=>hh(za(e,t),Ba(e,t));function Hf(e,t){return s0=e,t?(Ha=t*Jo,Ey=Oy=Math.cos(Ha),dh=Math.sin(Ha),Sy=-dh):(Ey=Oy=1,Ha=dh=Sy=0),iW}const iW={beginPath(){},closePath(){},moveTo:Wm,lineTo:Wm,rect(e,t,n,i){Ha?(qm(e+n,t),qm(e+n,t+i),qm(e,t+i),Wm(e,t)):($o(e+n,t+i),hh(e,t))},quadraticCurveTo(e,t,n,i){const r=za(e,t),o=Ba(e,t),a=za(n,i),s=Ba(n,i);bO(ch,r,a,yO),bO(fh,o,s,vO),hh(a,s)},bezierCurveTo(e,t,n,i,r,o){const a=za(e,t),s=Ba(e,t),u=za(n,i),l=Ba(n,i),c=za(r,o),f=Ba(r,o);xO(ch,a,u,c,yO),xO(fh,s,l,f,vO),hh(c,f)},arc(e,t,n,i,r,o){if(i+=Ha,r+=Ha,ch=n*Math.cos(r)+e,fh=n*Math.sin(r)+t,Math.abs(r-i)>nW)$o(e-n,t-n),$o(e+n,t+n);else{const a=l=>$o(n*Math.cos(l)+e,n*Math.sin(l)+t);let s,u;if(a(i),a(r),r!==i)if(i=i%Vi,i<0&&(i+=Vi),r=r%Vi,r<0&&(r+=Vi),r<i&&(o=!o,s=i,i=r,r=s),o)for(r-=Vi,s=i-i%La,u=0;u<4&&s>r;++u,s-=La)a(s);else for(s=i-i%La+La,u=0;u<4&&s<r;++u,s=s+La)a(s)}}};function bO(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}function xO(e,t,n,i,r){const o=i-e+3*t-3*n,a=e+n-2*t,s=e-t;let u=0,l=0,c;Math.abs(o)>mq?(c=a*a+s*o,c>=0&&(c=Math.sqrt(c),u=(-a+c)/o,l=(-a-c)/o)):u=.5*s/a,0<u&&u<1&&r(wO(u,e,t,n,i)),0<l&&l<1&&r(wO(l,e,t,n,i))}function wO(e,t,n,i,r){const o=1-e,a=o*o,s=e*e;return a*o*t+3*a*e*n+3*o*s*i+s*e*r}var Bo=(Bo=zo(1,1))?Bo.getContext("2d"):null;const Ay=new it;function P2(e){return function(t,n){if(!Bo)return!0;e(Bo,t),Ay.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:o,y2:a}=Ay;for(let s=r;s<=a;++s)for(let u=i;u<=o;++u)if(Bo.isPointInPath(u,s))return!0;return!1}}function I2(e,t){return t.contains(e.x||0,e.y||0)}function dD(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,o=e.height||0;return t.intersects(Ay.set(n,i,n+r,i+o))}function hD(e,t){const n=e.x||0,i=e.y||0,r=e.x2!=null?e.x2:n,o=e.y2!=null?e.y2:i;return uu(t,n,i,r,o)}function uu(e,t,n,i,r){const{x1:o,y1:a,x2:s,y2:u}=e,l=i-t,c=r-n;let f=0,d=1,h,g,p,m;for(m=0;m<4;++m){if(m===0&&(h=-l,g=-(o-t)),m===1&&(h=l,g=s-t),m===2&&(h=-c,g=-(a-n)),m===3&&(h=c,g=u-n),Math.abs(h)<1e-10&&g<0)return!1;if(p=g/h,h<0){if(p>d)return!1;p>f&&(f=p)}else if(h>0){if(p<f)return!1;p<d&&(d=p)}}return!0}function zu(e,t){e.globalCompositeOperation=t.blend||"source-over"}function fi(e,t){return e==null?t:e}function _O(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function rW(e,t,n){const i=n.width(),r=n.height();let o;if(t.gradient==="radial")o=e.createRadialGradient(n.x1+fi(t.x1,.5)*i,n.y1+fi(t.y1,.5)*r,Math.max(i,r)*fi(t.r1,0),n.x1+fi(t.x2,.5)*i,n.y1+fi(t.y2,.5)*r,Math.max(i,r)*fi(t.r2,.5));else{const a=fi(t.x1,0),s=fi(t.y1,0),u=fi(t.x2,1),l=fi(t.y2,0);if(a===u||s===l||i===r)o=e.createLinearGradient(n.x1+a*i,n.y1+s*r,n.x1+u*i,n.y1+l*r);else{const c=zo(Math.ceil(i),Math.ceil(r)),f=c.getContext("2d");return f.scale(i,r),f.fillStyle=_O(f.createLinearGradient(a,s,u,l),t.stops),f.fillRect(0,0,i,r),e.createPattern(c,"no-repeat")}}return _O(o,t.stops)}function gD(e,t,n){return M2(n)?rW(e,n,t.bounds):n}function eg(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=gD(e,t,t.fill),!0):!1}var oW=[];function Bu(e,t,n){var i=(i=t.strokeWidth)!=null?i:1;return i<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=gD(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||oW),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function aW(e,t){return e.zindex-t.zindex||e.index-t.index}function L2(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],i,r,o;for(r=0,o=t.length;r<o;++r)i=t[r],i.index=r,i.zindex&&n.push(i);return e.zdirty=!1,e.zitems=n.sort(aW)}function Ni(e,t){var n=e.items,i,r;if(!n||!n.length)return;const o=L2(e);if(o&&o.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||t(n[i]);n=o}for(i=0,r=n.length;i<r;++i)t(n[i])}function tg(e,t){var n=e.items,i,r;if(!n||!n.length)return null;const o=L2(e);for(o&&o.length&&(n=o),r=n.length;--r>=0;)if(i=t(n[r]))return i;if(n===o){for(n=e.items,r=n.length;--r>=0;)if(!n[r].zindex&&(i=t(n[r])))return i}return null}function z2(e){return function(t,n,i){Ni(n,r=>{(!i||i.intersects(r.bounds))&&pD(e,t,r,r)})}}function sW(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&pD(e,t,n.items[0],n.items)}}function pD(e,t,n,i){var r=n.opacity==null?1:n.opacity;r!==0&&(e(t,i)||(zu(t,n),n.fill&&eg(t,n,r)&&t.fill(),n.stroke&&Bu(t,n,r)&&t.stroke()))}function u0(e){return e=e||Zn,function(t,n,i,r,o,a){return i*=t.pixelRatio,r*=t.pixelRatio,tg(n,s=>{const u=s.bounds;if(!(u&&!u.contains(o,a)||!u)&&e(t,s,i,r,o,a))return s})}}function Yf(e,t){return function(n,i,r,o){var a=Array.isArray(i)?i[0]:i,s=t==null?a.fill:t,u=a.stroke&&n.isPointInStroke,l,c;return u&&(l=a.strokeWidth,c=a.strokeCap,n.lineWidth=l!=null?l:1,n.lineCap=c!=null?c:"butt"),e(n,i)?!1:s&&n.isPointInPath(r,o)||u&&n.isPointInStroke(r,o)}}function B2(e){return u0(Yf(e))}function Za(e,t){return"translate("+e+","+t+")"}function U2(e){return"rotate("+e+")"}function uW(e,t){return"scale("+e+","+t+")"}function mD(e){return Za(e.x||0,e.y||0)}function lW(e){return Za(e.x||0,e.y||0)+(e.angle?" "+U2(e.angle):"")}function cW(e){return Za(e.x||0,e.y||0)+(e.angle?" "+U2(e.angle):"")+(e.scaleX||e.scaleY?" "+uW(e.scaleX||1,e.scaleY||1):"")}function q2(e,t,n){function i(a,s){a("transform",lW(s)),a("d",t(null,s))}function r(a,s){return t(Hf(a,s.angle),s),co(a,s).translate(s.x||0,s.y||0)}function o(a,s){var u=s.x||0,l=s.y||0,c=s.angle||0;a.translate(u,l),c&&a.rotate(c*=Jo),a.beginPath(),t(a,s),c&&a.rotate(-c),a.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:i,bound:r,draw:z2(o),pick:B2(o),isect:n||P2(o)}}var fW=q2("arc",Vq);function dW(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],i=e[0].orient==="horizontal"?"y":"x",r=e.length,o=1/0,a,s;--r>=0;)e[r].defined!==!1&&(s=Math.abs(e[r][i]-n),s<o&&(o=s,a=e[r]));return a}function hW(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),i=e.length,r,o,a;--i>=0;)if(e[i].defined!==!1&&(r=e[i].x-t[0],o=e[i].y-t[1],a=r*r+o*o,a<n))return e[i];return null}function gW(e,t){for(var n=e.length,i,r,o;--n>=0;)if(e[n].defined!==!1&&(i=e[n].x-t[0],r=e[n].y-t[1],o=i*i+r*r,i=e[n].size||1,o<i*i))return e[n];return null}function W2(e,t,n){function i(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function r(u,l){var c=l.items;return c.length===0?u:(t(Hf(u),c),co(u,c[0]))}function o(u,l){u.beginPath(),t(u,l)}const a=Yf(o);function s(u,l,c,f,d,h){var g=l.items,p=l.bounds;return!g||!g.length||p&&!p.contains(d,h)?null:(c*=u.pixelRatio,f*=u.pixelRatio,a(u,g,c,f)?g[0]:null)}return{type:e,tag:"path",nested:!0,attr:i,bound:r,draw:sW(o),pick:s,isect:I2,tip:n}}var pW=W2("area",Kq,dW);function mW(e,t){var n=t.clip;e.save(),fe(n)?(e.beginPath(),n(e),e.clip()):yD(e,t.group)}function yD(e,t){e.beginPath(),N2(t)?bl(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function vD(e){const t=fi(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function yW(e,t){e("transform",mD(t))}function bD(e,t){const n=vD(t);e("d",bl(null,t,n,n))}function vW(e,t){e("class","background"),e("aria-hidden",!0),bD(e,t)}function bW(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?bD(e,t):e("d","")}function xW(e,t,n){const i=t.clip?j2(n,t,t):null;e("clip-path",i)}function wW(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let r=0;r<i;++r)e.union(n[r].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),co(e,t),e.translate(t.x||0,t.y||0)}function tf(e,t,n,i){const r=vD(t);e.beginPath(),bl(e,t,(n||0)+r,(i||0)+r)}const _W=Yf(tf),EW=Yf(tf,!1),SW=Yf(tf,!0);function OW(e,t,n){Ni(t,i=>{const r=i.x||0,o=i.y||0,a=i.strokeForeground,s=i.opacity==null?1:i.opacity;(i.stroke||i.fill)&&s&&(tf(e,i,r,o),zu(e,i),i.fill&&eg(e,i,s)&&e.fill(),i.stroke&&!a&&Bu(e,i,s)&&e.stroke()),e.save(),e.translate(r,o),i.clip&&yD(e,i),n&&n.translate(-r,-o),Ni(i,u=>{this.draw(e,u,n)}),n&&n.translate(r,o),e.restore(),a&&i.stroke&&s&&(tf(e,i,r,o),zu(e,i),Bu(e,i,s)&&e.stroke())})}function AW(e,t,n,i,r,o){if(t.bounds&&!t.bounds.contains(r,o)||!t.items)return null;const a=n*e.pixelRatio,s=i*e.pixelRatio;return tg(t,u=>{let l,c,f;const d=u.bounds;if(d&&!d.contains(r,o))return;c=u.x||0,f=u.y||0;const h=c+(u.width||0),g=f+(u.height||0),p=u.clip;if(p&&(r<c||r>h||o<f||o>g))return;if(e.save(),e.translate(c,f),c=r-c,f=o-f,p&&N2(u)&&!SW(e,u,a,s))return e.restore(),null;const m=u.strokeForeground,y=t.interactive!==!1;return y&&m&&u.stroke&&EW(e,u,a,s)?(e.restore(),u):(l=tg(u,v=>kW(v,c,f)?this.pick(v,n,i,c,f):null),!l&&y&&(u.fill||!m&&u.stroke)&&_W(e,u,a,s)&&(l=u),e.restore(),l||null)})}function kW(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var CW={type:"group",tag:"g",nested:!1,attr:yW,bound:wW,draw:OW,pick:AW,isect:dD,content:xW,background:vW,foreground:bW},nf={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function G2(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function H2(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function Y2(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function l0(e,t){return e==="center"?t/2:e==="right"?t:0}function c0(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function $W(e,t,n){const i=G2(t,n),r=H2(t,i),o=Y2(t,i),a=(t.x||0)-l0(t.align,r),s=(t.y||0)-c0(t.baseline,o),u=!i.src&&i.toDataURL?i.toDataURL():i.src||"";e("href",u,nf["xmlns:xlink"],"xlink:href"),e("transform",Za(a,s)),e("width",r),e("height",o),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function FW(e,t){const n=t.image,i=H2(t,n),r=Y2(t,n),o=(t.x||0)-l0(t.align,i),a=(t.y||0)-c0(t.baseline,r);return e.set(o,a,o+i,a+r)}function TW(e,t,n){Ni(t,i=>{if(n&&!n.intersects(i.bounds))return;const r=G2(i,this);let o=H2(i,r),a=Y2(i,r);if(o===0||a===0)return;let s=(i.x||0)-l0(i.align,o),u=(i.y||0)-c0(i.baseline,a),l,c,f,d;i.aspect!==!1&&(c=r.width/r.height,f=i.width/i.height,c===c&&f===f&&c!==f&&(f<c?(d=o/c,u+=(a-d)/2,a=d):(d=a*c,s+=(o-d)/2,o=d))),(r.complete||r.toDataURL)&&(zu(e,i),e.globalAlpha=(l=i.opacity)!=null?l:1,e.imageSmoothingEnabled=i.smooth!==!1,e.drawImage(r,s,u,o,a))})}var MW={type:"image",tag:"image",nested:!1,attr:$W,bound:FW,draw:TW,pick:u0(),isect:Zn,get:G2,xOffset:l0,yOffset:c0},DW=W2("line",Jq,hW);function NW(e,t){var n=t.scaleX||1,i=t.scaleY||1;(n!==1||i!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",cW(t)),e("d",t.path)}function gh(e,t){var n=t.path;if(n==null)return!0;var i=t.x||0,r=t.y||0,o=t.scaleX||1,a=t.scaleY||1,s=(t.angle||0)*Jo,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=Lu(n)).path=n),s&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(s),ef(e,u,0,0,o,a),e.rotate(-s),e.translate(-i,-r)):ef(e,u,i,r,o,a)}function jW(e,t){return gh(Hf(e,t.angle),t)?e.set(0,0,0,0):co(e,t,!0)}var RW={type:"path",tag:"path",nested:!1,attr:NW,bound:jW,draw:z2(gh),pick:B2(gh),isect:P2(gh)};function PW(e,t){e("d",bl(null,t))}function IW(e,t){var n,i;return co(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)}function EO(e,t){e.beginPath(),bl(e,t)}var LW={type:"rect",tag:"path",nested:!1,attr:PW,bound:IW,draw:z2(EO),pick:B2(EO),isect:dD};function zW(e,t){e("transform",mD(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function BW(e,t){var n,i;return co(e.set(n=t.x||0,i=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:i),t)}function xD(e,t,n){var i,r,o,a;return t.stroke&&Bu(e,t,n)?(i=t.x||0,r=t.y||0,o=t.x2!=null?t.x2:i,a=t.y2!=null?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(o,a),!0):!1}function UW(e,t,n){Ni(t,i=>{if(!(n&&!n.intersects(i.bounds))){var r=i.opacity==null?1:i.opacity;r&&xD(e,i,r)&&(zu(e,i),e.stroke())}})}function qW(e,t,n,i){return e.isPointInStroke?xD(e,t,1)&&e.isPointInStroke(n,i):!1}var WW={type:"rule",tag:"line",nested:!1,attr:zW,bound:BW,draw:UW,pick:u0(qW),isect:hD},GW=q2("shape",Qq),HW=q2("symbol",Zq,I2);const SO=z$();var Ci={height:Cr,measureWidth:X2,estimateWidth:ky,width:ky,canvas:wD};wD(!0);function wD(e){Ci.width=e&&Bo?X2:ky}function ky(e,t){return _D(Zo(e,t),Cr(e))}function _D(e,t){return~~(.8*e.length*t)}function X2(e,t){return Cr(e)<=0||!(t=Zo(e,t))?0:ED(t,f0(e))}function ED(e,t){const n="(".concat(t,") ").concat(e);let i=SO.get(n);return i===void 0&&(Bo.font=t,i=Bo.measureText(e).width,SO.set(n,i)),i}function Cr(e){return e.fontSize!=null?+e.fontSize||0:11}function Qo(e){return e.lineHeight!=null?e.lineHeight:Cr(e)+2}function YW(e){return I(e)?e.length>1?e:e[0]:e}function Xf(e){return YW(e.lineBreak&&e.text&&!I(e.text)?e.text.split(e.lineBreak):e.text)}function V2(e){const t=Xf(e);return(I(t)?t.length-1:0)*Qo(e)}function Zo(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?VW(e,n):n}function XW(e){if(Ci.width===X2){const t=f0(e);return n=>ED(n,t)}else{const t=Cr(e);return n=>_D(n,t)}}function VW(e,t){var n=+e.limit,i=XW(e);if(i(t)<n)return t;var r=e.ellipsis||"\u2026",o=e.dir==="rtl",a=0,s=t.length,u;if(n-=i(r),o){for(;a<s;)u=a+s>>>1,i(t.slice(u))>n?a=u+1:s=u;return r+t.slice(a)}else{for(;a<s;)u=1+(a+s>>>1),i(t.slice(0,u))<n?a=u:s=u-1;return t.slice(0,a)+r}}function Vf(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function f0(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Cr(e)+"px "+Vf(e,t)}function K2(e){var t=e.baseline,n=Cr(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Qo(e):t==="line-bottom"?.29*n-.5*Qo(e):0)}const KW={left:"start",center:"middle",right:"end"},$c=new it;function d0(e){var t=e.x||0,n=e.y||0,i=e.radius||0,r;return i&&(r=(e.theta||0)-La,t+=i*Math.cos(r),n+=i*Math.sin(r)),$c.x1=t,$c.y1=n,$c}function JW(e,t){var n=t.dx||0,i=(t.dy||0)+K2(t),r=d0(t),o=r.x1,a=r.y1,s=t.angle||0,u;e("text-anchor",KW[t.align]||"start"),s?(u=Za(o,a)+" "+U2(s),(n||i)&&(u+=" "+Za(n,i))):u=Za(o+n,a+i),e("transform",u)}function J2(e,t,n){var i=Ci.height(t),r=t.align,o=d0(t),a=o.x1,s=o.y1,u=t.dx||0,l=(t.dy||0)+K2(t)-Math.round(.8*i),c=Xf(t),f;if(I(c)?(i+=Qo(t)*(c.length-1),f=c.reduce((d,h)=>Math.max(d,Ci.width(t,h)),0)):f=Ci.width(t,c),r==="center"?u-=f/2:r==="right"&&(u-=f),e.set(u+=a,l+=s,u+f,l+i),t.angle&&!n)e.rotate(t.angle*Jo,a,s);else if(n===2)return e.rotatedPoints(t.angle*Jo,a,s);return e}function QW(e,t,n){Ni(t,i=>{var r=i.opacity==null?1:i.opacity,o,a,s,u,l,c,f;if(!(n&&!n.intersects(i.bounds)||r===0||i.fontSize<=0||i.text==null||i.text.length===0)){if(e.font=f0(i),e.textAlign=i.align||"left",o=d0(i),a=o.x1,s=o.y1,i.angle&&(e.save(),e.translate(a,s),e.rotate(i.angle*Jo),a=s=0),a+=i.dx||0,s+=(i.dy||0)+K2(i),c=Xf(i),zu(e,i),I(c))for(l=Qo(i),u=0;u<c.length;++u)f=Zo(i,c[u]),i.fill&&eg(e,i,r)&&e.fillText(f,a,s),i.stroke&&Bu(e,i,r)&&e.strokeText(f,a,s),s+=l;else f=Zo(i,c),i.fill&&eg(e,i,r)&&e.fillText(f,a,s),i.stroke&&Bu(e,i,r)&&e.strokeText(f,a,s);i.angle&&e.restore()}})}function ZW(e,t,n,i,r,o){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var a=d0(t),s=a.x1,u=a.y1,l=J2($c,t,1),c=-t.angle*Jo,f=Math.cos(c),d=Math.sin(c),h=f*r-d*o+(s-f*s+d*u),g=d*r+f*o+(u-d*s-f*u);return l.contains(h,g)}function eG(e,t){const n=J2($c,e,2);return uu(t,n[0],n[1],n[2],n[3])||uu(t,n[0],n[1],n[4],n[5])||uu(t,n[4],n[5],n[6],n[7])||uu(t,n[2],n[3],n[6],n[7])}var tG={type:"text",tag:"text",nested:!1,attr:JW,bound:J2,draw:QW,pick:u0(ZW),isect:eG},nG=W2("trail",eW,gW),zn={arc:fW,area:pW,group:CW,image:MW,line:DW,path:RW,rect:LW,rule:WW,shape:GW,symbol:HW,text:tG,trail:nG};function Cy(e,t,n){var i=zn[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new it),e,n)}var OO={mark:null};function SD(e,t,n){var i=zn[e.marktype],r=i.bound,o=e.items,a=o&&o.length,s,u,l,c;if(i.nested)return a?l=o[0]:(OO.mark=e,l=OO),c=Cy(l,r,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new it,a)for(s=0,u=o.length;s<u;++s)t.union(Cy(o[s],r,n));return e.bounds=t}const iG=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function OD(e,t){return JSON.stringify(e,iG,t)}function AD(e){const t=typeof e=="string"?JSON.parse(e):e;return kD(t)}function kD(e){var t=e.marktype,n=e.items,i,r,o;if(n)for(r=0,o=n.length;r<o;++r)i=t?"mark":"group",n[r][i]=e,n[r].zindex&&(n[r][i].zdirty=!0),(t||i)==="group"&&kD(n[r]);return t&&SD(e),e}function Q2(e){arguments.length?this.root=AD(e):(this.root=CD({marktype:"group",name:"root",role:"frame"}),this.root.items=[new a0(this.root)])}Q2.prototype={toJSON(e){return OD(this.root,e||0)},mark(e,t,n){t=t||this.root.items[0];const i=CD(e,t);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}};function CD(e,t){const n={bounds:new it,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function Fo(e,t,n){return!e&&typeof document!="undefined"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Z2(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function gn(e,t,n,i){var r=e.childNodes[t],o;return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(o=r||null,r=Fo(e.ownerDocument,n,i),e.insertBefore(r,o)),r}function bi(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function $D(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function h0(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function rG(e,t,n,i){var r=e&&e.mark,o,a;if(r&&(o=zn[r.marktype]).tip){for(a=h0(t,n),a[0]-=i[0],a[1]-=i[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=o.tip(r.items,a)}return e}function ea(e,t){this._active=null,this._handlers={},this._loader=e||Mp(),this._tooltip=t||oG}function oG(e,t,n,i){e.element().setAttribute("title",i||"")}ea.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const i in t)n.push(...t[i]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const r=new MouseEvent(e.type,e),o=Fo(null,"a");for(const a in i)o.setAttribute(a,i[a]);o.dispatchEvent(r)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=rG(t,e,this.canvas(),this._origin);const i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,o=r.width(),a=r.height();let s=r.x1+i[0]+n.left,u=r.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,u+=e.y||0;return{x:s,y:u,width:o,height:a,left:s,top:u,right:s+o,bottom:u+a}}};function $r(e){this._el=null,this._bgcolor=null,this._loader=new R2(e)}$r.prototype={initialize(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,i=n._loader[e](t);if(!n._ready){const r=n._call;n._ready=n._loader.ready().then(o=>{o&&r(),n._ready=null})}return i},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const aG="keydown",sG="keypress",uG="keyup",FD="dragenter",ph="dragleave",TD="dragover",$y="mousedown",lG="mouseup",ng="mousemove",Fc="mouseout",MD="mouseover",ig="click",cG="dblclick",fG="wheel",DD="mousewheel",rg="touchstart",og="touchmove",ag="touchend",dG=[aG,sG,uG,FD,ph,TD,$y,lG,ng,Fc,MD,ig,cG,fG,DD,rg,og,ag],Fy=ng,rf=Fc,Ty=ig;function Kf(e,t){ea.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const hG=e=>e===rg||e===og||e===ag?[rg,og,ag]:[e];function AO(e,t){hG(t).forEach(n=>gG(e,n))}function gG(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?i=>e[t](i):i=>e.fire(t,i)))}function kO(e,t,n){return function(i){const r=this._active,o=this.pickEvent(i);o===r?this.fire(e,i):((!r||!r.exit)&&this.fire(n,i),this._active=o,this.fire(t,i),this.fire(e,i))}}function CO(e){return function(t){this.fire(e,t),this._active=null}}W(Kf,ea,{initialize(e,t,n){return this._canvas=e&&Z2(e,"canvas"),[ig,$y,ng,Fc,ph].forEach(i=>AO(this,i)),ea.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:dG,DOMMouseScroll(e){this.fire(DD,e)},mousemove:kO(ng,MD,Fc),dragover:kO(TD,FD,ph),mouseout:CO(Fc),dragleave:CO(ph),mousedown(e){this._down=this._active,this.fire($y,e)},click(e){this._down===this._active&&(this.fire(ig,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(rg,e,!0)},touchmove(e){this.fire(og,e,!0)},touchend(e){this.fire(ag,e,!0),this._touch=null},fire(e,t,n){const i=n?this._touch:this._active,r=this._handlers[e];if(t.vegaType=e,e===Ty&&i&&i.href?this.handleHref(t,i,i.href):(e===Fy||e===rf)&&this.handleTooltip(t,i,e!==rf),r)for(let o=0,a=r.length;o<a;++o)r[o].handler.call(this._obj,t,i)},on(e,t){const n=this.eventName(e),i=this._handlers;return this._handlerIndex(i[n],e,t)<0&&(AO(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},pickEvent(e){const t=h0(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,i,r){const o=this.context();return zn[e.marktype].pick.call(this,o,e,t,n,i,r)}});function pG(){return typeof window!="undefined"&&window.devicePixelRatio||1}var mG=pG();function yG(e,t,n,i,r,o){const a=typeof HTMLElement!="undefined"&&e instanceof HTMLElement&&e.parentNode!=null,s=e.getContext("2d"),u=a?mG:r;e.width=t*u,e.height=n*u;for(const l in o)s[l]=o[l];return a&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=u,s.setTransform(u,0,0,u,u*i[0],u*i[1]),e}function sg(e){$r.call(this,e),this._options={},this._redraw=!1,this._dirty=new it,this._tempb=new it}const $O=$r.prototype,vG=(e,t,n)=>new it().set(0,0,t,n).translate(-e[0],-e[1]);function bG(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}W(sg,$r,{initialize(e,t,n,i,r,o){return this._options=o||{},this._canvas=this._options.externalContext?null:zo(1,1,this._options.type),e&&this._canvas&&(bi(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),$O.initialize.call(this,e,t,n,i,r)},resize(e,t,n,i){if($O.resize.call(this,e,t,n,i),this._canvas)yG(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const r=this._options.externalContext;r||P("CanvasRenderer is missing a valid canvas or context"),r.scale(this._scale,this._scale),r.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,i=this._width,r=this._height,o=this._dirty,a=vG(n,i,r);t.save();const s=this._redraw||o.empty()?(this._redraw=!1,a.expand(1)):bG(t,a.intersect(o),n);return this.clear(-n[0],-n[1],i,r),this.draw(t,e,s),t.restore(),o.clear(),this},draw(e,t,n){const i=zn[t.marktype];t.clip&&mW(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,i){const r=this._options,o=this.context();r.type!=="pdf"&&!r.externalContext&&o.clearRect(e,t,n,i),this._bgcolor!=null&&(o.fillStyle=this._bgcolor,o.fillRect(e,t,n,i))}});function ew(e,t){ea.call(this,e,t);const n=this;n._hrefHandler=My(n,(i,r)=>{r&&r.href&&n.handleHref(i,r,r.href)}),n._tooltipHandler=My(n,(i,r)=>{n.handleTooltip(i,r,i.type!==rf)})}const My=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};W(ew,ea,{initialize(e,t,n){let i=this._svg;return i&&(i.removeEventListener(Ty,this._hrefHandler),i.removeEventListener(Fy,this._tooltipHandler),i.removeEventListener(rf,this._tooltipHandler)),this._svg=i=e&&Z2(e,"svg"),i&&(i.addEventListener(Ty,this._hrefHandler),i.addEventListener(Fy,this._tooltipHandler),i.addEventListener(rf,this._tooltipHandler)),ea.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),i=this._handlers;if(this._handlerIndex(i[n],e,t)<0){const o={type:e,handler:t,listener:My(this,t)};(i[n]||(i[n]=[])).push(o),this._svg&&this._svg.addEventListener(n,o.listener)}return this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}});const ND="aria-hidden",tw="aria-label",nw="role",iw="aria-roledescription",jD="graphics-object",rw="graphics-symbol",RD=(e,t,n)=>({[nw]:e,[iw]:t,[tw]:n||void 0}),xG=Mi(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),FO={axis:{desc:"axis",caption:EG},legend:{desc:"legend",caption:SG},"title-text":{desc:"title",caption:e=>"Title text '".concat(MO(e),"'")},"title-subtitle":{desc:"subtitle",caption:e=>"Subtitle text '".concat(MO(e),"'")}},TO={ariaRole:nw,ariaRoleDescription:iw,description:tw};function PD(e,t){const n=t.aria===!1;if(e(ND,n||void 0),n||t.description==null)for(const i in TO)e(TO[i],void 0);else{const i=t.mark.marktype;e(tw,t.description),e(nw,t.ariaRole||(i==="group"?jD:rw)),e(iw,t.ariaRoleDescription||"".concat(i," mark"))}}function ID(e){return e.aria===!1?{[ND]:!0}:xG[e.role]?null:FO[e.role]?_G(e,FO[e.role]):wG(e)}function wG(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(i=>i.description!=null&&i.aria!==!1);return RD(n?jD:rw,"".concat(t," mark container"),e.description)}function _G(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return RD(t.role||rw,t.desc,n.description||i(n))}catch{return null}}function MO(e){return V(e.text).join(" ")}function EG(e){const t=e.datum,n=e.orient,i=t.title?LD(e):null,r=e.context,o=r.scales[t.scale].value,a=r.dataflow.locale(),s=o.type,u=n==="left"||n==="right"?"Y":"X";return"".concat(u,"-axis")+(i?" titled '".concat(i,"'"):"")+" for a ".concat(Iu(s)?"discrete":s," scale")+" with ".concat(nD(a,o,e))}function SG(e){const t=e.datum,n=t.title?LD(e):null,i="".concat(t.type||""," legend").trim(),r=t.scales,o=Object.keys(r),a=e.context,s=a.scales[r[o[0]]].value,u=a.dataflow.locale();return AG(i)+(n?" titled '".concat(n,"'"):"")+" for ".concat(OG(o))+" with ".concat(nD(u,s,e))}function LD(e){try{return V(ve(e.items).items[0].text).join(" ")}catch{return null}}function OG(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ve(e)}function AG(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const zD=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),kG=e=>zD(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function ow(){let e="",t="",n="";const i=[],r=()=>t=n="",o=u=>{t&&(e+="".concat(t,">").concat(n),r()),i.push(u)},a=(u,l)=>(l!=null&&(t+=" ".concat(u,'="').concat(kG(l),'"')),s),s={open(u){o(u),t="<"+u;for(var l=arguments.length,c=new Array(l>1?l-1:0),f=1;f<l;f++)c[f-1]=arguments[f];for(const d of c)for(const h in d)a(h,d[h]);return s},close(){const u=i.pop();return t?e+=t+(n?">".concat(n,"</").concat(u,">"):"/>"):e+="</".concat(u,">"),r(),s},attr:a,text:u=>(n+=zD(u),s),toString:()=>e};return s}const BD=e=>UD(ow(),e)+"";function UD(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,i=n.length;for(let r=0;r<i;++r)e.attr(n[r].name,n[r].value)}if(t.hasChildNodes()){const n=t.childNodes;for(const i of n)i.nodeType===3?e.text(i.nodeValue):UD(e,i)}return e.close()}const ug={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},lg={blend:"mix-blend-mode"},qD={fill:"none","stroke-miterlimit":10},ql=0,DO="http://www.w3.org/2000/xmlns/",ot=nf.xmlns;function aw(e){$r.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Gm=$r.prototype;W(aw,$r,{initialize(e,t,n,i,r){return this._defs={},this._clearDefs(),e&&(this._svg=gn(e,0,"svg",ot),this._svg.setAttributeNS(DO,"xmlns",ot),this._svg.setAttributeNS(DO,"xmlns:xlink",nf["xmlns:xlink"]),this._svg.setAttribute("version",nf.version),this._svg.setAttribute("class","marks"),bi(e,1),this._root=gn(this._svg,ql,"g",ot),To(this._root,qD),bi(this._svg,ql+1)),this.background(this._bgcolor),Gm.initialize.call(this,e,t,n,i,r)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Gm.background.apply(this,arguments)},resize(e,t,n,i){return Gm.resize.call(this,e,t,n,i),this._svg&&(To(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}),this._root.setAttribute("transform","translate(".concat(this._origin,")"))),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=gn(e,ql,"rect",ot),To(n,{width:this._width,height:this._height,fill:t}));const i=BD(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),i},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),bi(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||!e._svg.ownerSVGElement||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,i,r,o,a,s,u;for(a=0,s=e.length;a<s;++a)if(n=e[a],i=n.mark,i.marktype!==r&&(r=i.marktype,o=zn[r]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,NO(n,t),i.items.forEach(l=>{l.dirty=t})),!i.zdirty){if(n.exit){o.nested&&i.items.length?(u=i.items[0],u._svg&&this._update(o,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=o.nested?i.items[0]:n,n._update!==t&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,NO(n,t)):this._update(o,n._svg,n),n._update=t)}return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const i=this._svg,r=zn[t.marktype],o=t.interactive===!1?"none":null,a=r.tag==="g",s=jO(t,e,n,"g",i);s.setAttribute("class",$D(t));const u=ID(t);for(const d in u)Vt(s,d,u[d]);a||Vt(s,"pointer-events",o),Vt(s,"clip-path",t.clip?j2(this,t,t.group):null);let l=null,c=0;const f=d=>{const h=this.isDirty(d),g=jO(d,s,l,r.tag,i);h&&(this._update(r,g,d),a&&FG(this,g,d)),l=g,++c};return r.nested?t.items.length&&f(t.items[0]):Ni(t,f),bi(s,c),s},_update(e,t,n){Xr=t,Nt=t.__values__,PD(Tc,n),e.attr(Tc,n,this);const i=MG[e.type];i&&i.call(this,e,t,n),Xr&&this.style(Xr,n)},style(e,t){if(t!=null){for(const n in ug){let i=n==="font"?Vf(t):t[n];if(i===Nt[n])continue;const r=ug[n];i==null?e.removeAttribute(r):(M2(i)&&(i=rD(i,this._defs.gradient,WD())),e.setAttribute(r,i+"")),Nt[n]=i}for(const n in lg)mh(e,lg[n],t[n])}},defs(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const r in t.gradient)n||(t.el=n=gn(e,ql+1,"defs",ot)),i=CG(n,t.gradient[r],i);for(const r in t.clipping)n||(t.el=n=gn(e,ql+1,"defs",ot)),i=$G(n,t.clipping[r],i);n&&(i===0?(e.removeChild(n),t.el=null):bi(n,i))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function NO(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function CG(e,t,n){let i,r,o;if(t.gradient==="radial"){let a=gn(e,n++,"pattern",ot);To(a,{id:Zh+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),a=gn(a,0,"rect",ot),To(a,{width:1,height:1,fill:"url(".concat(WD(),"#").concat(t.id,")")}),e=gn(e,n++,"radialGradient",ot),To(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=gn(e,n++,"linearGradient",ot),To(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(i=0,r=t.stops.length;i<r;++i)o=gn(e,i,"stop",ot),o.setAttribute("offset",t.stops[i].offset),o.setAttribute("stop-color",t.stops[i].color);return bi(e,i),n}function $G(e,t,n){let i;return e=gn(e,n,"clipPath",ot),e.setAttribute("id",t.id),t.path?(i=gn(e,0,"path",ot),i.setAttribute("d",t.path)):(i=gn(e,0,"rect",ot),To(i,{x:0,y:0,width:t.width,height:t.height})),bi(e,1),n+1}function FG(e,t,n){t=t.lastChild.previousSibling;let i,r=0;Ni(n,o=>{i=e.mark(t,o,i),++r}),bi(t,1+r)}function jO(e,t,n,i,r){let o=e._svg,a;if(!o&&(a=t.ownerDocument,o=Fo(a,i,ot),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},i==="g"))){const s=Fo(a,"path",ot);o.appendChild(s),s.__data__=e;const u=Fo(a,"g",ot);o.appendChild(u),u.__data__=e;const l=Fo(a,"path",ot);o.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(o.ownerSVGElement!==r||TG(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}function TG(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let Xr=null,Nt=null;const MG={group(e,t,n){const i=Xr=t.childNodes[2];Nt=i.__values__,e.foreground(Tc,n,this),Nt=t.__values__,Xr=t.childNodes[1],e.content(Tc,n,this);const r=Xr=t.childNodes[0];e.background(Tc,n,this);const o=n.mark.interactive===!1?"none":null;if(o!==Nt.events&&(Vt(i,"pointer-events",o),Vt(r,"pointer-events",o),Nt.events=o),n.strokeForeground&&n.stroke){const a=n.fill;Vt(i,"display",null),this.style(r,n),Vt(r,"stroke",null),a&&(n.fill=null),Nt=i.__values__,this.style(i,n),a&&(n.fill=a),Xr=null}else Vt(i,"display","none")},image(e,t,n){n.smooth===!1?(mh(t,"image-rendering","optimizeSpeed"),mh(t,"image-rendering","pixelated")):mh(t,"image-rendering",null)},text(e,t,n){const i=Xf(n);let r,o,a,s;I(i)?(o=i.map(u=>Zo(n,u)),r=o.join(`
`),r!==Nt.text&&(bi(t,0),a=t.ownerDocument,s=Qo(n),o.forEach((u,l)=>{const c=Fo(a,"tspan",ot);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",s)),t.appendChild(c)}),Nt.text=r)):(o=Zo(n,i),o!==Nt.text&&(t.textContent=o,Nt.text=o)),Vt(t,"font-family",Vf(n)),Vt(t,"font-size",Cr(n)+"px"),Vt(t,"font-style",n.fontStyle),Vt(t,"font-variant",n.fontVariant),Vt(t,"font-weight",n.fontWeight)}};function Tc(e,t,n){t!==Nt[e]&&(n?DG(Xr,e,t,n):Vt(Xr,e,t),Nt[e]=t)}function mh(e,t,n){n!==Nt[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),Nt[t]=n)}function To(e,t){for(const n in t)Vt(e,n,t[n])}function Vt(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function DG(e,t,n,i){n!=null?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}function WD(){let e;return typeof window=="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function sw(e){$r.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}W(sw,$r,{svg(){return this._text},_render(e){const t=ow();t.open("svg",ce({},nf,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",qD,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=zn[t.marktype],i=n.tag,r=[PD,n.attr];e.open("g",{class:$D(t),"clip-path":t.clip?j2(this,t,t.group):null},ID(t),{"pointer-events":i!=="g"&&t.interactive===!1?"none":null});const o=a=>{const s=this.href(a);if(s&&e.open("a",s),e.open(i,this.attr(t,a,r,i!=="g"?i:null)),i==="text"){const u=Xf(a);if(I(u)){const l={x:0,dy:Qo(a)};for(let c=0;c<u.length;++c)e.open("tspan",c?l:null).text(Zo(a,u[c])).close()}else e.text(Zo(a,u))}else if(i==="g"){const u=a.strokeForeground,l=a.fill,c=a.stroke;u&&c&&(a.stroke=null),e.open("path",this.attr(t,a,n.background,"bgrect")).close(),e.open("g",this.attr(t,a,n.content)),Ni(a,f=>this.mark(e,f)),e.close(),u&&c?(l&&(a.fill=null),a.stroke=c,e.open("path",this.attr(t,a,n.foreground,"bgrect")).close(),l&&(a.fill=l)):e.open("path",this.attr(t,a,n.foreground,"bgfore")).close()}e.close(),s&&e.close()};return n.nested?t.items&&t.items.length&&o(t.items[0]):Ni(t,o),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(i=>{i["xlink:href"]=i.href,i.href=null,(this._hrefs||(this._hrefs={}))[t]=i})}return null},attr(e,t,n,i){const r={},o=(a,s,u,l)=>{r[l||a]=s};return Array.isArray(n)?n.forEach(a=>a(o,t,this)):n(o,t,this),i&&NG(r,t,e,i,this._defs),r},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const r in t){const o=t[r],a=o.stops;o.gradient==="radial"?(e.open("pattern",{id:Zh+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close(),e.close(),e.open("radialGradient",{id:r,fx:o.x1,fy:o.y1,fr:o.r1,cx:o.x2,cy:o.y2,r:o.r2})):e.open("linearGradient",{id:r,x1:o.x1,x2:o.x2,y1:o.y1,y2:o.y2});for(let s=0;s<a.length;++s)e.open("stop",{offset:a[s].offset,"stop-color":a[s].color}).close();e.close()}for(const r in n){const o=n[r];e.open("clipPath",{id:r}),o.path?e.open("path",{d:o.path}).close():e.open("rect",{x:0,y:0,width:o.width,height:o.height}).close(),e.close()}e.close()}}});function NG(e,t,n,i,r){let o;if(t==null||(i==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),i==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;i==="image"&&t.smooth===!1&&(o=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),i==="text"&&(e["font-family"]=Vf(t),e["font-size"]=Cr(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const a in ug){let s=t[a];const u=ug[a];s==="transparent"&&(u==="fill"||u==="stroke")||s!=null&&(M2(s)&&(s=rD(s,r.gradient,"")),e[u]=s)}for(const a in lg){const s=t[a];s!=null&&(o=o||[],o.push("".concat(lg[a],": ").concat(s,";")))}return o&&(e.style=o.join(" ")),e}const GD="canvas",HD="png",YD="svg",XD="none",Mo={Canvas:GD,PNG:HD,SVG:YD,None:XD},Uu={};Uu[GD]=Uu[HD]={renderer:sg,headless:sg,handler:Kf};Uu[YD]={renderer:aw,headless:sw,handler:ew};Uu[XD]={};function g0(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(Uu[e]=t,this):Uu[e]}function VD(e,t,n){const i=[],r=new it().union(t),o=e.marktype;return o?KD(e,r,n,i):o==="group"?JD(e,r,n,i):P("Intersect scene must be mark node or group item.")}function KD(e,t,n,i){if(jG(e,t,n)){const r=e.items,o=e.marktype,a=r.length;let s=0;if(o==="group")for(;s<a;++s)JD(r[s],t,n,i);else for(const u=zn[o].isect;s<a;++s){const l=r[s];QD(l,t,u)&&i.push(l)}}return i}function jG(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function JD(e,t,n,i){n&&n(e.mark)&&QD(e,t,zn.group.isect)&&i.push(e);const r=e.items,o=r&&r.length;if(o){const a=e.x||0,s=e.y||0;t.translate(-a,-s);for(let u=0;u<o;++u)KD(r[u],t,n,i);t.translate(a,s)}return i}function QD(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}const Hm=new it;function ZD(e){const t=e.clip;if(fe(t))t(Hf(Hm.clear()));else if(t)Hm.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(Hm)}const RG=1e-9;function uw(e,t,n){return e===t?!0:n==="path"?eN(e,t):e instanceof Date&&t instanceof Date?+e==+t:De(e)&&De(t)?Math.abs(e-t)<=RG:!e||!t||!K(e)&&!K(t)?e==t:PG(e,t)}function eN(e,t){return uw(Lu(e),Lu(t))}function PG(e,t){var n=Object.keys(e),i=Object.keys(t),r,o;if(n.length!==i.length)return!1;for(n.sort(),i.sort(),o=n.length-1;o>=0;o--)if(n[o]!=i[o])return!1;for(o=n.length-1;o>=0;o--)if(r=n[o],!uw(e[r],t[r],r))return!1;return typeof e==typeof t}function IG(){fD(),lq()}const qu="top",xi="left",Si="right",ta="bottom",LG="top-left",zG="top-right",BG="bottom-left",UG="bottom-right",lw="start",Dy="middle",Kt="end",qG="x",WG="y",p0="group",cw="axis",fw="title",GG="frame",HG="scope",dw="legend",tN="row-header",nN="row-footer",iN="row-title",rN="column-header",oN="column-footer",aN="column-title",YG="padding",XG="symbol",sN="fit",VG="fit-x",KG="fit-y",JG="pad",hw="none",Ad="all",Ny="each",gw="flush",Do="column",No="row";function uN(e){N.call(this,null,e)}W(uN,N,{transform(e,t){const n=t.dataflow,i=e.mark,r=i.marktype,o=zn[r],a=o.bound;let s=i.bounds,u;if(o.nested)i.items.length&&n.dirty(i.items[0]),s=kd(i,a),i.items.forEach(l=>{l.bounds.clear().union(s)});else if(r===p0||e.modified())switch(t.visit(t.MOD,l=>n.dirty(l)),s.clear(),i.items.forEach(l=>s.union(kd(l,a))),i.role){case cw:case dw:case fw:t.reflow()}else u=t.changed(t.REM),t.visit(t.ADD,l=>{s.union(kd(l,a))}),t.visit(t.MOD,l=>{u=u||s.alignsWith(l.bounds),n.dirty(l),s.union(kd(l,a))}),u&&(s.clear(),i.items.forEach(l=>s.union(l.bounds)));return ZD(i),t.modifies("bounds")}});function kd(e,t,n){return t(e.bounds.clear(),e,n)}const RO=":vega_identifier:";function pw(e){N.call(this,0,e)}pw.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};W(pw,N,{transform(e,t){const n=QG(t.dataflow),i=e.as;let r=n.value;return t.visit(t.ADD,o=>o[i]=o[i]||++r),n.set(this.value=r),t}});function QG(e){return e._signals[RO]||(e._signals[RO]=e.add(0))}function lN(e){N.call(this,null,e)}W(lN,N,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,ZG(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const i=n.marktype===p0?a0:o0;return t.visit(t.ADD,r=>i.call(r,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});function ZG(e){const t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function cN(e){N.call(this,null,e)}const PO={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((i,r)=>!r||!fN(n.bounds,i.bounds,t)?(n=i,1):i.opacity=0)}},fN=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),IO=(e,t)=>{for(var n=1,i=e.length,r=e[0].bounds,o;n<i;r=o,++n)if(fN(r,o=e[n].bounds,t))return!0},eH=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},tH=(e,t,n)=>{var i=e.range(),r=new it;return t===qu||t===ta?r.set(i[0],-1/0,i[1],1/0):r.set(-1/0,i[0],1/0,i[1]),r.expand(n||1),o=>r.encloses(o.bounds)},LO=e=>(e.forEach(t=>t.opacity=1),e),zO=(e,t)=>e.reflow(t.modified()).modifies("opacity");W(cN,N,{transform(e,t){const n=PO[e.method]||PO.parity,i=e.separation||0;let r=t.materialize(t.SOURCE).source,o,a;if(!r||!r.length)return;if(!e.method)return e.modified("method")&&(LO(r),t=zO(t,e)),t;if(r=r.filter(eH),!r.length)return;if(e.sort&&(r=r.slice().sort(e.sort)),o=LO(r),t=zO(t,e),o.length>=3&&IO(o,i)){do o=n(o,i);while(o.length>=3&&IO(o,i));o.length<3&&!ve(r).opacity&&(o.length>1&&(ve(o).opacity=0),ve(r).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(a=tH(e.boundScale,e.boundOrient,+e.boundTolerance),r.forEach(u=>{a(u)||(u.opacity=0)}));const s=o[0].mark.bounds.clear();return r.forEach(u=>{u.opacity&&s.union(u.bounds)}),t}});function dN(e){N.call(this,null,e)}W(dN,N,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,i=>n.dirty(i)),t.fields&&t.fields.zindex){const i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}}});const Dt=new it;function lu(e,t,n){return e[t]===n?0:(e[t]=n,1)}function nH(e){var t=e.items[0].orient;return t===xi||t===Si}function iH(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function rH(e,t,n,i){var r=t.items[0],o=r.datum,a=r.translate!=null?r.translate:.5,s=r.orient,u=iH(o),l=r.range,c=r.offset,f=r.position,d=r.minExtent,h=r.maxExtent,g=o.title&&r.items[u[2]].items[0],p=r.titlePadding,m=r.bounds,y=g&&V2(g),v=0,b=0,x,_;switch(Dt.clear().union(m),m.clear(),(x=u[0])>-1&&m.union(r.items[x].bounds),(x=u[1])>-1&&m.union(r.items[x].bounds),s){case qu:v=f||0,b=-c,_=Math.max(d,Math.min(h,-m.y1)),m.add(0,-_).add(l,0),g&&Cd(e,g,_,p,y,0,-1,m);break;case xi:v=-c,b=f||0,_=Math.max(d,Math.min(h,-m.x1)),m.add(-_,0).add(0,l),g&&Cd(e,g,_,p,y,1,-1,m);break;case Si:v=n+c,b=f||0,_=Math.max(d,Math.min(h,m.x2)),m.add(0,0).add(_,l),g&&Cd(e,g,_,p,y,1,1,m);break;case ta:v=f||0,b=i+c,_=Math.max(d,Math.min(h,m.y2)),m.add(0,0).add(l,_),g&&Cd(e,g,_,p,0,0,1,m);break;default:v=r.x,b=r.y}return co(m.translate(v,b),r),lu(r,"x",v+a)|lu(r,"y",b+a)&&(r.bounds=Dt,e.dirty(r),r.bounds=m,e.dirty(r)),r.mark.bounds.clear().union(m)}function Cd(e,t,n,i,r,o,a,s){const u=t.bounds;if(t.auto){const l=a*(n+r+i);let c=0,f=0;e.dirty(t),o?c=(t.x||0)-(t.x=l):f=(t.y||0)-(t.y=l),t.mark.bounds.clear().union(u.translate(-c,-f)),e.dirty(t)}s.union(u)}const BO=(e,t)=>Math.floor(Math.min(e,t)),UO=(e,t)=>Math.ceil(Math.max(e,t));function oH(e){var t=e.items,n=t.length,i=0,r,o;const a={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<n;++i)if(r=t[i],o=r.items,r.marktype===p0)switch(r.role){case cw:case dw:case fw:break;case tN:a.rowheaders.push(...o);break;case nN:a.rowfooters.push(...o);break;case rN:a.colheaders.push(...o);break;case oN:a.colfooters.push(...o);break;case iN:a.rowtitle=o[0];break;case aN:a.coltitle=o[0];break;default:a.marks.push(...o)}return a}function aH(e){return new it().set(0,0,e.width||0,e.height||0)}function sH(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Ue(e,t,n){const i=K(e)?e[t]:e;return i!=null?i:n!==void 0?n:0}function qO(e){return e<0?Math.ceil(-e):0}function hN(e,t,n){var i=!n.nodirty,r=n.bounds===gw?aH:sH,o=Dt.set(0,0,0,0),a=Ue(n.align,Do),s=Ue(n.align,No),u=Ue(n.padding,Do),l=Ue(n.padding,No),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),d=t.length,h=Array(d),g=Array(c),p=0,m=Array(d),y=Array(f),v=0,b=Array(d),x=Array(d),_=Array(d),E,w,S,C,A,O,F,k,M,$,T;for(w=0;w<c;++w)g[w]=0;for(w=0;w<f;++w)y[w]=0;for(w=0;w<d;++w)O=t[w],A=_[w]=r(O),O.x=O.x||0,b[w]=0,O.y=O.y||0,x[w]=0,S=w%c,C=~~(w/c),p=Math.max(p,F=Math.ceil(A.x2)),v=Math.max(v,k=Math.ceil(A.y2)),g[S]=Math.max(g[S],F),y[C]=Math.max(y[C],k),h[w]=u+qO(A.x1),m[w]=l+qO(A.y1),i&&e.dirty(t[w]);for(w=0;w<d;++w)w%c===0&&(h[w]=0),w<c&&(m[w]=0);if(a===Ny)for(S=1;S<c;++S){for(T=0,w=S;w<d;w+=c)T<h[w]&&(T=h[w]);for(w=S;w<d;w+=c)h[w]=T+g[S-1]}else if(a===Ad){for(T=0,w=0;w<d;++w)w%c&&T<h[w]&&(T=h[w]);for(w=0;w<d;++w)w%c&&(h[w]=T+p)}else for(a=!1,S=1;S<c;++S)for(w=S;w<d;w+=c)h[w]+=g[S-1];if(s===Ny)for(C=1;C<f;++C){for(T=0,w=C*c,E=w+c;w<E;++w)T<m[w]&&(T=m[w]);for(w=C*c;w<E;++w)m[w]=T+y[C-1]}else if(s===Ad){for(T=0,w=c;w<d;++w)T<m[w]&&(T=m[w]);for(w=c;w<d;++w)m[w]=T+v}else for(s=!1,C=1;C<f;++C)for(w=C*c,E=w+c;w<E;++w)m[w]+=y[C-1];for(M=0,w=0;w<d;++w)M=h[w]+(w%c?M:0),b[w]+=M-t[w].x;for(S=0;S<c;++S)for($=0,w=S;w<d;w+=c)$+=m[w],x[w]+=$-t[w].y;if(a&&Ue(n.center,Do)&&f>1)for(w=0;w<d;++w)A=a===Ad?p:g[w%c],M=A-_[w].x2-t[w].x-b[w],M>0&&(b[w]+=M/2);if(s&&Ue(n.center,No)&&c!==1)for(w=0;w<d;++w)A=s===Ad?v:y[~~(w/c)],$=A-_[w].y2-t[w].y-x[w],$>0&&(x[w]+=$/2);for(w=0;w<d;++w)o.union(_[w].translate(b[w],x[w]));switch(M=Ue(n.anchor,qG),$=Ue(n.anchor,WG),Ue(n.anchor,Do)){case Kt:M-=o.width();break;case Dy:M-=o.width()/2}switch(Ue(n.anchor,No)){case Kt:$-=o.height();break;case Dy:$-=o.height()/2}for(M=Math.round(M),$=Math.round($),o.clear(),w=0;w<d;++w)t[w].mark.bounds.clear();for(w=0;w<d;++w)O=t[w],O.x+=b[w]+=M,O.y+=x[w]+=$,o.union(O.mark.bounds.union(O.bounds.translate(b[w],x[w]))),i&&e.dirty(O);return o}function uH(e,t,n){var i=oH(t),r=i.marks,o=n.bounds===gw?lH:cH,a=n.offset,s=n.columns||r.length,u=s<=0?1:Math.ceil(r.length/s),l=u*s,c,f,d,h,g,p,m;const y=hN(e,r,n);y.empty()&&y.set(0,0,0,0),i.rowheaders&&(p=Ue(n.headerBand,No,null),c=$d(e,i.rowheaders,r,s,u,-Ue(a,"rowHeader"),BO,0,o,"x1",0,s,1,p)),i.colheaders&&(p=Ue(n.headerBand,Do,null),f=$d(e,i.colheaders,r,s,s,-Ue(a,"columnHeader"),BO,1,o,"y1",0,1,s,p)),i.rowfooters&&(p=Ue(n.footerBand,No,null),d=$d(e,i.rowfooters,r,s,u,Ue(a,"rowFooter"),UO,0,o,"x2",s-1,s,1,p)),i.colfooters&&(p=Ue(n.footerBand,Do,null),h=$d(e,i.colfooters,r,s,s,Ue(a,"columnFooter"),UO,1,o,"y2",l-s,1,s,p)),i.rowtitle&&(g=Ue(n.titleAnchor,No),m=Ue(a,"rowTitle"),m=g===Kt?d+m:c-m,p=Ue(n.titleBand,No,.5),WO(e,i.rowtitle,m,0,y,p)),i.coltitle&&(g=Ue(n.titleAnchor,Do),m=Ue(a,"columnTitle"),m=g===Kt?h+m:f-m,p=Ue(n.titleBand,Do,.5),WO(e,i.coltitle,m,1,y,p))}function lH(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function cH(e,t){return e.bounds[t]}function $d(e,t,n,i,r,o,a,s,u,l,c,f,d,h){var g=n.length,p=0,m=0,y,v,b,x,_,E,w,S,C;if(!g)return p;for(y=c;y<g;y+=f)n[y]&&(p=a(p,u(n[y],l)));if(!t.length)return p;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),p+=o,v=0,x=t.length;v<x;++v)e.dirty(t[v]),t[v].mark.bounds.clear();for(y=c,v=0,x=t.length;v<x;++v,y+=f){for(E=t[v],_=E.mark.bounds,b=y;b>=0&&(w=n[b])==null;b-=d);s?(S=h==null?w.x:Math.round(w.bounds.x1+h*w.bounds.width()),C=p):(S=p,C=h==null?w.y:Math.round(w.bounds.y1+h*w.bounds.height())),_.union(E.bounds.translate(S-(E.x||0),C-(E.y||0))),E.x=S,E.y=C,e.dirty(E),m=a(m,_[l])}return m}function WO(e,t,n,i,r,o){if(!!t){e.dirty(t);var a=n,s=n;i?a=Math.round(r.x1+o*r.width()):s=Math.round(r.y1+o*r.height()),t.bounds.translate(a-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=a,t.y=s,e.dirty(t)}}function fH(e,t){const n=e[t]||{};return(i,r)=>n[i]!=null?n[i]:e[i]!=null?e[i]:r}function dH(e,t){let n=-1/0;return e.forEach(i=>{i.offset!=null&&(n=Math.max(n,i.offset))}),n>-1/0?n:t}function hH(e,t,n,i,r,o,a){const s=fH(n,t),u=dH(e,s("offset",0)),l=s("anchor",lw),c=l===Kt?1:l===Dy?.5:0,f={align:Ny,bounds:s("bounds",gw),columns:s("direction")==="vertical"?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case xi:f.anchor={x:Math.floor(i.x1)-u,column:Kt,y:c*(a||i.height()+2*i.y1),row:l};break;case Si:f.anchor={x:Math.ceil(i.x2)+u,y:c*(a||i.height()+2*i.y1),row:l};break;case qu:f.anchor={y:Math.floor(r.y1)-u,row:Kt,x:c*(o||r.width()+2*r.x1),column:l};break;case ta:f.anchor={y:Math.ceil(r.y2)+u,x:c*(o||r.width()+2*r.x1),column:l};break;case LG:f.anchor={x:u,y:u};break;case zG:f.anchor={x:o-u,y:u,column:Kt};break;case BG:f.anchor={x:u,y:a-u,row:Kt};break;case UG:f.anchor={x:o-u,y:a-u,column:Kt,row:Kt};break}return f}function gH(e,t){var n=t.items[0],i=n.datum,r=n.orient,o=n.bounds,a=n.x,s=n.y,u,l;return n._bounds?n._bounds.clear().union(o):n._bounds=o.clone(),o.clear(),mH(e,n,n.items[0].items[0]),o=pH(n,o),u=2*n.padding,l=2*n.padding,o.empty()||(u=Math.ceil(o.width()+u),l=Math.ceil(o.height()+l)),i.type===XG&&yH(n.items[0].items[0].items[0].items),r!==hw&&(n.x=a=0,n.y=s=0),n.width=u,n.height=l,co(o.set(a,s,a+u,s+l),n),n.mark.bounds.clear().union(o),n}function pH(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function mH(e,t,n){var i=t.padding,r=i-n.x,o=i-n.y;if(!t.datum.title)(r||o)&&Wl(e,n,r,o);else{var a=t.items[1].items[0],s=a.anchor,u=t.titlePadding||0,l=i-a.x,c=i-a.y;switch(a.orient){case xi:r+=Math.ceil(a.bounds.width())+u;break;case Si:case ta:break;default:o+=a.bounds.height()+u}switch((r||o)&&Wl(e,n,r,o),a.orient){case xi:c+=Xs(t,n,a,s,1,1);break;case Si:l+=Xs(t,n,a,Kt,0,0)+u,c+=Xs(t,n,a,s,1,1);break;case ta:l+=Xs(t,n,a,s,0,0),c+=Xs(t,n,a,Kt,-1,0,1)+u;break;default:l+=Xs(t,n,a,s,0,0)}(l||c)&&Wl(e,a,l,c),(l=Math.round(a.bounds.x1-i))<0&&(Wl(e,n,-l,0),Wl(e,a,-l,0))}}function Xs(e,t,n,i,r,o,a){const s=e.datum.type!=="symbol",u=n.datum.vgrad,l=s&&(o||!u)&&!a?t.items[0]:t,c=l.bounds[r?"y2":"x2"]-e.padding,f=u&&o?c:0,d=u&&o?0:c,h=r<=0?0:V2(n);return Math.round(i===lw?f:i===Kt?d-h:.5*(c-h))}function Wl(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function yH(e){const t=e.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function vH(e,t,n,i,r){var o=t.items[0],a=o.frame,s=o.orient,u=o.anchor,l=o.offset,c=o.padding,f=o.items[0].items[0],d=o.items[1]&&o.items[1].items[0],h=s===xi||s===Si?i:n,g=0,p=0,m=0,y=0,v=0,b;if(a!==p0?s===xi?(g=r.y2,h=r.y1):s===Si?(g=r.y1,h=r.y2):(g=r.x1,h=r.x2):s===xi&&(g=i,h=0),b=u===lw?g:u===Kt?h:(g+h)/2,d&&d.text){switch(s){case qu:case ta:v=f.bounds.height()+c;break;case xi:y=f.bounds.width()+c;break;case Si:y=-f.bounds.width()-c;break}Dt.clear().union(d.bounds),Dt.translate(y-(d.x||0),v-(d.y||0)),lu(d,"x",y)|lu(d,"y",v)&&(e.dirty(d),d.bounds.clear().union(Dt),d.mark.bounds.clear().union(Dt),e.dirty(d)),Dt.clear().union(d.bounds)}else Dt.clear();switch(Dt.union(f.bounds),s){case qu:p=b,m=r.y1-Dt.height()-l;break;case xi:p=r.x1-Dt.width()-l,m=b;break;case Si:p=r.x2+Dt.width()+l,m=b;break;case ta:p=b,m=r.y2+l;break;default:p=o.x,m=o.y}return lu(o,"x",p)|lu(o,"y",m)&&(Dt.translate(p,m),e.dirty(o),o.bounds.clear().union(Dt),t.bounds.clear().union(Dt),e.dirty(o)),o.bounds}function gN(e){N.call(this,null,e)}W(gN,N,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&uH(n,i,e.layout),xH(n,i,e)}),bH(e.mark.group)?t.reflow():t}});function bH(e){return e&&e.mark.role!=="legend-entry"}function xH(e,t,n){var i=t.items,r=Math.max(0,t.width||0),o=Math.max(0,t.height||0),a=new it().set(0,0,r,o),s=a.clone(),u=a.clone(),l=[],c,f,d,h,g,p;for(g=0,p=i.length;g<p;++g)switch(f=i[g],f.role){case cw:h=nH(f)?s:u,h.union(rH(e,f,r,o));break;case fw:c=f;break;case dw:l.push(gH(e,f));break;case GG:case HG:case tN:case nN:case iN:case rN:case oN:case aN:s.union(f.bounds),u.union(f.bounds);break;default:a.union(f.bounds)}if(l.length){const m={};l.forEach(y=>{d=y.orient||Si,d!==hw&&(m[d]||(m[d]=[])).push(y)});for(const y in m){const v=m[y];hN(e,v,hH(v,y,n.legends,s,u,r,o))}l.forEach(y=>{const v=y.bounds;if(v.equals(y._bounds)||(y.bounds=y._bounds,e.dirty(y),y.bounds=v,e.dirty(y)),n.autosize&&n.autosize.type===sN)switch(y.orient){case xi:case Si:a.add(v.x1,0).add(v.x2,0);break;case qu:case ta:a.add(0,v.y1).add(0,v.y2)}else a.union(v)})}a.union(s).union(u),c&&a.union(vH(e,c,r,o,a)),t.clip&&a.set(0,0,t.width||0,t.height||0),wH(e,t,a,n)}function wH(e,t,n,i){const r=i.autosize||{},o=r.type;if(e._autosize<1||!o)return;let a=e._width,s=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-u)),h=Math.max(0,Math.ceil(n.y2-c));if(r.contains===YG){const g=e.padding();a-=g.left+g.right,s-=g.top+g.bottom}o===hw?(l=0,f=0,u=a,c=s):o===sN?(u=Math.max(0,a-l-d),c=Math.max(0,s-f-h)):o===VG?(u=Math.max(0,a-l-d),s=c+f+h):o===KG?(a=u+l+d,c=Math.max(0,s-f-h)):o===JG&&(a=u+l+d,s=c+f+h),e._resizeView(a,s,u,c,[l,f],r.resize)}var _H=Object.freeze(Object.defineProperty({__proto__:null,bound:uN,identifier:pw,mark:lN,overlap:cN,render:dN,viewlayout:gN},Symbol.toStringTag,{value:"Module"}));function pN(e){N.call(this,null,e)}W(pN,N,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,o=e.scale,a=e.count==null?e.values?e.values.length:10:e.count,s=F2(o,a,e.minstep),u=e.format||J3(n,o,s,e.formatSpecifier,e.formatType,!!e.values),l=e.values?K3(o,e.values,s):T2(o,s);return r&&(i.rem=r),r=l.map((c,f)=>Ce({index:f/(l.length-1||1),value:c,label:u(c)})),e.extra&&r.length&&r.push(Ce({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}});function mN(e){N.call(this,null,e)}function EH(){return Ce({})}function SH(e){const t=ll().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}W(mN,N,{transform(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||EH,o=e.key||ne,a=this.value;return I(i.encode)&&(i.encode=null),a&&(e.modified("key")||t.modified(o))&&P("DataJoin does not support modified key function or fields."),a||(t=t.addAll(),this.value=a=SH(o)),t.visit(t.ADD,s=>{const u=o(s);let l=a.get(u);l?l.exit?(a.empty--,i.add.push(l)):i.mod.push(l):(l=r(s),a.set(u,l),i.add.push(l)),l.datum=s,l.exit=!1}),t.visit(t.MOD,s=>{const u=o(s),l=a.get(u);l&&(l.datum=s,i.mod.push(l))}),t.visit(t.REM,s=>{const u=o(s),l=a.get(u);s===l.datum&&!l.exit&&(i.rem.push(l),l.exit=!0,++a.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&a.empty>n.cleanThreshold)&&n.runAfter(a.clean),i}});function yN(e){N.call(this,null,e)}W(yN,N,{transform(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,o=t.encode;if(I(o))if(n.changed()||o.every(f=>r[f]))o=o[0],n.encode=null;else return t.StopPropagation;var a=o==="enter",s=r.update||bo,u=r.enter||bo,l=r.exit||bo,c=(o&&!a?r[o]:s)||bo;if(t.changed(t.ADD)&&(t.visit(t.ADD,f=>{u(f,e),s(f,e)}),n.modifies(u.output),n.modifies(s.output),c!==bo&&c!==s&&(t.visit(t.ADD,f=>{c(f,e)}),n.modifies(c.output))),t.changed(t.REM)&&l!==bo&&(t.visit(t.REM,f=>{l(f,e)}),n.modifies(l.output)),a||c!==bo){const f=t.MOD|(e.modified()?t.REFLOW:0);a?(t.visit(f,d=>{const h=u(d,e)||i;(c(d,e)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(u.output)):t.visit(f,d=>{(c(d,e)||i)&&n.mod.push(d)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}});function vN(e){N.call(this,[],e)}W(vN,N,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,o=e.type||lh,a=e.scale,s=+e.limit,u=F2(a,e.count==null?5:e.count,e.minstep),l=!!e.values||o===lh,c=e.format||tD(n,a,u,o,e.formatSpecifier,e.formatType,l),f=e.values||eD(a,u),d,h,g,p,m;return r&&(i.rem=r),o===lh?(s&&f.length>s?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,s-1),m=!0):r=f,fe(g=e.size)?(!e.values&&a(r[0])===0&&(r=r.slice(1)),p=r.reduce((y,v)=>Math.max(y,g(v,e)),0)):g=Gt(p=g||8),r=r.map((y,v)=>Ce({index:v,label:c(y,v,r),value:y,offset:p,size:g(y,e)})),m&&(m=f[r.length],r.push(Ce({index:r.length,label:"\u2026".concat(f.length-r.length," entries"),value:m,offset:p,size:g(m,e)})))):o===KU?(d=a.domain(),h=Y3(a,d[0],ve(d)),f.length<3&&!e.values&&d[0]!==ve(d)&&(f=[d[0],ve(d)]),r=f.map((y,v)=>Ce({index:v,label:c(y,v,f),value:y,perc:h(y)}))):(g=f.length-1,h=sq(a),r=f.map((y,v)=>Ce({index:v,label:c(y,v,f),value:y,perc:v?h(y):0,perc2:v===g?1:h(f[v+1])}))),i.source=r,i.add=r,this.value=r,i}});const OH=e=>e.source.x,AH=e=>e.source.y,kH=e=>e.target.x,CH=e=>e.target.y;function mw(e){N.call(this,{},e)}mw.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};W(mw,N,{transform(e,t){var n=e.sourceX||OH,i=e.sourceY||AH,r=e.targetX||kH,o=e.targetY||CH,a=e.as||"path",s=e.orient||"vertical",u=e.shape||"line",l=GO.get(u+"-"+s)||GO.get(u);return l||P("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,c=>{c[a]=l(n(c),i(c),r(c),o(c))}),t.reflow(e.modified()).modifies(a)}});const bN=(e,t,n,i)=>"M"+e+","+t+"L"+n+","+i,$H=(e,t,n,i)=>bN(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),xN=(e,t,n,i)=>{var r=n-e,o=i-t,a=Math.sqrt(r*r+o*o)/2,s=180*Math.atan2(o,r)/Math.PI;return"M"+e+","+t+"A"+a+","+a+" "+s+" 0 1 "+n+","+i},FH=(e,t,n,i)=>xN(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),wN=(e,t,n,i)=>{const r=n-e,o=i-t,a=.2*(r+o),s=.2*(o-r);return"M"+e+","+t+"C"+(e+a)+","+(t+s)+" "+(n+s)+","+(i-a)+" "+n+","+i},TH=(e,t,n,i)=>wN(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),MH=(e,t,n,i)=>"M"+e+","+t+"V"+i+"H"+n,DH=(e,t,n,i)=>"M"+e+","+t+"H"+n+"V"+i,NH=(e,t,n,i)=>{const r=Math.cos(e),o=Math.sin(e),a=Math.cos(n),s=Math.sin(n),u=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*r+","+t*o+"A"+t+","+t+" 0 0,"+(u?1:0)+" "+t*a+","+t*s+"L"+i*a+","+i*s},jH=(e,t,n,i)=>{const r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i},RH=(e,t,n,i)=>{const r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i},PH=(e,t,n,i)=>{const r=Math.cos(e),o=Math.sin(e),a=Math.cos(n),s=Math.sin(n),u=(t+i)/2;return"M"+t*r+","+t*o+"C"+u*r+","+u*o+" "+u*a+","+u*s+" "+i*a+","+i*s},GO=ll({line:bN,"line-radial":$H,arc:xN,"arc-radial":FH,curve:wN,"curve-radial":TH,"orthogonal-horizontal":MH,"orthogonal-vertical":DH,"orthogonal-radial":NH,"diagonal-horizontal":jH,"diagonal-vertical":RH,"diagonal-radial":PH});function yw(e){N.call(this,null,e)}yw.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};W(yw,N,{transform(e,t){var n=e.as||["startAngle","endAngle"],i=n[0],r=n[1],o=e.field||al,a=e.startAngle||0,s=e.endAngle!=null?e.endAngle:2*Math.PI,u=t.source,l=u.map(o),c=l.length,f=a,d=(s-a)/HF(l),h=jn(c),g,p,m;for(e.sort&&h.sort((y,v)=>l[y]-l[v]),g=0;g<c;++g)m=l[h[g]],p=u[h[g]],p[i]=f,p[r]=f+=m*d;return this.value=l,t.reflow(e.modified()).modifies(n)}});const IH=5;function LH(e){const t=e.type;return!e.bins&&(t===Ru||t===Lf||t===zf)}function _N(e){return k2(e)&&e!==or}const zH=Mi(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function EN(e){N.call(this,null,e),this.modified(!0)}W(EN,N,{transform(e,t){var n=t.dataflow,i=this.value,r=BH(e);(!i||r!==i.type)&&(this.value=i=Ae(r)());for(r in e)if(!zH[r]){if(r==="padding"&&_N(i.type))continue;fe(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return YH(i,e,HH(i,e,qH(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function BH(e){var t=e.type,n="",i;return t===or?or+"-"+Ru:(UH(e)&&(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=i===2?or+"-":i===3?vl+"-":""),(n+t||Ru).toLowerCase())}function UH(e){const t=e.type;return k2(t)&&t!==fs&&t!==ds&&(e.scheme||e.range&&e.range.length&&e.range.every(Y))}function qH(e,t,n){const i=WH(e,t.domainRaw,n);if(i>-1)return i;var r=t.domain,o=e.type,a=t.zero||t.zero===void 0&&LH(e),s,u;if(!r)return 0;if(_N(o)&&t.padding&&r[0]!==ve(r)&&(r=GH(o,r,t.range,t.padding,t.exponent,t.constant)),(a||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(s=(r=r.slice()).length-1||1,a&&(r[0]>0&&(r[0]=0),r[s]<0&&(r[s]=0)),t.domainMin!=null&&(r[0]=t.domainMin),t.domainMax!=null&&(r[s]=t.domainMax),t.domainMid!=null)){u=t.domainMid;const l=u>r[s]?s+1:u<r[0]?0:s;l!==s&&n.warn("Scale domainMid exceeds domain min or max.",u),r.splice(l,0,u)}return e.domain(SN(o,r,n)),o===E2&&e.unknown(t.domainImplicit?hy:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&F2(e,t.nice)||null),r.length}function WH(e,t,n){return t?(e.domain(SN(e.type,t,n)),t.length):-1}function GH(e,t,n,i,r,o){var a=Math.abs(ve(n)-n[0]),s=a/(a-2*i),u=e===ro?pb(t,null,s):e===zf?Th(t,null,s,.5):e===Lf?Th(t,null,s,r||1):e===e0?mb(t,null,s,o||1):gb(t,null,s);return t=t.slice(),t[0]=u[0],t[t.length-1]=u[1],t}function SN(e,t,n){if(U3(e)){var i=Math.abs(t.reduce((r,o)=>r+(o<0?-1:o>0?1:0),0));i!==t.length&&n.warn("Log scale domain includes zero: "+G(t))}return t}function HH(e,t,n){let i=t.bins;if(i&&!I(i)){const r=e.domain(),o=r[0],a=ve(r),s=i.step;let u=i.start==null?o:i.start,l=i.stop==null?a:i.stop;s||P("Scale bins parameter missing step property."),u<o&&(u=s*Math.ceil(o/s)),l>a&&(l=s*Math.floor(a/s)),i=jn(u,l+s/2,s)}return i?e.bins=i:e.bins&&delete e.bins,e.type===S2&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}function YH(e,t,n){var i=e.type,r=t.round||!1,o=t.range;if(t.rangeStep!=null)o=XH(i,t,n);else if(t.scheme&&(o=VH(i,t,n),fe(o))){if(e.interpolator)return e.interpolator(o);P("Scale type ".concat(i," does not support interpolating color schemes."))}if(o&&q3(i))return e.interpolator(i0(jy(o,t.reverse),t.interpolate,t.interpolateGamma));o&&t.interpolate&&e.interpolate?e.interpolate(C2(t.interpolate,t.interpolateGamma)):fe(e.round)?e.round(r):fe(e.rangeRound)&&e.interpolate(r?Pf:ba),o&&e.range(jy(o,t.reverse))}function XH(e,t,n){e!==I3&&e!==xy&&P("Only band and point scales support rangeStep.");var i=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,r=e===xy?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*_2(n,r,i)]}function VH(e,t,n){var i=t.schemeExtent,r,o;return I(t.scheme)?o=i0(t.scheme,t.interpolate,t.interpolateGamma):(r=t.scheme.toLowerCase(),o=$2(r),o||P("Unrecognized scheme name: ".concat(t.scheme))),n=e===n0?n+1:e===S2?n-1:e===Pu||e===t0?+t.schemeCount||IH:n,q3(e)?HO(o,i,t.reverse):fe(o)?H3(HO(o,i),n):e===E2?o:o.slice(0,n)}function HO(e,t,n){return fe(e)&&(t||n)?G3(e,jy(t||[0,1],n)):e}function jy(e,t){return t?e.slice().reverse():e}function ON(e){N.call(this,null,e)}W(ON,N,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Ds(e.sort)),this.modified(n),t}});const YO="zero",AN="center",kN="normalize",CN=["y0","y1"];function vw(e){N.call(this,null,e)}vw.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:YO,values:[YO,AN,kN]},{name:"as",type:"string",array:!0,length:2,default:CN}]};W(vw,N,{transform(e,t){var n=e.as||CN,i=n[0],r=n[1],o=Ds(e.sort),a=e.field||al,s=e.offset===AN?KH:e.offset===kN?JH:QH,u,l,c,f;for(u=ZH(t.source,e.groupby,o,a),l=0,c=u.length,f=u.max;l<c;++l)s(u[l],f,a,i,r);return t.reflow(e.modified()).modifies(n)}});function KH(e,t,n,i,r){for(var o=(t-e.sum)/2,a=e.length,s=0,u;s<a;++s)u=e[s],u[i]=o,u[r]=o+=Math.abs(n(u))}function JH(e,t,n,i,r){for(var o=1/e.sum,a=0,s=e.length,u=0,l=0,c;u<s;++u)c=e[u],c[i]=a,c[r]=a=o*(l+=Math.abs(n(c)))}function QH(e,t,n,i,r){for(var o=0,a=0,s=e.length,u=0,l,c;u<s;++u)c=e[u],l=+n(c),l<0?(c[i]=a,c[r]=a+=l):(c[i]=o,c[r]=o+=l)}function ZH(e,t,n,i){var r=[],o=p=>p(c),a,s,u,l,c,f,d,h,g;if(t==null)r.push(e.slice());else for(a={},s=0,u=e.length;s<u;++s)c=e[s],f=t.map(o),d=a[f],d||(a[f]=d=[],r.push(d)),d.push(c);for(f=0,g=0,l=r.length;f<l;++f){for(d=r[f],s=0,h=0,u=d.length;s<u;++s)h+=Math.abs(i(d[s]));d.sum=h,h>g&&(g=h),n&&d.sort(n)}return r.max=g,r}var eY=Object.freeze(Object.defineProperty({__proto__:null,axisticks:pN,datajoin:mN,encode:yN,legendentries:vN,linkpath:mw,pie:yw,scale:EN,sortitems:ON,stack:vw},Symbol.toStringTag,{value:"Module"})),re=1e-6,cg=1e-12,ge=Math.PI,Je=ge/2,fg=ge/4,on=ge*2,et=180/ge,he=ge/180,ye=Math.abs,xl=Math.atan,ri=Math.atan2,oe=Math.cos,Fd=Math.ceil,$N=Math.exp,Ry=Math.hypot,dg=Math.log,Ym=Math.pow,ie=Math.sin,Vn=Math.sign||function(e){return e>0?1:e<0?-1:0},an=Math.sqrt,bw=Math.tan;function FN(e){return e>1?0:e<-1?ge:Math.acos(e)}function kn(e){return e>1?Je:e<-1?-Je:Math.asin(e)}function St(){}function hg(e,t){e&&VO.hasOwnProperty(e.type)&&VO[e.type](e,t)}var XO={Feature:function(e,t){hg(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)hg(n[i].geometry,t)}},VO={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Py(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Py(n[i],t,0)},Polygon:function(e,t){KO(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)KO(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)hg(n[i],t)}};function Py(e,t,n){var i=-1,r=e.length-n,o;for(t.lineStart();++i<r;)o=e[i],t.point(o[0],o[1],o[2]);t.lineEnd()}function KO(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Py(e[n],t,1);t.polygonEnd()}function Ur(e,t){e&&XO.hasOwnProperty(e.type)?XO[e.type](e,t):hg(e,t)}var gg=new nn,pg=new nn,TN,MN,Iy,Ly,zy,hr={point:St,lineStart:St,lineEnd:St,polygonStart:function(){gg=new nn,hr.lineStart=tY,hr.lineEnd=nY},polygonEnd:function(){var e=+gg;pg.add(e<0?on+e:e),this.lineStart=this.lineEnd=this.point=St},sphere:function(){pg.add(on)}};function tY(){hr.point=iY}function nY(){DN(TN,MN)}function iY(e,t){hr.point=DN,TN=e,MN=t,e*=he,t*=he,Iy=e,Ly=oe(t=t/2+fg),zy=ie(t)}function DN(e,t){e*=he,t*=he,t=t/2+fg;var n=e-Iy,i=n>=0?1:-1,r=i*n,o=oe(t),a=ie(t),s=zy*a,u=Ly*o+s*oe(r),l=s*i*ie(r);gg.add(ri(l,u)),Iy=e,Ly=o,zy=a}function rY(e){return pg=new nn,Ur(e,hr),pg*2}function mg(e){return[ri(e[1],e[0]),kn(e[2])]}function hs(e){var t=e[0],n=e[1],i=oe(n);return[i*oe(t),i*ie(t),ie(n)]}function Td(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Wu(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Xm(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Md(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function yg(e){var t=an(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Ge,hn,Ve,Dn,Ra,NN,jN,bu,Mc,Oo,oo,Lr={point:By,lineStart:JO,lineEnd:QO,polygonStart:function(){Lr.point=PN,Lr.lineStart=oY,Lr.lineEnd=aY,Mc=new nn,hr.polygonStart()},polygonEnd:function(){hr.polygonEnd(),Lr.point=By,Lr.lineStart=JO,Lr.lineEnd=QO,gg<0?(Ge=-(Ve=180),hn=-(Dn=90)):Mc>re?Dn=90:Mc<-re&&(hn=-90),oo[0]=Ge,oo[1]=Ve},sphere:function(){Ge=-(Ve=180),hn=-(Dn=90)}};function By(e,t){Oo.push(oo=[Ge=e,Ve=e]),t<hn&&(hn=t),t>Dn&&(Dn=t)}function RN(e,t){var n=hs([e*he,t*he]);if(bu){var i=Wu(bu,n),r=[i[1],-i[0],0],o=Wu(r,i);yg(o),o=mg(o);var a=e-Ra,s=a>0?1:-1,u=o[0]*et*s,l,c=ye(a)>180;c^(s*Ra<u&&u<s*e)?(l=o[1]*et,l>Dn&&(Dn=l)):(u=(u+360)%360-180,c^(s*Ra<u&&u<s*e)?(l=-o[1]*et,l<hn&&(hn=l)):(t<hn&&(hn=t),t>Dn&&(Dn=t))),c?e<Ra?Mn(Ge,e)>Mn(Ge,Ve)&&(Ve=e):Mn(e,Ve)>Mn(Ge,Ve)&&(Ge=e):Ve>=Ge?(e<Ge&&(Ge=e),e>Ve&&(Ve=e)):e>Ra?Mn(Ge,e)>Mn(Ge,Ve)&&(Ve=e):Mn(e,Ve)>Mn(Ge,Ve)&&(Ge=e)}else Oo.push(oo=[Ge=e,Ve=e]);t<hn&&(hn=t),t>Dn&&(Dn=t),bu=n,Ra=e}function JO(){Lr.point=RN}function QO(){oo[0]=Ge,oo[1]=Ve,Lr.point=By,bu=null}function PN(e,t){if(bu){var n=e-Ra;Mc.add(ye(n)>180?n+(n>0?360:-360):n)}else NN=e,jN=t;hr.point(e,t),RN(e,t)}function oY(){hr.lineStart()}function aY(){PN(NN,jN),hr.lineEnd(),ye(Mc)>re&&(Ge=-(Ve=180)),oo[0]=Ge,oo[1]=Ve,bu=null}function Mn(e,t){return(t-=e)<0?t+360:t}function sY(e,t){return e[0]-t[0]}function ZO(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function uY(e){var t,n,i,r,o,a,s;if(Dn=Ve=-(Ge=hn=1/0),Oo=[],Ur(e,Lr),n=Oo.length){for(Oo.sort(sY),t=1,i=Oo[0],o=[i];t<n;++t)r=Oo[t],ZO(i,r[0])||ZO(i,r[1])?(Mn(i[0],r[1])>Mn(i[0],i[1])&&(i[1]=r[1]),Mn(r[0],i[1])>Mn(i[0],i[1])&&(i[0]=r[0])):o.push(i=r);for(a=-1/0,n=o.length-1,t=0,i=o[n];t<=n;i=r,++t)r=o[t],(s=Mn(i[1],r[0]))>a&&(a=s,Ge=r[0],Ve=i[1])}return Oo=oo=null,Ge===1/0||hn===1/0?[[NaN,NaN],[NaN,NaN]]:[[Ge,hn],[Ve,Dn]]}var hc,vg,bg,xg,wg,_g,Eg,Sg,Uy,qy,Wy,IN,LN,Jt,Qt,Zt,Oi={sphere:St,point:xw,lineStart:eA,lineEnd:tA,polygonStart:function(){Oi.lineStart=fY,Oi.lineEnd=dY},polygonEnd:function(){Oi.lineStart=eA,Oi.lineEnd=tA}};function xw(e,t){e*=he,t*=he;var n=oe(t);Jf(n*oe(e),n*ie(e),ie(t))}function Jf(e,t,n){++hc,bg+=(e-bg)/hc,xg+=(t-xg)/hc,wg+=(n-wg)/hc}function eA(){Oi.point=lY}function lY(e,t){e*=he,t*=he;var n=oe(t);Jt=n*oe(e),Qt=n*ie(e),Zt=ie(t),Oi.point=cY,Jf(Jt,Qt,Zt)}function cY(e,t){e*=he,t*=he;var n=oe(t),i=n*oe(e),r=n*ie(e),o=ie(t),a=ri(an((a=Qt*o-Zt*r)*a+(a=Zt*i-Jt*o)*a+(a=Jt*r-Qt*i)*a),Jt*i+Qt*r+Zt*o);vg+=a,_g+=a*(Jt+(Jt=i)),Eg+=a*(Qt+(Qt=r)),Sg+=a*(Zt+(Zt=o)),Jf(Jt,Qt,Zt)}function tA(){Oi.point=xw}function fY(){Oi.point=hY}function dY(){zN(IN,LN),Oi.point=xw}function hY(e,t){IN=e,LN=t,e*=he,t*=he,Oi.point=zN;var n=oe(t);Jt=n*oe(e),Qt=n*ie(e),Zt=ie(t),Jf(Jt,Qt,Zt)}function zN(e,t){e*=he,t*=he;var n=oe(t),i=n*oe(e),r=n*ie(e),o=ie(t),a=Qt*o-Zt*r,s=Zt*i-Jt*o,u=Jt*r-Qt*i,l=Ry(a,s,u),c=kn(l),f=l&&-c/l;Uy.add(f*a),qy.add(f*s),Wy.add(f*u),vg+=c,_g+=c*(Jt+(Jt=i)),Eg+=c*(Qt+(Qt=r)),Sg+=c*(Zt+(Zt=o)),Jf(Jt,Qt,Zt)}function gY(e){hc=vg=bg=xg=wg=_g=Eg=Sg=0,Uy=new nn,qy=new nn,Wy=new nn,Ur(e,Oi);var t=+Uy,n=+qy,i=+Wy,r=Ry(t,n,i);return r<cg&&(t=_g,n=Eg,i=Sg,vg<re&&(t=bg,n=xg,i=wg),r=Ry(t,n,i),r<cg)?[NaN,NaN]:[ri(n,t)*et,kn(i/r)*et]}function Gy(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function Hy(e,t){return ye(e)>ge&&(e-=Math.round(e/on)*on),[e,t]}Hy.invert=Hy;function BN(e,t,n){return(e%=on)?t||n?Gy(iA(e),rA(t,n)):iA(e):t||n?rA(t,n):Hy}function nA(e){return function(t,n){return t+=e,ye(t)>ge&&(t-=Math.round(t/on)*on),[t,n]}}function iA(e){var t=nA(e);return t.invert=nA(-e),t}function rA(e,t){var n=oe(e),i=ie(e),r=oe(t),o=ie(t);function a(s,u){var l=oe(u),c=oe(s)*l,f=ie(s)*l,d=ie(u),h=d*n+c*i;return[ri(f*r-h*o,c*n-d*i),kn(h*r+f*o)]}return a.invert=function(s,u){var l=oe(u),c=oe(s)*l,f=ie(s)*l,d=ie(u),h=d*r-f*o;return[ri(f*r+d*o,c*n+h*i),kn(h*n-c*i)]},a}function pY(e){e=BN(e[0]*he,e[1]*he,e.length>2?e[2]*he:0);function t(n){return n=e(n[0]*he,n[1]*he),n[0]*=et,n[1]*=et,n}return t.invert=function(n){return n=e.invert(n[0]*he,n[1]*he),n[0]*=et,n[1]*=et,n},t}function mY(e,t,n,i,r,o){if(!!n){var a=oe(t),s=ie(t),u=i*n;r==null?(r=t+i*on,o=t-u/2):(r=oA(a,r),o=oA(a,o),(i>0?r<o:r>o)&&(r+=i*on));for(var l,c=r;i>0?c>o:c<o;c-=u)l=mg([a,-s*oe(c),-s*ie(c)]),e.point(l[0],l[1])}}function oA(e,t){t=hs(t),t[0]-=e,yg(t);var n=FN(-t[1]);return((-t[2]<0?-n:n)+on-re)%on}function UN(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:St,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function yh(e,t){return ye(e[0]-t[0])<re&&ye(e[1]-t[1])<re}function Dd(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function qN(e,t,n,i,r){var o=[],a=[],s,u;if(e.forEach(function(g){if(!((p=g.length-1)<=0)){var p,m=g[0],y=g[p],v;if(yh(m,y)){if(!m[2]&&!y[2]){for(r.lineStart(),s=0;s<p;++s)r.point((m=g[s])[0],m[1]);r.lineEnd();return}y[0]+=2*re}o.push(v=new Dd(m,g,null,!0)),a.push(v.o=new Dd(m,null,v,!1)),o.push(v=new Dd(y,g,null,!1)),a.push(v.o=new Dd(y,null,v,!0))}}),!!o.length){for(a.sort(t),aA(o),aA(a),s=0,u=a.length;s<u;++s)a[s].e=n=!n;for(var l=o[0],c,f;;){for(var d=l,h=!0;d.v;)if((d=d.n)===l)return;c=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(s=0,u=c.length;s<u;++s)r.point((f=c[s])[0],f[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(h)for(c=d.p.z,s=c.length-1;s>=0;--s)r.point((f=c[s])[0],f[1]);else i(d.x,d.p.x,-1,r);d=d.p}d=d.o,c=d.z,h=!h}while(!d.v);r.lineEnd()}}}function aA(e){if(!!(t=e.length)){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function Vm(e){return ye(e[0])<=ge?e[0]:Vn(e[0])*((ye(e[0])+ge)%on-ge)}function yY(e,t){var n=Vm(t),i=t[1],r=ie(i),o=[ie(n),-oe(n),0],a=0,s=0,u=new nn;r===1?i=Je+re:r===-1&&(i=-Je-re);for(var l=0,c=e.length;l<c;++l)if(!!(d=(f=e[l]).length))for(var f,d,h=f[d-1],g=Vm(h),p=h[1]/2+fg,m=ie(p),y=oe(p),v=0;v<d;++v,g=x,m=E,y=w,h=b){var b=f[v],x=Vm(b),_=b[1]/2+fg,E=ie(_),w=oe(_),S=x-g,C=S>=0?1:-1,A=C*S,O=A>ge,F=m*E;if(u.add(ri(F*C*ie(A),y*w+F*oe(A))),a+=O?S+C*on:S,O^g>=n^x>=n){var k=Wu(hs(h),hs(b));yg(k);var M=Wu(o,k);yg(M);var $=(O^S>=0?-1:1)*kn(M[2]);(i>$||i===$&&(k[0]||k[1]))&&(s+=O^S>=0?1:-1)}}return(a<-re||a<re&&u<-cg)^s&1}function WN(e,t,n,i){return function(r){var o=t(r),a=UN(),s=t(a),u=!1,l,c,f,d={point:h,lineStart:p,lineEnd:m,polygonStart:function(){d.point=y,d.lineStart=v,d.lineEnd=b,c=[],l=[]},polygonEnd:function(){d.point=h,d.lineStart=p,d.lineEnd=m,c=GF(c);var x=yY(l,i);c.length?(u||(r.polygonStart(),u=!0),qN(c,bY,x,n,r)):x&&(u||(r.polygonStart(),u=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),u&&(r.polygonEnd(),u=!1),c=l=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function h(x,_){e(x,_)&&r.point(x,_)}function g(x,_){o.point(x,_)}function p(){d.point=g,o.lineStart()}function m(){d.point=h,o.lineEnd()}function y(x,_){f.push([x,_]),s.point(x,_)}function v(){s.lineStart(),f=[]}function b(){y(f[0][0],f[0][1]),s.lineEnd();var x=s.clean(),_=a.result(),E,w=_.length,S,C,A;if(f.pop(),l.push(f),f=null,!!w){if(x&1){if(C=_[0],(S=C.length-1)>0){for(u||(r.polygonStart(),u=!0),r.lineStart(),E=0;E<S;++E)r.point((A=C[E])[0],A[1]);r.lineEnd()}return}w>1&&x&2&&_.push(_.pop().concat(_.shift())),c.push(_.filter(vY))}}return d}}function vY(e){return e.length>1}function bY(e,t){return((e=e.x)[0]<0?e[1]-Je-re:Je-e[1])-((t=t.x)[0]<0?t[1]-Je-re:Je-t[1])}var sA=WN(function(){return!0},xY,_Y,[-ge,-Je]);function xY(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(o,a){var s=o>0?ge:-ge,u=ye(o-t);ye(u-ge)<re?(e.point(t,n=(n+a)/2>0?Je:-Je),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(s,n),e.point(o,n),r=0):i!==s&&u>=ge&&(ye(t-i)<re&&(t-=i*re),ye(o-s)<re&&(o-=s*re),n=wY(t,n,o,a),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(s,n),r=0),e.point(t=o,n=a),i=s},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function wY(e,t,n,i){var r,o,a=ie(e-n);return ye(a)>re?xl((ie(t)*(o=oe(i))*ie(n)-ie(i)*(r=oe(t))*ie(e))/(r*o*a)):(t+i)/2}function _Y(e,t,n,i){var r;if(e==null)r=n*Je,i.point(-ge,r),i.point(0,r),i.point(ge,r),i.point(ge,0),i.point(ge,-r),i.point(0,-r),i.point(-ge,-r),i.point(-ge,0),i.point(-ge,r);else if(ye(e[0]-t[0])>re){var o=e[0]<t[0]?ge:-ge;r=n*o/2,i.point(-o,r),i.point(0,r),i.point(o,r)}else i.point(t[0],t[1])}function EY(e){var t=oe(e),n=6*he,i=t>0,r=ye(t)>re;function o(c,f,d,h){mY(h,e,n,d,c,f)}function a(c,f){return oe(c)*oe(f)>t}function s(c){var f,d,h,g,p;return{lineStart:function(){g=h=!1,p=1},point:function(m,y){var v=[m,y],b,x=a(m,y),_=i?x?0:l(m,y):x?l(m+(m<0?ge:-ge),y):0;if(!f&&(g=h=x)&&c.lineStart(),x!==h&&(b=u(f,v),(!b||yh(f,b)||yh(v,b))&&(v[2]=1)),x!==h)p=0,x?(c.lineStart(),b=u(v,f),c.point(b[0],b[1])):(b=u(f,v),c.point(b[0],b[1],2),c.lineEnd()),f=b;else if(r&&f&&i^x){var E;!(_&d)&&(E=u(v,f,!0))&&(p=0,i?(c.lineStart(),c.point(E[0][0],E[0][1]),c.point(E[1][0],E[1][1]),c.lineEnd()):(c.point(E[1][0],E[1][1]),c.lineEnd(),c.lineStart(),c.point(E[0][0],E[0][1],3)))}x&&(!f||!yh(f,v))&&c.point(v[0],v[1]),f=v,h=x,d=_},lineEnd:function(){h&&c.lineEnd(),f=null},clean:function(){return p|(g&&h)<<1}}}function u(c,f,d){var h=hs(c),g=hs(f),p=[1,0,0],m=Wu(h,g),y=Td(m,m),v=m[0],b=y-v*v;if(!b)return!d&&c;var x=t*y/b,_=-t*v/b,E=Wu(p,m),w=Md(p,x),S=Md(m,_);Xm(w,S);var C=E,A=Td(w,C),O=Td(C,C),F=A*A-O*(Td(w,w)-1);if(!(F<0)){var k=an(F),M=Md(C,(-A-k)/O);if(Xm(M,w),M=mg(M),!d)return M;var $=c[0],T=f[0],D=c[1],R=f[1],L;T<$&&(L=$,$=T,T=L);var J=T-$,ue=ye(J-ge)<re,_e=ue||J<re;if(!ue&&R<D&&(L=D,D=R,R=L),_e?ue?D+R>0^M[1]<(ye(M[0]-$)<re?D:R):D<=M[1]&&M[1]<=R:J>ge^($<=M[0]&&M[0]<=T)){var Ee=Md(C,(-A+k)/O);return Xm(Ee,w),[M,mg(Ee)]}}}function l(c,f){var d=i?e:ge-e,h=0;return c<-d?h|=1:c>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return WN(a,s,o,i?[0,-e]:[-ge,e-ge])}function SY(e,t,n,i,r,o){var a=e[0],s=e[1],u=t[0],l=t[1],c=0,f=1,d=u-a,h=l-s,g;if(g=n-a,!(!d&&g>0)){if(g/=d,d<0){if(g<c)return;g<f&&(f=g)}else if(d>0){if(g>f)return;g>c&&(c=g)}if(g=r-a,!(!d&&g<0)){if(g/=d,d<0){if(g>f)return;g>c&&(c=g)}else if(d>0){if(g<c)return;g<f&&(f=g)}if(g=i-s,!(!h&&g>0)){if(g/=h,h<0){if(g<c)return;g<f&&(f=g)}else if(h>0){if(g>f)return;g>c&&(c=g)}if(g=o-s,!(!h&&g<0)){if(g/=h,h<0){if(g>f)return;g>c&&(c=g)}else if(h>0){if(g<c)return;g<f&&(f=g)}return c>0&&(e[0]=a+c*d,e[1]=s+c*h),f<1&&(t[0]=a+f*d,t[1]=s+f*h),!0}}}}}var gc=1e9,Nd=-gc;function GN(e,t,n,i){function r(l,c){return e<=l&&l<=n&&t<=c&&c<=i}function o(l,c,f,d){var h=0,g=0;if(l==null||(h=a(l,f))!==(g=a(c,f))||u(l,c)<0^f>0)do d.point(h===0||h===3?e:n,h>1?i:t);while((h=(h+f+4)%4)!==g);else d.point(c[0],c[1])}function a(l,c){return ye(l[0]-e)<re?c>0?0:3:ye(l[0]-n)<re?c>0?2:1:ye(l[1]-t)<re?c>0?1:0:c>0?3:2}function s(l,c){return u(l.x,c.x)}function u(l,c){var f=a(l,1),d=a(c,1);return f!==d?f-d:f===0?c[1]-l[1]:f===1?l[0]-c[0]:f===2?l[1]-c[1]:c[0]-l[0]}return function(l){var c=l,f=UN(),d,h,g,p,m,y,v,b,x,_,E,w={point:S,lineStart:F,lineEnd:k,polygonStart:A,polygonEnd:O};function S($,T){r($,T)&&c.point($,T)}function C(){for(var $=0,T=0,D=h.length;T<D;++T)for(var R=h[T],L=1,J=R.length,ue=R[0],_e,Ee,Ye=ue[0],pe=ue[1];L<J;++L)_e=Ye,Ee=pe,ue=R[L],Ye=ue[0],pe=ue[1],Ee<=i?pe>i&&(Ye-_e)*(i-Ee)>(pe-Ee)*(e-_e)&&++$:pe<=i&&(Ye-_e)*(i-Ee)<(pe-Ee)*(e-_e)&&--$;return $}function A(){c=f,d=[],h=[],E=!0}function O(){var $=C(),T=E&&$,D=(d=GF(d)).length;(T||D)&&(l.polygonStart(),T&&(l.lineStart(),o(null,null,1,l),l.lineEnd()),D&&qN(d,s,$,o,l),l.polygonEnd()),c=l,d=h=g=null}function F(){w.point=M,h&&h.push(g=[]),_=!0,x=!1,v=b=NaN}function k(){d&&(M(p,m),y&&x&&f.rejoin(),d.push(f.result())),w.point=S,x&&c.lineEnd()}function M($,T){var D=r($,T);if(h&&g.push([$,T]),_)p=$,m=T,y=D,_=!1,D&&(c.lineStart(),c.point($,T));else if(D&&x)c.point($,T);else{var R=[v=Math.max(Nd,Math.min(gc,v)),b=Math.max(Nd,Math.min(gc,b))],L=[$=Math.max(Nd,Math.min(gc,$)),T=Math.max(Nd,Math.min(gc,T))];SY(R,L,e,t,n,i)?(x||(c.lineStart(),c.point(R[0],R[1])),c.point(L[0],L[1]),D||c.lineEnd(),E=!1):D&&(c.lineStart(),c.point($,T),E=!1)}v=$,b=T,x=D}return w}}function uA(e,t,n){var i=jn(e,t-re,n).concat(t);return function(r){return i.map(function(o){return[r,o]})}}function lA(e,t,n){var i=jn(e,t-re,n).concat(t);return function(r){return i.map(function(o){return[o,r]})}}function OY(){var e,t,n,i,r,o,a,s,u=10,l=u,c=90,f=360,d,h,g,p,m=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return jn(Fd(i/c)*c,n,c).map(g).concat(jn(Fd(s/f)*f,a,f).map(p)).concat(jn(Fd(t/u)*u,e,u).filter(function(b){return ye(b%c)>re}).map(d)).concat(jn(Fd(o/l)*l,r,l).filter(function(b){return ye(b%f)>re}).map(h))}return y.lines=function(){return v().map(function(b){return{type:"LineString",coordinates:b}})},y.outline=function(){return{type:"Polygon",coordinates:[g(i).concat(p(a).slice(1),g(n).reverse().slice(1),p(s).reverse().slice(1))]}},y.extent=function(b){return arguments.length?y.extentMajor(b).extentMinor(b):y.extentMinor()},y.extentMajor=function(b){return arguments.length?(i=+b[0][0],n=+b[1][0],s=+b[0][1],a=+b[1][1],i>n&&(b=i,i=n,n=b),s>a&&(b=s,s=a,a=b),y.precision(m)):[[i,s],[n,a]]},y.extentMinor=function(b){return arguments.length?(t=+b[0][0],e=+b[1][0],o=+b[0][1],r=+b[1][1],t>e&&(b=t,t=e,e=b),o>r&&(b=o,o=r,r=b),y.precision(m)):[[t,o],[e,r]]},y.step=function(b){return arguments.length?y.stepMajor(b).stepMinor(b):y.stepMinor()},y.stepMajor=function(b){return arguments.length?(c=+b[0],f=+b[1],y):[c,f]},y.stepMinor=function(b){return arguments.length?(u=+b[0],l=+b[1],y):[u,l]},y.precision=function(b){return arguments.length?(m=+b,d=uA(o,r,90),h=lA(t,e,m),g=uA(s,a,90),p=lA(i,n,m),y):m},y.extentMajor([[-180,-90+re],[180,90-re]]).extentMinor([[-180,-80-re],[180,80+re]])}var of=e=>e,Km=new nn,Yy=new nn,HN,YN,Xy,Vy,Co={point:St,lineStart:St,lineEnd:St,polygonStart:function(){Co.lineStart=AY,Co.lineEnd=CY},polygonEnd:function(){Co.lineStart=Co.lineEnd=Co.point=St,Km.add(ye(Yy)),Yy=new nn},result:function(){var e=Km/2;return Km=new nn,e}};function AY(){Co.point=kY}function kY(e,t){Co.point=XN,HN=Xy=e,YN=Vy=t}function XN(e,t){Yy.add(Vy*e-Xy*t),Xy=e,Vy=t}function CY(){XN(HN,YN)}var cA=Co,Gu=1/0,Og=Gu,af=-Gu,Ag=af,$Y={point:FY,lineStart:St,lineEnd:St,polygonStart:St,polygonEnd:St,result:function(){var e=[[Gu,Og],[af,Ag]];return af=Ag=-(Og=Gu=1/0),e}};function FY(e,t){e<Gu&&(Gu=e),e>af&&(af=e),t<Og&&(Og=t),t>Ag&&(Ag=t)}var kg=$Y,Ky=0,Jy=0,pc=0,Cg=0,$g=0,cu=0,Qy=0,Zy=0,mc=0,VN,KN,Ki,Ji,wi={point:gs,lineStart:fA,lineEnd:dA,polygonStart:function(){wi.lineStart=DY,wi.lineEnd=NY},polygonEnd:function(){wi.point=gs,wi.lineStart=fA,wi.lineEnd=dA},result:function(){var e=mc?[Qy/mc,Zy/mc]:cu?[Cg/cu,$g/cu]:pc?[Ky/pc,Jy/pc]:[NaN,NaN];return Ky=Jy=pc=Cg=$g=cu=Qy=Zy=mc=0,e}};function gs(e,t){Ky+=e,Jy+=t,++pc}function fA(){wi.point=TY}function TY(e,t){wi.point=MY,gs(Ki=e,Ji=t)}function MY(e,t){var n=e-Ki,i=t-Ji,r=an(n*n+i*i);Cg+=r*(Ki+e)/2,$g+=r*(Ji+t)/2,cu+=r,gs(Ki=e,Ji=t)}function dA(){wi.point=gs}function DY(){wi.point=jY}function NY(){JN(VN,KN)}function jY(e,t){wi.point=JN,gs(VN=Ki=e,KN=Ji=t)}function JN(e,t){var n=e-Ki,i=t-Ji,r=an(n*n+i*i);Cg+=r*(Ki+e)/2,$g+=r*(Ji+t)/2,cu+=r,r=Ji*e-Ki*t,Qy+=r*(Ki+e),Zy+=r*(Ji+t),mc+=r*3,gs(Ki=e,Ji=t)}var hA=wi;function QN(e){this._context=e}QN.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,on);break}}},result:St};var ev=new nn,Jm,ZN,ej,yc,vc,Fg={point:St,lineStart:function(){Fg.point=RY},lineEnd:function(){Jm&&tj(ZN,ej),Fg.point=St},polygonStart:function(){Jm=!0},polygonEnd:function(){Jm=null},result:function(){var e=+ev;return ev=new nn,e}};function RY(e,t){Fg.point=tj,ZN=yc=e,ej=vc=t}function tj(e,t){yc-=e,vc-=t,ev.add(an(yc*yc+vc*vc)),yc=e,vc=t}var gA=Fg;let pA,Tg,mA,yA;class vA{constructor(t){this._append=t==null?nj:PY(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==mA||this._append!==Tg){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,mA=i,Tg=this._append,yA=this._,this._=r}this._+=yA;break}}}result(){const t=this._;return this._="",t.length?t:null}}function nj(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function PY(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return nj;if(t!==pA){const n=10**t;pA=t,Tg=function(r){let o=1;this._+=r[0];for(const a=r.length;o<a;++o)this._+=Math.round(arguments[o]*n)/n+r[o]}}return Tg}function ij(e,t){let n=3,i=4.5,r,o;function a(s){return s&&(typeof i=="function"&&o.pointRadius(+i.apply(this,arguments)),Ur(s,r(o))),o.result()}return a.area=function(s){return Ur(s,r(cA)),cA.result()},a.measure=function(s){return Ur(s,r(gA)),gA.result()},a.bounds=function(s){return Ur(s,r(kg)),kg.result()},a.centroid=function(s){return Ur(s,r(hA)),hA.result()},a.projection=function(s){return arguments.length?(r=s==null?(e=null,of):(e=s).stream,a):e},a.context=function(s){return arguments.length?(o=s==null?(t=null,new vA(n)):new QN(t=s),typeof i!="function"&&o.pointRadius(i),a):t},a.pointRadius=function(s){return arguments.length?(i=typeof s=="function"?s:(o.pointRadius(+s),+s),a):i},a.digits=function(s){if(!arguments.length)return n;if(s==null)n=null;else{const u=Math.floor(s);if(!(u>=0))throw new RangeError(`invalid digits: ${s}`);n=u}return t===null&&(o=new vA(n)),a},a.projection(e).digits(n).context(t)}function m0(e){return function(t){var n=new tv;for(var i in e)n[i]=e[i];return n.stream=t,n}}function tv(){}tv.prototype={constructor:tv,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function ww(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),Ur(n,e.stream(kg)),t(kg.result()),i!=null&&e.clipExtent(i),e}function y0(e,t,n){return ww(e,function(i){var r=t[1][0]-t[0][0],o=t[1][1]-t[0][1],a=Math.min(r/(i[1][0]-i[0][0]),o/(i[1][1]-i[0][1])),s=+t[0][0]+(r-a*(i[1][0]+i[0][0]))/2,u=+t[0][1]+(o-a*(i[1][1]+i[0][1]))/2;e.scale(150*a).translate([s,u])},n)}function _w(e,t,n){return y0(e,[[0,0],t],n)}function Ew(e,t,n){return ww(e,function(i){var r=+t,o=r/(i[1][0]-i[0][0]),a=(r-o*(i[1][0]+i[0][0]))/2,s=-o*i[0][1];e.scale(150*o).translate([a,s])},n)}function Sw(e,t,n){return ww(e,function(i){var r=+t,o=r/(i[1][1]-i[0][1]),a=-o*i[0][0],s=(r-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([a,s])},n)}var bA=16,IY=oe(30*he);function xA(e,t){return+t?zY(e,t):LY(e)}function LY(e){return m0({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function zY(e,t){function n(i,r,o,a,s,u,l,c,f,d,h,g,p,m){var y=l-i,v=c-r,b=y*y+v*v;if(b>4*t&&p--){var x=a+d,_=s+h,E=u+g,w=an(x*x+_*_+E*E),S=kn(E/=w),C=ye(ye(E)-1)<re||ye(o-f)<re?(o+f)/2:ri(_,x),A=e(C,S),O=A[0],F=A[1],k=O-i,M=F-r,$=v*k-y*M;($*$/b>t||ye((y*k+v*M)/b-.5)>.3||a*d+s*h+u*g<IY)&&(n(i,r,o,a,s,u,O,F,C,x/=w,_/=w,E,p,m),m.point(O,F),n(O,F,C,x,_,E,l,c,f,d,h,g,p,m))}}return function(i){var r,o,a,s,u,l,c,f,d,h,g,p,m={point:y,lineStart:v,lineEnd:x,polygonStart:function(){i.polygonStart(),m.lineStart=_},polygonEnd:function(){i.polygonEnd(),m.lineStart=v}};function y(S,C){S=e(S,C),i.point(S[0],S[1])}function v(){f=NaN,m.point=b,i.lineStart()}function b(S,C){var A=hs([S,C]),O=e(S,C);n(f,d,c,h,g,p,f=O[0],d=O[1],c=S,h=A[0],g=A[1],p=A[2],bA,i),i.point(f,d)}function x(){m.point=y,i.lineEnd()}function _(){v(),m.point=E,m.lineEnd=w}function E(S,C){b(r=S,C),o=f,a=d,s=h,u=g,l=p,m.point=b}function w(){n(f,d,c,h,g,p,o,a,r,s,u,l,bA,i),m.lineEnd=x,x()}return m}}var BY=m0({point:function(e,t){this.stream.point(e*he,t*he)}});function UY(e){return m0({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function qY(e,t,n,i,r){function o(a,s){return a*=i,s*=r,[t+e*a,n-e*s]}return o.invert=function(a,s){return[(a-t)/e*i,(n-s)/e*r]},o}function wA(e,t,n,i,r,o){if(!o)return qY(e,t,n,i,r);var a=oe(o),s=ie(o),u=a*e,l=s*e,c=a/e,f=s/e,d=(s*n-a*t)/e,h=(s*t+a*n)/e;function g(p,m){return p*=i,m*=r,[u*p-l*m+t,n-l*p-u*m]}return g.invert=function(p,m){return[i*(c*p-f*m+d),r*(h-f*p-c*m)]},g}function Fr(e){return rj(function(){return e})()}function rj(e){var t,n=150,i=480,r=250,o=0,a=0,s=0,u=0,l=0,c,f=0,d=1,h=1,g=null,p=sA,m=null,y,v,b,x=of,_=.5,E,w,S,C,A;function O($){return S($[0]*he,$[1]*he)}function F($){return $=S.invert($[0],$[1]),$&&[$[0]*et,$[1]*et]}O.stream=function($){return C&&A===$?C:C=BY(UY(c)(p(E(x(A=$)))))},O.preclip=function($){return arguments.length?(p=$,g=void 0,M()):p},O.postclip=function($){return arguments.length?(x=$,m=y=v=b=null,M()):x},O.clipAngle=function($){return arguments.length?(p=+$?EY(g=$*he):(g=null,sA),M()):g*et},O.clipExtent=function($){return arguments.length?(x=$==null?(m=y=v=b=null,of):GN(m=+$[0][0],y=+$[0][1],v=+$[1][0],b=+$[1][1]),M()):m==null?null:[[m,y],[v,b]]},O.scale=function($){return arguments.length?(n=+$,k()):n},O.translate=function($){return arguments.length?(i=+$[0],r=+$[1],k()):[i,r]},O.center=function($){return arguments.length?(o=$[0]%360*he,a=$[1]%360*he,k()):[o*et,a*et]},O.rotate=function($){return arguments.length?(s=$[0]%360*he,u=$[1]%360*he,l=$.length>2?$[2]%360*he:0,k()):[s*et,u*et,l*et]},O.angle=function($){return arguments.length?(f=$%360*he,k()):f*et},O.reflectX=function($){return arguments.length?(d=$?-1:1,k()):d<0},O.reflectY=function($){return arguments.length?(h=$?-1:1,k()):h<0},O.precision=function($){return arguments.length?(E=xA(w,_=$*$),M()):an(_)},O.fitExtent=function($,T){return y0(O,$,T)},O.fitSize=function($,T){return _w(O,$,T)},O.fitWidth=function($,T){return Ew(O,$,T)},O.fitHeight=function($,T){return Sw(O,$,T)};function k(){var $=wA(n,0,0,d,h,f).apply(null,t(o,a)),T=wA(n,i-$[0],r-$[1],d,h,f);return c=BN(s,u,l),w=Gy(t,T),S=Gy(c,w),E=xA(w,_),M()}function M(){return C=A=null,O}return function(){return t=e.apply(this,arguments),O.invert=t.invert&&F,k()}}function Ow(e){var t=0,n=ge/3,i=rj(e),r=i(t,n);return r.parallels=function(o){return arguments.length?i(t=o[0]*he,n=o[1]*he):[t*et,n*et]},r}function WY(e){var t=oe(e);function n(i,r){return[i*t,ie(r)/t]}return n.invert=function(i,r){return[i/t,kn(r*t)]},n}function GY(e,t){var n=ie(e),i=(n+ie(t))/2;if(ye(i)<re)return WY(e);var r=1+n*(2*i-n),o=an(r)/i;function a(s,u){var l=an(r-2*i*ie(u))/i;return[l*ie(s*=i),o-l*oe(s)]}return a.invert=function(s,u){var l=o-u,c=ri(s,ye(l))*Vn(l);return l*i<0&&(c-=ge*Vn(s)*Vn(l)),[c/i,kn((r-(s*s+l*l)*i*i)/(2*i))]},a}function Mg(){return Ow(GY).scale(155.424).center([0,33.6442])}function oj(){return Mg().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function HY(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function YY(){var e,t,n=oj(),i,r=Mg().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o,a=Mg().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s,u,l={point:function(d,h){u=[d,h]}};function c(d){var h=d[0],g=d[1];return u=null,i.point(h,g),u||(o.point(h,g),u)||(s.point(h,g),u)}c.invert=function(d){var h=n.scale(),g=n.translate(),p=(d[0]-g[0])/h,m=(d[1]-g[1])/h;return(m>=.12&&m<.234&&p>=-.425&&p<-.214?r:m>=.166&&m<.234&&p>=-.214&&p<-.115?a:n).invert(d)},c.stream=function(d){return e&&t===d?e:e=HY([n.stream(t=d),r.stream(d),a.stream(d)])},c.precision=function(d){return arguments.length?(n.precision(d),r.precision(d),a.precision(d),f()):n.precision()},c.scale=function(d){return arguments.length?(n.scale(d),r.scale(d*.35),a.scale(d),c.translate(n.translate())):n.scale()},c.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),g=+d[0],p=+d[1];return i=n.translate(d).clipExtent([[g-.455*h,p-.238*h],[g+.455*h,p+.238*h]]).stream(l),o=r.translate([g-.307*h,p+.201*h]).clipExtent([[g-.425*h+re,p+.12*h+re],[g-.214*h-re,p+.234*h-re]]).stream(l),s=a.translate([g-.205*h,p+.212*h]).clipExtent([[g-.214*h+re,p+.166*h+re],[g-.115*h-re,p+.234*h-re]]).stream(l),f()},c.fitExtent=function(d,h){return y0(c,d,h)},c.fitSize=function(d,h){return _w(c,d,h)},c.fitWidth=function(d,h){return Ew(c,d,h)},c.fitHeight=function(d,h){return Sw(c,d,h)};function f(){return e=t=null,c}return c.scale(1070)}function aj(e){return function(t,n){var i=oe(t),r=oe(n),o=e(i*r);return o===1/0?[2,0]:[o*r*ie(t),o*ie(n)]}}function Qf(e){return function(t,n){var i=an(t*t+n*n),r=e(i),o=ie(r),a=oe(r);return[ri(t*o,i*a),kn(i&&n*o/i)]}}var sj=aj(function(e){return an(2/(1+e))});sj.invert=Qf(function(e){return 2*kn(e/2)});function XY(){return Fr(sj).scale(124.75).clipAngle(180-.001)}var uj=aj(function(e){return(e=FN(e))&&e/ie(e)});uj.invert=Qf(function(e){return e});function VY(){return Fr(uj).scale(79.4188).clipAngle(180-.001)}function v0(e,t){return[e,dg(bw((Je+t)/2))]}v0.invert=function(e,t){return[e,2*xl($N(t))-Je]};function KY(){return lj(v0).scale(961/on)}function lj(e){var t=Fr(e),n=t.center,i=t.scale,r=t.translate,o=t.clipExtent,a=null,s,u,l;t.scale=function(f){return arguments.length?(i(f),c()):i()},t.translate=function(f){return arguments.length?(r(f),c()):r()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?a=s=u=l=null:(a=+f[0][0],s=+f[0][1],u=+f[1][0],l=+f[1][1]),c()):a==null?null:[[a,s],[u,l]]};function c(){var f=ge*i(),d=t(pY(t.rotate()).invert([0,0]));return o(a==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:e===v0?[[Math.max(d[0]-f,a),s],[Math.min(d[0]+f,u),l]]:[[a,Math.max(d[1]-f,s)],[u,Math.min(d[1]+f,l)]])}return c()}function jd(e){return bw((Je+e)/2)}function JY(e,t){var n=oe(e),i=e===t?ie(e):dg(n/oe(t))/dg(jd(t)/jd(e)),r=n*Ym(jd(e),i)/i;if(!i)return v0;function o(a,s){r>0?s<-Je+re&&(s=-Je+re):s>Je-re&&(s=Je-re);var u=r/Ym(jd(s),i);return[u*ie(i*a),r-u*oe(i*a)]}return o.invert=function(a,s){var u=r-s,l=Vn(i)*an(a*a+u*u),c=ri(a,ye(u))*Vn(u);return u*i<0&&(c-=ge*Vn(a)*Vn(u)),[c/i,2*xl(Ym(r/l,1/i))-Je]},o}function QY(){return Ow(JY).scale(109.5).parallels([30,30])}function Dg(e,t){return[e,t]}Dg.invert=Dg;function ZY(){return Fr(Dg).scale(152.63)}function eX(e,t){var n=oe(e),i=e===t?ie(e):(n-oe(t))/(t-e),r=n/i+e;if(ye(i)<re)return Dg;function o(a,s){var u=r-s,l=i*a;return[u*ie(l),r-u*oe(l)]}return o.invert=function(a,s){var u=r-s,l=ri(a,ye(u))*Vn(u);return u*i<0&&(l-=ge*Vn(a)*Vn(u)),[l/i,r-Vn(i)*an(a*a+u*u)]},o}function tX(){return Ow(eX).scale(131.154).center([0,13.9389])}var Dc=1.340264,Nc=-.081106,jc=893e-6,Rc=.003796,Ng=an(3)/2,nX=12;function cj(e,t){var n=kn(Ng*ie(t)),i=n*n,r=i*i*i;return[e*oe(n)/(Ng*(Dc+3*Nc*i+r*(7*jc+9*Rc*i))),n*(Dc+Nc*i+r*(jc+Rc*i))]}cj.invert=function(e,t){for(var n=t,i=n*n,r=i*i*i,o=0,a,s,u;o<nX&&(s=n*(Dc+Nc*i+r*(jc+Rc*i))-t,u=Dc+3*Nc*i+r*(7*jc+9*Rc*i),n-=a=s/u,i=n*n,r=i*i*i,!(ye(a)<cg));++o);return[Ng*e*(Dc+3*Nc*i+r*(7*jc+9*Rc*i))/oe(n),kn(ie(n)/Ng)]};function iX(){return Fr(cj).scale(177.158)}function fj(e,t){var n=oe(t),i=oe(e)*n;return[n*ie(e)/i,ie(t)/i]}fj.invert=Qf(xl);function rX(){return Fr(fj).scale(144.049).clipAngle(60)}function oX(){var e=1,t=0,n=0,i=1,r=1,o=0,a,s,u=null,l,c,f,d=1,h=1,g=m0({point:function(x,_){var E=b([x,_]);this.stream.point(E[0],E[1])}}),p=of,m,y;function v(){return d=e*i,h=e*r,m=y=null,b}function b(x){var _=x[0]*d,E=x[1]*h;if(o){var w=E*a-_*s;_=_*a+E*s,E=w}return[_+t,E+n]}return b.invert=function(x){var _=x[0]-t,E=x[1]-n;if(o){var w=E*a+_*s;_=_*a-E*s,E=w}return[_/d,E/h]},b.stream=function(x){return m&&y===x?m:m=g(p(y=x))},b.postclip=function(x){return arguments.length?(p=x,u=l=c=f=null,v()):p},b.clipExtent=function(x){return arguments.length?(p=x==null?(u=l=c=f=null,of):GN(u=+x[0][0],l=+x[0][1],c=+x[1][0],f=+x[1][1]),v()):u==null?null:[[u,l],[c,f]]},b.scale=function(x){return arguments.length?(e=+x,v()):e},b.translate=function(x){return arguments.length?(t=+x[0],n=+x[1],v()):[t,n]},b.angle=function(x){return arguments.length?(o=x%360*he,s=ie(o),a=oe(o),v()):o*et},b.reflectX=function(x){return arguments.length?(i=x?-1:1,v()):i<0},b.reflectY=function(x){return arguments.length?(r=x?-1:1,v()):r<0},b.fitExtent=function(x,_){return y0(b,x,_)},b.fitSize=function(x,_){return _w(b,x,_)},b.fitWidth=function(x,_){return Ew(b,x,_)},b.fitHeight=function(x,_){return Sw(b,x,_)},b}function dj(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),t*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}dj.invert=function(e,t){var n=t,i=25,r;do{var o=n*n,a=o*o;n-=r=(n*(1.007226+o*(.015085+a*(-.044475+.028874*o-.005916*a)))-t)/(1.007226+o*(.015085*3+a*(-.044475*7+.028874*9*o-.005916*11*a)))}while(ye(r)>re&&--i>0);return[e/(.8707+(o=n*n)*(-.131979+o*(-.013791+o*o*o*(.003971-.001529*o)))),n]};function aX(){return Fr(dj).scale(175.295)}function hj(e,t){return[oe(t)*ie(e),ie(t)]}hj.invert=Qf(kn);function sX(){return Fr(hj).scale(249.5).clipAngle(90+re)}function gj(e,t){var n=oe(t),i=1+oe(e)*n;return[n*ie(e)/i,ie(t)/i]}gj.invert=Qf(function(e){return 2*xl(e)});function uX(){return Fr(gj).scale(250).clipAngle(142)}function pj(e,t){return[dg(bw((Je+t)/2)),-e]}pj.invert=function(e,t){return[-t,2*xl($N(e))-Je]};function lX(){var e=lj(pj),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}var cX=Math.abs,nv=Math.cos,jg=Math.sin,fX=1e-6,mj=Math.PI,iv=mj/2,_A=dX(2);function EA(e){return e>1?iv:e<-1?-iv:Math.asin(e)}function dX(e){return e>0?Math.sqrt(e):0}function hX(e,t){var n=e*jg(t),i=30,r;do t-=r=(t+jg(t)-n)/(1+nv(t));while(cX(r)>fX&&--i>0);return t/2}function gX(e,t,n){function i(r,o){return[e*r*nv(o=hX(n,o)),t*jg(o)]}return i.invert=function(r,o){return o=EA(o/t),[r/(e*nv(o)),EA((2*o+jg(2*o))/n)]},i}var pX=gX(_A/iv,_A,mj);function mX(){return Fr(pX).scale(169.529)}const yX=ij(),rv=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function vX(e,t){return function n(){const i=t();return i.type=e,i.path=ij().projection(i),i.copy=i.copy||function(){const r=n();return rv.forEach(o=>{i[o]&&r[o](i[o]())}),r.path.pointRadius(i.path.pointRadius()),r},i}}function Aw(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(Rg[e]=vX(e,t),this):Rg[e]||null}function yj(e){return e&&e.path||yX}const Rg={albers:oj,albersusa:YY,azimuthalequalarea:XY,azimuthalequidistant:VY,conicconformal:QY,conicequalarea:Mg,conicequidistant:tX,equalEarth:iX,equirectangular:ZY,gnomonic:rX,identity:oX,mercator:KY,mollweide:mX,naturalEarth1:aX,orthographic:sX,stereographic:uX,transversemercator:lX};for(const e in Rg)Aw(e,Rg[e]);function bX(){}const Nr=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function vj(){var e=1,t=1,n=s;function i(u,l){return l.map(c=>r(u,c))}function r(u,l){var c=[],f=[];return o(u,l,d=>{n(d,u,l),xX(d)>0?c.push([d]):f.push(d)}),f.forEach(d=>{for(var h=0,g=c.length,p;h<g;++h)if(wX((p=c[h])[0],d)!==-1){p.push(d);return}}),{type:"MultiPolygon",value:l,coordinates:c}}function o(u,l,c){var f=new Array,d=new Array,h,g,p,m,y,v;for(h=g=-1,m=u[0]>=l,Nr[m<<1].forEach(b);++h<e-1;)p=m,m=u[h+1]>=l,Nr[p|m<<1].forEach(b);for(Nr[m<<0].forEach(b);++g<t-1;){for(h=-1,m=u[g*e+e]>=l,y=u[g*e]>=l,Nr[m<<1|y<<2].forEach(b);++h<e-1;)p=m,m=u[g*e+e+h+1]>=l,v=y,y=u[g*e+h+1]>=l,Nr[p|m<<1|y<<2|v<<3].forEach(b);Nr[m|y<<3].forEach(b)}for(h=-1,y=u[g*e]>=l,Nr[y<<2].forEach(b);++h<e-1;)v=y,y=u[g*e+h+1]>=l,Nr[y<<2|v<<3].forEach(b);Nr[y<<3].forEach(b);function b(x){var _=[x[0][0]+h,x[0][1]+g],E=[x[1][0]+h,x[1][1]+g],w=a(_),S=a(E),C,A;(C=d[w])?(A=f[S])?(delete d[C.end],delete f[A.start],C===A?(C.ring.push(E),c(C.ring)):f[C.start]=d[A.end]={start:C.start,end:A.end,ring:C.ring.concat(A.ring)}):(delete d[C.end],C.ring.push(E),d[C.end=S]=C):(C=f[S])?(A=d[w])?(delete f[C.start],delete d[A.end],C===A?(C.ring.push(E),c(C.ring)):f[A.start]=d[C.end]={start:A.start,end:C.end,ring:A.ring.concat(C.ring)}):(delete f[C.start],C.ring.unshift(_),f[C.start=w]=C):f[w]=d[S]={start:w,end:S,ring:[_,E]}}}function a(u){return u[0]*2+u[1]*(e+1)*4}function s(u,l,c){u.forEach(f=>{var d=f[0],h=f[1],g=d|0,p=h|0,m,y=l[p*e+g];d>0&&d<e&&g===d&&(m=l[p*e+g-1],f[0]=d+(c-m)/(y-m)-.5),h>0&&h<t&&p===h&&(m=l[(p-1)*e+g],f[1]=h+(c-m)/(y-m)-.5)})}return i.contour=r,i.size=function(u){if(!arguments.length)return[e,t];var l=Math.floor(u[0]),c=Math.floor(u[1]);return l>=0&&c>=0||P("invalid size"),e=l,t=c,i},i.smooth=function(u){return arguments.length?(n=u?s:bX,i):n===s},i}function xX(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}function wX(e,t){for(var n=-1,i=t.length,r;++n<i;)if(r=_X(e,t[n]))return r;return 0}function _X(e,t){for(var n=t[0],i=t[1],r=-1,o=0,a=e.length,s=a-1;o<a;s=o++){var u=e[o],l=u[0],c=u[1],f=e[s],d=f[0],h=f[1];if(EX(u,f,t))return 0;c>i!=h>i&&n<(d-l)*(i-c)/(h-c)+l&&(r=-r)}return r}function EX(e,t,n){var i;return SX(e,t,n)&&OX(e[i=+(e[0]===t[0])],n[i],t[i])}function SX(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function OX(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function bj(e,t,n){return function(i){var r=lr(i),o=n?Math.min(r[0],0):r[0],a=r[1],s=a-o,u=t?Yo(o,a,e):s/(e+1);return jn(o+u,a,u)}}function kw(e){N.call(this,null,e)}kw.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};W(kw,N,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||Wt,o=vj().smooth(e.smooth!==!1),a=e.thresholds||AX(i,r,e),s=e.as===null?null:e.as||"contour",u=[];return i.forEach(l=>{const c=r(l),f=o.size([c.width,c.height])(c.values,I(a)?a:a(c.values));kX(f,c,l,e),f.forEach(d=>{u.push(jp(l,Ce(s!=null?{[s]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function AX(e,t,n){const i=bj(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?i:i(e.map(r=>Ka(t(r).values)))}function kX(e,t,n,i){let r=i.scale||t.scale,o=i.translate||t.translate;if(fe(r)&&(r=r(n,i)),fe(o)&&(o=o(n,i)),(r===1||r==null)&&!o)return;const a=(De(r)?r:r[0])||1,s=(De(r)?r:r[1])||1,u=o&&o[0]||0,l=o&&o[1]||0;e.forEach(xj(t,a,s,u,l))}function xj(e,t,n,i,r){const o=e.x1||0,a=e.y1||0,s=t*n<0;function u(f){f.forEach(l)}function l(f){s&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-o)*t+i,f[1]=(f[1]-a)*n+r}return function(f){return f.coordinates.forEach(u),f}}function SA(e,t,n){const i=e>=0?e:yx(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function Qm(e){return fe(e)?e:Gt(+e)}function wj(){var e=u=>u[0],t=u=>u[1],n=al,i=[-1,-1],r=960,o=500,a=2;function s(u,l){const c=SA(i[0],u,e)>>a,f=SA(i[1],u,t)>>a,d=c?c+2:0,h=f?f+2:0,g=2*d+(r>>a),p=2*h+(o>>a),m=new Float32Array(g*p),y=new Float32Array(g*p);let v=m;u.forEach(x=>{const _=d+(+e(x)>>a),E=h+(+t(x)>>a);_>=0&&_<g&&E>=0&&E<p&&(m[_+E*g]+=+n(x))}),c>0&&f>0?(Vs(g,p,m,y,c),Ks(g,p,y,m,f),Vs(g,p,m,y,c),Ks(g,p,y,m,f),Vs(g,p,m,y,c),Ks(g,p,y,m,f)):c>0?(Vs(g,p,m,y,c),Vs(g,p,y,m,c),Vs(g,p,m,y,c),v=y):f>0&&(Ks(g,p,m,y,f),Ks(g,p,y,m,f),Ks(g,p,m,y,f),v=y);const b=l?Math.pow(2,-2*a):1/HF(v);for(let x=0,_=g*p;x<_;++x)v[x]*=b;return{values:v,scale:1<<a,width:g,height:p,x1:d,y1:h,x2:d+(r>>a),y2:h+(o>>a)}}return s.x=function(u){return arguments.length?(e=Qm(u),s):e},s.y=function(u){return arguments.length?(t=Qm(u),s):t},s.weight=function(u){return arguments.length?(n=Qm(u),s):n},s.size=function(u){if(!arguments.length)return[r,o];var l=+u[0],c=+u[1];return l>=0&&c>=0||P("invalid size"),r=l,o=c,s},s.cellSize=function(u){return arguments.length?((u=+u)>=1||P("invalid cell size"),a=Math.floor(Math.log(u)/Math.LN2),s):1<<a},s.bandwidth=function(u){return arguments.length?(u=V(u),u.length===1&&(u=[+u[0],+u[0]]),u.length!==2&&P("invalid bandwidth"),i=u,s):i},s}function Vs(e,t,n,i,r){const o=(r<<1)+1;for(let a=0;a<t;++a)for(let s=0,u=0;s<e+r;++s)s<e&&(u+=n[s+a*e]),s>=r&&(s>=o&&(u-=n[s-o+a*e]),i[s-r+a*e]=u/Math.min(s+1,e-1+o-s,o))}function Ks(e,t,n,i,r){const o=(r<<1)+1;for(let a=0;a<e;++a)for(let s=0,u=0;s<t+r;++s)s<t&&(u+=n[a+s*e]),s>=r&&(s>=o&&(u-=n[a+(s-o)*e]),i[a+(s-r)*e]=u/Math.min(s+1,t-1+o-s,o))}function Cw(e){N.call(this,null,e)}Cw.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const CX=["x","y","weight","size","cellSize","bandwidth"];function _j(e,t){return CX.forEach(n=>t[n]!=null?e[n](t[n]):0),e}W(Cw,N,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=$X(i,e.groupby),o=(e.groupby||[]).map(Qe),a=_j(wj(),e),s=e.as||"grid",u=[];function l(c,f){for(let d=0;d<o.length;++d)c[o[d]]=f[d];return c}return u=r.map(c=>Ce(l({[s]:a(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function $X(e,t){var n=[],i=c=>c(s),r,o,a,s,u,l;if(t==null)n.push(e);else for(r={},o=0,a=e.length;o<a;++o)s=e[o],u=t.map(i),l=r[u],l||(r[u]=l=[],l.dims=u,n.push(l)),l.push(s);return n}function $w(e){N.call(this,null,e)}$w.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};W($w,N,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=vj().smooth(e.smooth!==!1),r=e.values,o=e.thresholds||bj(e.count||10,e.nice,!!r),a=e.size,s,u;return r||(r=t.materialize(t.SOURCE).source,s=_j(wj(),e)(r,!0),u=xj(s,s.scale||1,s.scale||1,0,0),a=[s.width,s.height],r=s.values),o=I(o)?o:o(r),r=i.size(a)(r,o),u&&r.forEach(u),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(Ce),n}});const ov="Feature",Fw="FeatureCollection",FX="MultiPoint";function Tw(e){N.call(this,null,e)}Tw.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};W(Tw,N,{transform(e,t){var n=this._features,i=this._points,r=e.fields,o=r&&r[0],a=r&&r[1],s=e.geojson||!r&&Wt,u=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(Lt(s))||o&&t.modified(Lt(o))||a&&t.modified(Lt(a)),(!this.value||l)&&(u=t.SOURCE,this._features=n=[],this._points=i=[]),s&&t.visit(u,c=>n.push(s(c))),o&&a&&(t.visit(u,c=>{var f=o(c),d=a(c);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&i.push([f,d])}),n=n.concat({type:ov,geometry:{type:FX,coordinates:i}})),this.value={type:Fw,features:n}}});function Mw(e){N.call(this,null,e)}Mw.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};W(Mw,N,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||Wt,o=e.as||"path",a=n.SOURCE;!i||e.modified()?(this.value=i=yj(e.projection),n.materialize().reflow()):a=r===Wt||t.modified(r.fields)?n.ADD_MOD:n.ADD;const s=TX(i,e.pointRadius);return n.visit(a,u=>u[o]=i(r(u))),i.pointRadius(s),n.modifies(o)}});function TX(e,t){const n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function Dw(e){N.call(this,null,e)}Dw.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};W(Dw,N,{transform(e,t){var n=e.projection,i=e.fields[0],r=e.fields[1],o=e.as||["x","y"],a=o[0],s=o[1],u;function l(c){const f=n([i(c),r(c)]);f?(c[a]=f[0],c[s]=f[1]):(c[a]=void 0,c[s]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(u=t.modified(i.fields)||t.modified(r.fields),t.visit(u?t.ADD_MOD:t.ADD,l)),t.modifies(o)}});function Nw(e){N.call(this,null,e)}Nw.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};W(Nw,N,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",o=n.ADD;return(!i||e.modified())&&(this.value=i=MX(yj(e.projection),e.field||wn("datum"),e.pointRadius),n.materialize().reflow(),o=n.SOURCE),n.visit(o,a=>a[r]=i),n.modifies(r)}});function MX(e,t,n){const i=n==null?r=>e(t(r)):r=>{var o=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(o),a};return i.context=r=>(e.context(r),i),i}function jw(e){N.call(this,[],e),this.generator=OY()}jw.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};W(jw,N,{transform(e,t){var n=this.value,i=this.generator,r;if(!n.length||e.modified())for(const o in e)fe(i[o])&&i[o](e[o]);return r=i(),n.length?t.mod.push(BT(n[0],r)):t.add.push(Ce(r)),n[0]=r,t}});function Rw(e){N.call(this,null,e)}Rw.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};W(Rw,N,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i=e.resolve==="shared",r=e.field||Wt,o=NX(e.opacity,e),a=DX(e.color,e),s=e.as||"image",u={$x:0,$y:0,$value:0,$max:i?Ka(n.map(l=>Ka(r(l).values))):0};return n.forEach(l=>{const c=r(l),f=ce({},l,u);i||(f.$max=Ka(c.values||[])),l[s]=jX(c,f,a.dep?a:Gt(a(f)),o.dep?o:Gt(o(f)))}),t.reflow(!0).modifies(s)}});function DX(e,t){let n;return fe(e)?(n=i=>Ko(e(i,t)),n.dep=Ej(e)):n=Gt(Ko(e||"#888")),n}function NX(e,t){let n;return fe(e)?(n=i=>e(i,t),n.dep=Ej(e)):e?n=Gt(e):(n=i=>i.$value/i.$max||0,n.dep=!0),n}function Ej(e){if(!fe(e))return!1;const t=Mi(Lt(e));return t.$x||t.$y||t.$value||t.$max}function jX(e,t,n,i){const r=e.width,o=e.height,a=e.x1||0,s=e.y1||0,u=e.x2||r,l=e.y2||o,c=e.values,f=c?m=>c[m]:ko,d=zo(u-a,l-s),h=d.getContext("2d"),g=h.getImageData(0,0,u-a,l-s),p=g.data;for(let m=s,y=0;m<l;++m){t.$y=m-s;for(let v=a,b=m*r;v<u;++v,y+=4){t.$x=v-a,t.$value=f(v+b);const x=n(t);p[y+0]=x.r,p[y+1]=x.g,p[y+2]=x.b,p[y+3]=~~(255*i(t))}}return h.putImageData(g,0,0),d}function Sj(e){N.call(this,null,e),this.modified(!0)}W(Sj,N,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=PX(e.type),rv.forEach(i=>{e[i]!=null&&OA(n,i,e[i])})):rv.forEach(i=>{e.modified(i)&&OA(n,i,e[i])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&RX(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function RX(e,t){const n=IX(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function PX(e){const t=Aw((e||"mercator").toLowerCase());return t||P("Unrecognized projection type: "+e),t()}function OA(e,t,n){fe(e[t])&&e[t](n)}function IX(e){return e=V(e),e.length===1?e[0]:{type:Fw,features:e.reduce((t,n)=>t.concat(LX(n)),[])}}function LX(e){return e.type===Fw?e.features:V(e).filter(t=>t!=null).map(t=>t.type===ov?t:{type:ov,geometry:t})}var zX=Object.freeze(Object.defineProperty({__proto__:null,contour:$w,geojson:Tw,geopath:Mw,geopoint:Dw,geoshape:Nw,graticule:jw,heatmap:Rw,isocontour:kw,kde2d:Cw,projection:Sj},Symbol.toStringTag,{value:"Module"}));function BX(e,t){var n,i=1;e==null&&(e=0),t==null&&(t=0);function r(){var o,a=n.length,s,u=0,l=0;for(o=0;o<a;++o)s=n[o],u+=s.x,l+=s.y;for(u=(u/a-e)*i,l=(l/a-t)*i,o=0;o<a;++o)s=n[o],s.x-=u,s.y-=l}return r.initialize=function(o){n=o},r.x=function(o){return arguments.length?(e=+o,r):e},r.y=function(o){return arguments.length?(t=+o,r):t},r.strength=function(o){return arguments.length?(i=+o,r):i},r}function UX(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return Oj(this.cover(t,n),t,n,e)}function Oj(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,o=e._root,a={data:i},s=e._x0,u=e._y0,l=e._x1,c=e._y1,f,d,h,g,p,m,y,v;if(!o)return e._root=a,e;for(;o.length;)if((p=t>=(f=(s+l)/2))?s=f:l=f,(m=n>=(d=(u+c)/2))?u=d:c=d,r=o,!(o=o[y=m<<1|p]))return r[y]=a,e;if(h=+e._x.call(null,o.data),g=+e._y.call(null,o.data),t===h&&n===g)return a.next=o,r?r[y]=a:e._root=a,e;do r=r?r[y]=new Array(4):e._root=new Array(4),(p=t>=(f=(s+l)/2))?s=f:l=f,(m=n>=(d=(u+c)/2))?u=d:c=d;while((y=m<<1|p)===(v=(g>=d)<<1|h>=f));return r[v]=o,r[y]=a,e}function qX(e){var t,n,i=e.length,r,o,a=new Array(i),s=new Array(i),u=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(o=+this._y.call(null,t))||(a[n]=r,s[n]=o,r<u&&(u=r),r>c&&(c=r),o<l&&(l=o),o>f&&(f=o));if(u>c||l>f)return this;for(this.cover(u,l).cover(c,f),n=0;n<i;++n)Oj(this,a[n],s[n],e[n]);return this}function WX(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,o=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,o=(i=Math.floor(t))+1;else{for(var a=r-n||1,s=this._root,u,l;n>e||e>=r||i>t||t>=o;)switch(l=(t<i)<<1|e<n,u=new Array(4),u[l]=s,s=u,a*=2,l){case 0:r=n+a,o=i+a;break;case 1:n=r-a,o=i+a;break;case 2:r=n+a,i=o-a;break;case 3:n=r-a,i=o-a;break}this._root&&this._root.length&&(this._root=s)}return this._x0=n,this._y0=i,this._x1=r,this._y1=o,this}function GX(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function HX(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function en(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function YX(e,t,n){var i,r=this._x0,o=this._y0,a,s,u,l,c=this._x1,f=this._y1,d=[],h=this._root,g,p;for(h&&d.push(new en(h,r,o,c,f)),n==null?n=1/0:(r=e-n,o=t-n,c=e+n,f=t+n,n*=n);g=d.pop();)if(!(!(h=g.node)||(a=g.x0)>c||(s=g.y0)>f||(u=g.x1)<r||(l=g.y1)<o))if(h.length){var m=(a+u)/2,y=(s+l)/2;d.push(new en(h[3],m,y,u,l),new en(h[2],a,y,m,l),new en(h[1],m,s,u,y),new en(h[0],a,s,m,y)),(p=(t>=y)<<1|e>=m)&&(g=d[d.length-1],d[d.length-1]=d[d.length-1-p],d[d.length-1-p]=g)}else{var v=e-+this._x.call(null,h.data),b=t-+this._y.call(null,h.data),x=v*v+b*b;if(x<n){var _=Math.sqrt(n=x);r=e-_,o=t-_,c=e+_,f=t+_,i=h.data}}return i}function XX(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,i,r,o,a=this._x0,s=this._y0,u=this._x1,l=this._y1,c,f,d,h,g,p,m,y;if(!n)return this;if(n.length)for(;;){if((g=c>=(d=(a+u)/2))?a=d:u=d,(p=f>=(h=(s+l)/2))?s=h:l=h,t=n,!(n=n[m=p<<1|g]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,y=m)}for(;n.data!==e;)if(r=n,!(n=n.next))return this;return(o=n.next)&&delete n.next,r?(o?r.next=o:delete r.next,this):t?(o?t[m]=o:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[y]=n:this._root=n),this):(this._root=o,this)}function VX(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function KX(){return this._root}function JX(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function QX(e){var t=[],n,i=this._root,r,o,a,s,u;for(i&&t.push(new en(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,o=n.x0,a=n.y0,s=n.x1,u=n.y1)&&i.length){var l=(o+s)/2,c=(a+u)/2;(r=i[3])&&t.push(new en(r,l,c,s,u)),(r=i[2])&&t.push(new en(r,o,c,l,u)),(r=i[1])&&t.push(new en(r,l,a,s,c)),(r=i[0])&&t.push(new en(r,o,a,l,c))}return this}function ZX(e){var t=[],n=[],i;for(this._root&&t.push(new en(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var o,a=i.x0,s=i.y0,u=i.x1,l=i.y1,c=(a+u)/2,f=(s+l)/2;(o=r[0])&&t.push(new en(o,a,s,c,f)),(o=r[1])&&t.push(new en(o,c,s,u,f)),(o=r[2])&&t.push(new en(o,a,f,c,l)),(o=r[3])&&t.push(new en(o,c,f,u,l))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function eV(e){return e[0]}function tV(e){return arguments.length?(this._x=e,this):this._x}function nV(e){return e[1]}function iV(e){return arguments.length?(this._y=e,this):this._y}function Pw(e,t,n){var i=new Iw(t==null?eV:t,n==null?nV:n,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function Iw(e,t,n,i,r,o){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=o,this._root=void 0}function AA(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var sn=Pw.prototype=Iw.prototype;sn.copy=function(){var e=new Iw(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,i;if(!t)return e;if(!t.length)return e._root=AA(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=AA(i));return e};sn.add=UX;sn.addAll=qX;sn.cover=WX;sn.data=GX;sn.extent=HX;sn.find=YX;sn.remove=XX;sn.removeAll=VX;sn.root=KX;sn.size=JX;sn.visit=QX;sn.visitAfter=ZX;sn.x=tV;sn.y=iV;function tn(e){return function(){return e}}function jo(e){return(e()-.5)*1e-6}function rV(e){return e.x+e.vx}function oV(e){return e.y+e.vy}function aV(e){var t,n,i,r=1,o=1;typeof e!="function"&&(e=tn(e==null?1:+e));function a(){for(var l,c=t.length,f,d,h,g,p,m,y=0;y<o;++y)for(f=Pw(t,rV,oV).visitAfter(s),l=0;l<c;++l)d=t[l],p=n[d.index],m=p*p,h=d.x+d.vx,g=d.y+d.vy,f.visit(v);function v(b,x,_,E,w){var S=b.data,C=b.r,A=p+C;if(S){if(S.index>d.index){var O=h-S.x-S.vx,F=g-S.y-S.vy,k=O*O+F*F;k<A*A&&(O===0&&(O=jo(i),k+=O*O),F===0&&(F=jo(i),k+=F*F),k=(A-(k=Math.sqrt(k)))/k*r,d.vx+=(O*=k)*(A=(C*=C)/(m+C)),d.vy+=(F*=k)*A,S.vx-=O*(A=1-A),S.vy-=F*A)}return}return x>h+A||E<h-A||_>g+A||w<g-A}}function s(l){if(l.data)return l.r=n[l.data.index];for(var c=l.r=0;c<4;++c)l[c]&&l[c].r>l.r&&(l.r=l[c].r)}function u(){if(!!t){var l,c=t.length,f;for(n=new Array(c),l=0;l<c;++l)f=t[l],n[f.index]=+e(f,l,t)}}return a.initialize=function(l,c){t=l,i=c,u()},a.iterations=function(l){return arguments.length?(o=+l,a):o},a.strength=function(l){return arguments.length?(r=+l,a):r},a.radius=function(l){return arguments.length?(e=typeof l=="function"?l:tn(+l),u(),a):e},a}function sV(e){return e.index}function kA(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function uV(e){var t=sV,n=f,i,r=tn(30),o,a,s,u,l,c=1;e==null&&(e=[]);function f(m){return 1/Math.min(s[m.source.index],s[m.target.index])}function d(m){for(var y=0,v=e.length;y<c;++y)for(var b=0,x,_,E,w,S,C,A;b<v;++b)x=e[b],_=x.source,E=x.target,w=E.x+E.vx-_.x-_.vx||jo(l),S=E.y+E.vy-_.y-_.vy||jo(l),C=Math.sqrt(w*w+S*S),C=(C-o[b])/C*m*i[b],w*=C,S*=C,E.vx-=w*(A=u[b]),E.vy-=S*A,_.vx+=w*(A=1-A),_.vy+=S*A}function h(){if(!!a){var m,y=a.length,v=e.length,b=new Map(a.map((_,E)=>[t(_,E,a),_])),x;for(m=0,s=new Array(y);m<v;++m)x=e[m],x.index=m,typeof x.source!="object"&&(x.source=kA(b,x.source)),typeof x.target!="object"&&(x.target=kA(b,x.target)),s[x.source.index]=(s[x.source.index]||0)+1,s[x.target.index]=(s[x.target.index]||0)+1;for(m=0,u=new Array(v);m<v;++m)x=e[m],u[m]=s[x.source.index]/(s[x.source.index]+s[x.target.index]);i=new Array(v),g(),o=new Array(v),p()}}function g(){if(!!a)for(var m=0,y=e.length;m<y;++m)i[m]=+n(e[m],m,e)}function p(){if(!!a)for(var m=0,y=e.length;m<y;++m)o[m]=+r(e[m],m,e)}return d.initialize=function(m,y){a=m,l=y,h()},d.links=function(m){return arguments.length?(e=m,h(),d):e},d.id=function(m){return arguments.length?(t=m,d):t},d.iterations=function(m){return arguments.length?(c=+m,d):c},d.strength=function(m){return arguments.length?(n=typeof m=="function"?m:tn(+m),g(),d):n},d.distance=function(m){return arguments.length?(r=typeof m=="function"?m:tn(+m),p(),d):r},d}var lV={value:()=>{}};function Aj(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new vh(n)}function vh(e){this._=e}function cV(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}vh.prototype=Aj.prototype={constructor:vh,on:function(e,t){var n=this._,i=cV(e+"",n),r,o=-1,a=i.length;if(arguments.length<2){for(;++o<a;)if((r=(e=i[o]).type)&&(r=fV(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<a;)if(r=(e=i[o]).type)n[r]=CA(n[r],e.name,t);else if(t==null)for(r in n)n[r]=CA(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new vh(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,o;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],i=0,r=o.length;i<r;++i)o[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};function fV(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function CA(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=lV,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var Hu=0,bc=0,Gl=0,kj=1e3,Pg,xc,Ig=0,ps=0,b0=0,sf=typeof performance=="object"&&performance.now?performance:Date,Cj=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Lw(){return ps||(Cj(dV),ps=sf.now()+b0)}function dV(){ps=0}function Lg(){this._call=this._time=this._next=null}Lg.prototype=$j.prototype={constructor:Lg,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Lw():+n)+(t==null?0:+t),!this._next&&xc!==this&&(xc?xc._next=this:Pg=this,xc=this),this._call=e,this._time=n,av()},stop:function(){this._call&&(this._call=null,this._time=1/0,av())}};function $j(e,t,n){var i=new Lg;return i.restart(e,t,n),i}function hV(){Lw(),++Hu;for(var e=Pg,t;e;)(t=ps-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Hu}function $A(){ps=(Ig=sf.now())+b0,Hu=bc=0;try{hV()}finally{Hu=0,pV(),ps=0}}function gV(){var e=sf.now(),t=e-Ig;t>kj&&(b0-=t,Ig=e)}function pV(){for(var e,t=Pg,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Pg=n);xc=e,av(i)}function av(e){if(!Hu){bc&&(bc=clearTimeout(bc));var t=e-ps;t>24?(e<1/0&&(bc=setTimeout($A,e-sf.now()-b0)),Gl&&(Gl=clearInterval(Gl))):(Gl||(Ig=sf.now(),Gl=setInterval(gV,kj)),Hu=1,Cj($A))}}function mV(e,t,n){var i=new Lg,r=t;return t==null?(i.restart(e,t,n),i):(i._restart=i.restart,i.restart=function(o,a,s){a=+a,s=s==null?Lw():+s,i._restart(function u(l){l+=r,i._restart(u,r+=a,s),o(l)},a,s)},i.restart(e,t,n),i)}const yV=1664525,vV=1013904223,FA=4294967296;function bV(){let e=1;return()=>(e=(yV*e+vV)%FA)/FA}function xV(e){return e.x}function wV(e){return e.y}var _V=10,EV=Math.PI*(3-Math.sqrt(5));function SV(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),o=0,a=.6,s=new Map,u=$j(f),l=Aj("tick","end"),c=bV();e==null&&(e=[]);function f(){d(),l.call("tick",t),n<i&&(u.stop(),l.call("end",t))}function d(p){var m,y=e.length,v;p===void 0&&(p=1);for(var b=0;b<p;++b)for(n+=(o-n)*r,s.forEach(function(x){x(n)}),m=0;m<y;++m)v=e[m],v.fx==null?v.x+=v.vx*=a:(v.x=v.fx,v.vx=0),v.fy==null?v.y+=v.vy*=a:(v.y=v.fy,v.vy=0);return t}function h(){for(var p=0,m=e.length,y;p<m;++p){if(y=e[p],y.index=p,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var v=_V*Math.sqrt(.5+p),b=p*EV;y.x=v*Math.cos(b),y.y=v*Math.sin(b)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function g(p){return p.initialize&&p.initialize(e,c),p}return h(),t={tick:d,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(p){return arguments.length?(e=p,h(),s.forEach(g),t):e},alpha:function(p){return arguments.length?(n=+p,t):n},alphaMin:function(p){return arguments.length?(i=+p,t):i},alphaDecay:function(p){return arguments.length?(r=+p,t):+r},alphaTarget:function(p){return arguments.length?(o=+p,t):o},velocityDecay:function(p){return arguments.length?(a=1-p,t):1-a},randomSource:function(p){return arguments.length?(c=p,s.forEach(g),t):c},force:function(p,m){return arguments.length>1?(m==null?s.delete(p):s.set(p,g(m)),t):s.get(p)},find:function(p,m,y){var v=0,b=e.length,x,_,E,w,S;for(y==null?y=1/0:y*=y,v=0;v<b;++v)w=e[v],x=p-w.x,_=m-w.y,E=x*x+_*_,E<y&&(S=w,y=E);return S},on:function(p,m){return arguments.length>1?(l.on(p,m),t):l.on(p)}}}function OV(){var e,t,n,i,r=tn(-30),o,a=1,s=1/0,u=.81;function l(h){var g,p=e.length,m=Pw(e,xV,wV).visitAfter(f);for(i=h,g=0;g<p;++g)t=e[g],m.visit(d)}function c(){if(!!e){var h,g=e.length,p;for(o=new Array(g),h=0;h<g;++h)p=e[h],o[p.index]=+r(p,h,e)}}function f(h){var g=0,p,m,y=0,v,b,x;if(h.length){for(v=b=x=0;x<4;++x)(p=h[x])&&(m=Math.abs(p.value))&&(g+=p.value,y+=m,v+=m*p.x,b+=m*p.y);h.x=v/y,h.y=b/y}else{p=h,p.x=p.data.x,p.y=p.data.y;do g+=o[p.data.index];while(p=p.next)}h.value=g}function d(h,g,p,m){if(!h.value)return!0;var y=h.x-t.x,v=h.y-t.y,b=m-g,x=y*y+v*v;if(b*b/u<x)return x<s&&(y===0&&(y=jo(n),x+=y*y),v===0&&(v=jo(n),x+=v*v),x<a&&(x=Math.sqrt(a*x)),t.vx+=y*h.value*i/x,t.vy+=v*h.value*i/x),!0;if(h.length||x>=s)return;(h.data!==t||h.next)&&(y===0&&(y=jo(n),x+=y*y),v===0&&(v=jo(n),x+=v*v),x<a&&(x=Math.sqrt(a*x)));do h.data!==t&&(b=o[h.data.index]*i/x,t.vx+=y*b,t.vy+=v*b);while(h=h.next)}return l.initialize=function(h,g){e=h,n=g,c()},l.strength=function(h){return arguments.length?(r=typeof h=="function"?h:tn(+h),c(),l):r},l.distanceMin=function(h){return arguments.length?(a=h*h,l):Math.sqrt(a)},l.distanceMax=function(h){return arguments.length?(s=h*h,l):Math.sqrt(s)},l.theta=function(h){return arguments.length?(u=h*h,l):Math.sqrt(u)},l}function AV(e){var t=tn(.1),n,i,r;typeof e!="function"&&(e=tn(e==null?0:+e));function o(s){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vx+=(r[u]-c.x)*i[u]*s}function a(){if(!!n){var s,u=n.length;for(i=new Array(u),r=new Array(u),s=0;s<u;++s)i[s]=isNaN(r[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}}return o.initialize=function(s){n=s,a()},o.strength=function(s){return arguments.length?(t=typeof s=="function"?s:tn(+s),a(),o):t},o.x=function(s){return arguments.length?(e=typeof s=="function"?s:tn(+s),a(),o):e},o}function kV(e){var t=tn(.1),n,i,r;typeof e!="function"&&(e=tn(e==null?0:+e));function o(s){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vy+=(r[u]-c.y)*i[u]*s}function a(){if(!!n){var s,u=n.length;for(i=new Array(u),r=new Array(u),s=0;s<u;++s)i[s]=isNaN(r[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}}return o.initialize=function(s){n=s,a()},o.strength=function(s){return arguments.length?(t=typeof s=="function"?s:tn(+s),a(),o):t},o.y=function(s){return arguments.length?(e=typeof s=="function"?s:tn(+s),a(),o):e},o}const TA={center:BX,collide:aV,nbody:OV,link:uV,x:AV,y:kV},wc="forces",sv=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],CV=["static","iterations"],Fj=["x","y","vx","vy"];function zw(e){N.call(this,null,e)}zw.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:Fj}]};W(zw,N,{transform(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(sv),o=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&Tj(n,e,0,t)):(this.value=n=FV(t.source,e),n.on("tick",$V(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified(CV)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/o)),e.static)for(n.stop();--o>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let s=this._argops,u=0,l=s.length,c;u<l;++u)if(c=s[u],!(c.name!==wc||c.op._argval.force!=="link")){for(var i=c.op._argops,r=0,o=i.length,a;r<o;++r)if(i[r].name==="links"&&(a=i[r].op.source)){n.pulse(a,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(Fj)}});function $V(e,t){return()=>e.touch(t).run()}function FV(e,t){const n=SV(e),i=n.stop,r=n.restart;let o=!1;return n.stopped=()=>o,n.restart=()=>(o=!1,r()),n.stop=()=>(o=!0,i()),Tj(n,t,!0).on("end",()=>o=!0)}function Tj(e,t,n,i){var r=V(t.forces),o,a,s,u;for(o=0,a=sv.length;o<a;++o)s=sv[o],s!==wc&&t.modified(s)&&e[s](t[s]);for(o=0,a=r.length;o<a;++o)u=wc+o,s=n||t.modified(wc,o)?MV(r[o]):i&&TV(r[o],i)?e.force(u):null,s&&e.force(u,s);for(a=e.numForces||0;o<a;++o)e.force(wc+o,null);return e.numForces=r.length,e}function TV(e,t){var n,i;for(n in e)if(fe(i=e[n])&&t.modified(Lt(i)))return 1;return 0}function MV(e){var t,n;ee(TA,e.force)||P("Unrecognized force: "+e.force),t=TA[e.force]();for(n in e)fe(t[n])&&DV(t[n],e[n],e);return t}function DV(e,t,n){e(fe(t)?i=>t(i,n):t)}var NV=Object.freeze(Object.defineProperty({__proto__:null,force:zw},Symbol.toStringTag,{value:"Module"}));function jV(e,t){return e.parent===t.parent?1:2}function RV(e){return e.reduce(PV,0)/e.length}function PV(e,t){return e+t.x}function IV(e){return 1+e.reduce(LV,0)}function LV(e,t){return Math.max(e,t.y)}function zV(e){for(var t;t=e.children;)e=t[0];return e}function BV(e){for(var t;t=e.children;)e=t[t.length-1];return e}function UV(){var e=jV,t=1,n=1,i=!1;function r(o){var a,s=0;o.eachAfter(function(d){var h=d.children;h?(d.x=RV(h),d.y=IV(h)):(d.x=a?s+=e(d,a):0,d.y=0,a=d)});var u=zV(o),l=BV(o),c=u.x-e(u,l)/2,f=l.x+e(l,u)/2;return o.eachAfter(i?function(d){d.x=(d.x-o.x)*t,d.y=(o.y-d.y)*n}:function(d){d.x=(d.x-c)/(f-c)*t,d.y=(1-(o.y?d.y/o.y:1))*n})}return r.separation=function(o){return arguments.length?(e=o,r):e},r.size=function(o){return arguments.length?(i=!1,t=+o[0],n=+o[1],r):i?null:[t,n]},r.nodeSize=function(o){return arguments.length?(i=!0,t=+o[0],n=+o[1],r):i?[t,n]:null},r}function qV(e){var t=0,n=e.children,i=n&&n.length;if(!i)t=1;else for(;--i>=0;)t+=n[i].value;e.value=t}function WV(){return this.eachAfter(qV)}function GV(e,t){let n=-1;for(const i of this)e.call(t,i,++n,this);return this}function HV(e,t){for(var n=this,i=[n],r,o,a=-1;n=i.pop();)if(e.call(t,n,++a,this),r=n.children)for(o=r.length-1;o>=0;--o)i.push(r[o]);return this}function YV(e,t){for(var n=this,i=[n],r=[],o,a,s,u=-1;n=i.pop();)if(r.push(n),o=n.children)for(a=0,s=o.length;a<s;++a)i.push(o[a]);for(;n=r.pop();)e.call(t,n,++u,this);return this}function XV(e,t){let n=-1;for(const i of this)if(e.call(t,i,++n,this))return i}function VV(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})}function KV(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function JV(e){for(var t=this,n=QV(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i}function QV(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}function ZV(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function eK(){return Array.from(this)}function tK(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function nK(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*iK(){var e=this,t,n=[e],i,r,o;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,i=e.children)for(r=0,o=i.length;r<o;++r)n.push(i[r]);while(n.length)}function Bw(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=aK)):t===void 0&&(t=oK);for(var n=new Yu(e),i,r=[n],o,a,s,u;i=r.pop();)if((a=t(i.data))&&(u=(a=Array.from(a)).length))for(i.children=a,s=u-1;s>=0;--s)r.push(o=a[s]=new Yu(a[s])),o.parent=i,o.depth=i.depth+1;return n.eachBefore(Mj)}function rK(){return Bw(this).eachBefore(sK)}function oK(e){return e.children}function aK(e){return Array.isArray(e)?e[1]:null}function sK(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function Mj(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function Yu(e){this.data=e,this.depth=this.height=0,this.parent=null}Yu.prototype=Bw.prototype={constructor:Yu,count:WV,each:GV,eachAfter:YV,eachBefore:HV,find:XV,sum:VV,sort:KV,path:JV,ancestors:ZV,descendants:eK,leaves:tK,links:nK,copy:rK,[Symbol.iterator]:iK};function bh(e){return e==null?null:Dj(e)}function Dj(e){if(typeof e!="function")throw new Error;return e}function Ua(){return 0}function ou(e){return function(){return e}}const uK=1664525,lK=1013904223,MA=4294967296;function cK(){let e=1;return()=>(e=(uK*e+lK)%MA)/MA}function fK(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function dK(e,t){let n=e.length,i,r;for(;n;)r=t()*n--|0,i=e[n],e[n]=e[r],e[r]=i;return e}function hK(e,t){for(var n=0,i=(e=dK(Array.from(e),t)).length,r=[],o,a;n<i;)o=e[n],a&&Nj(a,o)?++n:(a=pK(r=gK(r,o)),n=0);return a}function gK(e,t){var n,i;if(Zm(t,e))return[t];for(n=0;n<e.length;++n)if(Rd(t,e[n])&&Zm(_c(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(Rd(_c(e[n],e[i]),t)&&Rd(_c(e[n],t),e[i])&&Rd(_c(e[i],t),e[n])&&Zm(jj(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error}function Rd(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function Nj(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function Zm(e,t){for(var n=0;n<t.length;++n)if(!Nj(e,t[n]))return!1;return!0}function pK(e){switch(e.length){case 1:return mK(e[0]);case 2:return _c(e[0],e[1]);case 3:return jj(e[0],e[1],e[2])}}function mK(e){return{x:e.x,y:e.y,r:e.r}}function _c(e,t){var n=e.x,i=e.y,r=e.r,o=t.x,a=t.y,s=t.r,u=o-n,l=a-i,c=s-r,f=Math.sqrt(u*u+l*l);return{x:(n+o+u/f*c)/2,y:(i+a+l/f*c)/2,r:(f+r+s)/2}}function jj(e,t,n){var i=e.x,r=e.y,o=e.r,a=t.x,s=t.y,u=t.r,l=n.x,c=n.y,f=n.r,d=i-a,h=i-l,g=r-s,p=r-c,m=u-o,y=f-o,v=i*i+r*r-o*o,b=v-a*a-s*s+u*u,x=v-l*l-c*c+f*f,_=h*g-d*p,E=(g*x-p*b)/(_*2)-i,w=(p*m-g*y)/_,S=(h*b-d*x)/(_*2)-r,C=(d*y-h*m)/_,A=w*w+C*C-1,O=2*(o+E*w+S*C),F=E*E+S*S-o*o,k=-(Math.abs(A)>1e-6?(O+Math.sqrt(O*O-4*A*F))/(2*A):F/O);return{x:i+E+w*k,y:r+S+C*k,r:k}}function DA(e,t,n){var i=e.x-t.x,r,o,a=e.y-t.y,s,u,l=i*i+a*a;l?(o=t.r+n.r,o*=o,u=e.r+n.r,u*=u,o>u?(r=(l+u-o)/(2*l),s=Math.sqrt(Math.max(0,u/l-r*r)),n.x=e.x-r*i-s*a,n.y=e.y-r*a+s*i):(r=(l+o-u)/(2*l),s=Math.sqrt(Math.max(0,o/l-r*r)),n.x=t.x+r*i-s*a,n.y=t.y+r*a+s*i)):(n.x=t.x+n.r,n.y=t.y)}function NA(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function jA(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,o=(t.y*n.r+n.y*t.r)/i;return r*r+o*o}function Pd(e){this._=e,this.next=null,this.previous=null}function yK(e,t){if(!(o=(e=fK(e)).length))return 0;var n,i,r,o,a,s,u,l,c,f,d;if(n=e[0],n.x=0,n.y=0,!(o>1))return n.r;if(i=e[1],n.x=-i.r,i.x=n.r,i.y=0,!(o>2))return n.r+i.r;DA(i,n,r=e[2]),n=new Pd(n),i=new Pd(i),r=new Pd(r),n.next=r.previous=i,i.next=n.previous=r,r.next=i.previous=n;e:for(u=3;u<o;++u){DA(n._,i._,r=e[u]),r=new Pd(r),l=i.next,c=n.previous,f=i._.r,d=n._.r;do if(f<=d){if(NA(l._,r._)){i=l,n.next=i,i.previous=n,--u;continue e}f+=l._.r,l=l.next}else{if(NA(c._,r._)){n=c,n.next=i,i.previous=n,--u;continue e}d+=c._.r,c=c.previous}while(l!==c.next);for(r.previous=n,r.next=i,n.next=i.previous=i=r,a=jA(n);(r=r.next)!==i;)(s=jA(r))<a&&(n=r,a=s);i=n.next}for(n=[i._],r=i;(r=r.next)!==i;)n.push(r._);for(r=hK(n,t),u=0;u<o;++u)n=e[u],n.x-=r.x,n.y-=r.y;return r.r}function vK(e){return Math.sqrt(e.value)}function bK(){var e=null,t=1,n=1,i=Ua;function r(o){const a=cK();return o.x=t/2,o.y=n/2,e?o.eachBefore(RA(e)).eachAfter(e1(i,.5,a)).eachBefore(PA(1)):o.eachBefore(RA(vK)).eachAfter(e1(Ua,1,a)).eachAfter(e1(i,o.r/Math.min(t,n),a)).eachBefore(PA(Math.min(t,n)/(2*o.r))),o}return r.radius=function(o){return arguments.length?(e=bh(o),r):e},r.size=function(o){return arguments.length?(t=+o[0],n=+o[1],r):[t,n]},r.padding=function(o){return arguments.length?(i=typeof o=="function"?o:ou(+o),r):i},r}function RA(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function e1(e,t,n){return function(i){if(r=i.children){var r,o,a=r.length,s=e(i)*t||0,u;if(s)for(o=0;o<a;++o)r[o].r+=s;if(u=yK(r,n),s)for(o=0;o<a;++o)r[o].r-=s;i.r=u+s}}}function PA(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function Rj(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function Zf(e,t,n,i,r){for(var o=e.children,a,s=-1,u=o.length,l=e.value&&(i-t)/e.value;++s<u;)a=o[s],a.y0=n,a.y1=r,a.x0=t,a.x1=t+=a.value*l}function xK(){var e=1,t=1,n=0,i=!1;function r(a){var s=a.height+1;return a.x0=a.y0=n,a.x1=e,a.y1=t/s,a.eachBefore(o(t,s)),i&&a.eachBefore(Rj),a}function o(a,s){return function(u){u.children&&Zf(u,u.x0,a*(u.depth+1)/s,u.x1,a*(u.depth+2)/s);var l=u.x0,c=u.y0,f=u.x1-n,d=u.y1-n;f<l&&(l=f=(l+f)/2),d<c&&(c=d=(c+d)/2),u.x0=l,u.y0=c,u.x1=f,u.y1=d}}return r.round=function(a){return arguments.length?(i=!!a,r):i},r.size=function(a){return arguments.length?(e=+a[0],t=+a[1],r):[e,t]},r.padding=function(a){return arguments.length?(n=+a,r):n},r}var wK={depth:-1},IA={},t1={};function _K(e){return e.id}function EK(e){return e.parentId}function LA(){var e=_K,t=EK,n;function i(r){var o=Array.from(r),a=e,s=t,u,l,c,f,d,h,g,p,m=new Map;if(n!=null){const y=o.map((x,_)=>SK(n(x,_,r))),v=y.map(zA),b=new Set(y).add("");for(const x of v)b.has(x)||(b.add(x),y.push(x),v.push(zA(x)),o.push(t1));a=(x,_)=>y[_],s=(x,_)=>v[_]}for(c=0,u=o.length;c<u;++c)l=o[c],h=o[c]=new Yu(l),(g=a(l,c,r))!=null&&(g+="")&&(p=h.id=g,m.set(p,m.has(p)?IA:h)),(g=s(l,c,r))!=null&&(g+="")&&(h.parent=g);for(c=0;c<u;++c)if(h=o[c],g=h.parent){if(d=m.get(g),!d)throw new Error("missing: "+g);if(d===IA)throw new Error("ambiguous: "+g);d.children?d.children.push(h):d.children=[h],h.parent=d}else{if(f)throw new Error("multiple roots");f=h}if(!f)throw new Error("no root");if(n!=null){for(;f.data===t1&&f.children.length===1;)f=f.children[0],--u;for(let y=o.length-1;y>=0&&(h=o[y],h.data===t1);--y)h.data=null}if(f.parent=wK,f.eachBefore(function(y){y.depth=y.parent.depth+1,--u}).eachBefore(Mj),f.parent=null,u>0)throw new Error("cycle");return f}return i.id=function(r){return arguments.length?(e=bh(r),i):e},i.parentId=function(r){return arguments.length?(t=bh(r),i):t},i.path=function(r){return arguments.length?(n=bh(r),i):n},i}function SK(e){e=`${e}`;let t=e.length;return uv(e,t-1)&&!uv(e,t-2)&&(e=e.slice(0,-1)),e[0]==="/"?e:`/${e}`}function zA(e){let t=e.length;if(t<2)return"";for(;--t>1&&!uv(e,t););return e.slice(0,t)}function uv(e,t){if(e[t]==="/"){let n=0;for(;t>0&&e[--t]==="\\";)++n;if((n&1)===0)return!0}return!1}function OK(e,t){return e.parent===t.parent?1:2}function n1(e){var t=e.children;return t?t[0]:e.t}function i1(e){var t=e.children;return t?t[t.length-1]:e.t}function AK(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function kK(e){for(var t=0,n=0,i=e.children,r=i.length,o;--r>=0;)o=i[r],o.z+=t,o.m+=t,t+=o.s+(n+=o.c)}function CK(e,t,n){return e.a.parent===t.parent?e.a:n}function xh(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}xh.prototype=Object.create(Yu.prototype);function $K(e){for(var t=new xh(e,0),n,i=[t],r,o,a,s;n=i.pop();)if(o=n._.children)for(n.children=new Array(s=o.length),a=s-1;a>=0;--a)i.push(r=n.children[a]=new xh(o[a],a)),r.parent=n;return(t.parent=new xh(null,0)).children=[t],t}function FK(){var e=OK,t=1,n=1,i=null;function r(l){var c=$K(l);if(c.eachAfter(o),c.parent.m=-c.z,c.eachBefore(a),i)l.eachBefore(u);else{var f=l,d=l,h=l;l.eachBefore(function(v){v.x<f.x&&(f=v),v.x>d.x&&(d=v),v.depth>h.depth&&(h=v)});var g=f===d?1:e(f,d)/2,p=g-f.x,m=t/(d.x+g+p),y=n/(h.depth||1);l.eachBefore(function(v){v.x=(v.x+p)*m,v.y=v.depth*y})}return l}function o(l){var c=l.children,f=l.parent.children,d=l.i?f[l.i-1]:null;if(c){kK(l);var h=(c[0].z+c[c.length-1].z)/2;d?(l.z=d.z+e(l._,d._),l.m=l.z-h):l.z=h}else d&&(l.z=d.z+e(l._,d._));l.parent.A=s(l,d,l.parent.A||f[0])}function a(l){l._.x=l.z+l.parent.m,l.m+=l.parent.m}function s(l,c,f){if(c){for(var d=l,h=l,g=c,p=d.parent.children[0],m=d.m,y=h.m,v=g.m,b=p.m,x;g=i1(g),d=n1(d),g&&d;)p=n1(p),h=i1(h),h.a=l,x=g.z+v-d.z-m+e(g._,d._),x>0&&(AK(CK(g,l,f),l,x),m+=x,y+=x),v+=g.m,m+=d.m,b+=p.m,y+=h.m;g&&!i1(h)&&(h.t=g,h.m+=v-y),d&&!n1(p)&&(p.t=d,p.m+=m-b,f=l)}return f}function u(l){l.x*=t,l.y=l.depth*n}return r.separation=function(l){return arguments.length?(e=l,r):e},r.size=function(l){return arguments.length?(i=!1,t=+l[0],n=+l[1],r):i?null:[t,n]},r.nodeSize=function(l){return arguments.length?(i=!0,t=+l[0],n=+l[1],r):i?[t,n]:null},r}function x0(e,t,n,i,r){for(var o=e.children,a,s=-1,u=o.length,l=e.value&&(r-n)/e.value;++s<u;)a=o[s],a.x0=t,a.x1=i,a.y0=n,a.y1=n+=a.value*l}var Pj=(1+Math.sqrt(5))/2;function Ij(e,t,n,i,r,o){for(var a=[],s=t.children,u,l,c=0,f=0,d=s.length,h,g,p=t.value,m,y,v,b,x,_,E;c<d;){h=r-n,g=o-i;do m=s[f++].value;while(!m&&f<d);for(y=v=m,_=Math.max(g/h,h/g)/(p*e),E=m*m*_,x=Math.max(v/E,E/y);f<d;++f){if(m+=l=s[f].value,l<y&&(y=l),l>v&&(v=l),E=m*m*_,b=Math.max(v/E,E/y),b>x){m-=l;break}x=b}a.push(u={value:m,dice:h<g,children:s.slice(c,f)}),u.dice?Zf(u,n,i,r,p?i+=g*m/p:o):x0(u,n,i,p?n+=h*m/p:r,o),p-=m,c=f}return a}var Lj=function e(t){function n(i,r,o,a,s){Ij(t,i,r,o,a,s)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(Pj);function TK(){var e=Lj,t=!1,n=1,i=1,r=[0],o=Ua,a=Ua,s=Ua,u=Ua,l=Ua;function c(d){return d.x0=d.y0=0,d.x1=n,d.y1=i,d.eachBefore(f),r=[0],t&&d.eachBefore(Rj),d}function f(d){var h=r[d.depth],g=d.x0+h,p=d.y0+h,m=d.x1-h,y=d.y1-h;m<g&&(g=m=(g+m)/2),y<p&&(p=y=(p+y)/2),d.x0=g,d.y0=p,d.x1=m,d.y1=y,d.children&&(h=r[d.depth+1]=o(d)/2,g+=l(d)-h,p+=a(d)-h,m-=s(d)-h,y-=u(d)-h,m<g&&(g=m=(g+m)/2),y<p&&(p=y=(p+y)/2),e(d,g,p,m,y))}return c.round=function(d){return arguments.length?(t=!!d,c):t},c.size=function(d){return arguments.length?(n=+d[0],i=+d[1],c):[n,i]},c.tile=function(d){return arguments.length?(e=Dj(d),c):e},c.padding=function(d){return arguments.length?c.paddingInner(d).paddingOuter(d):c.paddingInner()},c.paddingInner=function(d){return arguments.length?(o=typeof d=="function"?d:ou(+d),c):o},c.paddingOuter=function(d){return arguments.length?c.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):c.paddingTop()},c.paddingTop=function(d){return arguments.length?(a=typeof d=="function"?d:ou(+d),c):a},c.paddingRight=function(d){return arguments.length?(s=typeof d=="function"?d:ou(+d),c):s},c.paddingBottom=function(d){return arguments.length?(u=typeof d=="function"?d:ou(+d),c):u},c.paddingLeft=function(d){return arguments.length?(l=typeof d=="function"?d:ou(+d),c):l},c}function MK(e,t,n,i,r){var o=e.children,a,s=o.length,u,l=new Array(s+1);for(l[0]=u=a=0;a<s;++a)l[a+1]=u+=o[a].value;c(0,s,e.value,t,n,i,r);function c(f,d,h,g,p,m,y){if(f>=d-1){var v=o[f];v.x0=g,v.y0=p,v.x1=m,v.y1=y;return}for(var b=l[f],x=h/2+b,_=f+1,E=d-1;_<E;){var w=_+E>>>1;l[w]<x?_=w+1:E=w}x-l[_-1]<l[_]-x&&f+1<_&&--_;var S=l[_]-b,C=h-S;if(m-g>y-p){var A=h?(g*C+m*S)/h:m;c(f,_,S,g,p,A,y),c(_,d,C,A,p,m,y)}else{var O=h?(p*C+y*S)/h:y;c(f,_,S,g,p,m,O),c(_,d,C,g,O,m,y)}}}function DK(e,t,n,i,r){(e.depth&1?x0:Zf)(e,t,n,i,r)}var NK=function e(t){function n(i,r,o,a,s){if((u=i._squarify)&&u.ratio===t)for(var u,l,c,f,d=-1,h,g=u.length,p=i.value;++d<g;){for(l=u[d],c=l.children,f=l.value=0,h=c.length;f<h;++f)l.value+=c[f].value;l.dice?Zf(l,r,o,a,p?o+=(s-o)*l.value/p:s):x0(l,r,o,p?r+=(a-r)*l.value/p:a,s),p-=l.value}else i._squarify=u=Ij(t,i,r,o,a,s),u.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(Pj);function lv(e,t,n){const i={};return e.each(r=>{const o=r.data;n(o)&&(i[t(o)]=r)}),e.lookup=i,e}function Uw(e){N.call(this,null,e)}Uw.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const jK=e=>e.values;W(Uw,N,{transform(e,t){t.source||P("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),o=this.value;return(!o||i||t.changed())&&(o&&o.each(a=>{a.children&&Np(a.data)&&r.rem.push(a.data)}),this.value=o=Bw({values:V(e.keys).reduce((a,s)=>(a.key(s),a),RK()).entries(r.source)},jK),n&&o.each(a=>{a.children&&(a=Ce(a.data),r.add.push(a),r.source.push(a))}),lv(o,ne,ne)),r.source.root=o,r}});function RK(){const e=[],t={entries:r=>i(n(r,0),0),key:r=>(e.push(r),t)};function n(r,o){if(o>=e.length)return r;const a=r.length,s=e[o++],u={},l={};let c=-1,f,d,h;for(;++c<a;)f=s(d=r[c])+"",(h=u[f])?h.push(d):u[f]=[d];for(f in u)l[f]=n(u[f],o);return l}function i(r,o){if(++o>e.length)return r;const a=[];for(const s in r)a.push({key:s,values:i(r[s],o)});return a}return t}function fo(e){N.call(this,null,e)}const PK=(e,t)=>e.parent===t.parent?1:2;W(fo,N,{transform(e,t){(!t.source||!t.source.root)&&P(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),i=this.fields,r=t.source.root,o=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(Ds(e.sort,a=>a.data)),IK(n,this.params,e),n.separation&&n.separation(e.separation!==!1?PK:al);try{this.value=n(r)}catch(a){P(a)}return r.each(a=>LK(a,i,o)),t.reflow(e.modified()).modifies(o).modifies("leaf")}});function IK(e,t,n){for(let i,r=0,o=t.length;r<o;++r)i=t[r],i in n&&e[i](n[i])}function LK(e,t,n){const i=e.data,r=t.length-1;for(let o=0;o<r;++o)i[n[o]]=e[t[o]];i[n[r]]=e.children?e.children.length:0}const cv=["x","y","r","depth","children"];function qw(e){fo.call(this,e)}qw.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:cv.length,default:cv}]};W(qw,fo,{layout:bK,params:["radius","size","padding"],fields:cv});const fv=["x0","y0","x1","y1","depth","children"];function Ww(e){fo.call(this,e)}Ww.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:fv.length,default:fv}]};W(Ww,fo,{layout:xK,params:["size","round","padding"],fields:fv});function Gw(e){N.call(this,null,e)}Gw.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};W(Gw,N,{transform(e,t){t.source||P("Stratify transform requires an upstream data source.");let n=this.value;const i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),o=!n||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),o&&(n=r.source.length?lv(LA().id(e.key).parentId(e.parentKey)(r.source),e.key,Zn):lv(LA()([{}]),e.key,e.key)),r.source.root=this.value=n,r}});const BA={tidy:FK,cluster:UV},dv=["x","y","depth","children"];function Hw(e){fo.call(this,e)}Hw.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:dv.length,default:dv}]};W(Hw,fo,{layout(e){const t=e||"tidy";if(ee(BA,t))return BA[t]();P("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:dv});function Yw(e){N.call(this,[],e)}Yw.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};W(Yw,N,{transform(e,t){const n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),o={};return i||P("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,a=>o[ne(a)]=1),i.each(a=>{const s=a.data,u=a.parent&&a.parent.data;u&&o[ne(s)]&&o[ne(u)]&&r.add.push(Ce({source:u,target:s}))}),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,a=>o[ne(a)]=1),n.forEach(a=>{(o[ne(a.source)]||o[ne(a.target)])&&r.mod.push(a)})),r}});const UA={binary:MK,dice:Zf,slice:x0,slicedice:DK,squarify:Lj,resquarify:NK},hv=["x0","y0","x1","y1","depth","children"];function Xw(e){fo.call(this,e)}Xw.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:hv.length,default:hv}]};W(Xw,fo,{layout(){const e=TK();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{ee(UA,t)?e.tile(UA[t]):P("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:hv});var zK=Object.freeze(Object.defineProperty({__proto__:null,nest:Uw,pack:qw,partition:Ww,stratify:Gw,tree:Hw,treelinks:Yw,treemap:Xw},Symbol.toStringTag,{value:"Module"}));const r1=4278190080;function BK(e,t){const n=e.bitmap();return(t||[]).forEach(i=>n.set(e(i.boundary[0]),e(i.boundary[3]))),[n,void 0]}function UK(e,t,n,i,r){const o=e.width,a=e.height,s=i||r,u=zo(o,a).getContext("2d"),l=zo(o,a).getContext("2d"),c=s&&zo(o,a).getContext("2d");n.forEach(S=>wh(u,S,!1)),wh(l,t,!1),s&&wh(c,t,!0);const f=o1(u,o,a),d=o1(l,o,a),h=s&&o1(c,o,a),g=e.bitmap(),p=s&&e.bitmap();let m,y,v,b,x,_,E,w;for(y=0;y<a;++y)for(m=0;m<o;++m)x=y*o+m,_=f[x]&r1,w=d[x]&r1,E=s&&h[x]&r1,(_||E||w)&&(v=e(m),b=e(y),!r&&(_||w)&&g.set(v,b),s&&(_||E)&&p.set(v,b));return[g,p]}function o1(e,t,n){return new Uint32Array(e.getImageData(0,0,t,n).data.buffer)}function wh(e,t,n){if(!t.length)return;const i=t[0].mark.marktype;i==="group"?t.forEach(r=>{r.items.forEach(o=>wh(e,o.items,n))}):zn[i].draw(e,{items:n?t.map(qK):t})}function qK(e){const t=jp(e,{});return t.stroke&&t.strokeOpacity!==0||t.fill&&t.fillOpacity!==0?{...t,strokeOpacity:1,stroke:"#000",fillOpacity:0}:t}const jr=5,Yt=31,uf=32,Ao=new Uint32Array(uf+1),yi=new Uint32Array(uf+1);yi[0]=0;Ao[0]=~yi[0];for(let e=1;e<=uf;++e)yi[e]=yi[e-1]<<1|1,Ao[e]=~yi[e];function WK(e,t){const n=new Uint32Array(~~((e*t+uf)/uf));function i(o,a){n[o]|=a}function r(o,a){n[o]&=a}return{array:n,get:(o,a)=>{const s=a*e+o;return n[s>>>jr]&1<<(s&Yt)},set:(o,a)=>{const s=a*e+o;i(s>>>jr,1<<(s&Yt))},clear:(o,a)=>{const s=a*e+o;r(s>>>jr,~(1<<(s&Yt)))},getRange:(o,a,s,u)=>{let l=u,c,f,d,h;for(;l>=a;--l)if(c=l*e+o,f=l*e+s,d=c>>>jr,h=f>>>jr,d===h){if(n[d]&Ao[c&Yt]&yi[(f&Yt)+1])return!0}else{if(n[d]&Ao[c&Yt]||n[h]&yi[(f&Yt)+1])return!0;for(let g=d+1;g<h;++g)if(n[g])return!0}return!1},setRange:(o,a,s,u)=>{let l,c,f,d,h;for(;a<=u;++a)if(l=a*e+o,c=a*e+s,f=l>>>jr,d=c>>>jr,f===d)i(f,Ao[l&Yt]&yi[(c&Yt)+1]);else for(i(f,Ao[l&Yt]),i(d,yi[(c&Yt)+1]),h=f+1;h<d;++h)i(h,4294967295)},clearRange:(o,a,s,u)=>{let l,c,f,d,h;for(;a<=u;++a)if(l=a*e+o,c=a*e+s,f=l>>>jr,d=c>>>jr,f===d)r(f,yi[l&Yt]|Ao[(c&Yt)+1]);else for(r(f,yi[l&Yt]),r(d,Ao[(c&Yt)+1]),h=f+1;h<d;++h)r(h,0)},outOfBounds:(o,a,s,u)=>o<0||a<0||u>=t||s>=e}}function GK(e,t,n){const i=Math.max(1,Math.sqrt(e*t/1e6)),r=~~((e+2*n+i)/i),o=~~((t+2*n+i)/i),a=s=>~~((s+n)/i);return a.invert=s=>s*i-n,a.bitmap=()=>WK(r,o),a.ratio=i,a.padding=n,a.width=e,a.height=t,a}function HK(e,t,n,i){const r=e.width,o=e.height;return function(a){const s=a.datum.datum.items[i].items,u=s.length,l=a.datum.fontSize,c=Ci.width(a.datum,a.datum.text);let f=0,d,h,g,p,m,y,v;for(let b=0;b<u;++b)d=s[b].x,g=s[b].y,h=s[b].x2===void 0?d:s[b].x2,p=s[b].y2===void 0?g:s[b].y2,m=(d+h)/2,y=(g+p)/2,v=Math.abs(h-d+p-g),v>=f&&(f=v,a.x=m,a.y=y);return m=c/2,y=l/2,d=a.x-m,h=a.x+m,g=a.y-y,p=a.y+y,a.align="center",d<0&&h<=r?a.align="left":0<=d&&r<h&&(a.align="right"),a.baseline="middle",g<0&&p<=o?a.baseline="top":0<=g&&o<p&&(a.baseline="bottom"),!0}}function zg(e,t,n,i,r,o){let a=n/2;return e-a<0||e+a>r||t-(a=i/2)<0||t+a>o}function Ro(e,t,n,i,r,o,a,s){const u=r*o/(i*2),l=e(t-u),c=e(t+u),f=e(n-(o=o/2)),d=e(n+o);return a.outOfBounds(l,f,c,d)||a.getRange(l,f,c,d)||s&&s.getRange(l,f,c,d)}function YK(e,t,n,i){const r=e.width,o=e.height,a=t[0],s=t[1];function u(l,c,f,d,h){const g=e.invert(l),p=e.invert(c);let m=f,y=o,v;if(!zg(g,p,d,h,r,o)&&!Ro(e,g,p,h,d,m,a,s)&&!Ro(e,g,p,h,d,h,a,null)){for(;y-m>=1;)v=(m+y)/2,Ro(e,g,p,h,d,v,a,s)?y=v:m=v;if(m>f)return[g,p,m,!0]}}return function(l){const c=l.datum.datum.items[i].items,f=c.length,d=l.datum.fontSize,h=Ci.width(l.datum,l.datum.text);let g=n?d:0,p=!1,m=!1,y=0,v,b,x,_,E,w,S,C,A,O,F,k,M,$,T,D,R;for(let L=0;L<f;++L){for(v=c[L].x,x=c[L].y,b=c[L].x2===void 0?v:c[L].x2,_=c[L].y2===void 0?x:c[L].y2,v>b&&(R=v,v=b,b=R),x>_&&(R=x,x=_,_=R),A=e(v),F=e(b),O=~~((A+F)/2),k=e(x),$=e(_),M=~~((k+$)/2),S=O;S>=A;--S)for(C=M;C>=k;--C)D=u(S,C,g,h,d),D&&([l.x,l.y,g,p]=D);for(S=O;S<=F;++S)for(C=M;C<=$;++C)D=u(S,C,g,h,d),D&&([l.x,l.y,g,p]=D);!p&&!n&&(T=Math.abs(b-v+_-x),E=(v+b)/2,w=(x+_)/2,T>=y&&!zg(E,w,h,d,r,o)&&!Ro(e,E,w,d,h,d,a,null)&&(y=T,l.x=E,l.y=w,m=!0))}return p||m?(E=h/2,w=d/2,a.setRange(e(l.x-E),e(l.y-w),e(l.x+E),e(l.y+w)),l.align="center",l.baseline="middle",!0):!1}}const XK=[-1,-1,1,1],VK=[-1,1,-1,1];function KK(e,t,n,i){const r=e.width,o=e.height,a=t[0],s=t[1],u=e.bitmap();return function(l){const c=l.datum.datum.items[i].items,f=c.length,d=l.datum.fontSize,h=Ci.width(l.datum,l.datum.text),g=[];let p=n?d:0,m=!1,y=!1,v=0,b,x,_,E,w,S,C,A,O,F,k,M;for(let $=0;$<f;++$){for(b=c[$].x,_=c[$].y,x=c[$].x2===void 0?b:c[$].x2,E=c[$].y2===void 0?_:c[$].y2,g.push([e((b+x)/2),e((_+E)/2)]);g.length;)if([C,A]=g.pop(),!(a.get(C,A)||s.get(C,A)||u.get(C,A))){u.set(C,A);for(let T=0;T<4;++T)w=C+XK[T],S=A+VK[T],u.outOfBounds(w,S,w,S)||g.push([w,S]);if(w=e.invert(C),S=e.invert(A),O=p,F=o,!zg(w,S,h,d,r,o)&&!Ro(e,w,S,d,h,O,a,s)&&!Ro(e,w,S,d,h,d,a,null)){for(;F-O>=1;)k=(O+F)/2,Ro(e,w,S,d,h,k,a,s)?F=k:O=k;O>p&&(l.x=w,l.y=S,p=O,m=!0)}}!m&&!n&&(M=Math.abs(x-b+E-_),w=(b+x)/2,S=(_+E)/2,M>=v&&!zg(w,S,h,d,r,o)&&!Ro(e,w,S,d,h,d,a,null)&&(v=M,l.x=w,l.y=S,y=!0))}return m||y?(w=h/2,S=d/2,a.setRange(e(l.x-w),e(l.y-S),e(l.x+w),e(l.y+S)),l.align="center",l.baseline="middle",!0):!1}}const JK=["right","center","left"],QK=["bottom","middle","top"];function ZK(e,t,n,i){const r=e.width,o=e.height,a=t[0],s=t[1],u=i.length;return function(l){var c;const f=l.boundary,d=l.datum.fontSize;if(f[2]<0||f[5]<0||f[0]>r||f[3]>o)return!1;let h=(c=l.textWidth)!==null&&c!==void 0?c:0,g,p,m,y,v,b,x,_,E,w,S,C,A,O,F;for(let k=0;k<u;++k){if(g=(n[k]&3)-1,p=(n[k]>>>2&3)-1,m=g===0&&p===0||i[k]<0,y=g&&p?Math.SQRT1_2:1,v=i[k]<0?-1:1,b=f[1+g]+i[k]*g*y,S=f[4+p]+v*d*p/2+i[k]*p*y,_=S-d/2,E=S+d/2,C=e(b),O=e(_),F=e(E),!h)if(qA(C,C,O,F,a,s,b,b,_,E,f,m))h=Ci.width(l.datum,l.datum.text);else continue;if(w=b+v*h*g/2,b=w-h/2,x=w+h/2,C=e(b),A=e(x),qA(C,A,O,F,a,s,b,x,_,E,f,m))return l.x=g?g*v<0?x:b:w,l.y=p?p*v<0?E:_:S,l.align=JK[g*v+1],l.baseline=QK[p*v+1],a.setRange(C,O,A,F),!0}return!1}}function qA(e,t,n,i,r,o,a,s,u,l,c,f){return!(r.outOfBounds(e,n,t,i)||(f&&o||r).getRange(e,n,t,i))}const a1=0,s1=4,u1=8,l1=0,c1=1,f1=2,eJ={"top-left":a1+l1,top:a1+c1,"top-right":a1+f1,left:s1+l1,middle:s1+c1,right:s1+f1,"bottom-left":u1+l1,bottom:u1+c1,"bottom-right":u1+f1},tJ={naive:HK,"reduced-search":YK,floodfill:KK};function nJ(e,t,n,i,r,o,a,s,u,l,c){if(!e.length)return e;const f=Math.max(i.length,r.length),d=iJ(i,f),h=rJ(r,f),g=oJ(e[0].datum),p=g==="group"&&e[0].datum.items[u].marktype,m=p==="area",y=aJ(g,p,s,u),v=l===null||l===1/0,b=m&&c==="naive";let x=-1,_=-1;const E=e.map(A=>{const O=v?Ci.width(A,A.text):void 0;return x=Math.max(x,O),_=Math.max(_,A.fontSize),{datum:A,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(A),textWidth:O}});l=l===null||l===1/0?Math.max(x,_)+Math.max(...i):l;const w=GK(t[0],t[1],l);let S;if(!b){n&&E.sort((F,k)=>n(F.datum,k.datum));let A=!1;for(let F=0;F<h.length&&!A;++F)A=h[F]===5||d[F]<0;const O=(g&&a||m)&&e.map(F=>F.datum);S=o.length||O?UK(w,O||[],o,A,m):BK(w,a&&E)}const C=m?tJ[c](w,S,a,u):ZK(w,S,h,d);return E.forEach(A=>A.opacity=+C(A)),E}function iJ(e,t){const n=new Float64Array(t),i=e.length;for(let r=0;r<i;++r)n[r]=e[r]||0;for(let r=i;r<t;++r)n[r]=n[i-1];return n}function rJ(e,t){const n=new Int8Array(t),i=e.length;for(let r=0;r<i;++r)n[r]|=eJ[e[r]];for(let r=i;r<t;++r)n[r]=n[i-1];return n}function oJ(e){return e&&e.mark&&e.mark.marktype}function aJ(e,t,n,i){const r=o=>[o.x,o.x,o.x,o.y,o.y,o.y];return e?e==="line"||e==="area"?o=>r(o.datum):t==="line"?o=>{const a=o.datum.items[i].items;return r(a.length?a[n==="start"?0:a.length-1]:{x:NaN,y:NaN})}:o=>{const a=o.datum.bounds;return[a.x1,(a.x1+a.x2)/2,a.x2,a.y1,(a.y1+a.y2)/2,a.y2]}:r}const gv=["x","y","opacity","align","baseline"],zj=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function Vw(e){N.call(this,null,e)}Vw.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:zj},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:gv.length,default:gv}]};W(Vw,N,{transform(e,t){function n(o){const a=e[o];return fe(a)&&t.modified(a.fields)}const i=e.modified();if(!(i||t.changed(t.ADD_REM)||n("sort")))return;(!e.size||e.size.length!==2)&&P("Size parameter should be specified as a [width, height] array.");const r=e.as||gv;return nJ(t.materialize(t.SOURCE).source||[],e.size,e.sort,V(e.offset==null?1:e.offset),V(e.anchor||zj),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding===void 0?0:e.padding,e.method||"naive").forEach(o=>{const a=o.datum;a[r[0]]=o.x,a[r[1]]=o.y,a[r[2]]=o.opacity,a[r[3]]=o.align,a[r[4]]=o.baseline}),t.reflow(i).modifies(r)}});var sJ=Object.freeze(Object.defineProperty({__proto__:null,label:Vw},Symbol.toStringTag,{value:"Module"}));function Bj(e,t){var n=[],i=function(c){return c(s)},r,o,a,s,u,l;if(t==null)n.push(e);else for(r={},o=0,a=e.length;o<a;++o)s=e[o],u=t.map(i),l=r[u],l||(r[u]=l=[],l.dims=u,n.push(l)),l.push(s);return n}function Kw(e){N.call(this,null,e)}Kw.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};W(Kw,N,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=Bj(i,e.groupby),o=(e.groupby||[]).map(Qe),a=o.length,s=e.as||[Qe(e.x),Qe(e.y)],u=[];r.forEach(l=>{oM(l,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let d=0;d<a;++d)f[o[d]]=l.dims[d];f[s[0]]=c[0],f[s[1]]=c[1],u.push(Ce(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});const pv={linear:$x,log:tM,exp:nM,pow:iM,quad:Fx,poly:rM},uJ=(e,t)=>e==="poly"?t:e==="quad"?2:1;function Jw(e){N.call(this,null,e)}Jw.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(pv)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};W(Jw,N,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=Bj(i,e.groupby),o=(e.groupby||[]).map(Qe),a=e.method||"linear",s=e.order||3,u=uJ(a,s),l=e.as||[Qe(e.x),Qe(e.y)],c=pv[a],f=[];let d=e.extent;ee(pv,a)||P("Invalid regression method: "+a),d!=null&&a==="log"&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),r.forEach(h=>{if(h.length<=u){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const p=c(h,e.x,e.y,s);if(e.params){f.push(Ce({keys:h.dims,coef:p.coef,rSquared:p.rSquared}));return}const m=d||lr(h,e.x),y=v=>{const b={};for(let x=0;x<o.length;++x)b[o[x]]=h.dims[x];b[l[0]]=v[0],b[l[1]]=v[1],f.push(Ce(b))};a==="linear"?m.forEach(v=>y([v,p.predict(v)])):Up(p.predict,m,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});var lJ=Object.freeze(Object.defineProperty({__proto__:null,loess:Kw,regression:Jw},Symbol.toStringTag,{value:"Module"}));const eo=11102230246251565e-32,Tt=134217729,cJ=(3+8*eo)*eo;function d1(e,t,n,i,r){let o,a,s,u,l=t[0],c=i[0],f=0,d=0;c>l==c>-l?(o=l,l=t[++f]):(o=c,c=i[++d]);let h=0;if(f<e&&d<n)for(c>l==c>-l?(a=l+o,s=o-(a-l),l=t[++f]):(a=c+o,s=o-(a-c),c=i[++d]),o=a,s!==0&&(r[h++]=s);f<e&&d<n;)c>l==c>-l?(a=o+l,u=a-o,s=o-(a-u)+(l-u),l=t[++f]):(a=o+c,u=a-o,s=o-(a-u)+(c-u),c=i[++d]),o=a,s!==0&&(r[h++]=s);for(;f<e;)a=o+l,u=a-o,s=o-(a-u)+(l-u),l=t[++f],o=a,s!==0&&(r[h++]=s);for(;d<n;)a=o+c,u=a-o,s=o-(a-u)+(c-u),c=i[++d],o=a,s!==0&&(r[h++]=s);return(o!==0||h===0)&&(r[h++]=o),h}function fJ(e,t){let n=t[0];for(let i=1;i<e;i++)n+=t[i];return n}function ed(e){return new Float64Array(e)}const dJ=(3+16*eo)*eo,hJ=(2+12*eo)*eo,gJ=(9+64*eo)*eo*eo,Js=ed(4),WA=ed(8),GA=ed(12),HA=ed(16),Xt=ed(4);function pJ(e,t,n,i,r,o,a){let s,u,l,c,f,d,h,g,p,m,y,v,b,x,_,E,w,S;const C=e-r,A=n-r,O=t-o,F=i-o;x=C*F,d=Tt*C,h=d-(d-C),g=C-h,d=Tt*F,p=d-(d-F),m=F-p,_=g*m-(x-h*p-g*p-h*m),E=O*A,d=Tt*O,h=d-(d-O),g=O-h,d=Tt*A,p=d-(d-A),m=A-p,w=g*m-(E-h*p-g*p-h*m),y=_-w,f=_-y,Js[0]=_-(y+f)+(f-w),v=x+y,f=v-x,b=x-(v-f)+(y-f),y=b-E,f=b-y,Js[1]=b-(y+f)+(f-E),S=v+y,f=S-v,Js[2]=v-(S-f)+(y-f),Js[3]=S;let k=fJ(4,Js),M=hJ*a;if(k>=M||-k>=M||(f=e-C,s=e-(C+f)+(f-r),f=n-A,l=n-(A+f)+(f-r),f=t-O,u=t-(O+f)+(f-o),f=i-F,c=i-(F+f)+(f-o),s===0&&u===0&&l===0&&c===0)||(M=gJ*a+cJ*Math.abs(k),k+=C*c+F*s-(O*l+A*u),k>=M||-k>=M))return k;x=s*F,d=Tt*s,h=d-(d-s),g=s-h,d=Tt*F,p=d-(d-F),m=F-p,_=g*m-(x-h*p-g*p-h*m),E=u*A,d=Tt*u,h=d-(d-u),g=u-h,d=Tt*A,p=d-(d-A),m=A-p,w=g*m-(E-h*p-g*p-h*m),y=_-w,f=_-y,Xt[0]=_-(y+f)+(f-w),v=x+y,f=v-x,b=x-(v-f)+(y-f),y=b-E,f=b-y,Xt[1]=b-(y+f)+(f-E),S=v+y,f=S-v,Xt[2]=v-(S-f)+(y-f),Xt[3]=S;const $=d1(4,Js,4,Xt,WA);x=C*c,d=Tt*C,h=d-(d-C),g=C-h,d=Tt*c,p=d-(d-c),m=c-p,_=g*m-(x-h*p-g*p-h*m),E=O*l,d=Tt*O,h=d-(d-O),g=O-h,d=Tt*l,p=d-(d-l),m=l-p,w=g*m-(E-h*p-g*p-h*m),y=_-w,f=_-y,Xt[0]=_-(y+f)+(f-w),v=x+y,f=v-x,b=x-(v-f)+(y-f),y=b-E,f=b-y,Xt[1]=b-(y+f)+(f-E),S=v+y,f=S-v,Xt[2]=v-(S-f)+(y-f),Xt[3]=S;const T=d1($,WA,4,Xt,GA);x=s*c,d=Tt*s,h=d-(d-s),g=s-h,d=Tt*c,p=d-(d-c),m=c-p,_=g*m-(x-h*p-g*p-h*m),E=u*l,d=Tt*u,h=d-(d-u),g=u-h,d=Tt*l,p=d-(d-l),m=l-p,w=g*m-(E-h*p-g*p-h*m),y=_-w,f=_-y,Xt[0]=_-(y+f)+(f-w),v=x+y,f=v-x,b=x-(v-f)+(y-f),y=b-E,f=b-y,Xt[1]=b-(y+f)+(f-E),S=v+y,f=S-v,Xt[2]=v-(S-f)+(y-f),Xt[3]=S;const D=d1(T,GA,4,Xt,HA);return HA[D-1]}function Id(e,t,n,i,r,o){const a=(t-o)*(n-r),s=(e-r)*(i-o),u=a-s;if(a===0||s===0||a>0!=s>0)return u;const l=Math.abs(a+s);return Math.abs(u)>=dJ*l?u:-pJ(e,t,n,i,r,o,l)}const YA=Math.pow(2,-52),Ld=new Uint32Array(512);class Bg{static from(t,n=xJ,i=wJ){const r=t.length,o=new Float64Array(r*2);for(let a=0;a<r;a++){const s=t[a];o[2*a]=n(s),o[2*a+1]=i(s)}return new Bg(o)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:o}=this,a=t.length>>1;let s=1/0,u=1/0,l=-1/0,c=-1/0;for(let A=0;A<a;A++){const O=t[2*A],F=t[2*A+1];O<s&&(s=O),F<u&&(u=F),O>l&&(l=O),F>c&&(c=F),this._ids[A]=A}const f=(s+l)/2,d=(u+c)/2;let h=1/0,g,p,m;for(let A=0;A<a;A++){const O=h1(f,d,t[2*A],t[2*A+1]);O<h&&(g=A,h=O)}const y=t[2*g],v=t[2*g+1];h=1/0;for(let A=0;A<a;A++){if(A===g)continue;const O=h1(y,v,t[2*A],t[2*A+1]);O<h&&O>0&&(p=A,h=O)}let b=t[2*p],x=t[2*p+1],_=1/0;for(let A=0;A<a;A++){if(A===g||A===p)continue;const O=vJ(y,v,b,x,t[2*A],t[2*A+1]);O<_&&(m=A,_=O)}let E=t[2*m],w=t[2*m+1];if(_===1/0){for(let F=0;F<a;F++)this._dists[F]=t[2*F]-t[0]||t[2*F+1]-t[1];fu(this._ids,this._dists,0,a-1);const A=new Uint32Array(a);let O=0;for(let F=0,k=-1/0;F<a;F++){const M=this._ids[F];this._dists[M]>k&&(A[O++]=M,k=this._dists[M])}this.hull=A.subarray(0,O),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Id(y,v,b,x,E,w)<0){const A=p,O=b,F=x;p=m,b=E,x=w,m=A,E=O,w=F}const S=bJ(y,v,b,x,E,w);this._cx=S.x,this._cy=S.y;for(let A=0;A<a;A++)this._dists[A]=h1(t[2*A],t[2*A+1],S.x,S.y);fu(this._ids,this._dists,0,a-1),this._hullStart=g;let C=3;i[g]=n[m]=p,i[p]=n[g]=m,i[m]=n[p]=g,r[g]=0,r[p]=1,r[m]=2,o.fill(-1),o[this._hashKey(y,v)]=g,o[this._hashKey(b,x)]=p,o[this._hashKey(E,w)]=m,this.trianglesLen=0,this._addTriangle(g,p,m,-1,-1,-1);for(let A=0,O,F;A<this._ids.length;A++){const k=this._ids[A],M=t[2*k],$=t[2*k+1];if(A>0&&Math.abs(M-O)<=YA&&Math.abs($-F)<=YA||(O=M,F=$,k===g||k===p||k===m))continue;let T=0;for(let ue=0,_e=this._hashKey(M,$);ue<this._hashSize&&(T=o[(_e+ue)%this._hashSize],!(T!==-1&&T!==i[T]));ue++);T=n[T];let D=T,R;for(;R=i[D],Id(M,$,t[2*D],t[2*D+1],t[2*R],t[2*R+1])>=0;)if(D=R,D===T){D=-1;break}if(D===-1)continue;let L=this._addTriangle(D,k,i[D],-1,-1,r[D]);r[k]=this._legalize(L+2),r[D]=L,C++;let J=i[D];for(;R=i[J],Id(M,$,t[2*J],t[2*J+1],t[2*R],t[2*R+1])<0;)L=this._addTriangle(J,k,R,r[k],-1,r[J]),r[k]=this._legalize(L+2),i[J]=J,C--,J=R;if(D===T)for(;R=n[D],Id(M,$,t[2*R],t[2*R+1],t[2*D],t[2*D+1])<0;)L=this._addTriangle(R,k,D,-1,r[D],r[R]),this._legalize(L+2),r[R]=L,i[D]=D,C--,D=R;this._hullStart=n[k]=D,i[D]=n[J]=k,i[k]=J,o[this._hashKey(M,$)]=k,o[this._hashKey(t[2*D],t[2*D+1])]=D}this.hull=new Uint32Array(C);for(let A=0,O=this._hullStart;A<C;A++)this.hull[A]=O,O=i[O];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(mJ(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:r}=this;let o=0,a=0;for(;;){const s=i[t],u=t-t%3;if(a=u+(t+2)%3,s===-1){if(o===0)break;t=Ld[--o];continue}const l=s-s%3,c=u+(t+1)%3,f=l+(s+2)%3,d=n[a],h=n[t],g=n[c],p=n[f];if(yJ(r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*g],r[2*g+1],r[2*p],r[2*p+1])){n[t]=p,n[s]=d;const y=i[f];if(y===-1){let b=this._hullStart;do{if(this._hullTri[b]===f){this._hullTri[b]=t;break}b=this._hullPrev[b]}while(b!==this._hullStart)}this._link(t,y),this._link(s,i[a]),this._link(a,f);const v=l+(s+1)%3;o<Ld.length&&(Ld[o++]=v)}else{if(o===0)break;t=Ld[--o]}}return a}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,i,r,o,a){const s=this.trianglesLen;return this._triangles[s]=t,this._triangles[s+1]=n,this._triangles[s+2]=i,this._link(s,r),this._link(s+1,o),this._link(s+2,a),this.trianglesLen+=3,s}}function mJ(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function h1(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}function yJ(e,t,n,i,r,o,a,s){const u=e-a,l=t-s,c=n-a,f=i-s,d=r-a,h=o-s,g=u*u+l*l,p=c*c+f*f,m=d*d+h*h;return u*(f*m-p*h)-l*(c*m-p*d)+g*(c*h-f*d)<0}function vJ(e,t,n,i,r,o){const a=n-e,s=i-t,u=r-e,l=o-t,c=a*a+s*s,f=u*u+l*l,d=.5/(a*l-s*u),h=(l*c-s*f)*d,g=(a*f-u*c)*d;return h*h+g*g}function bJ(e,t,n,i,r,o){const a=n-e,s=i-t,u=r-e,l=o-t,c=a*a+s*s,f=u*u+l*l,d=.5/(a*l-s*u),h=e+(l*c-s*f)*d,g=t+(a*f-u*c)*d;return{x:h,y:g}}function fu(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const o=e[r],a=t[o];let s=r-1;for(;s>=n&&t[e[s]]>a;)e[s+1]=e[s--];e[s+1]=o}else{const r=n+i>>1;let o=n+1,a=i;Hl(e,r,o),t[e[n]]>t[e[i]]&&Hl(e,n,i),t[e[o]]>t[e[i]]&&Hl(e,o,i),t[e[n]]>t[e[o]]&&Hl(e,n,o);const s=e[o],u=t[s];for(;;){do o++;while(t[e[o]]<u);do a--;while(t[e[a]]>u);if(a<o)break;Hl(e,o,a)}e[n+1]=e[a],e[a]=s,i-o+1>=a-n?(fu(e,t,o,i),fu(e,t,n,a-1)):(fu(e,t,n,a-1),fu(e,t,o,i))}}function Hl(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function xJ(e){return e[0]}function wJ(e){return e[1]}const XA=1e-6;class Ya{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){t=+t,n=+n,i=+i;const r=t+i,o=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${o}`:(Math.abs(this._x1-r)>XA||Math.abs(this._y1-o)>XA)&&(this._+="L"+r+","+o),i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=o}`)}rect(t,n,i,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class mv{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class _J{constructor(t,[n,i,r,o]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((o=+o)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=r,this.xmin=n,this.ymax=o,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:r}=this,o=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let h=0,g=0,p=i.length,m,y;h<p;h+=3,g+=2){const v=i[h]*2,b=i[h+1]*2,x=i[h+2]*2,_=t[v],E=t[v+1],w=t[b],S=t[b+1],C=t[x],A=t[x+1],O=w-_,F=S-E,k=C-_,M=A-E,$=(O*M-F*k)*2;if(Math.abs($)<1e-9){let T=1e9;const D=i[0]*2;T*=Math.sign((t[D]-_)*M-(t[D+1]-E)*k),m=(_+C)/2-T*M,y=(E+A)/2+T*k}else{const T=1/$,D=O*O+F*F,R=k*k+M*M;m=_+(M*D-F*R)*T,y=E+(O*R-k*D)*T}o[g]=m,o[g+1]=y}let a=n[n.length-1],s,u=a*4,l,c=t[2*a],f,d=t[2*a+1];r.fill(0);for(let h=0;h<n.length;++h)a=n[h],s=u,l=c,f=d,u=a*4,c=t[2*a],d=t[2*a+1],r[s+2]=r[u]=f-d,r[s+3]=r[u+1]=c-l}render(t){const n=t==null?t=new Ya:void 0,{delaunay:{halfedges:i,inedges:r,hull:o},circumcenters:a,vectors:s}=this;if(o.length<=1)return null;for(let c=0,f=i.length;c<f;++c){const d=i[c];if(d<c)continue;const h=Math.floor(c/3)*2,g=Math.floor(d/3)*2,p=a[h],m=a[h+1],y=a[g],v=a[g+1];this._renderSegment(p,m,y,v,t)}let u,l=o[o.length-1];for(let c=0;c<o.length;++c){u=l,l=o[c];const f=Math.floor(r[l]/3)*2,d=a[f],h=a[f+1],g=u*4,p=this._project(d,h,s[g+2],s[g+3]);p&&this._renderSegment(d,h,p[0],p[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new Ya:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=n==null?n=new Ya:void 0,r=this._clip(t);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let o=r.length;for(;r[0]===r[o-2]&&r[1]===r[o-1]&&o>1;)o-=2;for(let a=2;a<o;a+=2)(r[a]!==r[a-2]||r[a+1]!==r[a-1])&&n.lineTo(r[a],r[a+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(t){const n=new mv;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,r,o){let a;const s=this._regioncode(t,n),u=this._regioncode(i,r);s===0&&u===0?(o.moveTo(t,n),o.lineTo(i,r)):(a=this._clipSegment(t,n,i,r,s,u))&&(o.moveTo(a[0],a[1]),o.lineTo(a[2],a[3]))}contains(t,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const r=this._clip(i);if(r){e:for(let o=0,a=n.length;o<a;o+=2)for(let s=0,u=r.length;s<u;s+=2)if(n[o]==r[s]&&n[o+1]==r[s+1]&&n[(o+2)%a]==r[(s+u-2)%u]&&n[(o+3)%a]==r[(s+u-1)%u]){yield i;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:o}}=this,a=i[t];if(a===-1)return null;const s=[];let u=a;do{const l=Math.floor(u/3);if(s.push(n[l*2],n[l*2+1]),u=u%3===2?u-2:u+1,o[u]!==t)break;u=r[u]}while(u!==a&&u!==-1);return s}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:i}=this,r=t*4;return i[r]||i[r+1]?this._clipInfinite(t,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(t,n)}_clipFinite(t,n){const i=n.length;let r=null,o,a,s=n[i-2],u=n[i-1],l,c=this._regioncode(s,u),f,d=0;for(let h=0;h<i;h+=2)if(o=s,a=u,s=n[h],u=n[h+1],l=c,c=this._regioncode(s,u),l===0&&c===0)f=d,d=0,r?r.push(s,u):r=[s,u];else{let g,p,m,y,v;if(l===0){if((g=this._clipSegment(o,a,s,u,l,c))===null)continue;[p,m,y,v]=g}else{if((g=this._clipSegment(s,u,o,a,c,l))===null)continue;[y,v,p,m]=g,f=d,d=this._edgecode(p,m),f&&d&&this._edge(t,f,d,r,r.length),r?r.push(p,m):r=[p,m]}f=d,d=this._edgecode(y,v),f&&d&&this._edge(t,f,d,r,r.length),r?r.push(y,v):r=[y,v]}if(r)f=d,d=this._edgecode(r[0],r[1]),f&&d&&this._edge(t,f,d,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,n,i,r,o,a){for(;;){if(o===0&&a===0)return[t,n,i,r];if(o&a)return null;let s,u,l=o||a;l&8?(s=t+(i-t)*(this.ymax-n)/(r-n),u=this.ymax):l&4?(s=t+(i-t)*(this.ymin-n)/(r-n),u=this.ymin):l&2?(u=n+(r-n)*(this.xmax-t)/(i-t),s=this.xmax):(u=n+(r-n)*(this.xmin-t)/(i-t),s=this.xmin),o?(t=s,n=u,o=this._regioncode(t,n)):(i=s,r=u,a=this._regioncode(i,r))}}_clipInfinite(t,n,i,r,o,a){let s=Array.from(n),u;if((u=this._project(s[0],s[1],i,r))&&s.unshift(u[0],u[1]),(u=this._project(s[s.length-2],s[s.length-1],o,a))&&s.push(u[0],u[1]),s=this._clipFinite(t,s))for(let l=0,c=s.length,f,d=this._edgecode(s[c-2],s[c-1]);l<c;l+=2)f=d,d=this._edgecode(s[l],s[l+1]),f&&d&&(l=this._edge(t,f,d,s,l),c=s.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(t,n,i,r,o){for(;n!==i;){let a,s;switch(n){case 5:n=4;continue;case 4:n=6,a=this.xmax,s=this.ymin;break;case 6:n=2;continue;case 2:n=10,a=this.xmax,s=this.ymax;break;case 10:n=8;continue;case 8:n=9,a=this.xmin,s=this.ymax;break;case 9:n=1;continue;case 1:n=5,a=this.xmin,s=this.ymin;break}(r[o]!==a||r[o+1]!==s)&&this.contains(t,a,s)&&(r.splice(o,0,a,s),o+=2)}if(r.length>4)for(let a=0;a<r.length;a+=2){const s=(a+2)%r.length,u=(a+4)%r.length;(r[a]===r[s]&&r[s]===r[u]||r[a+1]===r[s+1]&&r[s+1]===r[u+1])&&(r.splice(s,2),a-=2)}return o}_project(t,n,i,r){let o=1/0,a,s,u;if(r<0){if(n<=this.ymin)return null;(a=(this.ymin-n)/r)<o&&(u=this.ymin,s=t+(o=a)*i)}else if(r>0){if(n>=this.ymax)return null;(a=(this.ymax-n)/r)<o&&(u=this.ymax,s=t+(o=a)*i)}if(i>0){if(t>=this.xmax)return null;(a=(this.xmax-t)/i)<o&&(s=this.xmax,u=n+(o=a)*r)}else if(i<0){if(t<=this.xmin)return null;(a=(this.xmin-t)/i)<o&&(s=this.xmin,u=n+(o=a)*r)}return[s,u]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}}const EJ=2*Math.PI,Qs=Math.pow;function SJ(e){return e[0]}function OJ(e){return e[1]}function AJ(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],o=2*t[i+1],a=2*t[i+2];if((n[a]-n[r])*(n[o+1]-n[r+1])-(n[o]-n[r])*(n[a+1]-n[r+1])>1e-10)return!1}return!0}function kJ(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class Qw{static from(t,n=SJ,i=OJ,r){return new Qw("length"in t?CJ(t,n,i,r):Float64Array.from($J(t,n,i,r)))}constructor(t){this._delaunator=new Bg(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&AJ(t)){this.collinear=Int32Array.from({length:n.length/2},(d,h)=>h).sort((d,h)=>n[2*d]-n[2*h]||n[2*d+1]-n[2*h+1]);const u=this.collinear[0],l=this.collinear[this.collinear.length-1],c=[n[2*u],n[2*u+1],n[2*l],n[2*l+1]],f=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let d=0,h=n.length/2;d<h;++d){const g=kJ(n[2*d],n[2*d+1],f);n[2*d]=g[0],n[2*d+1]=g[1]}this._delaunator=new Bg(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),s=this._hullIndex.fill(-1);for(let u=0,l=i.length;u<l;++u){const c=o[u%3===2?u-2:u+1];(i[u]===-1||a[c]===-1)&&(a[c]=u)}for(let u=0,l=r.length;u<l;++u)s[r[u]]=u;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],a[r[0]]=1,r.length===2&&(a[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new _J(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:r,halfedges:o,triangles:a,collinear:s}=this;if(s){const f=s.indexOf(t);f>0&&(yield s[f-1]),f<s.length-1&&(yield s[f+1]);return}const u=n[t];if(u===-1)return;let l=u,c=-1;do{if(yield c=a[l],l=l%3===2?l-2:l+1,a[l]!==t)return;if(l=o[l],l===-1){const f=i[(r[t]+1)%i.length];f!==c&&(yield f);return}}while(l!==u)}find(t,n,i=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const r=i;let o;for(;(o=this._step(i,t,n))>=0&&o!==i&&o!==r;)i=o;return o}_step(t,n,i){const{inedges:r,hull:o,_hullIndex:a,halfedges:s,triangles:u,points:l}=this;if(r[t]===-1||!l.length)return(t+1)%(l.length>>1);let c=t,f=Qs(n-l[t*2],2)+Qs(i-l[t*2+1],2);const d=r[t];let h=d;do{let g=u[h];const p=Qs(n-l[g*2],2)+Qs(i-l[g*2+1],2);if(p<f&&(f=p,c=g),h=h%3===2?h-2:h+1,u[h]!==t)break;if(h=s[h],h===-1){if(h=o[(a[t]+1)%o.length],h!==g&&Qs(n-l[h*2],2)+Qs(i-l[h*2+1],2)<f)return h;break}}while(h!==d);return c}render(t){const n=t==null?t=new Ya:void 0,{points:i,halfedges:r,triangles:o}=this;for(let a=0,s=r.length;a<s;++a){const u=r[a];if(u<a)continue;const l=o[a]*2,c=o[u]*2;t.moveTo(i[l],i[l+1]),t.lineTo(i[c],i[c+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const i=t==null?t=new Ya:void 0,{points:r}=this;for(let o=0,a=r.length;o<a;o+=2){const s=r[o],u=r[o+1];t.moveTo(s+n,u),t.arc(s,u,n,0,EJ)}return i&&i.value()}renderHull(t){const n=t==null?t=new Ya:void 0,{hull:i,points:r}=this,o=i[0]*2,a=i.length;t.moveTo(r[o],r[o+1]);for(let s=1;s<a;++s){const u=2*i[s];t.lineTo(r[u],r[u+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new mv;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=n==null?n=new Ya:void 0,{points:r,triangles:o}=this,a=o[t*=3]*2,s=o[t+1]*2,u=o[t+2]*2;return n.moveTo(r[a],r[a+1]),n.lineTo(r[s],r[s+1]),n.lineTo(r[u],r[u+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new mv;return this.renderTriangle(t,n),n.value()}}function CJ(e,t,n,i){const r=e.length,o=new Float64Array(r*2);for(let a=0;a<r;++a){const s=e[a];o[a*2]=t.call(i,s,a,e),o[a*2+1]=n.call(i,s,a,e)}return o}function*$J(e,t,n,i){let r=0;for(const o of e)yield t.call(i,o,r,e),yield n.call(i,o,r,e),++r}function Zw(e){N.call(this,null,e)}Zw.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const FJ=[-1e5,-1e5,1e5,1e5];W(Zw,N,{transform(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:FJ;const o=this.value=Qw.from(i,e.x,e.y).voronoi(r);for(let a=0,s=i.length;a<s;++a){const u=o.cellPolygon(a);i[a][n]=u?TJ(u):null}return t.reflow(e.modified()).modifies(n)}});function TJ(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}var MJ=Object.freeze(Object.defineProperty({__proto__:null,voronoi:Zw},Symbol.toStringTag,{value:"Module"})),g1=Math.PI/180,Ec=1<<11>>5,_h=1<<11;function DJ(){var e=[256,256],t,n,i,r,o,a,s,u=Uj,l=[],c=Math.random,f={};f.layout=function(){for(var g=d(zo()),p=LJ((e[0]>>5)*e[1]),m=null,y=l.length,v=-1,b=[],x=l.map(E=>({text:t(E),font:n(E),style:r(E),weight:o(E),rotate:a(E),size:~~(i(E)+1e-14),padding:s(E),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:E})).sort((E,w)=>w.size-E.size);++v<y;){var _=x[v];_.x=e[0]*(c()+.5)>>1,_.y=e[1]*(c()+.5)>>1,NJ(g,_,x,v),_.hasText&&h(p,_,m)&&(b.push(_),m?RJ(m,_):m=[{x:_.x+_.x0,y:_.y+_.y0},{x:_.x+_.x1,y:_.y+_.y1}],_.x-=e[0]>>1,_.y-=e[1]>>1)}return b};function d(g){g.width=g.height=1;var p=Math.sqrt(g.getContext("2d").getImageData(0,0,1,1).data.length>>2);g.width=(Ec<<5)/p,g.height=_h/p;var m=g.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:p}}function h(g,p,m){for(var y=p.x,v=p.y,b=Math.sqrt(e[0]*e[0]+e[1]*e[1]),x=u(e),_=c()<.5?1:-1,E=-_,w,S,C;(w=x(E+=_))&&(S=~~w[0],C=~~w[1],!(Math.min(Math.abs(S),Math.abs(C))>=b));)if(p.x=y+S,p.y=v+C,!(p.x+p.x0<0||p.y+p.y0<0||p.x+p.x1>e[0]||p.y+p.y1>e[1])&&(!m||!jJ(p,g,e[0]))&&(!m||PJ(p,m))){for(var A=p.sprite,O=p.width>>5,F=e[0]>>5,k=p.x-(O<<4),M=k&127,$=32-M,T=p.y1-p.y0,D=(p.y+p.y0)*F+(k>>5),R,L=0;L<T;L++){R=0;for(var J=0;J<=O;J++)g[D+J]|=R<<$|(J<O?(R=A[L*O+J])>>>M:0);D+=F}return p.sprite=null,!0}return!1}return f.words=function(g){return arguments.length?(l=g,f):l},f.size=function(g){return arguments.length?(e=[+g[0],+g[1]],f):e},f.font=function(g){return arguments.length?(n=Oa(g),f):n},f.fontStyle=function(g){return arguments.length?(r=Oa(g),f):r},f.fontWeight=function(g){return arguments.length?(o=Oa(g),f):o},f.rotate=function(g){return arguments.length?(a=Oa(g),f):a},f.text=function(g){return arguments.length?(t=Oa(g),f):t},f.spiral=function(g){return arguments.length?(u=zJ[g]||g,f):u},f.fontSize=function(g){return arguments.length?(i=Oa(g),f):i},f.padding=function(g){return arguments.length?(s=Oa(g),f):s},f.random=function(g){return arguments.length?(c=g,f):c},f}function NJ(e,t,n,i){if(!t.sprite){var r=e.context,o=e.ratio;r.clearRect(0,0,(Ec<<5)/o,_h/o);var a=0,s=0,u=0,l=n.length,c,f,d,h,g;for(--i;++i<l;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/o)+"px "+t.font,c=r.measureText(t.text+"m").width*o,d=t.size<<1,t.rotate){var p=Math.sin(t.rotate*g1),m=Math.cos(t.rotate*g1),y=c*m,v=c*p,b=d*m,x=d*p;c=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,d=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else c=c+31>>5<<5;if(d>u&&(u=d),a+c>=Ec<<5&&(a=0,s+=u,u=0),s+d>=_h)break;r.translate((a+(c>>1))/o,(s+(d>>1))/o),t.rotate&&r.rotate(t.rotate*g1),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=c,t.height=d,t.xoff=a,t.yoff=s,t.x1=c>>1,t.y1=d>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,a+=c}for(var _=r.getImageData(0,0,(Ec<<5)/o,_h/o).data,E=[];--i>=0;)if(t=n[i],!!t.hasText){for(c=t.width,f=c>>5,d=t.y1-t.y0,h=0;h<d*f;h++)E[h]=0;if(a=t.xoff,a==null)return;s=t.yoff;var w=0,S=-1;for(g=0;g<d;g++){for(h=0;h<c;h++){var C=f*g+(h>>5),A=_[(s+g)*(Ec<<5)+(a+h)<<2]?1<<31-h%32:0;E[C]|=A,w|=A}w?S=g:(t.y0++,d--,g--,s++)}t.y1=t.y0+S,t.sprite=E.slice(0,(t.y1-t.y0)*f)}}}function jJ(e,t,n){n>>=5;for(var i=e.sprite,r=e.width>>5,o=e.x-(r<<4),a=o&127,s=32-a,u=e.y1-e.y0,l=(e.y+e.y0)*n+(o>>5),c,f=0;f<u;f++){c=0;for(var d=0;d<=r;d++)if((c<<s|(d<r?(c=i[f*r+d])>>>a:0))&t[l+d])return!0;l+=n}return!1}function RJ(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function PJ(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function Uj(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function IJ(e){var t=4,n=t*e[0]/e[1],i=0,r=0;return function(o){var a=o<0?-1:1;switch(Math.sqrt(1+4*a*o)-a&3){case 0:i+=n;break;case 1:r+=t;break;case 2:i-=n;break;default:r-=t;break}return[i,r]}}function LJ(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function Oa(e){return typeof e=="function"?e:function(){return e}}var zJ={archimedean:Uj,rectangular:IJ};const qj=["x","y","font","fontSize","fontStyle","fontWeight","angle"],BJ=["text","font","rotate","fontSize","fontStyle","fontWeight"];function e_(e){N.call(this,DJ(),e)}e_.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:qj}]};W(e_,N,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&P("Wordcloud size dimensions must be non-zero.");function n(g){const p=e[g];return fe(p)&&t.modified(p.fields)}const i=e.modified();if(!(i||t.changed(t.ADD_REM)||BJ.some(n)))return;const r=t.materialize(t.SOURCE).source,o=this.value,a=e.as||qj;let s=e.fontSize||14,u;if(fe(s)?u=e.fontSizeRange:s=Gt(s),u){const g=s,p=Ae("sqrt")().domain(lr(r,g)).range(u);s=m=>p(g(m))}r.forEach(g=>{g[a[0]]=NaN,g[a[1]]=NaN,g[a[3]]=0});const l=o.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(ii).layout(),c=o.size(),f=c[0]>>1,d=c[1]>>1,h=l.length;for(let g=0,p,m;g<h;++g)p=l[g],m=p.datum,m[a[0]]=p.x+f,m[a[1]]=p.y+d,m[a[2]]=p.font,m[a[3]]=p.size,m[a[4]]=p.style,m[a[5]]=p.weight,m[a[6]]=p.rotate;return t.reflow(i).modifies(a)}});var UJ=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:e_},Symbol.toStringTag,{value:"Module"}));const qJ=e=>new Uint8Array(e),WJ=e=>new Uint16Array(e),Pc=e=>new Uint32Array(e);function GJ(){let e=8,t=[],n=Pc(0),i=zd(0,e),r=zd(0,e);return{data:()=>t,seen:()=>n=HJ(n,t.length),add(o){for(let a=0,s=t.length,u=o.length,l;a<u;++a)l=o[a],l._index=s++,t.push(l)},remove(o,a){const s=t.length,u=Array(s-o),l=t;let c,f,d;for(f=0;!a[f]&&f<s;++f)u[f]=t[f],l[f]=f;for(d=f;f<s;++f)c=t[f],a[f]?l[f]=-1:(l[f]=d,i[d]=i[f],r[d]=r[f],u[d]=c,c._index=d++),i[f]=0;return t=u,l},size:()=>t.length,curr:()=>i,prev:()=>r,reset:o=>r[o]=i[o],all:()=>e<257?255:e<65537?65535:4294967295,set(o,a){i[o]|=a},clear(o,a){i[o]&=~a},resize(o,a){const s=i.length;(o>s||a>e)&&(e=Math.max(a,e),i=zd(o,e,i),r=zd(o,e))}}}function HJ(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function zd(e,t,n){const i=(t<257?qJ:t<65537?WJ:Pc)(e);return n&&i.set(n),i}function VA(e,t,n){const i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(r,o){const a=this,s=a.bisect(a.range,r.value),u=r.index,l=s[0],c=s[1],f=u.length;let d;for(d=0;d<l;++d)o[u[d]]|=i;for(d=c;d<f;++d)o[u[d]]|=i;return a}}}function KA(){let e=Pc(0),t=[],n=0;function i(s,u,l){if(!u.length)return[];const c=n,f=u.length,d=Pc(f);let h=Array(f),g,p,m;for(m=0;m<f;++m)h[m]=s(u[m]),d[m]=m;if(h=YJ(h,d),c)g=t,p=e,t=Array(c+f),e=Pc(c+f),XJ(l,g,p,c,h,d,f,t,e);else{if(l>0)for(m=0;m<f;++m)d[m]+=l;t=h,e=d}return n=c+f,{index:d,value:h}}function r(s,u){const l=n;let c,f,d;for(f=0;!u[e[f]]&&f<l;++f);for(d=f;f<l;++f)u[c=e[f]]||(e[d]=c,t[d]=t[f],++d);n=l-s}function o(s){for(let u=0,l=n;u<l;++u)e[u]=s[e[u]]}function a(s,u){let l;return u?l=u.length:(u=t,l=n),[f8(u,s[0],0,l),jh(u,s[1],0,l)]}return{insert:i,remove:r,bisect:a,reindex:o,index:()=>e,size:()=>n}}function YJ(e,t){return e.sort.call(t,(n,i)=>{const r=e[n],o=e[i];return r<o?-1:r>o?1:0}),g8(e,t)}function XJ(e,t,n,i,r,o,a,s,u){let l=0,c=0,f;for(f=0;l<i&&c<a;++f)t[l]<r[c]?(s[f]=t[l],u[f]=n[l++]):(s[f]=r[c],u[f]=o[c++]+e);for(;l<i;++l,++f)s[f]=t[l],u[f]=n[l];for(;c<a;++c,++f)s[f]=r[c],u[f]=o[c]+e}function t_(e){N.call(this,GJ(),e),this._indices=null,this._dims=null}t_.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};W(t_,N,{transform(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(i=>t.modified(i.fields));return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},init(e,t){const n=e.fields,i=e.query,r=this._indices={},o=this._dims=[],a=i.length;let s=0,u,l;for(;s<a;++s)u=n[s].fname,l=r[u]||(r[u]=KA()),o.push(VA(l,s,i[s]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),i=e.fields,r=e.query,o=this._indices,a=this._dims,s=this.value,u=s.curr(),l=s.prev(),c=s.all(),f=n.rem=n.add,d=n.mod,h=r.length,g={};let p,m,y,v,b,x,_,E,w;if(l.set(u),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(x={},v=t.mod,_=0,E=v.length;_<E;++_)x[v[_]._index]=1;for(_=0;_<h;++_)w=i[_],(!a[_]||e.modified("fields",_)||t.modified(w.fields))&&(y=w.fname,(p=g[y])||(o[y]=m=KA(),g[y]=p=m.insert(w,t.source,0)),a[_]=VA(m,_,r[_]).onAdd(p,u));for(_=0,E=s.data().length;_<E;++_)b[_]||(l[_]!==u[_]?f.push(_):x[_]&&u[_]!==c&&d.push(_));return s.mask=(1<<h)-1,n},eval(e,t){const n=t.materialize().fork(),i=this._dims.length;let r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},insert(e,t,n){const i=t.add,r=this.value,o=this._dims,a=this._indices,s=e.fields,u={},l=n.add,c=r.size()+i.length,f=o.length;let d=r.size(),h,g,p;r.resize(c,f),r.add(i);const m=r.curr(),y=r.prev(),v=r.all();for(h=0;h<f;++h)g=s[h].fname,p=u[g]||(u[g]=a[g].insert(s[h],i,d)),o[h].onAdd(p,m);for(;d<c;++d)y[d]=v,m[d]!==v&&l.push(d)},modify(e,t){const n=t.mod,i=this.value,r=i.curr(),o=i.all(),a=e.mod;let s,u,l;for(s=0,u=a.length;s<u;++s)l=a[s]._index,r[l]!==o&&n.push(l)},remove(e,t,n){const i=this._indices,r=this.value,o=r.curr(),a=r.prev(),s=r.all(),u={},l=n.rem,c=t.rem;let f,d,h,g;for(f=0,d=c.length;f<d;++f)h=c[f]._index,u[h]=1,a[h]=g=o[h],o[h]=s,g!==s&&l.push(h);for(h in i)i[h].remove(d,u);return this.reindex(t,d,u),u},reindex(e,t,n){const i=this._indices,r=this.value;e.runAfter(()=>{const o=r.remove(t,n);for(const a in i)i[a].reindex(o)})},update(e,t,n){const i=this._dims,r=e.query,o=t.stamp,a=i.length;let s=0,u,l;for(n.filters=0,l=0;l<a;++l)e.modified("query",l)&&(u=l,++s);if(s===1)s=i[u].one,this.incrementOne(i[u],r[u],n.add,n.rem);else for(l=0,s=0;l<a;++l)!e.modified("query",l)||(s|=i[l].one,this.incrementAll(i[l],r[l],o,n.add),n.rem=n.add);return s},incrementAll(e,t,n,i){const r=this.value,o=r.seen(),a=r.curr(),s=r.prev(),u=e.index(),l=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=l[0],g=l[1],p=e.one;let m,y,v;if(f<h)for(m=f,y=Math.min(h,d);m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,i.push(v)),a[v]^=p;else if(f>h)for(m=h,y=Math.min(f,g);m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,i.push(v)),a[v]^=p;if(d>g)for(m=Math.max(f,g),y=d;m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,i.push(v)),a[v]^=p;else if(d<g)for(m=Math.max(h,d),y=g;m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,i.push(v)),a[v]^=p;e.range=t.slice()},incrementOne(e,t,n,i){const r=this.value,o=r.curr(),a=e.index(),s=e.bisect(e.range),u=e.bisect(t),l=u[0],c=u[1],f=s[0],d=s[1],h=e.one;let g,p,m;if(l<f)for(g=l,p=Math.min(f,c);g<p;++g)m=a[g],o[m]^=h,n.push(m);else if(l>f)for(g=f,p=Math.min(l,d);g<p;++g)m=a[g],o[m]^=h,i.push(m);if(c>d)for(g=Math.max(l,d),p=c;g<p;++g)m=a[g],o[m]^=h,n.push(m);else if(c<d)for(g=Math.max(f,c),p=d;g<p;++g)m=a[g],o[m]^=h,i.push(m);e.range=t.slice()}});function n_(e){N.call(this,null,e)}n_.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};W(n_,N,{transform(e,t){const n=~(e.ignore||0),i=e.filter,r=i.mask;if((r&n)===0)return t.StopPropagation;const o=t.fork(t.ALL),a=i.data(),s=i.curr(),u=i.prev(),l=c=>s[c]&n?null:a[c];return o.filter(o.MOD,l),r&r-1?(o.filter(o.ADD,c=>{const f=s[c]&n;return!f&&f^u[c]&n?a[c]:null}),o.filter(o.REM,c=>{const f=s[c]&n;return f&&!(f^(f^u[c]&n))?a[c]:null})):(o.filter(o.ADD,l),o.filter(o.REM,c=>(s[c]&n)===r?a[c]:null)),o.filter(o.SOURCE,c=>l(c._index))}});var VJ=Object.freeze(Object.defineProperty({__proto__:null,crossfilter:t_,resolvefilter:n_},Symbol.toStringTag,{value:"Module"}));const KJ="RawCode",ms="Literal",JJ="Property",QJ="Identifier",ZJ="ArrayExpression",eQ="BinaryExpression",Wj="CallExpression",tQ="ConditionalExpression",nQ="LogicalExpression",iQ="MemberExpression",rQ="ObjectExpression",oQ="UnaryExpression";function Li(e){this.type=e}Li.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=aQ(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1};function aQ(e){switch(e.type){case ZJ:return e.elements;case eQ:case nQ:return[e.left,e.right];case Wj:return[e.callee].concat(e.arguments);case tQ:return[e.test,e.consequent,e.alternate];case iQ:return[e.object,e.property];case rQ:return e.properties;case JJ:return[e.key,e.value];case oQ:return[e.argument];case QJ:case ms:case KJ:default:return[]}}var Tr,Q,j,Ut,Te,w0=1,td=2,ys=3,wa=4,_0=5,Ps=6,fn=7,nd=8,sQ=9;Tr={};Tr[w0]="Boolean";Tr[td]="<end>";Tr[ys]="Identifier";Tr[wa]="Keyword";Tr[_0]="Null";Tr[Ps]="Numeric";Tr[fn]="Punctuator";Tr[nd]="String";Tr[sQ]="RegularExpression";var uQ="ArrayExpression",lQ="BinaryExpression",cQ="CallExpression",fQ="ConditionalExpression",Gj="Identifier",dQ="Literal",hQ="LogicalExpression",gQ="MemberExpression",pQ="ObjectExpression",mQ="Property",yQ="UnaryExpression",mt="Unexpected token %0",vQ="Unexpected number",bQ="Unexpected string",xQ="Unexpected identifier",wQ="Unexpected reserved word",_Q="Unexpected end of input",yv="Invalid regular expression",p1="Invalid regular expression: missing /",Hj="Octal literals are not allowed in strict mode.",EQ="Duplicate data property in object literal not allowed in strict mode",Ot="ILLEGAL",lf="Disabled.",SQ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),OQ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function E0(e,t){if(!e)throw new Error("ASSERT: "+t)}function zr(e){return e>=48&&e<=57}function i_(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Ic(e){return"01234567".indexOf(e)>=0}function AQ(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function cf(e){return e===10||e===13||e===8232||e===8233}function id(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&SQ.test(String.fromCharCode(e))}function Ug(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&OQ.test(String.fromCharCode(e))}const kQ={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Yj(){for(;j<Ut;){const e=Q.charCodeAt(j);if(AQ(e)||cf(e))++j;else break}}function vv(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)j<Ut&&i_(Q[j])?(i=Q[j++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):Se({},mt,Ot);return String.fromCharCode(r)}function CQ(){var e,t,n,i;for(e=Q[j],t=0,e==="}"&&Se({},mt,Ot);j<Ut&&(e=Q[j++],!!i_(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Se({},mt,Ot),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function Xj(){var e,t;for(e=Q.charCodeAt(j++),t=String.fromCharCode(e),e===92&&(Q.charCodeAt(j)!==117&&Se({},mt,Ot),++j,e=vv("u"),(!e||e==="\\"||!id(e.charCodeAt(0)))&&Se({},mt,Ot),t=e);j<Ut&&(e=Q.charCodeAt(j),!!Ug(e));)++j,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Q.charCodeAt(j)!==117&&Se({},mt,Ot),++j,e=vv("u"),(!e||e==="\\"||!Ug(e.charCodeAt(0)))&&Se({},mt,Ot),t+=e);return t}function $Q(){var e,t;for(e=j++;j<Ut;){if(t=Q.charCodeAt(j),t===92)return j=e,Xj();if(Ug(t))++j;else break}return Q.slice(e,j)}function FQ(){var e,t,n;return e=j,t=Q.charCodeAt(j)===92?Xj():$Q(),t.length===1?n=ys:kQ.hasOwnProperty(t)?n=wa:t==="null"?n=_0:t==="true"||t==="false"?n=w0:n=ys,{type:n,value:t,start:e,end:j}}function m1(){var e=j,t=Q.charCodeAt(j),n,i=Q[j],r,o,a;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++j,{type:fn,value:String.fromCharCode(t),start:e,end:j};default:if(n=Q.charCodeAt(j+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return j+=2,{type:fn,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:j};case 33:case 61:return j+=2,Q.charCodeAt(j)===61&&++j,{type:fn,value:Q.slice(e,j),start:e,end:j}}}if(a=Q.substr(j,4),a===">>>=")return j+=4,{type:fn,value:a,start:e,end:j};if(o=a.substr(0,3),o===">>>"||o==="<<="||o===">>=")return j+=3,{type:fn,value:o,start:e,end:j};if(r=o.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return j+=2,{type:fn,value:r,start:e,end:j};if(r==="//"&&Se({},mt,Ot),"<>=!+-*%&|^/".indexOf(i)>=0)return++j,{type:fn,value:i,start:e,end:j};Se({},mt,Ot)}function TQ(e){let t="";for(;j<Ut&&i_(Q[j]);)t+=Q[j++];return t.length===0&&Se({},mt,Ot),id(Q.charCodeAt(j))&&Se({},mt,Ot),{type:Ps,value:parseInt("0x"+t,16),start:e,end:j}}function MQ(e){let t="0"+Q[j++];for(;j<Ut&&Ic(Q[j]);)t+=Q[j++];return(id(Q.charCodeAt(j))||zr(Q.charCodeAt(j)))&&Se({},mt,Ot),{type:Ps,value:parseInt(t,8),octal:!0,start:e,end:j}}function JA(){var e,t,n;if(n=Q[j],E0(zr(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=j,e="",n!=="."){if(e=Q[j++],n=Q[j],e==="0"){if(n==="x"||n==="X")return++j,TQ(t);if(Ic(n))return MQ(t);n&&zr(n.charCodeAt(0))&&Se({},mt,Ot)}for(;zr(Q.charCodeAt(j));)e+=Q[j++];n=Q[j]}if(n==="."){for(e+=Q[j++];zr(Q.charCodeAt(j));)e+=Q[j++];n=Q[j]}if(n==="e"||n==="E")if(e+=Q[j++],n=Q[j],(n==="+"||n==="-")&&(e+=Q[j++]),zr(Q.charCodeAt(j)))for(;zr(Q.charCodeAt(j));)e+=Q[j++];else Se({},mt,Ot);return id(Q.charCodeAt(j))&&Se({},mt,Ot),{type:Ps,value:parseFloat(e),start:t,end:j}}function DQ(){var e="",t,n,i,r,o=!1;for(t=Q[j],E0(t==="'"||t==='"',"String literal must starts with a quote"),n=j,++j;j<Ut;)if(i=Q[j++],i===t){t="";break}else if(i==="\\")if(i=Q[j++],!i||!cf(i.charCodeAt(0)))switch(i){case"u":case"x":Q[j]==="{"?(++j,e+=CQ()):e+=vv(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Ic(i)?(r="01234567".indexOf(i),r!==0&&(o=!0),j<Ut&&Ic(Q[j])&&(o=!0,r=r*8+"01234567".indexOf(Q[j++]),"0123".indexOf(i)>=0&&j<Ut&&Ic(Q[j])&&(r=r*8+"01234567".indexOf(Q[j++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&Q[j]===`
`&&++j;else{if(cf(i.charCodeAt(0)))break;e+=i}return t!==""&&Se({},mt,Ot),{type:nd,value:e,octal:o,start:n,end:j}}function NQ(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,r)=>{if(parseInt(r,16)<=1114111)return"x";Se({},yv)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{Se({},yv)}try{return new RegExp(e,t)}catch{return null}}function jQ(){var e,t,n,i,r;for(e=Q[j],E0(e==="/","Regular expression literal must start with a slash"),t=Q[j++],n=!1,i=!1;j<Ut;)if(e=Q[j++],t+=e,e==="\\")e=Q[j++],cf(e.charCodeAt(0))&&Se({},p1),t+=e;else if(cf(e.charCodeAt(0)))Se({},p1);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||Se({},p1),r=t.substr(1,t.length-2),{value:r,literal:t}}function RQ(){var e,t,n;for(t="",n="";j<Ut&&(e=Q[j],!!Ug(e.charCodeAt(0)));)++j,e==="\\"&&j<Ut?Se({},mt,Ot):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Se({},yv,n),{value:n,literal:t}}function PQ(){var e,t,n,i;return Te=null,Yj(),e=j,t=jQ(),n=RQ(),i=NQ(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:j}}function IQ(e){return e.type===ys||e.type===wa||e.type===w0||e.type===_0}function Vj(){if(Yj(),j>=Ut)return{type:td,start:j,end:j};const e=Q.charCodeAt(j);return id(e)?FQ():e===40||e===41||e===59?m1():e===39||e===34?DQ():e===46?zr(Q.charCodeAt(j+1))?JA():m1():zr(e)?JA():m1()}function pn(){const e=Te;return j=e.end,Te=Vj(),j=e.end,e}function Kj(){const e=j;Te=Vj(),j=e}function LQ(e){const t=new Li(uQ);return t.elements=e,t}function QA(e,t,n){const i=new Li(e==="||"||e==="&&"?hQ:lQ);return i.operator=e,i.left=t,i.right=n,i}function zQ(e,t){const n=new Li(cQ);return n.callee=e,n.arguments=t,n}function BQ(e,t,n){const i=new Li(fQ);return i.test=e,i.consequent=t,i.alternate=n,i}function r_(e){const t=new Li(Gj);return t.name=e,t}function Sc(e){const t=new Li(dQ);return t.value=e.value,t.raw=Q.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function ZA(e,t,n){const i=new Li(gQ);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function UQ(e){const t=new Li(pQ);return t.properties=e,t}function ek(e,t,n){const i=new Li(mQ);return i.key=t,i.value=n,i.kind=e,i}function qQ(e,t){const n=new Li(yQ);return n.operator=e,n.argument=t,n.prefix=!0,n}function Se(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(o,a)=>(E0(a<i.length,"Message reference must be in range"),i[a]));throw n=new Error(r),n.index=j,n.description=r,n}function S0(e){e.type===td&&Se(e,_Q),e.type===Ps&&Se(e,vQ),e.type===nd&&Se(e,bQ),e.type===ys&&Se(e,xQ),e.type===wa&&Se(e,wQ),Se(e,mt,e.value)}function qt(e){const t=pn();(t.type!==fn||t.value!==e)&&S0(t)}function Be(e){return Te.type===fn&&Te.value===e}function y1(e){return Te.type===wa&&Te.value===e}function WQ(){const e=[];for(j=Te.start,qt("[");!Be("]");)Be(",")?(pn(),e.push(null)):(e.push(vs()),Be("]")||qt(","));return pn(),LQ(e)}function tk(){j=Te.start;const e=pn();return e.type===nd||e.type===Ps?(e.octal&&Se(e,Hj),Sc(e)):r_(e.value)}function GQ(){var e,t,n,i;if(j=Te.start,e=Te,e.type===ys)return n=tk(),qt(":"),i=vs(),ek("init",n,i);if(e.type===td||e.type===fn)S0(e);else return t=tk(),qt(":"),i=vs(),ek("init",t,i)}function HQ(){var e=[],t,n,i,r={},o=String;for(j=Te.start,qt("{");!Be("}");)t=GQ(),t.key.type===Gj?n=t.key.name:n=o(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?Se({},EQ):r[i]=!0,e.push(t),Be("}")||qt(",");return qt("}"),UQ(e)}function YQ(){qt("(");const e=o_();return qt(")"),e}const XQ={if:1};function VQ(){var e,t,n;if(Be("("))return YQ();if(Be("["))return WQ();if(Be("{"))return HQ();if(e=Te.type,j=Te.start,e===ys||XQ[Te.value])n=r_(pn().value);else if(e===nd||e===Ps)Te.octal&&Se(Te,Hj),n=Sc(pn());else{if(e===wa)throw new Error(lf);e===w0?(t=pn(),t.value=t.value==="true",n=Sc(t)):e===_0?(t=pn(),t.value=null,n=Sc(t)):Be("/")||Be("/=")?(n=Sc(PQ()),Kj()):S0(pn())}return n}function KQ(){const e=[];if(qt("("),!Be(")"))for(;j<Ut&&(e.push(vs()),!Be(")"));)qt(",");return qt(")"),e}function JQ(){j=Te.start;const e=pn();return IQ(e)||S0(e),r_(e.value)}function QQ(){return qt("."),JQ()}function ZQ(){qt("[");const e=o_();return qt("]"),e}function eZ(){var e,t,n;for(e=VQ();;)if(Be("."))n=QQ(),e=ZA(".",e,n);else if(Be("("))t=KQ(),e=zQ(e,t);else if(Be("["))n=ZQ(),e=ZA("[",e,n);else break;return e}function nk(){const e=eZ();if(Te.type===fn&&(Be("++")||Be("--")))throw new Error(lf);return e}function Eh(){var e,t;if(Te.type!==fn&&Te.type!==wa)t=nk();else{if(Be("++")||Be("--"))throw new Error(lf);if(Be("+")||Be("-")||Be("~")||Be("!"))e=pn(),t=Eh(),t=qQ(e.value,t);else{if(y1("delete")||y1("void")||y1("typeof"))throw new Error(lf);t=nk()}}return t}function ik(e){let t=0;if(e.type!==fn&&e.type!==wa)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function tZ(){var e,t,n,i,r,o,a,s,u,l;if(e=Te,u=Eh(),i=Te,r=ik(i),r===0)return u;for(i.prec=r,pn(),t=[e,Te],a=Eh(),o=[u,i,a];(r=ik(Te))>0;){for(;o.length>2&&r<=o[o.length-2].prec;)a=o.pop(),s=o.pop().value,u=o.pop(),t.pop(),n=QA(s,u,a),o.push(n);i=pn(),i.prec=r,o.push(i),t.push(Te),n=Eh(),o.push(n)}for(l=o.length-1,n=o[l],t.pop();l>1;)t.pop(),n=QA(o[l-1].value,o[l-2],n),l-=2;return n}function vs(){var e,t,n;return e=tZ(),Be("?")&&(pn(),t=vs(),qt(":"),n=vs(),e=BQ(e,t,n)),e}function o_(){const e=vs();if(Be(","))throw new Error(lf);return e}function a_(e){Q=e,j=0,Ut=Q.length,Te=null,Kj();const t=o_();if(Te.type!==td)throw new Error("Unexpect token after expression.");return t}var Jj={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Qj(e){function t(a,s,u,l){let c=e(s[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+a+(l<0?"":l===0?"()":"("+s.slice(1).map(e).join(",")+")")}function n(a,s,u){return l=>t(a,l,s,u)}const i="new Date",r="String",o="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(a){a.length<3&&P("Missing arguments to clamp function."),a.length>3&&P("Too many arguments to clamp function.");const s=a.map(e);return"Math.max("+s[1]+", Math.min("+s[2]+","+s[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),trim:n("trim",r,0),regexp:o,test:n("test",o),if:function(a){a.length<3&&P("Missing arguments to if function."),a.length>3&&P("Too many arguments to if function.");const s=a.map(e);return"("+s[0]+"?"+s[1]+":"+s[2]+")"}}}function nZ(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function Zj(e){e=e||{};const t=e.allowed?Mi(e.allowed):{},n=e.forbidden?Mi(e.forbidden):{},i=e.constants||Jj,r=(e.functions||Qj)(f),o=e.globalvar,a=e.fieldvar,s=fe(o)?o:g=>`${o}["${g}"]`;let u={},l={},c=0;function f(g){if(Y(g))return g;const p=d[g.type];return p==null&&P("Unsupported type: "+g.type),p(g)}const d={Literal:g=>g.raw,Identifier:g=>{const p=g.name;return c>0?p:ee(n,p)?P("Illegal identifier: "+p):ee(i,p)?i[p]:ee(t,p)?p:(u[p]=1,s(p))},MemberExpression:g=>{const p=!g.computed,m=f(g.object);p&&(c+=1);const y=f(g.property);return m===a&&(l[nZ(y)]=1),p&&(c-=1),m+(p?"."+y:"["+y+"]")},CallExpression:g=>{g.callee.type!=="Identifier"&&P("Illegal callee type: "+g.callee.type);const p=g.callee.name,m=g.arguments,y=ee(r,p)&&r[p];return y||P("Unrecognized function: "+p),fe(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:g=>"["+g.elements.map(f).join(",")+"]",BinaryExpression:g=>"("+f(g.left)+" "+g.operator+" "+f(g.right)+")",UnaryExpression:g=>"("+g.operator+f(g.argument)+")",ConditionalExpression:g=>"("+f(g.test)+"?"+f(g.consequent)+":"+f(g.alternate)+")",LogicalExpression:g=>"("+f(g.left)+g.operator+f(g.right)+")",ObjectExpression:g=>"{"+g.properties.map(f).join(",")+"}",Property:g=>{c+=1;const p=f(g.key);return c-=1,p+":"+f(g.value)}};function h(g){const p={code:f(g),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},p}return h.functions=r,h.constants=i,h}function rk(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function iZ(e){let t=e,n=e,i=e;e.length!==2&&(t=(s,u)=>e(s)-u,n=rk,i=(s,u)=>rk(e(s),u));function r(s,u,l=0,c=s.length){if(l<c){if(n(u,u)!==0)return c;do{const f=l+c>>>1;i(s[f],u)<0?l=f+1:c=f}while(l<c)}return l}function o(s,u,l=0,c=s.length){if(l<c){if(n(u,u)!==0)return c;do{const f=l+c>>>1;i(s[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function a(s,u,l=0,c=s.length){const f=r(s,u,l,c-1);return f>l&&t(s[f-1],u)>-t(s[f],u)?f-1:f}return{left:r,center:a,right:o}}function rZ(e,...t){e=new Rh(e),t=t.map(oZ);e:for(const n of e)for(const i of t)if(!i.has(n)){e.delete(n);continue e}return e}function oZ(e){return e instanceof Rh?e:new Rh(e)}function aZ(...e){const t=new Rh;for(const n of e)for(const i of n)t.add(i);return t}const s_="intersect",ok="union",sZ="vlMulti",uZ="vlPoint",ak="or",lZ="and",Xi="_vgsid_",ff=wn(Xi),cZ="E",fZ="R",dZ="R-E",hZ="R-LE",gZ="R-RE",qg="index:unit";function sk(e,t){for(var n=t.fields,i=t.values,r=n.length,o=0,a,s;o<r;++o)if(s=n[o],s.getter=wn.getter||wn(s.field),a=s.getter(e),Po(a)&&(a=Rt(a)),Po(i[o])&&(i[o]=Rt(i[o])),Po(i[o][0])&&(i[o]=i[o].map(Rt)),s.type===cZ){if(I(i[o])?i[o].indexOf(a)<0:a!==i[o])return!1}else if(s.type===fZ){if(!su(a,i[o]))return!1}else if(s.type===gZ){if(!su(a,i[o],!0,!1))return!1}else if(s.type===dZ){if(!su(a,i[o],!1,!1))return!1}else if(s.type===hZ&&!su(a,i[o],!1,!0))return!1;return!0}function pZ(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],o=i?i[qg]&&i[qg].value:void 0,a=n===s_,s=r.length,u=0,l,c,f,d,h;u<s;++u)if(l=r[u],o&&a){if(c=c||{},f=c[d=l.unit]||0,f===-1)continue;if(h=sk(t,l),c[d]=h?-1:++f,h&&o.size===1)return!0;if(!h&&f===o.get(d).count)return!1}else if(h=sk(t,l),a^h)return h;return s&&a}const eR=iZ(ff),mZ=eR.left,yZ=eR.right;function vZ(e,t,n){const i=this.context.data[e],r=i?i.values.value:[],o=i?i[qg]&&i[qg].value:void 0,a=n===s_,s=ff(t),u=mZ(r,s);if(u===r.length||ff(r[u])!==s)return!1;if(o&&a){if(o.size===1)return!0;if(yZ(r,s)-u<o.size)return!1}return!0}function bZ(e,t){return e.map(n=>ce(t.fields?{values:t.fields.map(i=>(i.getter||(i.getter=wn(i.field)))(n.datum))}:{[Xi]:ff(n.datum)},t))}function xZ(e,t,n,i){for(var r=this.context.data[e],o=r?r.values.value:[],a={},s={},u={},l,c,f,d,h,g,p,m,y,v,b=o.length,x=0,_,E;x<b;++x)if(l=o[x],d=l.unit,c=l.fields,f=l.values,c&&f){for(_=0,E=c.length;_<E;++_)h=c[_],p=a[h.field]||(a[h.field]={}),m=p[d]||(p[d]=[]),u[h.field]=y=h.type.charAt(0),v=v1["".concat(y,"_union")],p[d]=v(m,V(f[_]));n&&(m=s[d]||(s[d]=[]),m.push(V(f).reduce((w,S,C)=>(w[c[C].field]=S,w),{})))}else h=Xi,g=ff(l),p=a[h]||(a[h]={}),m=p[d]||(p[d]=[]),m.push(g),n&&(m=s[d]||(s[d]=[]),m.push({[Xi]:g}));if(t=t||ok,a[Xi]?a[Xi]=v1["".concat(Xi,"_").concat(t)](...Object.values(a[Xi])):Object.keys(a).forEach(w=>{a[w]=Object.keys(a[w]).map(S=>a[w][S]).reduce((S,C)=>S===void 0?C:v1["".concat(u[w],"_").concat(t)](S,C))}),o=Object.keys(s),n&&o.length){const w=i?uZ:sZ;a[w]=t===ok?{[ak]:o.reduce((S,C)=>(S.push(...s[C]),S),[])}:{[lZ]:o.map(S=>({[ak]:s[S]}))}}return a}var v1={["".concat(Xi,"_union")]:aZ,["".concat(Xi,"_intersect")]:rZ,E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Rt(t[0]),i=Rt(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=Rt(t[0]),i=Rt(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const wZ=":",_Z="@";function u_(e,t,n,i){t[0].type!==ms&&P("First argument to selection functions must be a string literal.");const r=t[0].value,o=t.length>=2&&ve(t).value,a="unit",s=_Z+a,u=wZ+r;o===s_&&!ee(i,s)&&(i[s]=n.getData(r).indataRef(n,a)),ee(i,u)||(i[u]=n.getData(r).tuplesRef())}function tR(e){const t=this.context.data[e];return t?t.values.value:[]}function EZ(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r&&r.count}function SZ(e,t){const n=this.context.dataflow,i=this.context.data[e],r=i.input;return n.pulse(r,n.changeset().remove(Zn).insert(t)),1}function OZ(e,t,n){if(e){const i=this.context.dataflow,r=e.mark.source;i.pulse(r,i.changeset().encode(e,t))}return n!==void 0?n:e}const rd=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},AZ=rd("format"),nR=rd("timeFormat"),kZ=rd("utcFormat"),CZ=rd("timeParse"),$Z=rd("utcParse"),Bd=new Date(2e3,0,1);function O0(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(Bd.setYear(2e3),Bd.setMonth(e),Bd.setDate(t),nR.call(this,Bd,n))}function FZ(e){return O0.call(this,e,1,"%B")}function TZ(e){return O0.call(this,e,1,"%b")}function MZ(e){return O0.call(this,0,2+e,"%A")}function DZ(e){return O0.call(this,0,2+e,"%a")}const NZ=":",jZ="@",bv="%",iR="$";function l_(e,t,n,i){t[0].type!==ms&&P("First argument to data functions must be a string literal.");const r=t[0].value,o=NZ+r;if(!ee(o,i))try{i[o]=n.getData(r).tuplesRef()}catch{}}function RZ(e,t,n,i){t[0].type!==ms&&P("First argument to indata must be a string literal."),t[1].type!==ms&&P("Second argument to indata must be a string literal.");const r=t[0].value,o=t[1].value,a=jZ+o;ee(a,i)||(i[a]=n.getData(r).indataRef(n,o))}function vn(e,t,n,i){if(t[0].type===ms)uk(n,i,t[0].value);else for(e in n.scales)uk(n,i,e)}function uk(e,t,n){const i=bv+n;if(!ee(t,i))try{t[i]=e.scaleRef(n)}catch{}}function ho(e,t){let n;return fe(e)?e:Y(e)?(n=t.scales[e])&&n.value:void 0}function PZ(e,t,n){t.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=vn,n._range=vn,n._scale=vn;const i=r=>"_["+(r.type===ms?G(bv+r.value):G(bv)+"+"+e(r))+"]";return{_bandwidth:r=>"this.__bandwidth(".concat(i(r[0]),")"),_range:r=>"".concat(i(r[0]),".range()"),_scale:r=>"".concat(i(r[0]),"(").concat(e(r[1]),")")}}function c_(e,t){return function(n,i,r){if(n){const o=ho(n,(r||this).context);return o&&o.path[e](i)}else return t(i)}}const IZ=c_("area",rY),LZ=c_("bounds",uY),zZ=c_("centroid",gY);function BZ(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function f_(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function UZ(){return f_(this.context.dataflow,"warn",arguments)}function qZ(){return f_(this.context.dataflow,"info",arguments)}function WZ(){return f_(this.context.dataflow,"debug",arguments)}function b1(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function xv(e){const t=Ko(e),n=b1(t.r),i=b1(t.g),r=b1(t.b);return .2126*n+.7152*i+.0722*r}function GZ(e,t){const n=xv(e),i=xv(t),r=Math.max(n,i),o=Math.min(n,i);return(r+.05)/(o+.05)}function HZ(){const e=[].slice.call(arguments);return e.unshift({}),ce(...e)}function rR(e,t){return e===t||e!==e&&t!==t?!0:I(e)?I(t)&&e.length===t.length?YZ(e,t):!1:K(e)&&K(t)?oR(e,t):!1}function YZ(e,t){for(let n=0,i=e.length;n<i;++n)if(!rR(e[n],t[n]))return!1;return!0}function oR(e,t){for(const n in e)if(!rR(e[n],t[n]))return!1;return!0}function lk(e){return t=>oR(e,t)}function XZ(e,t,n,i,r,o){const a=this.context.dataflow,s=this.context.data[e],u=s.input,l=a.stamp();let c=s.changes,f,d;if(a._trigger===!1||!(u.value.length||t||i))return 0;if((!c||c.stamp<l)&&(s.changes=c=a.changeset(),c.stamp=l,a.runAfter(()=>{s.modified=!0,a.pulse(u,c).run()},!0,1)),n&&(f=n===!0?Zn:I(n)||Np(n)?n:lk(n),c.remove(f)),t&&c.insert(t),i&&(f=lk(i),u.value.some(f)?c.remove(f):c.insert(i)),r)for(d in o)c.modify(r,d,o[d]);return 1}function VZ(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+i*i)}function KZ(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const ck={};function JZ(e,t){const n=ck[t]||(ck[t]=wn(t));return I(e)?e.map(n):n(e)}function d_(e){return I(e)||ArrayBuffer.isView(e)?e:null}function h_(e){return d_(e)||(Y(e)?e:null)}function QZ(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return d_(e).join(...n)}function ZZ(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return h_(e).indexOf(...n)}function eee(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return h_(e).lastIndexOf(...n)}function tee(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return h_(e).slice(...n)}function nee(e,t,n){return fe(n)&&P("Function argument passed to replace."),String(e).replace(t,n)}function iee(e){return d_(e).slice().reverse()}function ree(e,t,n){return _2(e||0,t||0,n||0)}function oee(e,t){const n=ho(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function aee(e,t){const n=ho(e,(t||this).context);return n?n.copy():void 0}function see(e,t){const n=ho(e,(t||this).context);return n?n.domain():[]}function uee(e,t,n){const i=ho(e,(n||this).context);return i?I(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}function lee(e,t){const n=ho(e,(t||this).context);return n&&n.range?n.range():[]}function cee(e,t,n){const i=ho(e,(n||this).context);return i?i(t):void 0}function fee(e,t,n,i,r){e=ho(e,(r||this).context);const o=oD(t,n);let a=e.domain(),s=a[0],u=ve(a),l=Wt;return u-s?l=Y3(e,s,u):e=(e.interpolator?Ae("sequential")().interpolator(e.interpolator()):Ae("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,u=1]),e.ticks&&(a=e.ticks(+i||15),s!==a[0]&&a.unshift(s),u!==ve(a)&&a.push(u)),a.forEach(c=>o.stop(l(c),e(c))),o}function dee(e,t,n){const i=ho(e,(n||this).context);return function(r){return i?i.path.context(r)(t):""}}function hee(e){let t=null;return function(n){return n?ef(n,t=t||Lu(e)):e}}const aR=e=>e.data;function sR(e,t){const n=tR.call(t,e);return n.root&&n.root.lookup||{}}function gee(e,t,n){const i=sR(e,this),r=i[t],o=i[n];return r&&o?r.path(o).map(aR):void 0}function pee(e,t){const n=sR(e,this)[t];return n?n.ancestors().map(aR):void 0}const uR=()=>typeof window!="undefined"&&window||null;function mee(){const e=uR();return e?e.screen:{}}function yee(){const e=uR();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function vee(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}function lR(e,t,n){if(!e)return[];const[i,r]=e,o=new it().set(i[0],i[1],r[0],r[1]),a=n||this.context.dataflow.scenegraph().root;return VD(a,o,bee(t))}function bee(e){let t=null;if(e){const n=V(e.marktype),i=V(e.markname);t=r=>(!n.length||n.some(o=>r.marktype===o))&&(!i.length||i.some(o=>r.name===o))}return t}function xee(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5;const r=e[e.length-1];return r===void 0||Math.sqrt((r[0]-t)**2+(r[1]-n)**2)>i?(e.push([t,n]),[...e]):e}function wee(e){return(e!=null?e:[]).reduce((t,n,i)=>{let[r,o]=n;return t+=i==0?"M ".concat(r,",").concat(o," "):i===e.length-1?" Z":"L ".concat(r,",").concat(o," ")},"")}function _ee(e,t,n){const{x:i,y:r,mark:o}=n,a=new it().set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[u,l]of t)u<a.x1&&(a.x1=u),u>a.x2&&(a.x2=u),l<a.y1&&(a.y1=l),l>a.y2&&(a.y2=l);return a.translate(i,r),lR([[a.x1,a.y1],[a.x2,a.y2]],e,o).filter(u=>Eee(u.x,u.y,t))}function Eee(e,t,n){let i=0;for(let r=0,o=n.length-1;r<n.length;o=r++){const[a,s]=n[o],[u,l]=n[r];l>t!=s>t&&e<(a-u)*(t-l)/(s-l)+u&&i++}return i&1}const df={random(){return ii()},cumulativeNormal:Lp,cumulativeLogNormal:Ex,cumulativeUniform:kx,densityNormal:vx,densityLogNormal:_x,densityUniform:Ax,quantileNormal:zp,quantileLogNormal:Sx,quantileUniform:Cx,sampleNormal:Ip,sampleLogNormal:wx,sampleUniform:Ox,isArray:I,isBoolean:ua,isDate:Po,isDefined(e){return e!==void 0},isNumber:De,isObject:K,isRegExp:I$,isString:Y,isTuple:Np,isValid(e){return e!=null&&e===e},toBoolean:xb,toDate(e){return wb(e)},toNumber:Rt,toString:_b,indexof:ZZ,join:QZ,lastindexof:eee,replace:nee,reverse:iee,slice:tee,flush:R$,lerp:L$,merge:HZ,pad:U$,peek:ve,pluck:JZ,span:Sf,inrange:su,truncate:q$,rgb:Ko,lab:Kh,hcl:Jh,hsl:Xh,luminance:xv,contrast:GZ,sequence:jn,format:AZ,utcFormat:kZ,utcParse:$Z,utcOffset:dT,utcSequence:pT,timeFormat:nR,timeParse:CZ,timeOffset:fT,timeSequence:gT,timeUnitSpecifier:eT,monthFormat:FZ,monthAbbrevFormat:TZ,dayFormat:MZ,dayAbbrevFormat:DZ,quarter:M$,utcquarter:D$,week:nT,utcweek:oT,dayofyear:tT,utcdayofyear:rT,warn:UZ,info:qZ,debug:WZ,extent(e){return lr(e)},inScope:BZ,intersect:lR,clampRange:N$,pinchDistance:VZ,pinchAngle:KZ,screen:mee,containerSize:vee,windowSize:yee,bandspace:ree,setdata:SZ,pathShape:hee,panLinear:C$,panLog:$$,panPow:F$,panSymlog:T$,zoomLinear:gb,zoomLog:pb,zoomPow:Th,zoomSymlog:mb,encode:OZ,modify:XZ,lassoAppend:xee,lassoPath:wee,intersectLasso:_ee},See=["view","item","group","xy","x","y"],Oee="event.vega.",cR="this.",g_={},fR={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_[".concat(G(iR+e),"]"),functions:Aee,constants:Jj,visitors:g_},wv=Zj(fR);function Aee(e){const t=Qj(e);See.forEach(n=>t[n]=Oee+n);for(const n in df)t[n]=cR+n;return ce(t,PZ(e,df,g_)),t}function rt(e,t,n){return arguments.length===1?df[e]:(df[e]=t,n&&(g_[e]=n),wv&&(wv.functions[e]=cR+e),this)}rt("bandwidth",oee,vn);rt("copy",aee,vn);rt("domain",see,vn);rt("range",lee,vn);rt("invert",uee,vn);rt("scale",cee,vn);rt("gradient",fee,vn);rt("geoArea",IZ,vn);rt("geoBounds",LZ,vn);rt("geoCentroid",zZ,vn);rt("geoShape",dee,vn);rt("indata",EZ,RZ);rt("data",tR,l_);rt("treePath",gee,l_);rt("treeAncestors",pee,l_);rt("vlSelectionTest",pZ,u_);rt("vlSelectionIdTest",vZ,u_);rt("vlSelectionResolve",xZ,u_);rt("vlSelectionTuples",bZ);function gr(e,t){const n={};let i;try{e=Y(e)?e:G(e)+"",i=a_(e)}catch{P("Expression parse error: "+e)}i.visit(o=>{if(o.type!==Wj)return;const a=o.callee.name,s=fR.visitors[a];s&&s(a,o.arguments,t,n)});const r=wv(i);return r.globals.forEach(o=>{const a=iR+o;!ee(n,a)&&t.getSignal(o)&&(n[a]=t.signalRef(o))}),{$expr:ce({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function kee(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()}const Cee=Mi(["rule"]),fk=Mi(["group","image","rect"]);function $ee(e,t){let n="";return Cee[t]||(e.x2&&(e.x?(fk[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(fk[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function p_(e){return(e+"").toLowerCase()}function Fee(e){return p_(e)==="operator"}function Tee(e){return p_(e)==="collect"}function Yl(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");const i=Function(...t.concat(n));return e&&e.functions?i.bind(e.functions):i}function Mee(e,t,n,i){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,`
  : (u > v || v == null) && u != null ? `).concat(i,`
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? `).concat(n,`
  : v !== v && u === u ? `).concat(i," : ")}var Dee={operator:(e,t)=>Yl(e,["_"],t.code),parameter:(e,t)=>Yl(e,["datum","_"],t.code),event:(e,t)=>Yl(e,["event"],t.code),handler:(e,t)=>{const n="var datum=event.item&&event.item.datum;return ".concat(t.code,";");return Yl(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const o in i){const a="o["+G(o)+"]";r+="$=".concat(i[o].code,";if(").concat(a,"!==$)").concat(a,"=$,m=1;")}return r+=$ee(i,n),r+="return m;",Yl(e,["item","_"],r)},codegen:{get(e){const t="[".concat(e.map(G).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const i=(o,a)=>{const s=t[a];let u,l;return o.path?(u="a".concat(o.path),l="b".concat(o.path)):((n=n||{})["f"+a]=o,u="this.f".concat(a,"(a)"),l="this.f".concat(a,"(b)")),Mee(u,l,-s,s)},r=Function("a","b","var u, v; return "+e.map(i).join("")+"0;");return n?r.bind(n):r}}};function Nee(e){const t=this;Fee(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function jee(e){const t=this;if(e.params){const n=t.get(e.id);n||P("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function Ree(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=I(r)?r.map(o=>dk(o,n,t)):dk(r,n,t)}return t}function dk(e,t,n){if(!e||!K(e))return e;for(let i=0,r=hk.length,o;i<r;++i)if(o=hk[i],ee(e,o.key))return o.parse(e,t,n);return e}var hk=[{key:"$ref",parse:Pee},{key:"$key",parse:Lee},{key:"$expr",parse:Iee},{key:"$field",parse:zee},{key:"$encode",parse:Uee},{key:"$compare",parse:Bee},{key:"$context",parse:qee},{key:"$subflow",parse:Wee},{key:"$tupleid",parse:Gee}];function Pee(e,t){return t.get(e.$ref)||P("Operator not defined: "+e.$ref)}function Iee(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code+"_"+e.$name;return t.fn[i]||(t.fn[i]=Cn(t.parameterExpression(e.$expr),e.$fields,e.$name))}function Lee(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=bb(e.$key,e.$flat,t.expr.codegen))}function zee(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=wn(e.$field,e.$name,t.expr.codegen))}function Bee(e,t){const n="c:"+e.$compare+"_"+e.$order,i=V(e.$compare).map(r=>r&&r.$tupleid?ne:r);return t.fn[n]||(t.fn[n]=yb(i,e.$order,t.expr.codegen))}function Uee(e,t){const n=e.$encode,i={};for(const r in n){const o=n[r];i[r]=Cn(t.encodeExpression(o.$expr),o.$fields),i[r].output=o.$output}return i}function qee(e,t){return t}function Wee(e,t){const n=e.$subflow;return function(i,r,o){const a=t.fork().parse(n),s=a.get(n.operators[0].id),u=a.signals.parent;return u&&u.set(o),s.detachSubflow=()=>t.detach(a),s}}function Gee(){return ne}function Hee(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,i=e.stream!=null?t.get(e.stream):void 0,r;e.source?i=t.events(e.source,e.type,n):e.merge&&(r=e.merge.map(o=>t.get(o)),i=r[0].merge.apply(r[0],r.slice(1))),e.between&&(r=e.between.map(o=>t.get(o)),i=i.between(r[0],r[1])),e.filter&&(i=i.filter(n)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&P("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),t.stream(e,i)}function Yee(e){var t=this,n=K(n=e.source)?n.$ref:n,i=t.get(n),r=null,o=e.update,a=void 0;i||P("Source not defined: "+e.source),r=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),o&&o.$expr&&(o.$params&&(a=t.parseParameters(o.$params)),o=t.handlerExpression(o.$expr)),t.update(e,i,r,o,a)}const Xee={skip:!0};function Vee(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(o=>{const a=t.signals[o];e.signals(o,a)&&(i[o]=a.value)})}if(e.data){var r=n.data={};Object.keys(t.data).forEach(o=>{const a=t.data[o];e.data(o,a)&&(r[o]=a.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(o=>o.getState(e))),n}function Kee(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach(o=>{n.update(t.signals[o],r[o],Xee)}),Object.keys(i||{}).forEach(o=>{n.pulse(t.data[o].input,n.changeset().remove(Zn).insert(i[o]))}),(e.subcontext||[]).forEach((o,a)=>{const s=t.subcontext[a];s&&s.setState(o)})}function dR(e,t,n,i){return new hR(e,t,n,i)}function hR(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||Dee,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function gk(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}hR.prototype=gk.prototype={fork(){const e=new gk(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),Tee(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){let o=n.get(e.parent.$ref);o?(i.connect(o,[t]),t.targets().add(o)):(n.unresolved=n.unresolved||[]).push(()=>{o=n.get(e.parent.$ref),i.connect(o,[t]),t.targets().add(o)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const o in e.data){const a=n.data[o]||(n.data[o]={});e.data[o].forEach(s=>a[s]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[p_(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:kee,parseOperator:Nee,parseOperatorParameters:jee,parseParameters:Ree,parseStream:Hee,parseUpdate:Yee,getState:Vee,setState:Kee};function Jee(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),gR(t,e.description()))}function gR(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function Qee(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const x1="default";function Zee(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:x1,item:null}));e.on(e.events("view","mousemove"),t,(n,i)=>{const r=t.value,o=r?Y(r)?r:r.user:x1,a=i.item&&i.item.cursor||null;return r&&o===r.user&&a==r.item?r:{user:o,item:a}}),e.add(null,function(n){let i=n.cursor,r=this.value;return Y(i)||(r=i.item,i=i.user),_v(e,i&&i!==x1?i:r||i),r},{cursor:t})}function _v(e,t){const n=e.globalCursor()?typeof document!="undefined"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function Wg(e,t){var n=e._runtime.data;return ee(n,t)||P("Unrecognized data set: "+t),n[t]}function ete(e,t){return arguments.length<2?Wg(this,e).values.value:A0.call(this,e,Ns().remove(Zn).insert(t))}function A0(e,t){UT(t)||P("Second argument to changes must be a changeset.");const n=Wg(this,e);return n.modified=!0,this.pulse(n.input,t)}function tte(e,t){return A0.call(this,e,Ns().insert(t))}function nte(e,t){return A0.call(this,e,Ns().remove(t))}function pR(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function mR(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function k0(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function ite(e){var t=k0(e),n=pR(e),i=mR(e);e._renderer.background(e.background()),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach(r=>{try{r(n,i)}catch(o){e.error(o)}})}function rte(e,t,n){var i=e._renderer,r=i&&i.canvas(),o,a,s;return r&&(s=k0(e),a=t.changedTouches?t.changedTouches[0]:t,o=h0(a,r),o[0]-=s[0],o[1]-=s[1]),t.dataflow=e,t.item=n,t.vega=ote(e,n,o),t}function ote(e,t,n){const i=t?t.mark.marktype==="group"?t:t.mark.group:null;function r(a){var s=i,u;if(a){for(u=t;u;u=u.mark.group)if(u.mark.name===a){s=u;break}}return s&&s.mark&&s.mark.interactive?s:{}}function o(a){if(!a)return n;Y(a)&&(a=r(a));const s=n.slice();for(;a;)s[0]-=a.x||0,s[1]-=a.y||0,a=a.mark&&a.mark.group;return s}return{view:Gt(e),item:Gt(t||{}),group:r,xy:o,x:a=>o(a)[0],y:a=>o(a)[1]}}const pk="view",ate="timer",ste="window",ute={trap:!1};function lte(e){const t=ce({defaults:{}},e),n=(i,r)=>{r.forEach(o=>{I(i[o])&&(i[o]=Mi(i[o]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function yR(e,t,n,i){e._eventListeners.push({type:n,sources:V(t),handler:i})}function cte(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return i===!1||r===!0?!1:i===!0||r===!1?!0:i?i[t]:r?!r[t]:e.preventDefault()}function Ud(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return i===!1||K(i)&&!i[n]?(e.warn("Blocked ".concat(t," ").concat(n," event listener.")),!1):!0}function fte(e,t,n){var i=this,r=new Pp(n),o=function(l,c){i.runAsync(null,()=>{e===pk&&cte(i,t)&&l.preventDefault(),r.receive(rte(i,l,c))})},a;if(e===ate)Ud(i,"timer",t)&&i.timer(o,t);else if(e===pk)Ud(i,"view",t)&&i.addEventListener(t,o,ute);else if(e===ste?Ud(i,"window",t)&&typeof window!="undefined"&&(a=[window]):typeof document!="undefined"&&Ud(i,"selector",t)&&(a=document.querySelectorAll(e)),!a)i.warn("Can not resolve event source: "+e);else{for(var s=0,u=a.length;s<u;++s)a[s].addEventListener(t,o);yR(i,a,t,o)}return r}function mk(e){return e.item}function yk(e){return e.item.mark.source}function vk(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function dte(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",mk),yk,vk(e)),this.on(this.events("view","mouseout",mk),yk,vk(t)),this}function hte(){var e=this._tooltip,t=this._timers,n=this._eventListeners,i,r,o;for(i=t.length;--i>=0;)t[i].stop();for(i=n.length;--i>=0;)for(o=n[i],r=o.sources.length;--r>=0;)o.sources[r].removeEventListener(o.type,o.handler);return e&&e.call(this,this._handler,null,null,null),this}function Pn(e,t,n){const i=document.createElement(e);for(const r in t)i.setAttribute(r,t[r]);return n!=null&&(i.textContent=n),i}const gte="vega-bind",pte="vega-bind-name",mte="vega-bind-radio";function yte(e,t,n){if(!t)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:a=>{a!=e.signal(i.signal)&&e.runAsync(null,()=>{r.source=!0,e.signal(i.signal,a)})}},i.debounce&&(r.update=vb(i.debounce,r.update))),(i.input==null&&i.element?vte:xte)(r,t,i,e),r.active||(e.on(e._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(e.signal(i.signal))}),r.active=!0),r}function vte(e,t,n,i){const r=n.event||"input",o=()=>e.update(t.value);i.signal(n.signal,t.value),t.addEventListener(r,o),yR(i,t,r,o),e.set=a=>{t.value=a,t.dispatchEvent(bte(r))}}function bte(e){return typeof Event!="undefined"?new Event(e):{type:e}}function xte(e,t,n,i){const r=i.signal(n.signal),o=Pn("div",{class:gte}),a=n.input==="radio"?o:o.appendChild(Pn("label"));a.appendChild(Pn("span",{class:pte},n.name||n.signal)),t.appendChild(o);let s=wte;switch(n.input){case"checkbox":s=_te;break;case"select":s=Ete;break;case"radio":s=Ste;break;case"range":s=Ote;break}s(e,a,n,r)}function wte(e,t,n,i){const r=Pn("input");for(const o in n)o!=="signal"&&o!=="element"&&r.setAttribute(o==="input"?"type":o,n[o]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",()=>e.update(r.value)),e.elements=[r],e.set=o=>r.value=o}function _te(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const o=Pn("input",r);t.appendChild(o),o.addEventListener("change",()=>e.update(o.checked)),e.elements=[o],e.set=a=>o.checked=!!a||null}function Ete(e,t,n,i){const r=Pn("select",{name:n.signal}),o=n.labels||[];n.options.forEach((a,s)=>{const u={value:a};Gg(a,i)&&(u.selected=!0),r.appendChild(Pn("option",u,(o[s]||a)+""))}),t.appendChild(r),r.addEventListener("change",()=>{e.update(n.options[r.selectedIndex])}),e.elements=[r],e.set=a=>{for(let s=0,u=n.options.length;s<u;++s)if(Gg(n.options[s],a)){r.selectedIndex=s;return}}}function Ste(e,t,n,i){const r=Pn("span",{class:mte}),o=n.labels||[];t.appendChild(r),e.elements=n.options.map((a,s)=>{const u={type:"radio",name:n.signal,value:a};Gg(a,i)&&(u.checked=!0);const l=Pn("input",u);l.addEventListener("change",()=>e.update(a));const c=Pn("label",{},(o[s]||a)+"");return c.prepend(l),r.appendChild(c),l}),e.set=a=>{const s=e.elements,u=s.length;for(let l=0;l<u;++l)Gg(s[l].value,a)&&(s[l].checked=!0)}}function Ote(e,t,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,o=n.min||Math.min(0,r,+i)||0,a=n.step||Yo(o,r,100),s=Pn("input",{type:"range",name:n.signal,min:o,max:r,step:a});s.value=i;const u=Pn("span",{},+i);t.appendChild(s),t.appendChild(u);const l=()=>{u.textContent=s.value,e.update(+s.value)};s.addEventListener("input",l),s.addEventListener("change",l),e.elements=[s],e.set=c=>{s.value=c,u.textContent=c}}function Gg(e,t){return e===t||e+""==t+""}function vR(e,t,n,i,r,o){return t=t||new i(e.loader()),t.initialize(n,pR(e),mR(e),k0(e),r,o).background(e.background())}function m_(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function Ate(e,t,n,i){const r=new i(e.loader(),m_(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,k0(e),e);return t&&t.handlers().forEach(o=>{r.on(o.type,o.handler)}),r}function kte(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,o=g0(i);e=n._el=e?w1(n,e,!0):null,Jee(n),o||n.error("Unrecognized renderer type: "+i);const a=o.handler||Kf,s=e?o.renderer:o.headless;return n._renderer=s?vR(n,n._renderer,e,s):null,n._handler=Ate(n,n._handler,e,a),n._redraw=!0,e&&r!=="none"&&(t=t?n._elBind=w1(n,t,!0):e.appendChild(Pn("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&r!=="container"&&(u.element=w1(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{yte(n,u.element||t,u)})),n}function w1(e,t,n){if(typeof t=="string")if(typeof document!="undefined"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&n)try{t.textContent=""}catch(i){t=null,e.error(i)}return t}const Xl=e=>+e||0,Cte=e=>({top:e,bottom:e,left:e,right:e});function bk(e){return K(e)?{top:Xl(e.top),bottom:Xl(e.bottom),left:Xl(e.left),right:Xl(e.right)}:Cte(Xl(e))}async function y_(e,t,n,i){const r=g0(t),o=r&&r.headless;return o||P("Unrecognized renderer type: "+t),await e.runAsync(),vR(e,null,null,o,n,i).renderAsync(e._scenegraph.root)}async function $te(e,t){e!==Mo.Canvas&&e!==Mo.SVG&&e!==Mo.PNG&&P("Unrecognized image type: "+e);const n=await y_(this,e,t);return e===Mo.SVG?Fte(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function Fte(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function Tte(e,t){return(await y_(this,Mo.Canvas,e,t)).canvas()}async function Mte(e){return(await y_(this,Mo.SVG,e)).svg()}function Dte(e,t,n){return dR(e,Du,df,n).parse(t)}function Nte(e){var t=this._runtime.scales;return ee(t,e)||P("Unrecognized scale or projection: "+e),t[e].value}var bR="width",xR="height",v_="padding",xk={skip:!0};function wR(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===v_?i.left+i.right:0)}function _R(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===v_?i.top+i.bottom:0)}function jte(e){var t=e._signals,n=t[bR],i=t[xR],r=t[v_];function o(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,s=>{e._width=s.size,e._viewWidth=wR(e,s.size),o()},{size:n}),e._resizeHeight=e.add(null,s=>{e._height=s.size,e._viewHeight=_R(e,s.size),o()},{size:i});const a=e.add(null,o,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,a.rank=r.rank+1}function Rte(e,t,n,i,r,o){this.runAfter(a=>{let s=0;a._autosize=0,a.width()!==n&&(s=1,a.signal(bR,n,xk),a._resizeWidth.skip(!0)),a.height()!==i&&(s=1,a.signal(xR,i,xk),a._resizeHeight.skip(!0)),a._viewWidth!==e&&(a._resize=1,a._viewWidth=e),a._viewHeight!==t&&(a._resize=1,a._viewHeight=t),(a._origin[0]!==r[0]||a._origin[1]!==r[1])&&(a._resize=1,a._origin=r),s&&a.run("enter"),o&&a.runAfter(u=>u.resize())},!1,1)}function Pte(e){return this._runtime.getState(e||{data:Ite,signals:Lte,recurse:!0})}function Ite(e,t){return t.modified&&I(t.input.value)&&e.indexOf("_:vega:_")}function Lte(e,t){return!(e==="parent"||t instanceof Du.proxy)}function zte(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function Bte(e,t){function n(i){e({timestamp:Date.now(),elapsed:i})}this._timers.push(mV(n,t))}function Ute(e,t,n,i){const r=e.element();r&&r.setAttribute("title",qte(i))}function qte(e){return e==null?"":I(e)?ER(e):K(e)&&!Po(e)?Wte(e):e+""}function Wte(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+(I(n)?ER(n):SR(n))}).join(`
`)}function ER(e){return"["+e.map(SR).join(", ")+"]"}function SR(e){return I(e)?"[\u2026]":K(e)&&!Po(e)?"{\u2026}":e}function OR(e,t){const n=this;if(t=t||{},mu.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const o=ce({},e.locale,t.locale);n.locale(MT(o.number,o.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||Mo.Canvas,n._scenegraph=new Q2;const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||Ute,n._redraw=!0,n._handler=new Kf().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=lte(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=Dte(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map(o=>({state:null,param:ce({},o)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=wR(n,n._width),n._viewHeight=_R(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,jte(n),Qee(n),Zee(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function qd(e,t){return ee(e._signals,t)?e._signals[t]:P("Unrecognized signal name: "+G(t))}function AR(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function wk(e,t,n,i){let r=AR(n,i);return r||(r=m_(e,()=>i(t,n.value)),r.handler=i,e.on(n,null,r)),e}function _k(e,t,n){const i=AR(t,n);return i&&t._targets.remove(i),e}W(OR,mu,{async evaluate(e,t,n){if(await mu.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,ite(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&sh(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&gR(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const i=qd(this,e);return arguments.length===1?i.value:this.update(i,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",bk(e)):bk(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(g0(e)||P("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(mu.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(qd(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:Rte,addEventListener(e,t,n){let i=t;return n&&n.trap===!1||(i=m_(this,t),i.raw=t),this._handler.on(e,i),this},removeEventListener(e,t){for(var n=this._handler.handlers(e),i=n.length,r,o;--i>=0;)if(o=n[i].type,r=n[i].handler,e===o&&(t===r||t===r.raw)){this._handler.off(o,r);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return wk(this,e,qd(this,e),t)},removeSignalListener(e,t){return _k(this,qd(this,e),t)},addDataListener(e,t){return wk(this,e,Wg(this,e).values,t)},removeDataListener(e,t){return _k(this,Wg(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=_v(this,null);this._globalCursor=!!e,t&&_v(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:Bte,events:fte,finalize:hte,hover:dte,data:ete,change:A0,insert:tte,remove:nte,scale:Nte,initialize:kte,toImageURL:$te,toCanvas:Tte,toSVG:Mte,getState:Pte,setState:zte});const Gte="view",Hg="[",Yg="]",kR="{",CR="}",Hte=":",$R=",",Yte="@",Xte=">",Vte=/[[\]{}]/,Kte={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let FR,TR;function _a(e,t,n){return FR=t||Gte,TR=n||Kte,MR(e.trim()).map(Ev)}function Jte(e){return TR[e]}function Lc(e,t,n,i,r){const o=e.length;let a=0,s;for(;t<o;++t){if(s=e[t],!a&&s===n)return t;r&&r.indexOf(s)>=0?--a:i&&i.indexOf(s)>=0&&++a}return t}function MR(e){const t=[],n=e.length;let i=0,r=0;for(;r<n;)r=Lc(e,r,$R,Hg+kR,Yg+CR),t.push(e.substring(i,r).trim()),i=++r;if(t.length===0)throw"Empty event selector: "+e;return t}function Ev(e){return e[0]==="["?Qte(e):Zte(e)}function Qte(e){const t=e.length;let n=1,i;if(n=Lc(e,n,Yg,Hg,Yg),n===t)throw"Empty between selector: "+e;if(i=MR(e.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==Xte)throw"Expected '>' after between selector: "+e;i=i.map(Ev);const r=Ev(e.slice(1).trim());return r.between?{between:i,stream:r}:(r.between=i,r)}function Zte(e){const t={source:FR},n=[];let i=[0,0],r=0,o=0,a=e.length,s=0,u,l;if(e[a-1]===CR){if(s=e.lastIndexOf(kR),s>=0){try{i=ene(e.substring(s+1,a-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,s).trim(),a=e.length}else throw"Unmatched right brace: "+e;s=0}if(!a)throw e;if(e[0]===Yte&&(r=++s),u=Lc(e,s,Hte),u<a&&(n.push(e.substring(o,u).trim()),o=s=++u),s=Lc(e,s,Hg),s===a)n.push(e.substring(o,a).trim());else if(n.push(e.substring(o,s).trim()),l=[],o=++s,o===a)throw"Unmatched left bracket: "+e;for(;s<a;){if(s=Lc(e,s,Yg),s===a)throw"Unmatched left bracket: "+e;if(l.push(e.substring(o,s).trim()),s<a-1&&e[++s]!==Hg)throw"Expected left bracket: "+e;o=++s}if(!(a=n.length)||Vte.test(n[a-1]))throw"Invalid event selector: "+e;return a>1?(t.type=n[1],r?t.markname=n[0].slice(1):Jte(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}function ene(e){const t=e.split($R);if(!e.length||t.length>2)throw e;return t.map(n=>{const i=+n;if(i!==i)throw e;return i})}function tne(e){return K(e)?e:{type:e||"pad"}}const Vl=e=>+e||0,nne=e=>({top:e,bottom:e,left:e,right:e});function ine(e){return K(e)?e.signal?e:{top:Vl(e.top),bottom:Vl(e.bottom),left:Vl(e.left),right:Vl(e.right)}:nne(Vl(e))}const yt=e=>K(e)&&!I(e)?ce({},e):{value:e};function Ek(e,t,n,i){return n!=null?(K(n)&&!I(n)||I(n)&&n.length&&K(n[0])?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function kt(e,t,n){for(const i in t)Ek(e,i,t[i]);for(const i in n)Ek(e,i,n[i],"update")}function wl(e,t,n){for(const i in t)n&&ee(n,i)||(e[i]=ce(e[i]||{},t[i]));return e}function au(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const b_="mark",x_="frame",w_="scope",rne="axis",one="axis-domain",ane="axis-grid",sne="axis-label",une="axis-tick",lne="axis-title",cne="legend",fne="legend-band",dne="legend-entry",hne="legend-gradient",DR="legend-label",gne="legend-symbol",pne="legend-title",mne="title",yne="title-text",vne="title-subtitle";function bne(e,t,n,i,r){const o={},a={};let s,u,l,c;u="lineBreak",t==="text"&&r[u]!=null&&!au(u,e)&&_1(o,u,r[u]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===x_?r.group:n===b_?ce({},r.mark,r[t]):null;for(u in c)l=au(u,e)||(u==="fill"||u==="stroke")&&(au("fill",e)||au("stroke",e)),l||_1(o,u,c[u]);V(i).forEach(f=>{const d=r.style&&r.style[f];for(const h in d)au(h,e)||_1(o,h,d[h])}),e=ce({},e);for(u in o)c=o[u],c.signal?(s=s||{})[u]=c:a[u]=c;return e.enter=ce(a,e.enter),s&&(e.update=ce(s,e.update)),e}function _1(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const NR=e=>Y(e)?G(e):e.signal?`(${e.signal})`:jR(e);function C0(e){if(e.gradient!=null)return wne(e);let t=e.signal?`(${e.signal})`:e.color?xne(e.color):e.field!=null?jR(e.field):e.value!==void 0?G(e.value):void 0;return e.scale!=null&&(t=_ne(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${Sh(e.exponent)})`),e.mult!=null&&(t+=`*${Sh(e.mult)}`),e.offset!=null&&(t+=`+${Sh(e.offset)}`),e.round&&(t=`round(${t})`),t}const Wd=(e,t,n,i)=>`(${e}(${[t,n,i].map(C0).join(",")})+'')`;function xne(e){return e.c?Wd("hcl",e.h,e.c,e.l):e.h||e.s?Wd("hsl",e.h,e.s,e.l):e.l||e.a?Wd("lab",e.l,e.a,e.b):e.r||e.g||e.b?Wd("rgb",e.r,e.g,e.b):null}function wne(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:G(n));for(;t.length&&ve(t)==null;)t.pop();return t.unshift(NR(e.gradient)),`gradient(${t.join(",")})`}function Sh(e){return K(e)?"("+C0(e)+")":e}function jR(e){return RR(K(e)?e:{datum:e})}function RR(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):P("Invalid field reference: "+G(e));return e.signal||(i=Y(i)?br(i).map(G).join("]["):RR(i)),t+"["+i+"]"}function _ne(e,t){const n=NR(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band==1?"":"*"+Sh(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function Ene(e){let t="";return e.forEach(n=>{const i=C0(n);t+=n.test?`(${n.test})?${i}:`:i}),ve(t)===":"&&(t+="null"),t}function PR(e,t,n,i,r,o){const a={};o=o||{},o.encoders={$encode:a},e=bne(e,t,n,i,r.config);for(const s in e)a[s]=Sne(e[s],t,o,r);return o}function Sne(e,t,n,i){const r={},o={};for(const a in e)e[a]!=null&&(r[a]=Ane(One(e[a]),i,n,o));return{$expr:{marktype:t,channels:r},$fields:Object.keys(o),$output:Object.keys(e)}}function One(e){return I(e)?Ene(e):C0(e)}function Ane(e,t,n,i){const r=gr(e,t);return r.$fields.forEach(o=>i[o]=1),ce(n,r.$params),r.$expr}const kne="outer",Cne=["value","update","init","react","bind"];function Sk(e,t){P(e+' for "outer" push: '+G(t))}function IR(e,t){const n=e.name;if(e.push===kne)t.signals[n]||Sk("No prior signal definition",n),Cne.forEach(i=>{e[i]!==void 0&&Sk("Invalid property ",i)});else{const i=t.addSignal(n,e.value);e.react===!1&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Sv(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function $0(e,t,n,i){return new Sv(e,t,n,i)}function Xg(e,t){return $0("operator",e,t)}function te(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function hf(e,t){return t?{$field:e,$name:t}:{$field:e}}const Ov=hf("key");function Ok(e,t){return{$compare:e,$order:t}}function $ne(e,t){const n={$key:e};return t&&(n.$flat=!0),n}const Fne="ascending",Tne="descending";function Mne(e){return K(e)?(e.order===Tne?"-":"+")+F0(e.op,e.field):""}function F0(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const __="scope",Av="view";function ut(e){return e&&e.signal}function Dne(e){return e&&e.expr}function Oh(e){if(ut(e))return!0;if(K(e)){for(const t in e)if(Oh(e[t]))return!0}return!1}function pi(e,t){return e!=null?e:t}function es(e){return e&&e.signal||e}const Ak="timer";function gf(e,t){return(e.merge?jne:e.stream?Rne:e.type?Pne:P("Invalid stream specification: "+G(e)))(e,t)}function Nne(e){return e===__?Av:e||Av}function jne(e,t){const n=e.merge.map(r=>gf(r,t)),i=E_({merge:n},e,t);return t.addStream(i).id}function Rne(e,t){const n=gf(e.stream,t),i=E_({stream:n},e,t);return t.addStream(i).id}function Pne(e,t){let n;e.type===Ak?(n=t.event(Ak,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(Nne(e.source),e.type);const i=E_({stream:n},e,t);return Object.keys(i).length===1?n:t.addStream(i).id}function E_(e,t,n){let i=t.between;return i&&(i.length!==2&&P('Stream "between" parameter must have 2 entries: '+G(t)),e.between=[gf(i[0],n),gf(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(Ine(t.marktype,t.markname,t.markrole)),t.source===__&&i.push("inScope(event.item)"),i.length&&(e.filter=gr("("+i.join(")&&(")+")",n).$expr),(i=t.throttle)!=null&&(e.throttle=+i),(i=t.debounce)!=null&&(e.debounce=+i),t.consume&&(e.consume=!0),e}function Ine(e,t,n){const i="event.item";return i+(e&&e!=="*"?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}const Lne={code:"_.$value",ast:{type:"Identifier",value:"value"}};function zne(e,t,n){const i=e.encode,r={target:n};let o=e.events,a=e.update,s=[];o||P("Signal update missing events specification."),Y(o)&&(o=_a(o,t.isSubscope()?__:Av)),o=V(o).filter(u=>u.signal||u.scale?(s.push(u),0):1),s.length>1&&(s=[Une(s)]),o.length&&s.push(o.length>1?{merge:o}:o[0]),i!=null&&(a&&P("Signal encode and update are mutually exclusive."),a="encode(item(),"+G(i)+")"),r.update=Y(a)?gr(a,t):a.expr!=null?gr(a.expr,t):a.value!=null?a.value:a.signal!=null?{$expr:Lne,$params:{$value:t.signalRef(a.signal)}}:P("Invalid signal update specification."),e.force&&(r.options={force:!0}),s.forEach(u=>t.addUpdate(ce(Bne(u,t),r)))}function Bne(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):gf(e,t)}}function Une(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function qne(e,t){const n=t.getSignal(e.name);let i=e.update;e.init&&(i?P("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=gr(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach(r=>zne(r,t,n.id))}const Ne=e=>(t,n,i)=>$0(e,n,t||void 0,i),LR=Ne("aggregate"),Wne=Ne("axisticks"),zR=Ne("bound"),zi=Ne("collect"),kk=Ne("compare"),Gne=Ne("datajoin"),BR=Ne("encode"),Hne=Ne("expression"),Yne=Ne("facet"),Xne=Ne("field"),Vne=Ne("key"),Kne=Ne("legendentries"),Jne=Ne("load"),Qne=Ne("mark"),Zne=Ne("multiextent"),eie=Ne("multivalues"),tie=Ne("overlap"),nie=Ne("params"),UR=Ne("prefacet"),iie=Ne("projection"),rie=Ne("proxy"),oie=Ne("relay"),qR=Ne("render"),aie=Ne("scale"),Is=Ne("sieve"),sie=Ne("sortitems"),WR=Ne("viewlayout"),uie=Ne("values");let lie=0;const GR={min:"min",max:"max",count:"sum"};function cie(e,t){const n=e.type||"linear";B3(n)||P("Unrecognized scale type: "+G(n)),t.addScale(e.name,{type:n,domain:void 0})}function fie(e,t){const n=t.getScale(e.name).params;let i;n.domain=HR(e.domain,e,t),e.range!=null&&(n.range=XR(e,t,n)),e.interpolate!=null&&wie(e.interpolate,n),e.nice!=null&&(n.nice=xie(e.nice)),e.bins!=null&&(n.bins=bie(e.bins,t));for(i in e)ee(n,i)||i==="name"||(n[i]=Kn(e[i],t))}function Kn(e,t){return K(e)?e.signal?t.signalRef(e.signal):P("Unsupported object: "+G(e)):e}function Ah(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Kn(n,t))}function T0(e){P("Can not find data set: "+G(e))}function HR(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&P("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(I(e)?die:e.fields?gie:hie)(e,t,n)}function die(e,t,n){return e.map(i=>Kn(i,n))}function hie(e,t,n){const i=n.getData(e.data);return i||T0(e.data),Iu(t.type)?i.valuesRef(n,e.field,YR(e.sort,!1)):W3(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function gie(e,t,n){const i=e.data,r=e.fields.reduce((o,a)=>(a=Y(a)?{data:i,field:a}:I(a)||a.signal?pie(a,n):a,o.push(a),o),[]);return(Iu(t.type)?mie:W3(t.type)?yie:vie)(e,n,r)}function pie(e,t){const n="_:vega:_"+lie++,i=zi({});if(I(e))i.value={$ingest:e};else if(e.signal){const r="setdata("+G(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,Is({})]),{data:n,field:"data"}}function mie(e,t,n){const i=YR(e.sort,!0);let r,o;const a=n.map(l=>{const c=t.getData(l.data);return c||T0(l.data),c.countsRef(t,l.field,i)}),s={groupby:Ov,pulse:a};i&&(r=i.op||"count",o=i.field?F0(r,i.field):"count",s.ops=[GR[r]],s.fields=[t.fieldRef(o)],s.as=[o]),r=t.add(LR(s));const u=t.add(zi({pulse:te(r)}));return o=t.add(uie({field:Ov,sort:t.sortRef(i),pulse:te(u)})),te(o)}function YR(e,t){return e&&(!e.field&&!e.op?K(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?P("No field provided for sort aggregate op: "+e.op):t&&e.field&&e.op&&!GR[e.op]&&P("Multiple domain scales can not be sorted using "+e.op)),e}function yie(e,t,n){const i=n.map(r=>{const o=t.getData(r.data);return o||T0(r.data),o.domainRef(t,r.field)});return te(t.add(eie({values:i})))}function vie(e,t,n){const i=n.map(r=>{const o=t.getData(r.data);return o||T0(r.data),o.extentRef(t,r.field)});return te(t.add(Zne({extents:i})))}function bie(e,t){return e.signal||I(e)?Ah(e,t):t.objectProperty(e)}function xie(e){return K(e)?{interval:Kn(e.interval),step:Kn(e.step)}:Kn(e)}function wie(e,t){t.interpolate=Kn(e.type||e),e.gamma!=null&&(t.interpolateGamma=Kn(e.gamma))}function XR(e,t,n){const i=t.config.range;let r=e.range;if(r.signal)return t.signalRef(r.signal);if(Y(r)){if(i&&ee(i,r))return e=ce({},e,{range:i[r]}),XR(e,t,n);r==="width"?r=[0,{signal:"width"}]:r==="height"?r=Iu(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:P("Unrecognized scale range value: "+G(r))}else if(r.scheme){n.scheme=I(r.scheme)?Ah(r.scheme,t):Kn(r.scheme,t),r.extent&&(n.schemeExtent=Ah(r.extent,t)),r.count&&(n.schemeCount=Kn(r.count,t));return}else if(r.step){n.rangeStep=Kn(r.step,t);return}else{if(Iu(e.type)&&!I(r))return HR(r,e,t);I(r)||P("Unsupported range type: "+G(r))}return r.map(o=>(I(o)?Ah:Kn)(o,t))}function _ie(e,t){const n=t.config.projection||{},i={};for(const r in e)r!=="name"&&(i[r]=kv(e[r],r,t));for(const r in n)i[r]==null&&(i[r]=kv(n[r],r,t));t.addProjection(e.name,i)}function kv(e,t,n){return I(e)?e.map(i=>kv(i,t,n)):K(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:P("Unsupported parameter object: "+G(e)):e}const Bi="top",_l="left",El="right",na="bottom",VR="center",Eie="vertical",Sie="start",Oie="middle",Aie="end",Cv="index",S_="label",kie="offset",Xu="perc",Cie="perc2",Jn="value",od="guide-label",O_="guide-title",$ie="group-title",Fie="group-subtitle",Ck="symbol",kh="gradient",$v="discrete",Fv="size",Tie="shape",Mie="fill",Die="stroke",Nie="strokeWidth",jie="strokeDash",Rie="opacity",A_=[Fv,Tie,Mie,Die,Nie,jie,Rie],ad={name:1,style:1,interactive:1},xe={value:0},Qn={value:1},M0="group",KR="rect",k_="rule",Pie="symbol",Ls="text";function pf(e){return e.type=M0,e.interactive=e.interactive||!1,e}function $n(e,t){const n=(i,r)=>pi(e[i],pi(t[i],r));return n.isVertical=i=>Eie===pi(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>pi(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>pi(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>pi(e.columns,pi(t.columns,+n.isVertical(!0))),n}function JR(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function Iie(e,t,n){const i=t.config.style[n];return i&&i[e]}function D0(e,t,n){return`item.anchor === '${Sie}' ? ${e} : item.anchor === '${Aie}' ? ${t} : ${n}`}const C_=D0(G(_l),G(El),G(VR));function Lie(e){const t=e("tickBand");let n=e("tickOffset"),i,r;return t?t.signal?(i={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},K(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(i=1,r=!0,n=0):(i=.5,r=!1):(i=e("bandPosition"),r=e("tickExtra")),{extra:r,band:i,offset:n}}function QR(e,t){return t?e?K(e)?Object.assign({},e,{offset:QR(e.offset,t)}):{value:e,offset:t}:t:e}function Bn(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=wl(e.encode,t,ad)):e.interactive=!1,e}function zie(e,t,n,i){const r=$n(e,n),o=r.isVertical(),a=r.gradientThickness(),s=r.gradientLength();let u,l,c,f,d;o?(l=[0,1],c=[0,0],f=a,d=s):(l=[0,0],c=[1,0],f=s,d=a);const h={enter:u={opacity:xe,x:xe,y:xe,width:yt(f),height:yt(d)},update:ce({},u,{opacity:Qn,fill:{gradient:t,start:l,stop:c}}),exit:{opacity:xe}};return kt(h,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),Bn({type:KR,role:hne,encode:h},i)}function Bie(e,t,n,i,r){const o=$n(e,n),a=o.isVertical(),s=o.gradientThickness(),u=o.gradientLength();let l,c,f,d,h="";a?(l="y",f="y2",c="x",d="width",h="1-"):(l="x",f="x2",c="y",d="height");const g={opacity:xe,fill:{scale:t,field:Jn}};g[l]={signal:h+"datum."+Xu,mult:u},g[c]=xe,g[f]={signal:h+"datum."+Cie,mult:u},g[d]=yt(s);const p={enter:g,update:ce({},g,{opacity:Qn}),exit:{opacity:xe}};return kt(p,{stroke:o("gradientStrokeColor"),strokeWidth:o("gradientStrokeWidth")},{opacity:o("gradientOpacity")}),Bn({type:KR,role:fne,key:Jn,from:r,encode:p},i)}const Uie=`datum.${Xu}<=0?"${_l}":datum.${Xu}>=1?"${El}":"${VR}"`,qie=`datum.${Xu}<=0?"${na}":datum.${Xu}>=1?"${Bi}":"${Oie}"`;function $k(e,t,n,i){const r=$n(e,t),o=r.isVertical(),a=yt(r.gradientThickness()),s=r.gradientLength();let u=r("labelOverlap"),l,c,f,d,h="";const g={enter:l={opacity:xe},update:c={opacity:Qn,text:{field:S_}},exit:{opacity:xe}};return kt(g,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:pi(e.labelLimit,t.gradientLabelLimit)}),o?(l.align={value:"left"},l.baseline=c.baseline={signal:qie},f="y",d="x",h="1-"):(l.align=c.align={signal:Uie},l.baseline={value:"top"},f="x",d="y"),l[f]=c[f]={signal:h+"datum."+Xu,mult:s},l[d]=c[d]=a,a.offset=pi(e.labelOffset,t.gradientLabelOffset)||0,u=u?{separation:r("labelSeparation"),method:u,order:"datum."+Cv}:void 0,Bn({type:Ls,role:DR,style:od,key:Jn,from:i,encode:g,overlap:u},n)}function Wie(e,t,n,i,r){const o=$n(e,t),a=n.entries,s=!!(a&&a.interactive),u=a?a.name:void 0,l=o("clipHeight"),c=o("symbolOffset"),f={data:"value"},d=`(${r}) ? datum.${kie} : datum.${Fv}`,h=l?yt(l):{field:Fv},g=`datum.${Cv}`,p=`max(1, ${r})`;let m,y,v,b,x;h.mult=.5,m={enter:y={opacity:xe,x:{signal:d,mult:.5,offset:c},y:h},update:v={opacity:Qn,x:y.x,y:y.y},exit:{opacity:xe}};let _=null,E=null;e.fill||(_=t.symbolBaseFillColor,E=t.symbolBaseStrokeColor),kt(m,{fill:o("symbolFillColor",_),shape:o("symbolType"),size:o("symbolSize"),stroke:o("symbolStrokeColor",E),strokeDash:o("symbolDash"),strokeDashOffset:o("symbolDashOffset"),strokeWidth:o("symbolStrokeWidth")},{opacity:o("symbolOpacity")}),A_.forEach(A=>{e[A]&&(v[A]=y[A]={scale:e[A],field:Jn})});const w=Bn({type:Pie,role:gne,key:Jn,from:f,clip:l?!0:void 0,encode:m},n.symbols),S=yt(c);S.offset=o("labelOffset"),m={enter:y={opacity:xe,x:{signal:d,offset:S},y:h},update:v={opacity:Qn,text:{field:S_},x:y.x,y:y.y},exit:{opacity:xe}},kt(m,{align:o("labelAlign"),baseline:o("labelBaseline"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontStyle:o("labelFontStyle"),fontWeight:o("labelFontWeight"),limit:o("labelLimit")});const C=Bn({type:Ls,role:DR,style:od,key:Jn,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:xe,height:l?yt(l):xe,opacity:xe},exit:{opacity:xe},update:v={opacity:Qn,row:{signal:null},column:{signal:null}}},o.isVertical(!0)?(b=`ceil(item.mark.items.length / ${p})`,v.row.signal=`${g}%${b}`,v.column.signal=`floor(${g} / ${b})`,x={field:["row",g]}):(v.row.signal=`floor(${g} / ${p})`,v.column.signal=`${g} % ${p}`,x={field:g}),v.column.signal=`(${r})?${v.column.signal}:${g}`,i={facet:{data:i,name:"value",groupby:Cv}},pf({role:w_,from:i,encode:wl(m,a,ad),marks:[w,C],name:u,interactive:s,sort:x})}function Gie(e,t){const n=$n(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const $_='item.orient === "left"',F_='item.orient === "right"',N0=`(${$_} || ${F_})`,Hie=`datum.vgrad && ${N0}`,Yie=D0('"top"','"bottom"','"middle"'),Xie=D0('"right"','"left"','"center"'),Vie=`datum.vgrad && ${F_} ? (${Xie}) : (${N0} && !(datum.vgrad && ${$_})) ? "left" : ${C_}`,Kie=`item._anchor || (${N0} ? "middle" : "start")`,Jie=`${Hie} ? (${$_} ? -90 : 90) : 0`,Qie=`${N0} ? (datum.vgrad ? (${F_} ? "bottom" : "top") : ${Yie}) : "top"`;function Zie(e,t,n,i){const r=$n(e,t),o={enter:{opacity:xe},update:{opacity:Qn,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:xe}};return kt(o,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:Kie},angle:{signal:Jie},align:{signal:Vie},baseline:{signal:Qie},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),Bn({type:Ls,role:pne,style:O_,from:i,encode:o},n)}function ere(e,t){let n;return K(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+Fk(e.path)+")":e.sphere&&(n="geoShape("+Fk(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function Fk(e){return K(e)&&e.signal?e.signal:G(e)}function ZR(e){const t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===M0?w_:t||b_}function tre(e){return{marktype:e.type,name:e.name||void 0,role:e.role||ZR(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function nre(e,t){return e&&e.signal?t.signalRef(e.signal):e!==!1}function T_(e,t){const n=GT(e.type);n||P("Unrecognized transform type: "+G(e.type));const i=$0(n.type.toLowerCase(),null,e5(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function e5(e,t,n){const i={},r=e.params.length;for(let o=0;o<r;++o){const a=e.params[o];i[a.name]=ire(a,t,n)}return i}function ire(e,t,n){const i=e.type,r=t[e.name];if(i==="index")return rre(e,t,n);if(r===void 0){e.required&&P("Missing required "+G(t.type)+" parameter: "+G(e.name));return}else{if(i==="param")return ore(e,t,n);if(i==="projection")return n.projectionRef(t[e.name])}return e.array&&!ut(r)?r.map(o=>Tk(e,o,n)):Tk(e,r,n)}function Tk(e,t,n){const i=e.type;if(ut(t))return Dk(i)?P("Expression references can not be signals."):E1(i)?n.fieldRef(t):Nk(i)?n.compareRef(t):n.signalRef(t.signal);{const r=e.expr||E1(i);return r&&are(t)?n.exprRef(t.expr,t.as):r&&sre(t)?hf(t.field,t.as):Dk(i)?gr(t,n):ure(i)?te(n.getData(t).values):E1(i)?hf(t):Nk(i)?n.compareRef(t):t}}function rre(e,t,n){return Y(t.from)||P('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function ore(e,t,n){const i=t[e.name];return e.array?(I(i)||P("Expected an array of sub-parameters. Instead: "+G(i)),i.map(r=>Mk(e,r,n))):Mk(e,i,n)}function Mk(e,t,n){const i=e.params.length;let r;for(let a=0;a<i;++a){r=e.params[a];for(const s in r.key)if(r.key[s]!==t[s]){r=null;break}if(r)break}r||P("Unsupported parameter: "+G(t));const o=ce(e5(r,t,n),r.key);return te(n.add(nie(o)))}const are=e=>e&&e.expr,sre=e=>e&&e.field,ure=e=>e==="data",Dk=e=>e==="expr",E1=e=>e==="field",Nk=e=>e==="compare";function lre(e,t,n){let i,r,o,a,s;return e?(i=e.facet)&&(t||P("Only group marks can be faceted."),i.field!=null?a=s=Ch(i,n):(e.data?s=te(n.getData(e.data).aggregate):(o=T_(ce({type:"aggregate",groupby:V(i.groupby)},i.aggregate),n),o.params.key=n.keyRef(i.groupby),o.params.pulse=Ch(i,n),a=s=te(n.add(o))),r=n.keyRef(i.groupby,!0))):a=te(n.add(zi(null,[{}]))),a||(a=Ch(e,n)),{key:r,pulse:a,parent:s}}function Ch(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:te(t.getData(e.data).output)}function bs(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}bs.fromEntries=function(e,t){const n=t.length,i=t[n-1],r=t[n-2];let o=t[0],a=null,s=1;for(o&&o.type==="load"&&(o=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=te(t[s-1]),e.add(t[s]),t[s].type==="aggregate"&&(a=t[s]);return new bs(e,o,r,i,a)};function t5(e){return Y(e)?e:null}function jk(e,t,n){const i=F0(n.op,n.field);let r;if(t.ops){for(let o=0,a=t.as.length;o<a;++o)if(t.as[o]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Kl(e,t,n,i,r,o,a){const s=t[n]||(t[n]={}),u=Mne(o);let l=t5(r),c,f;if(l!=null&&(e=t.scope,l=l+(u?"|"+u:""),c=s[l]),!c){const d=o?{field:Ov,pulse:t.countsRef(e,r,o)}:{field:e.fieldRef(r),pulse:te(t.output)};u&&(d.sort=e.sortRef(o)),f=e.add($0(i,void 0,d)),a&&(t.index[r]=f),c=te(f),l!=null&&(s[l]=c)}return c}bs.prototype={countsRef(e,t,n){const i=this,r=i.counts||(i.counts={}),o=t5(t);let a,s,u;return o!=null&&(e=i.scope,a=r[o]),a?n&&n.field&&jk(e,a.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:te(i.output)},n&&n.field&&jk(e,u,n),s=e.add(LR(u)),a=e.add(zi({pulse:te(s)})),a={agg:s,ref:te(a)},o!=null&&(r[o]=a)),a.ref},tuplesRef(){return te(this.values)},extentRef(e,t){return Kl(e,this,"extent","extent",t,!1)},domainRef(e,t){return Kl(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return Kl(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return Kl(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return Kl(e,this,"indata","tupleindex",t,!0,!0)}};function cre(e,t,n){const i=e.from.facet,r=i.name,o=Ch(i,t);let a;i.name||P("Facet must have a name: "+G(i)),i.data||P("Facet must reference a data set: "+G(i)),i.field?a=t.add(UR({field:t.fieldRef(i.field),pulse:o})):i.groupby?a=t.add(Yne({key:t.keyRef(i.groupby),group:te(t.proxy(n.parent)),pulse:o})):P("Facet must specify groupby or field: "+G(i));const s=t.fork(),u=s.add(zi()),l=s.add(Is({pulse:te(u)}));s.addData(r,new bs(s,u,u,l)),s.addSignal("parent",null),a.params.subflow={$subflow:s.parse(e).toRuntime()}}function fre(e,t,n){const i=t.add(UR({pulse:n.pulse})),r=t.fork();r.add(Is()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}function n5(e,t,n){const i=e.remove,r=e.insert,o=e.toggle,a=e.modify,s=e.values,u=t.add(Xg()),l="if("+e.trigger+',modify("'+n+'",'+[r,i,o,a,s].map(f=>f==null?"null":f).join(",")+"),0)",c=gr(l,t);u.update=c.$expr,u.params=c.$params}function j0(e,t){const n=ZR(e),i=e.type===M0,r=e.from&&e.from.facet,o=e.overlap;let a=e.layout||n===w_||n===x_,s,u,l,c,f,d,h;const g=n===b_||a||r,p=lre(e.from,i,t);u=t.add(Gne({key:p.key||(e.key?hf(e.key):void 0),pulse:p.pulse,clean:!i}));const m=te(u);u=l=t.add(zi({pulse:m})),u=t.add(Qne({markdef:tre(e),interactive:nre(e.interactive,t),clip:ere(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:te(u)}));const y=te(u);u=c=t.add(BR(PR(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(E=>{const w=T_(E,t),S=w.metadata;(S.generates||S.changes)&&P("Mark transforms should not generate new data."),S.nomod||(c.params.mod=!0),w.params.pulse=te(u),t.add(u=w)}),e.sort&&(u=t.add(sie({sort:t.compareRef(e.sort),pulse:te(u)})));const v=te(u);(r||a)&&(a=t.add(WR({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:v})),d=te(a));const b=t.add(zR({mark:y,pulse:d||v}));h=te(b),i&&(g&&(s=t.operators,s.pop(),a&&s.pop()),t.pushState(v,d||h,m),r?cre(e,t,p):g?fre(e,t,p):t.parse(e),t.popState(),g&&(a&&s.push(a),s.push(b))),o&&(h=dre(o,h,t));const x=t.add(qR({pulse:h})),_=t.add(Is({pulse:te(x)},void 0,t.parent()));e.name!=null&&(f=e.name,t.addData(f,new bs(t,l,x,_)),e.on&&e.on.forEach(E=>{(E.insert||E.remove||E.toggle)&&P("Marks only support modify triggers."),n5(E,t,f)}))}function dre(e,t,n){const i=e.method,r=e.bound,o=e.separation,a={separation:ut(o)?n.signalRef(o.signal):o,method:ut(i)?n.signalRef(i.signal):i,pulse:t};if(e.order&&(a.sort=n.compareRef({field:e.order})),r){const s=r.tolerance;a.boundTolerance=ut(s)?n.signalRef(s.signal):+s,a.boundScale=n.scaleRef(r.scale),a.boundOrient=r.orient}return te(n.add(tie(a)))}function hre(e,t){const n=t.config.legend,i=e.encode||{},r=$n(e,n),o=i.legend||{},a=o.name||void 0,s=o.interactive,u=o.style,l={};let c=0,f,d,h;A_.forEach(b=>e[b]?(l[b]=e[b],c=c||e[b]):0),c||P("Missing valid scale for legend.");const g=gre(e,t.scaleType(c)),p={title:e.title!=null,scales:l,type:g,vgrad:g!=="symbol"&&r.isVertical()},m=te(t.add(zi(null,[p]))),y={enter:{x:{value:0},y:{value:0}}},v=te(t.add(Kne(d={type:g,scale:t.scaleRef(c),count:t.objectProperty(r("tickCount")),limit:t.property(r("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return g===kh?(h=[zie(e,c,n,i.gradient),$k(e,n,i.labels,v)],d.count=d.count||t.signalRef(`max(2,2*floor((${es(r.gradientLength())})/100))`)):g===$v?h=[Bie(e,c,n,i.gradient,v),$k(e,n,i.labels,v)]:(f=Gie(e,n),h=[Wie(e,n,i,v,es(f.columns))],d.size=yre(e,t,h[0].marks)),h=[pf({role:dne,from:m,encode:y,marks:h,layout:f,interactive:s})],p.title&&h.push(Zie(e,n,i.title,m)),j0(pf({role:cne,from:m,encode:wl(mre(r,e,n),o,ad),marks:h,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:a,interactive:s,style:u}),t)}function gre(e,t){let n=e.type||Ck;return!e.type&&pre(e)===1&&(e.fill||e.stroke)&&(n=k2(t)?kh:wy(t)?$v:Ck),n!==kh?n:wy(t)?$v:kh}function pre(e){return A_.reduce((t,n)=>t+(e[n]?1:0),0)}function mre(e,t,n){const i={enter:{},update:{}};return kt(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function yre(e,t,n){const i=es(Rk("size",e,n)),r=es(Rk("strokeWidth",e,n)),o=es(vre(n[1].encode,t,od));return gr(`max(ceil(sqrt(${i})+${r}),${o})`,t)}function Rk(e,t,n){return t[e]?`scale("${t[e]}",datum)`:JR(e,n[0].encode)}function vre(e,t,n){return JR("fontSize",e)||Iie("fontSize",t,n)}const bre=`item.orient==="${_l}"?-90:item.orient==="${El}"?90:0`;function xre(e,t){e=Y(e)?{text:e}:e;const n=$n(e,t.config.title),i=e.encode||{},r=i.group||{},o=r.name||void 0,a=r.interactive,s=r.style,u=[],l={},c=te(t.add(zi(null,[l])));return u.push(Ere(e,n,wre(e),c)),e.subtitle&&u.push(Sre(e,n,i.subtitle,c)),j0(pf({role:mne,from:c,encode:_re(n,r),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:o,interactive:a,style:s}),t)}function wre(e){const t=e.encode;return t&&t.title||ce({name:e.name,interactive:e.interactive,style:e.style},t)}function _re(e,t){const n={enter:{},update:{}};return kt(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:C_},angle:{signal:bre},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),wl(n,t,ad)}function Ere(e,t,n,i){const r={value:0},o=e.text,a={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return kt(a,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Bn({type:Ls,role:yne,style:$ie,from:i,encode:a},n)}function Sre(e,t,n,i){const r={value:0},o=e.subtitle,a={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return kt(a,{text:o,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Bn({type:Ls,role:vne,style:Fie,from:i,encode:a},n)}function Ore(e,t){const n=[];e.transform&&e.transform.forEach(i=>{n.push(T_(i,t))}),e.on&&e.on.forEach(i=>{n5(i,t,e.name)}),t.addDataPipeline(e.name,Are(e,t,n))}function Are(e,t,n){const i=[];let r=null,o=!1,a=!1,s,u,l,c,f;for(e.values?ut(e.values)||Oh(e.format)?(i.push(Pk(t,e)),i.push(r=Aa())):i.push(r=Aa({$ingest:e.values,$format:e.format})):e.url?Oh(e.url)||Oh(e.format)?(i.push(Pk(t,e)),i.push(r=Aa())):i.push(r=Aa({$request:e.url,$format:e.format})):e.source&&(r=s=V(e.source).map(d=>te(t.getData(d).output)),i.push(null)),u=0,l=n.length;u<l;++u)c=n[u],f=c.metadata,!r&&!f.source&&i.push(r=Aa()),i.push(c),f.generates&&(a=!0),f.modifies&&!a&&(o=!0),f.source?r=c:f.changes&&(r=null);return s&&(l=s.length-1,i[0]=oie({derive:o,pulse:l?s:s[0]}),(o||l)&&i.splice(1,0,Aa())),r||i.push(Aa()),i.push(Is({})),i}function Aa(e){const t=zi({},e);return t.metadata={source:!0},t}function Pk(e,t){return Jne({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const i5=e=>e===na||e===Bi,R0=(e,t,n)=>ut(e)?Fre(e.signal,t,n):e===_l||e===Bi?t:n,vt=(e,t,n)=>ut(e)?Cre(e.signal,t,n):i5(e)?t:n,$i=(e,t,n)=>ut(e)?$re(e.signal,t,n):i5(e)?n:t,r5=(e,t,n)=>ut(e)?Tre(e.signal,t,n):e===Bi?{value:t}:{value:n},kre=(e,t,n)=>ut(e)?Mre(e.signal,t,n):e===El?{value:t}:{value:n},Cre=(e,t,n)=>o5(`${e} === '${Bi}' || ${e} === '${na}'`,t,n),$re=(e,t,n)=>o5(`${e} !== '${Bi}' && ${e} !== '${na}'`,t,n),Fre=(e,t,n)=>M_(`${e} === '${_l}' || ${e} === '${Bi}'`,t,n),Tre=(e,t,n)=>M_(`${e} === '${Bi}'`,t,n),Mre=(e,t,n)=>M_(`${e} === '${El}'`,t,n),o5=(e,t,n)=>(t=t!=null?yt(t):t,n=n!=null?yt(n):n,Ik(t)&&Ik(n)?(t=t?t.signal||G(t.value):null,n=n?n.signal||G(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[ce({test:e},t)].concat(n||[])),Ik=e=>e==null||Object.keys(e).length===1,M_=(e,t,n)=>({signal:`${e} ? (${du(t)}) : (${du(n)})`}),Dre=(e,t,n,i,r)=>({signal:(i!=null?`${e} === '${_l}' ? (${du(i)}) : `:"")+(n!=null?`${e} === '${na}' ? (${du(n)}) : `:"")+(r!=null?`${e} === '${El}' ? (${du(r)}) : `:"")+(t!=null?`${e} === '${Bi}' ? (${du(t)}) : `:"")+"(null)"}),du=e=>ut(e)?e.signal:e==null?null:G(e),Nre=(e,t)=>t===0?0:ut(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},xu=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function Zs(e,t,n,i){let r;if(t&&ee(t,e))return t[e];if(ee(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i[O_][r]}else if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i[od][r]}return null}function Lk(e){const t={};for(const n of e)if(!!n)for(const i in n)t[i]=1;return Object.keys(t)}function jre(e,t){var n=t.config,i=n.style,r=n.axis,o=t.scaleType(e.scale)==="band"&&n.axisBand,a=e.orient,s,u,l;if(ut(a)){const f=Lk([n.axisX,n.axisY]),d=Lk([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);s={};for(l of f)s[l]=vt(a,Zs(l,n.axisX,r,i),Zs(l,n.axisY,r,i));u={};for(l of d)u[l]=Dre(a.signal,Zs(l,n.axisTop,r,i),Zs(l,n.axisBottom,r,i),Zs(l,n.axisLeft,r,i),Zs(l,n.axisRight,r,i))}else s=a===Bi||a===na?n.axisX:n.axisY,u=n["axis"+a[0].toUpperCase()+a.slice(1)];return s||u||o?ce({},r,s,u,o):r}function Rre(e,t,n,i){const r=$n(e,t),o=e.orient;let a,s;const u={enter:a={opacity:xe},update:s={opacity:Qn},exit:{opacity:xe}};kt(u,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const l=zk(e,0),c=zk(e,1);return a.x=s.x=vt(o,l,xe),a.x2=s.x2=vt(o,c),a.y=s.y=$i(o,l,xe),a.y2=s.y2=$i(o,c),Bn({type:k_,role:one,from:i,encode:u},n)}function zk(e,t){return{scale:e.scale,range:t}}function Pre(e,t,n,i,r){const o=$n(e,t),a=e.orient,s=e.gridScale,u=R0(a,1,-1),l=Ire(e.offset,u);let c,f,d;const h={enter:c={opacity:xe},update:d={opacity:Qn},exit:f={opacity:xe}};kt(h,{stroke:o("gridColor"),strokeCap:o("gridCap"),strokeDash:o("gridDash"),strokeDashOffset:o("gridDashOffset"),strokeOpacity:o("gridOpacity"),strokeWidth:o("gridWidth")});const g={scale:e.scale,field:Jn,band:r.band,extra:r.extra,offset:r.offset,round:o("tickRound")},p=vt(a,{signal:"height"},{signal:"width"}),m=s?{scale:s,range:0,mult:u,offset:l}:{value:0,offset:l},y=s?{scale:s,range:1,mult:u,offset:l}:ce(p,{mult:u,offset:l});return c.x=d.x=vt(a,g,m),c.y=d.y=$i(a,g,m),c.x2=d.x2=$i(a,y),c.y2=d.y2=vt(a,y),f.x=vt(a,g),f.y=$i(a,g),Bn({type:k_,role:ane,key:Jn,from:i,encode:h},n)}function Ire(e,t){if(t!==1)if(!K(e))e=ut(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=ce({},e);for(;n.mult!=null;)if(K(n.mult))n=n.mult=ce({},n.mult);else return n.mult=ut(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function Lre(e,t,n,i,r,o){const a=$n(e,t),s=e.orient,u=R0(s,-1,1);let l,c,f;const d={enter:l={opacity:xe},update:f={opacity:Qn},exit:c={opacity:xe}};kt(d,{stroke:a("tickColor"),strokeCap:a("tickCap"),strokeDash:a("tickDash"),strokeDashOffset:a("tickDashOffset"),strokeOpacity:a("tickOpacity"),strokeWidth:a("tickWidth")});const h=yt(r);h.mult=u;const g={scale:e.scale,field:Jn,band:o.band,extra:o.extra,offset:o.offset,round:a("tickRound")};return f.y=l.y=vt(s,xe,g),f.y2=l.y2=vt(s,h),c.x=vt(s,g),f.x=l.x=$i(s,xe,g),f.x2=l.x2=$i(s,h),c.y=$i(s,g),Bn({type:k_,role:une,key:Jn,from:i,encode:d},n)}function S1(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function zre(e,t,n,i,r,o){const a=$n(e,t),s=e.orient,u=e.scale,l=R0(s,-1,1),c=es(a("labelFlush")),f=es(a("labelFlushOffset")),d=a("labelAlign"),h=a("labelBaseline");let g=c===0||!!c,p;const m=yt(r);m.mult=l,m.offset=yt(a("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:Jn,band:.5,offset:QR(o.offset,a("labelOffset"))},v=vt(s,g?S1(u,c,'"left"','"right"','"center"'):{value:"center"},kre(s,"left","right")),b=vt(s,r5(s,"bottom","top"),g?S1(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=S1(u,c,`-(${f})`,f,0);g=g&&f;const _={opacity:xe,x:vt(s,y,m),y:$i(s,y,m)},E={enter:_,update:p={opacity:Qn,text:{field:S_},x:_.x,y:_.y,align:v,baseline:b},exit:{opacity:xe,x:_.x,y:_.y}};kt(E,{dx:!d&&g?vt(s,x):null,dy:!h&&g?$i(s,x):null}),kt(E,{angle:a("labelAngle"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontWeight:a("labelFontWeight"),fontStyle:a("labelFontStyle"),limit:a("labelLimit"),lineHeight:a("labelLineHeight")},{align:d,baseline:h});const w=a("labelBound");let S=a("labelOverlap");return S=S||w?{separation:a("labelSeparation"),method:S,order:"datum.index",bound:w?{scale:u,orient:s,tolerance:w}:null}:void 0,p.align!==v&&(p.align=xu(p.align,v)),p.baseline!==b&&(p.baseline=xu(p.baseline,b)),Bn({type:Ls,role:sne,style:od,key:Jn,from:i,encode:E,overlap:S},n)}function Bre(e,t,n,i){const r=$n(e,t),o=e.orient,a=R0(o,-1,1);let s,u;const l={enter:s={opacity:xe,anchor:yt(r("titleAnchor",null)),align:{signal:C_}},update:u=ce({},s,{opacity:Qn,text:yt(e.title)}),exit:{opacity:xe}},c={signal:`lerp(range("${e.scale}"), ${D0(0,1,.5)})`};return u.x=vt(o,c),u.y=$i(o,c),s.angle=vt(o,xe,Nre(a,90)),s.baseline=vt(o,r5(o,na,Bi),{value:na}),u.angle=s.angle,u.baseline=s.baseline,kt(l,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),Ure(r,o,l,n),l.update.align=xu(l.update.align,s.align),l.update.angle=xu(l.update.angle,s.angle),l.update.baseline=xu(l.update.baseline,s.baseline),Bn({type:Ls,role:lne,style:O_,from:i,encode:l},n)}function Ure(e,t,n,i){const r=(s,u)=>s!=null?(n.update[u]=xu(yt(s),n.update[u]),!1):!au(u,i),o=r(e("titleX"),"x"),a=r(e("titleY"),"y");n.enter.auto=a===o?yt(a):vt(t,yt(a),yt(o))}function qre(e,t){const n=jre(e,t),i=e.encode||{},r=i.axis||{},o=r.name||void 0,a=r.interactive,s=r.style,u=$n(e,n),l=Lie(u),c={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:e.title!=null},f=te(t.add(zi({},[c]))),d=te(t.add(Wne({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),h=[];let g;return c.grid&&h.push(Pre(e,n,i.grid,d,l)),c.ticks&&(g=u("tickSize"),h.push(Lre(e,n,i.ticks,d,g,l))),c.labels&&(g=c.ticks?g:0,h.push(zre(e,n,i.labels,d,g,l))),c.domain&&h.push(Rre(e,n,i.domain,f)),c.title&&h.push(Bre(e,n,i.title,f)),j0(pf({role:rne,from:f,encode:wl(Wre(u,e),r,ad),marks:h,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:o,interactive:a,style:s}),t)}function Wre(e,t){const n={enter:{},update:{}};return kt(n,{orient:e("orient"),offset:e("offset")||0,position:pi(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function a5(e,t,n){const i=V(e.signals),r=V(e.scales);return n||i.forEach(o=>IR(o,t)),V(e.projections).forEach(o=>_ie(o,t)),r.forEach(o=>cie(o,t)),V(e.data).forEach(o=>Ore(o,t)),r.forEach(o=>fie(o,t)),(n||i).forEach(o=>qne(o,t)),V(e.axes).forEach(o=>qre(o,t)),V(e.marks).forEach(o=>j0(o,t)),V(e.legends).forEach(o=>hre(o,t)),e.title&&xre(e.title,t),t.parseLambdas(),t}const Gre=e=>wl({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function Hre(e,t){const n=t.config,i=te(t.root=t.add(Xg())),r=Yre(e,n);r.forEach(l=>IR(l,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const o=t.add(zi()),a=t.add(BR(PR(Gre(e.encode),M0,x_,e.style,t,{pulse:te(o)}))),s=t.add(WR({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:te(a)}));t.operators.pop(),t.pushState(te(a),te(s),null),a5(e,t,r),t.operators.push(s);let u=t.add(zR({mark:i,pulse:te(s)}));return u=t.add(qR({pulse:te(u)})),u=t.add(Is({pulse:te(u)})),t.addData("root",new bs(t,o,o,u)),t}function Jl(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Yre(e,t){const n=a=>pi(e[a],t[a]),i=[Jl("background",n("background")),Jl("autosize",tne(n("autosize"))),Jl("padding",ine(n("padding"))),Jl("width",n("width")||0),Jl("height",n("height")||0)],r=i.reduce((a,s)=>(a[s.name]=s,a),{}),o={};return V(e.signals).forEach(a=>{ee(r,a.name)?a=ce(r[a.name],a):i.push(a),o[a.name]=a}),V(t.signals).forEach(a=>{!ee(o,a.name)&&!ee(r,a.name)&&i.push(a)}),i}function s5(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function Bk(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}s5.prototype=Bk.prototype={parse(e){return a5(e,this)},fork(){return new Bk(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof Sv?te(e):e;return this.add(rie({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(i,r,o){let a,s;i&&(a=i.data||(i.data={}),s=a[r]||(a[r]=[]),s.push(o))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const i in t.index)n(t.index[i],e,"index:"+i)}return this},pushState(e,t,n){this._encode.push(te(this.add(Is({pulse:e})))),this._parent.push(t),this._lookup.push(n?te(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return ve(this._parent)},encode(){return ve(this._encode)},lookup(){return ve(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Y(e))return hf(e,t);e.signal||P("Unsupported field reference: "+G(e));const n=e.signal;let i=this.field[n];if(!i){const r={name:this.signalRef(n)};t&&(r.as=t),this.field[n]=i=te(this.add(Xne(r)))}return i},compareRef(e){let t=!1;const n=o=>ut(o)?(t=!0,this.signalRef(o.signal)):Dne(o)?(t=!0,this.exprRef(o.expr)):o,i=V(e.field).map(n),r=V(e.order).map(n);return t?te(this.add(kk({fields:i,orders:r}))):Ok(i,r)},keyRef(e,t){let n=!1;const i=o=>ut(o)?(n=!0,te(r[o.signal])):o,r=this.signals;return e=V(e).map(i),n?te(this.add(Vne({fields:e,flat:t}))):$ne(e,t)},sortRef(e){if(!e)return e;const t=F0(e.op,e.field),n=e.order||Fne;return n.signal?te(this.add(kk({fields:t,orders:this.signalRef(n.signal)}))):Ok(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},hasOwnSignal(e){return ee(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&P("Duplicate signal name: "+G(e));const n=t instanceof Sv?t:this.add(Xg(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||P("Unrecognized signal name: "+G(e)),this.signals[e]},signalRef(e){return this.signals[e]?te(this.signals[e]):(ee(this.lambdas,e)||(this.lambdas[e]=this.add(Xg(null))),te(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const i=e[t],r=gr(i,this),o=this.lambdas[i];o.params=r.$params,o.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return!e||!K(e)?e:this.signalRef(e.signal||D_(e))},exprRef(e,t){const n={expr:gr(e,this)};return t&&(n.expr.$name=t),te(this.add(Hne(n)))},addBinding(e,t){this.bindings||P("Nested signals do not support binding: "+G(e)),this.bindings.push(ce({signal:e},t))},addScaleProj(e,t){ee(this.scales,e)&&P("Duplicate scale or projection name: "+G(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,aie(t))},addProjection(e,t){this.addScaleProj(e,iie(t))},getScale(e){return this.scales[e]||P("Unrecognized scale name: "+G(e)),this.scales[e]},scaleRef(e){return te(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return ee(this.data,e)&&P("Duplicate data set name: "+G(e)),this.data[e]=t},getData(e){return this.data[e]||P("Undefined data set name: "+G(e)),this.data[e]},addDataPipeline(e,t){return ee(this.data,e)&&P("Duplicate data set name: "+G(e)),this.addData(e,bs.fromEntries(this,t))}};function D_(e){return(I(e)?Xre:Vre)(e)}function Xre(e){const t=e.length;let n="[";for(let i=0;i<t;++i){const r=e[i];n+=(i>0?",":"")+(K(r)?r.signal||D_(r):G(r))}return n+"]"}function Vre(e){let t="{",n=0,i,r;for(i in e)r=e[i],t+=(++n>1?",":"")+G(i)+":"+(K(r)?r.signal||D_(r):G(r));return t+"}"}function Kre(){const e="sans-serif",i="#4c78a8",r="#000",o="#888",a="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:2},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:e,fontSize:11},trail:{fill:i,size:2},style:{"guide-label":{fill:r,font:e,fontSize:10},"guide-title":{fill:r,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:a}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:o,grid:!1,gridWidth:1,gridColor:a,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:o,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:a,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:o,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function Jre(e,t,n){return K(e)||P("Input Vega specification must be an object."),t=sl(Kre(),t,e.config),Hre(e,new s5(t,n)).toRuntime()}var Qre="5.22.1";ce(Du,tB,_H,eY,zX,NV,sJ,zK,lJ,MJ,UJ,VJ);var Zre=Object.freeze(Object.defineProperty({__proto__:null,version:Qre,Dataflow:mu,EventStream:Pp,MultiPulse:hx,Operator:Re,Parameters:Rp,Pulse:Lo,Transform:N,changeset:Ns,definition:GT,ingest:Ce,isTuple:Np,transform:HT,transforms:Du,tupleid:ne,interpolate:C2,interpolateColors:i0,interpolateRange:G3,quantizeInterpolator:H3,scale:Ae,scheme:$2,projection:Aw,View:OR,defaultLocale:ux,formatLocale:Bh,locale:MT,resetDefaultLocale:t9,timeFormatLocale:Xc,expressionFunction:rt,parse:Jre,runtimeContext:dR,codegenExpression:Zj,parseExpression:a_,parseSelector:_a,Debug:E$,Error:fb,Info:_$,None:w$,Warn:db,accessor:Cn,accessorFields:Lt,accessorName:Qe,array:V,ascending:pp,clampRange:N$,compare:yb,constant:Gt,debounce:vb,error:P,extend:ce,extent:lr,extentIndex:j$,falsy:bo,fastmap:ll,field:wn,flush:R$,hasOwnProperty:ee,id:Ef,identity:Wt,inherits:W,inrange:su,isArray:I,isBoolean:ua,isDate:Po,isFunction:fe,isIterable:P$,isNumber:De,isObject:K,isRegExp:I$,isString:Y,key:bb,lerp:L$,logger:hb,lruCache:z$,merge:B$,mergeConfig:sl,one:al,pad:U$,panLinear:C$,panLog:$$,panPow:F$,panSymlog:T$,peek:ve,quarter:M$,repeat:oc,span:Sf,splitAccessPath:br,stringValue:G,toBoolean:xb,toDate:wb,toNumber:Rt,toSet:Mi,toString:_b,truncate:q$,truthy:Zn,utcquarter:D$,visitArray:_o,writeConfig:ul,zero:ko,zoomLinear:gb,zoomLog:pb,zoomPow:Th,zoomSymlog:mb,bandwidthNRD:yx,bin:XT,bootstrapCI:VT,cumulativeLogNormal:Ex,cumulativeNormal:Lp,cumulativeUniform:kx,densityLogNormal:_x,densityNormal:vx,densityUniform:Ax,dotbin:KT,quantileLogNormal:Sx,quantileNormal:zp,quantileUniform:Cx,quantiles:px,quartiles:mx,get random(){return ii},randomInteger:o7,randomKDE:xx,randomLCG:r7,randomLogNormal:QT,randomMixture:ZT,randomNormal:bx,randomUniform:eM,regressionExp:nM,regressionLinear:$x,regressionLoess:oM,regressionLog:tM,regressionPoly:rM,regressionPow:iM,regressionQuad:Fx,sampleCurve:Up,sampleLogNormal:wx,sampleNormal:Ip,sampleUniform:Ox,setRandom:n7,DATE:An,DAY:jt,DAYOFYEAR:dr,HOURS:In,MILLISECONDS:Di,MINUTES:Ln,MONTH:Bt,QUARTER:On,SECONDS:ni,TIME_UNITS:ix,WEEK:at,YEAR:At,dayofyear:tT,timeBin:vT,timeFloor:uT,timeInterval:gl,timeOffset:fT,timeSequence:gT,timeUnitSpecifier:eT,timeUnits:rx,utcFloor:lT,utcInterval:pl,utcOffset:dT,utcSequence:pT,utcdayofyear:rT,utcweek:oT,week:nT,format:ah,formats:fx,inferType:NT,inferTypes:jT,loader:Mp,read:IT,responseType:PT,typeParsers:ly,path:Wp,Bounds:it,CanvasHandler:Kf,CanvasRenderer:sg,Gradient:oD,GroupItem:a0,Handler:ea,Item:o0,Marks:zn,RenderType:Mo,Renderer:$r,ResourceLoader:R2,SVGHandler:ew,SVGRenderer:aw,SVGStringRenderer:sw,Scenegraph:Q2,boundClip:ZD,boundContext:Hf,boundItem:Cy,boundMark:SD,boundStroke:co,domChild:gn,domClear:bi,domCreate:Fo,domFind:Z2,font:f0,fontFamily:Vf,fontSize:Cr,intersect:VD,intersectBoxLine:uu,intersectPath:P2,intersectPoint:I2,intersectRule:hD,lineHeight:Qo,markup:ow,multiLineOffset:V2,pathCurves:D2,pathEqual:eN,pathParse:Lu,pathRectangle:uD,pathRender:ef,pathSymbols:sD,pathTrail:lD,point:h0,renderModule:g0,resetSVGClipId:fD,resetSVGDefIds:IG,sceneEqual:uw,sceneFromJSON:AD,scenePickVisit:tg,sceneToJSON:OD,sceneVisit:Ni,sceneZOrder:L2,serializeXML:BD,textMetrics:Ci},Symbol.toStringTag,{value:"Module"}));const sd={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function eoe(e){return e==="quantitative"||e==="temporal"}function u5(e){return e==="ordinal"||e==="nominal"}const xs=sd.quantitative,N_=sd.ordinal,Vu=sd.temporal,j_=sd.nominal,Sl=sd.geojson;function toe(e){if(e)switch(e=e.toLowerCase(),e){case"q":case xs:return"quantitative";case"t":case Vu:return"temporal";case"o":case N_:return"ordinal";case"n":case j_:return"nominal";case Sl:return"geojson"}}var noe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const bn={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Tv={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function ioe(e,t){const n=Tv[e],i=Tv[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const roe={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Uk(e){return roe[e]}const l5=new Set(["linear","log","pow","sqrt","symlog"]),c5=new Set([...l5,"time","utc"]);function f5(e){return l5.has(e)}const d5=new Set(["quantile","quantize","threshold"]),ooe=new Set([...c5,...d5,"sequential","identity"]),aoe=new Set(["ordinal","bin-ordinal","point","band"]);function wt(e){return aoe.has(e)}function Un(e){return ooe.has(e)}function Ai(e){return c5.has(e)}function Ku(e){return d5.has(e)}const soe={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0};function uoe(e){return!Y(e)&&!!e.name}function h5(e){return e==null?void 0:e.param}function loe(e){return e==null?void 0:e.unionWith}function coe(e){return K(e)&&"field"in e}const foe={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},doe=noe(foe,["type","domain","range","rangeMax","rangeMin","scheme"]),hoe=z(doe);function Mv(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Ai(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return Ai(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return Ai(e);case"nice":return Ai(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return Un(e)&&!me(["log","time","utc","threshold","quantile"],e)}}function g5(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return pu(e)?void 0:o4(t);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function goe(e,t){return me([N_,j_],t)?e===void 0||wt(e):t===Vu?me([bn.TIME,bn.UTC,void 0],e):t===xs?f5(e)||Ku(e)||e===void 0:!0}function poe(e,t,n=!1){if(!ga(e))return!1;switch(e){case He:case bt:case la:case cl:case ai:case Pi:return Ai(t)||t==="band"?!0:t==="point"?!n:!1;case uo:case da:case lo:case ca:case fa:case ks:return Ai(t)||Ku(t)||me(["band","point","ordinal"],t);case _n:case Er:case Sr:return t!=="band";case ha:case En:return t==="ordinal"||Ku(t)}}const un={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},p5=un.arc,P0=un.area,I0=un.bar,moe=un.image,L0=un.line,z0=un.point,yoe=un.rect,Vg=un.rule,m5=un.text,R_=un.tick,voe=un.trail,P_=un.circle,I_=un.square,y5=un.geoshape;function Ea(e){return["line","area","trail"].includes(e)}function v5(e){return["rect","bar","image","arc"].includes(e)}const boe=new Set(z(un));function pr(e){return e.type}const xoe=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],woe=["fill","fillOpacity"],_oe=[...xoe,...woe],Eoe={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},qk=z(Eoe),Soe={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},Ooe={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},Aoe={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},b5=z(Aoe);function ws(e){return e&&e.band!=null}const koe={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},x5=5,Coe={binSpacing:1,continuousBandSize:x5,timeUnitBandPosition:.5},$oe={binSpacing:0,continuousBandSize:x5,timeUnitBandPosition:.5},Foe={thickness:1};function Toe(e){return pr(e)?e.type:e}function L_(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:o}=e,a=B_(e);return q(n)&&!cF(n.aggregate)&&r&&Ai(r.get("type"))?Moe({fieldDef:n,channel:t,markDef:i,ref:a,config:o}):a}function Moe({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){return Ea(n.type)?i:Fe("invalid",n,r)===null?[Doe(e,t),i]:i}function Doe(e,t){const n=z_(e,!0),r=Cs(t)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function z_(e,t=!0){return Zb(Y(e)?e:H(e,{expr:"datum"}),!t)}function Noe(e){const{datum:t}=e;return Fs(t)?Gc(t):`${Ie(t)}`}function ts(e,t,n,i){const r={};if(t&&(r.scale=t),Mr(e)){const{datum:o}=e;Fs(o)?r.signal=Gc(o):Z(o)?r.signal=o.signal:Ff(o)?r.signal=o.expr:r.value=o}else r.field=H(e,n);if(i){const{offset:o,band:a}=i;o&&(r.offset=o),a&&(r.band=a)}return r}function Kg({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:o=.5}){const a=0<o&&o<1?"datum":void 0,s=H(t,{expr:a,suffix:r}),u=n!==void 0?H(n,{expr:a}):H(t,{suffix:"end",expr:a}),l={};if(o===0||o===1){l.scale=e;const c=o===0?s:u;l.field=c}else{const c=Z(o)?`${o.signal} * ${s} + (1-${o.signal}) * ${u}`:`${o} * ${s} + ${1-o} * ${u}`;l.signal=`scale("${e}", ${c})`}return i&&(l.offset=i),l}function B_({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:o,scale:a,stack:s,offset:u,defaultRef:l,bandPosition:c}){var f;if(t){if(se(t)){const d=a==null?void 0:a.get("type");if(oi(t)){c!=null||(c=C5({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:h,timeUnit:g,type:p}=t;if(Le(h)||c&&g&&p===Vu)return s!=null&&s.impute?ts(t,o,{binSuffix:"mid"},{offset:u}):c&&!wt(d)?Kg({scaleName:o,fieldOrDatumDef:t,bandPosition:c,offset:u}):ts(t,o,fd(t,e)?{binSuffix:"range"}:{},{offset:u});if(Et(h)){if(q(n))return Kg({scaleName:o,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:c,offset:u});U(OF(e===He?Ri:xr))}}return ts(t,o,wt(d)?{binSuffix:"range"}:{},{offset:u,band:d==="band"?(f=c!=null?c:t.bandPosition)!==null&&f!==void 0?f:.5:void 0})}else if(ji(t)){const d=t.value,h=u?{offset:u}:{};return Object.assign(Object.assign({},zc(e,d)),h)}}return fe(l)&&(l=l()),l&&Object.assign(Object.assign({},l),u?{offset:u}:{})}function zc(e,t){return me(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:me(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:ze(t)}function _s(e){return e&&e!=="number"&&e!=="time"}function w5(e,t,n){return`${e}(${t}${n?`, ${Ie(n)}`:""})`}const joe=" \u2013 ";function U_({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:o}){var a,s;if(_s(n))return ki({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:o});const u=_5(e,i,r),l=Ju(e);if(t===void 0&&n===void 0&&o.customFormatTypes){if(l==="quantitative"){if(r&&o.normalizedNumberFormatType)return ki({fieldOrDatumDef:e,format:o.normalizedNumberFormat,formatType:o.normalizedNumberFormatType,expr:i,config:o});if(o.numberFormatType)return ki({fieldOrDatumDef:e,format:o.numberFormat,formatType:o.numberFormatType,expr:i,config:o})}if(l==="temporal"&&o.timeFormatType&&q(e)&&e.timeUnit===void 0)return ki({fieldOrDatumDef:e,format:o.timeFormat,formatType:o.timeFormatType,expr:i,config:o})}if(Zu(e)){const c=Poe({field:u,timeUnit:q(e)?(a=Ht(e.timeUnit))===null||a===void 0?void 0:a.unit:void 0,format:t,formatType:o.timeFormatType,rawTimeFormat:o.timeFormat,isUTCScale:zs(e)&&((s=e.scale)===null||s===void 0?void 0:s.type)===bn.UTC});return c?{signal:c}:void 0}if(t=Dv({type:l,specifiedFormat:t,config:o,normalizeStack:r}),q(e)&&Le(e.bin)){const c=H(e,{expr:i,binSuffix:"end"});return{signal:ud(u,c,t,n,o)}}else return t||Ju(e)==="quantitative"?{signal:`${O5(u,t)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function _5(e,t,n){return q(e)?n?`${H(e,{expr:t,suffix:"end"})}-${H(e,{expr:t,suffix:"start"})}`:H(e,{expr:t}):Noe(e)}function ki({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:o,field:a}){if(a!=null||(a=_5(e,i,r)),a!=="datum.value"&&q(e)&&Le(e.bin)){const s=H(e,{expr:i,binSuffix:"end"});return{signal:ud(a,s,t,n,o)}}return{signal:w5(n,a,t)}}function E5(e,t,n,i,r,o){var a;if(!_s(i)&&!(n===void 0&&i===void 0&&r.customFormatTypes&&Ju(e)==="quantitative"&&(r.normalizedNumberFormatType&&Qu(e)&&e.stack==="normalize"||r.numberFormatType))){if(Qu(e)&&e.stack==="normalize"&&r.normalizedNumberFormat)return Dv({type:"quantitative",config:r,normalizeStack:!0});if(Zu(e)){const s=q(e)?(a=Ht(e.timeUnit))===null||a===void 0?void 0:a.unit:void 0;return s===void 0&&r.customFormatTypes&&r.timeFormatType?void 0:Roe({specifiedFormat:n,timeUnit:s,config:r,omitTimeFormatConfig:o})}return Dv({type:t,specifiedFormat:n,config:r})}}function S5(e,t,n){var i;if(e&&(Z(e)||e==="number"||e==="time"))return e;if(Zu(t)&&n!=="time"&&n!=="utc")return q(t)&&((i=Ht(t==null?void 0:t.timeUnit))===null||i===void 0?void 0:i.utc)?"utc":"time"}function Dv({type:e,specifiedFormat:t,config:n,normalizeStack:i}){if(Y(t))return t;if(e===xs)return i?n.normalizedNumberFormat:n.numberFormat}function Roe({specifiedFormat:e,timeUnit:t,config:n,omitTimeFormatConfig:i}){return e||(t?{signal:TF(t)}:i?void 0:n.timeFormat)}function O5(e,t){return`format(${e}, "${t||""}")`}function Wk(e,t,n,i){var r;return _s(n)?w5(n,e,t):O5(e,(r=Y(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function ud(e,t,n,i,r){if(n===void 0&&i===void 0&&r.customFormatTypes&&r.numberFormatType)return ud(e,t,r.numberFormat,r.numberFormatType,r);const o=Wk(e,n,i,r),a=Wk(t,n,i,r);return`${Zb(e,!1)} ? "null" : ${o} + "${joe}" + ${a}`}function Poe({field:e,timeUnit:t,format:n,formatType:i,rawTimeFormat:r,isUTCScale:o}){return!t||n?!t&&i?`${i}(${e}, '${n}')`:(n=Y(n)?n:r,`${o?"utc":"time"}Format(${e}, '${n}')`):W4(t,e,o)}const B0="min",Ioe={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function Gk(e){return e in Ioe}function A5(e){return!!(e!=null&&e.encoding)}function ar(e){return e&&(e.op==="count"||!!e.field)}function k5(e){return e&&I(e)}function ld(e){return"row"in e||"column"in e}function q_(e){return!!e&&"header"in e}function U0(e){return"facet"in e}var Nv=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Loe(e){return e.param}function zoe(e){return e&&!Y(e)&&"repeat"in e}function Hk(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function W_(e){return"sort"in e}function C5({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(se(e)&&e.bandPosition!==void 0)return e.bandPosition;if(q(e)){const{timeUnit:r,bin:o}=e;if(r&&!t)return v5(n.type)?0:us("timeUnitBandPosition",n,i);if(Le(o))return .5}}function $5({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:o,useVlSizeChannel:a}){var s,u,l;const c=Sn(e),f=Fe(a?"size":c,i,r,{vgChannel:c});if(f!==void 0)return f;if(q(t)){const{timeUnit:d,bin:h}=t;if(d&&!n)return{band:us("timeUnitBandSize",i,r)};if(Le(h)&&!wt(o))return{band:1}}if(v5(i.type))return o?wt(o)?((s=r[i.type])===null||s===void 0?void 0:s.discreteBandSize)||{band:1}:(u=r[i.type])===null||u===void 0?void 0:u.continuousBandSize:(l=r[i.type])===null||l===void 0?void 0:l.discreteBandSize}function F5(e,t,n,i){return Le(e.bin)||e.timeUnit&&oi(e)&&e.type==="temporal"?C5({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function q0(e){return e&&"condition"in e}function W0(e){const t=e==null?void 0:e.condition;return!!t&&!I(t)&&q(t)}function cd(e){const t=e==null?void 0:e.condition;return!!t&&!I(t)&&se(t)}function Boe(e){const t=e==null?void 0:e.condition;return!!t&&(I(t)||ji(t))}function q(e){return e&&(!!e.field||e.aggregate==="count")}function Ju(e){return e==null?void 0:e.type}function Mr(e){return e&&"datum"in e}function tr(e){return oi(e)&&!Jg(e)||jv(e)}function jv(e){return Mr(e)&&De(e.datum)}function se(e){return q(e)||Mr(e)}function oi(e){return e&&("field"in e||e.aggregate==="count")&&"type"in e}function ji(e){return e&&"value"in e&&"value"in e}function zs(e){return e&&("scale"in e||"sort"in e)}function Qu(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function T5(e){return e&&"legend"in e}function M5(e){return e&&("format"in e||"formatType"in e)}function Uoe(e){return yn(e,["legend","axis","header","scale"])}function qoe(e){return"op"in e}function H(e,t={}){var n,i,r;let o=e.field;const a=t.prefix;let s=t.suffix,u="";if(Goe(e))o=J$("count");else{let l;if(!t.nofn)if(qoe(e))l=e.op;else{const{bin:c,aggregate:f,timeUnit:d}=e;Le(c)?(l=fF(c),s=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?pa(f)?(u=`["${o}"]`,o=`argmax_${f.argmax}`):no(f)?(u=`["${o}"]`,o=`argmin_${f.argmin}`):l=String(f):d&&(l=G4(d),s=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}l&&(o=o?`${l}_${o}`:l)}return s&&(o=`${o}_${s}`),a&&(o=`${a}_${o}`),t.forAs?Tb(o):t.expr?X$(o,t.expr)+u:ei(o)+u}function Jg(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return q(e)&&!!e.bin;case"temporal":return!1}throw new Error(wF(e.type))}function Woe(e){var t;return zs(e)&&Ku((t=e.scale)===null||t===void 0?void 0:t.type)}function Goe(e){return e.aggregate==="count"}function Hoe(e,t){var n;const{field:i,bin:r,timeUnit:o,aggregate:a}=e;if(a==="count")return t.countTitle;if(Le(r))return`${i} (binned)`;if(o){const s=(n=Ht(o))===null||n===void 0?void 0:n.unit;if(s)return`${i} (${Gb(s).join("-")})`}else if(a)return pa(a)?`${i} for max ${a.argmax}`:no(a)?`${i} for min ${a.argmin}`:`${Of(a)} of ${i}`;return i}function Yoe(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(pa(t))return`${r} for argmax(${t.argmax})`;if(no(t))return`${r} for argmin(${t.argmin})`;const o=Ht(i),a=t||(o==null?void 0:o.unit)||(o==null?void 0:o.maxbins)&&"timeunit"||Le(n)&&"bin";return a?`${a.toUpperCase()}(${r})`:r}const D5=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Yoe(e);default:return Hoe(e,t)}};let N5=D5;function j5(e){N5=e}function Xoe(){j5(D5)}function wu(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,o;const a=(r=G_(e))===null||r===void 0?void 0:r.title;if(!q(e))return a!=null?a:e.title;const s=e,u=i?H_(s,t):void 0;return n?nt(a,s.title,u):(o=a!=null?a:s.title)!==null&&o!==void 0?o:u}function G_(e){if(Qu(e)&&e.axis)return e.axis;if(T5(e)&&e.legend)return e.legend;if(q_(e)&&e.header)return e.header}function H_(e,t){return N5(e,t)}function Qg(e){var t;if(M5(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=G_(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function Voe(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(W_(e)&&I(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:o}=e;if(o)return"temporal";if(r||i&&!pa(i)&&!no(i))return"quantitative";if(zs(e)&&((n=e.scale)===null||n===void 0?void 0:n.type))switch(Tv[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function mr(e){if(q(e))return e;if(W0(e))return e.condition}function st(e){if(se(e))return e;if(cd(e))return e.condition}function R5(e,t,n,i={}){if(Y(e)||De(e)||ua(e)){const r=Y(e)?"string":De(e)?"number":"boolean";return U(HL(t,r,e)),{value:e}}return se(e)?Zg(e,t,n,i):cd(e)?Object.assign(Object.assign({},e),{condition:Zg(e.condition,t,n,i)}):e}function Zg(e,t,n,i){if(M5(e)){const{format:r,formatType:o}=e,a=Nv(e,["format","formatType"]);if(_s(o)&&!n.customFormatTypes)return U(ZE(t)),Zg(a,t,n,i)}else{const r=Qu(e)?"axis":T5(e)?"legend":q_(e)?"header":null;if(r&&e[r]){const o=e[r],{format:a,formatType:s}=o,u=Nv(o,["format","formatType"]);if(_s(s)&&!n.customFormatTypes)return U(ZE(t)),Zg(Object.assign(Object.assign({},e),{[r]:u}),t,n,i)}}return q(e)?Y_(e,t,i):Koe(e)}function Koe(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=De(n)?"quantitative":Y(n)?"nominal":Fs(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function Y_(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:o,field:a}=e,s=Object.assign({},e);if(!n&&i&&!Ib(i)&&!pa(i)&&!no(i)&&(U(XL(i)),delete s.aggregate),r&&(s.timeUnit=Ht(r)),a&&(s.field=`${a}`),Le(o)&&(s.bin=G0(o,t)),Et(o)&&!xt(t)&&U(k4(t)),oi(s)){const{type:u}=s,l=toe(u);u!==l&&(s.type=l),u!=="quantitative"&&cF(i)&&(U(YL(u,i)),s.type="quantitative")}else if(!iF(t)){const u=Voe(s,t);s.type=u}if(oi(s)){const{compatible:u,warning:l}=Joe(s,t)||{};u===!1&&U(l)}if(W_(s)&&Y(s.sort)){const{sort:u}=s;if(Gk(u))return Object.assign(Object.assign({},s),{sort:{encoding:u}});const l=u.substr(1);if(u.charAt(0)==="-"&&Gk(l))return Object.assign(Object.assign({},s),{sort:{encoding:l,order:"descending"}})}if(q_(s)){const{header:u}=s;if(u){const{orient:l}=u,c=Nv(u,["orient"]);if(l)return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},c),{labelOrient:u.labelOrient||l,titleOrient:u.titleOrient||l})})}}return s}function G0(e,t){return ua(e)?{maxbins:WE(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:WE(t)}):e}const eu={compatible:!0};function Joe(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Vr:case Kr:case yp:return Jg(e)?eu:{compatible:!1,warning:ZL(t)};case He:case bt:case la:case cl:case _n:case Er:case Sr:case kf:case $f:case vp:case ss:case bp:case xp:case ks:case ai:case Pi:case wp:return eu;case _r:case ti:case wr:case Ii:return n!==xs?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:eu;case lo:case ca:case fa:case da:case uo:case so:case ao:case Ri:case xr:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:eu;case En:case ha:return!Jg(e)&&!Woe(e)?{compatible:!1,warning:e4(t)}:eu;case Cf:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:eu}}function Zu(e){const{formatType:t}=Qg(e);return t==="time"||!t&&Qoe(e)}function Qoe(e){return e&&(e.type==="temporal"||q(e)&&!!e.timeUnit)}function H0(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var o;const a=t&&((o=Ht(t))===null||o===void 0?void 0:o.unit);let s=a||n==="temporal",u;return Ff(e)?u=e.expr:Z(e)?u=e.signal:Fs(e)?(s=!0,u=Gc(e)):(Y(e)||De(e))&&s&&(u=`datetime(${Ie(e)})`,z4(a)&&(De(e)&&e<1e4||Y(e)&&isNaN(Date.parse(e)))&&(u=Gc({[a]:e}))),u?i&&s?`time(${u})`:u:r?void 0:Ie(e)}function P5(e,t){const{type:n}=e;return t.map(i=>{const r=H0(i,{timeUnit:q(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function fd(e,t){return Le(e.bin)?ga(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const Yk={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function dd(e){return e==null?void 0:e.condition}const I5=["domain","grid","labels","ticks","title"],Zoe={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},L5={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},eae=Object.assign(Object.assign({},L5),{style:1,labelExpr:1,encoding:1});function Xk(e){return!!eae[e]}const tae={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},z5=z(tae);function go(e){return"mark"in e}class Y0{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return go(t)?Toe(t.mark)===this.name:!1}}var nae=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ns(e,t){const n=e&&e[t];return n?I(n)?os(n,i=>!!i.field):q(n)||W0(n):!1}function B5(e,t){const n=e&&e[t];return n?I(n)?os(n,i=>!!i.field):q(n)||Mr(n)||cd(n):!1}function Rv(e,t){if(xt(t)){const n=e[t];if((q(n)||Mr(n))&&u5(n.type)){const i=rF(t);return B5(e,i)}}return!1}function X_(e){return os(JI,t=>{if(ns(e,t)){const n=e[t];if(I(n))return os(n,i=>!!i.aggregate);{const i=mr(n);return i&&!!i.aggregate}}return!1})}function U5(e,t){const n=[],i=[],r=[],o=[],a={};return V_(e,(s,u)=>{if(q(s)){const{field:l,aggregate:c,bin:f,timeUnit:d}=s,h=nae(s,["field","aggregate","bin","timeUnit"]);if(c||d||f){const g=G_(s),p=g==null?void 0:g.title;let m=H(s,{forAs:!0});const y=Object.assign(Object.assign(Object.assign({},p?[]:{title:wu(s,t,{allowDisabling:!0})}),h),{field:m});if(c){let v;if(pa(c)?(v="argmax",m=H({op:"argmax",field:c.argmax},{forAs:!0}),y.field=`${m}.${l}`):no(c)?(v="argmin",m=H({op:"argmin",field:c.argmin},{forAs:!0}),y.field=`${m}.${l}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(v=c),v){const b={op:v,as:m};l&&(b.field=l),o.push(b)}}else if(n.push(m),oi(s)&&Le(f)){if(i.push({bin:f,field:l,as:m}),n.push(H(s,{binSuffix:"end"})),fd(s,u)&&n.push(H(s,{binSuffix:"range"})),xt(u)){const v={field:`${m}_end`};a[`${u}2`]=v}y.bin="binned",iF(u)||(y.type=xs)}else if(d){r.push({timeUnit:d,field:l,as:m});const v=oi(s)&&s.type!==Vu&&"time";v&&(u===kf||u===ss?y.formatType=v:sL(u)?y.legend=Object.assign({formatType:v},y.legend):xt(u)&&(y.axis=Object.assign({formatType:v},y.axis)))}a[u]=y}else n.push(l),a[u]=e[u]}else a[u]=e[u]}),{bins:i,timeUnits:r,aggregate:o,groupby:n,encoding:a}}function iae(e,t,n){const i=lL(t,n);if(i){if(i==="binned"){const r=e[t===Ri?He:bt];return!!(q(r)&&q(e[t])&&Et(r.bin))}}else return!1;return!0}function rae(e,t,n,i){const r={};for(const o of z(e))nF(o)||U(QL(o));for(let o of iL){if(!e[o])continue;const a=e[o];if(fl(o)){const s=oF(o),u=r[s];if(q(u)){if(eoe(u.type)&&q(a)){U(WL(s));continue}}else o=s,U(GL(s))}if(o==="angle"&&t==="arc"&&!e.theta&&(U(qL),o=ai),!iae(e,o,t)){U(Op(o,t));continue}if(o===uo&&t==="line"){const s=mr(e[o]);if(s!=null&&s.aggregate){U(KL);continue}}if(o===_n&&(n?"fill"in e:"stroke"in e)){U(_F("encoding",{fill:"fill"in e,stroke:"stroke"in e}));continue}if(o===$f||o===Cf&&!I(a)&&!ji(a)||o===ss&&I(a))a&&(r[o]=V(a).reduce((s,u)=>(q(u)?s.push(Y_(u,o)):U(V1(u,o)),s),[]));else{if(o===ss&&a===null)r[o]=null;else if(!q(a)&&!Mr(a)&&!ji(a)&&!q0(a)&&!Z(a)){U(V1(a,o));continue}r[o]=R5(a,o,i)}}return r}function X0(e,t){const n={};for(const i of z(e)){const r=R5(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function oae(e){const t=[];for(const n of z(e))if(ns(e,n)){const i=e[n],r=V(i);for(const o of r)q(o)?t.push(o):W0(o)&&t.push(o.condition)}return t}function V_(e,t,n){if(!!e)for(const i of z(e)){const r=e[i];if(I(r))for(const o of r)t.call(n,o,i);else t.call(n,r,i)}}function aae(e,t,n,i){return e?z(e).reduce((r,o)=>{const a=e[o];return I(a)?a.reduce((s,u)=>t.call(i,s,u,o),r):t.call(i,r,a,o)},n):n}function q5(e,t){return z(t).reduce((n,i)=>{switch(i){case He:case bt:case bp:case wp:case xp:case Ri:case xr:case la:case cl:case ai:case so:case Pi:case ao:case wr:case _r:case Ii:case ti:case kf:case En:case ks:case ss:return n;case Cf:if(e==="line"||e==="trail")return n;case $f:case vp:{const r=t[i];if(I(r)||q(r))for(const o of V(r))o.aggregate||n.push(H(o,{}));return n}case uo:if(e==="trail")return n;case _n:case Er:case Sr:case lo:case ca:case fa:case ha:case da:{const r=mr(t[i]);return r&&!r.aggregate&&n.push(H(r,{})),n}}},[])}var W5=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function sae(e){const{tooltip:t}=e,n=W5(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(I(t)){for(const o of t)o.aggregate?(i||(i=[]),i.push(o)):(r||(r=[]),r.push(o));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return I(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Pv(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:a,titlePrefix:s})=>{const u=i?` of ${K_(t)}`:"";return{field:a+t.field,type:t.type,title:Z(s)?{signal:`${s}"${escape(u)}"`}:s+u}}),o=oae(n).map(Uoe);return{tooltip:[...r,...er(o,be)]}}function K_(e){const{title:t,field:n}=e;return nt(t,n)}function J_(e,t,n,i,r){const{scale:o,axis:a}=n;return({partName:s,mark:u,positionPrefix:l,endPositionPrefix:c=void 0,extraEncoding:f={}})=>{const d=K_(n);return G5(e,s,r,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:`${l}_${n.field}`,type:n.type},d!==void 0?{title:d}:{}),o!==void 0?{scale:o}:{}),a!==void 0?{axis:a}:{})},Y(c)?{[`${t}2`]:{field:`${c}_${n.field}`}}:{}),i),f)})}}function G5(e,t,n,i){const{clip:r,color:o,opacity:a}=e,s=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),o?{color:o}:{}),a?{opacity:a}:{}),pr(i.mark)?i.mark:{type:i.mark}),{style:`${s}-${String(t)}`}),ua(e[t])?{}:e[t])})]:[]}function H5(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",o=i[r],a=i[`${r}2`],s=i[`${r}Error`],u=i[`${r}Error2`];return{continuousAxisChannelDef:Gd(o,n),continuousAxisChannelDef2:Gd(a,n),continuousAxisChannelDefError:Gd(s,n),continuousAxisChannelDefError2:Gd(u,n),continuousAxis:r}}function Gd(e,t){if(e!=null&&e.aggregate){const{aggregate:n}=e,i=W5(e,["aggregate"]);return n!==t&&U(A4(n,t)),i}else return e}function Y5(e,t){const{mark:n,encoding:i}=e,{x:r,y:o}=i;if(pr(n)&&n.orient)return n.orient;if(tr(r)){if(tr(o)){const a=q(r)&&r.aggregate,s=q(o)&&o.aggregate;if(!a&&s===t)return"vertical";if(!s&&a===t)return"horizontal";if(a===t&&s===t)throw new Error("Both x and y cannot have aggregate");return Zu(o)&&!Zu(r)?"horizontal":"vertical"}return"horizontal"}else{if(tr(o))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}var $h=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const ep="boxplot",uae=["box","median","outliers","rule","ticks"],lae=new Y0(ep,V5);function X5(e){return De(e)?"tukey":e}function V5(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:X0(e.encoding,t)});const{mark:r,encoding:o,params:a,projection:s}=e,u=$h(e,["mark","encoding","params","projection"]),l=pr(r)?r:{type:r};a&&U(xF("boxplot"));const c=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=Fe("size",l,t),d=l.invalid,h=X5(c),{bins:g,timeUnits:p,transform:m,continuousAxisChannelDef:y,continuousAxis:v,groupby:b,aggregate:x,encodingWithoutContinuousAxis:_,ticksOrient:E,boxOrient:w,customTooltipWithoutAggregatedField:S}=cae(e,c,t),{color:C,size:A}=_,O=$h(_,["color","size"]),F=qn=>J_(l,v,y,qn,t.boxplot),k=F(O),M=F(_),$=F(Object.assign(Object.assign({},O),A?{size:A}:{})),T=Pv([{fieldPrefix:h==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:h==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],y,_),D={type:"tick",color:"black",opacity:1,orient:E,invalid:d,aria:!1},R=h==="min-max"?T:Pv([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],y,_),L=[...k({partName:"rule",mark:{type:"rule",invalid:d,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:R}),...k({partName:"rule",mark:{type:"rule",invalid:d,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:R}),...k({partName:"ticks",mark:D,positionPrefix:"lower_whisker",extraEncoding:R}),...k({partName:"ticks",mark:D,positionPrefix:"upper_whisker",extraEncoding:R})],J=[...h!=="tukey"?L:[],...M({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:w,invalid:d,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:T}),...$({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:d},K(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:E,aria:!1}),positionPrefix:"mid_box",extraEncoding:T})];if(h==="min-max")return Object.assign(Object.assign({},u),{transform:((i=u.transform)!==null&&i!==void 0?i:[]).concat(m),layer:J});const ue=`datum["lower_box_${y.field}"]`,_e=`datum["upper_box_${y.field}"]`,Ee=`(${_e} - ${ue})`,Ye=`${ue} - ${c} * ${Ee}`,pe=`${_e} + ${c} * ${Ee}`,ft=`datum["${y.field}"]`,li={joinaggregate:K5(y.field),groupby:b},$t={transform:[{filter:`(${Ye} <= ${ft}) && (${ft} <= ${pe})`},{aggregate:[{op:"min",field:y.field,as:`lower_whisker_${y.field}`},{op:"max",field:y.field,as:`upper_whisker_${y.field}`},{op:"min",field:`lower_box_${y.field}`,as:`lower_box_${y.field}`},{op:"max",field:`upper_box_${y.field}`,as:`upper_box_${y.field}`},...x],groupby:b}],layer:L},X=$h(O,["tooltip"]),{scale:ae,axis:de}=y,B=K_(y),We=yn(de,["title"]),we=G5(l,"outliers",t.boxplot,{transform:[{filter:`(${ft} < ${Ye}) || (${ft} > ${pe})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[v]:Object.assign(Object.assign(Object.assign({field:y.field,type:y.type},B!==void 0?{title:B}:{}),ae!==void 0?{scale:ae}:{}),Me(We)?{}:{axis:We})},X),C?{color:C}:{}),S?{tooltip:S}:{})})[0];let Ze;const Xe=[...g,...p,li];return we?Ze={transform:Xe,layer:[we,$t]}:(Ze=$t,Ze.transform.unshift(...Xe)),Object.assign(Object.assign({},u),{layer:[Ze,{transform:m,layer:J}]})}function K5(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function cae(e,t,n){const i=Y5(e,ep),{continuousAxisChannelDef:r,continuousAxis:o}=H5(e,i,ep),a=r.field,s=X5(t),u=[...K5(a),{op:"median",field:a,as:`mid_box_${a}`},{op:"min",field:a,as:(s==="min-max"?"lower_whisker_":"min_")+a},{op:"max",field:a,as:(s==="min-max"?"upper_whisker_":"max_")+a}],l=s==="min-max"||s==="tukey"?[]:[{calculate:`datum["upper_box_${a}"] - datum["lower_box_${a}"]`,as:`iqr_${a}`},{calculate:`min(datum["upper_box_${a}"] + datum["iqr_${a}"] * ${t}, datum["max_${a}"])`,as:`upper_whisker_${a}`},{calculate:`max(datum["lower_box_${a}"] - datum["iqr_${a}"] * ${t}, datum["min_${a}"])`,as:`lower_whisker_${a}`}],c=e.encoding,f=o;c[f];const d=$h(c,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:h,filteredEncoding:g}=sae(d),{bins:p,timeUnits:m,aggregate:y,groupby:v,encoding:b}=U5(g,n),x=i==="vertical"?"horizontal":"vertical",_=i,E=[...p,...m,{aggregate:[...y,...u],groupby:v},...l];return{bins:p,timeUnits:m,transform:E,groupby:v,aggregate:y,continuousAxisChannelDef:r,continuousAxis:o,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:_,customTooltipWithoutAggregatedField:h}}var Vk=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Q_="errorbar",fae=["ticks","rule"],dae=new Y0(Q_,J5);function J5(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:X0(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,ticksOrient:a,markDef:s,outerSpec:u,tooltipEncoding:l}=Q5(e,Q_,t);delete o.size;const c=J_(s,r,i,o,t.errorbar),f=s.thickness,d=s.size,h=Object.assign(Object.assign({type:"tick",orient:a,aria:!1},f!==void 0?{thickness:f}:{}),d!==void 0?{size:d}:{}),g=[...c({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:l}),...c({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:l}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},f!==void 0?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),g.length>1?{layer:g}:Object.assign({},g[0]))}function hae(e,t){const{encoding:n}=e;if(gae(n))return{orient:Y5(e,t),inputType:"raw"};const i=pae(n),r=mae(n),o=n.x,a=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const s=n.x2,u=n.y2;if(se(s)&&se(u))throw new Error(`${t} cannot have both x2 and y2`);if(se(s)){if(tr(o))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(se(u)){if(tr(a))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const s=n.xError,u=n.xError2,l=n.yError,c=n.yError2;if(se(u)&&!se(s))throw new Error(`${t} cannot have xError2 without xError`);if(se(c)&&!se(l))throw new Error(`${t} cannot have yError2 without yError`);if(se(s)&&se(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(se(s)){if(tr(o))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(se(l)){if(tr(a))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function gae(e){return(se(e.x)||se(e.y))&&!se(e.x2)&&!se(e.y2)&&!se(e.xError)&&!se(e.xError2)&&!se(e.yError)&&!se(e.yError2)}function pae(e){return se(e.x2)||se(e.y2)}function mae(e){return se(e.xError)||se(e.xError2)||se(e.yError)||se(e.yError2)}function Q5(e,t,n){var i;const{mark:r,encoding:o,params:a,projection:s}=e,u=Vk(e,["mark","encoding","params","projection"]),l=pr(r)?r:{type:r};a&&U(xF(t));const{orient:c,inputType:f}=hae(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:g,continuousAxisChannelDefError2:p,continuousAxis:m}=H5(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=yae(l,d,h,g,p,f,t,n),_=o,E=m;_[E];const w=m==="x"?"x2":"y2";_[w];const S=m==="x"?"xError":"yError";_[S];const C=m==="x"?"xError2":"yError2";_[C];const A=Vk(_,[typeof E=="symbol"?E:E+"",typeof w=="symbol"?w:w+"",typeof S=="symbol"?S:S+"",typeof C=="symbol"?C:C+""]),{bins:O,timeUnits:F,aggregate:k,groupby:M,encoding:$}=U5(A,n),T=[...k,...y],D=f!=="raw"?[]:M,R=Pv(b,d,$,x);return{transform:[...(i=u.transform)!==null&&i!==void 0?i:[],...O,...F,...T.length===0?[]:[{aggregate:T,groupby:D}],...v],groupby:D,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:$,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:R}}function yae(e,t,n,i,r,o,a,s){let u=[],l=[];const c=t.field;let f,d=!1;if(o==="raw"){const h=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":s.errorbar.center,g=e.extent?e.extent:h==="mean"?"stderr":"iqr";if(h==="median"!=(g==="iqr")&&U(O4(h,g,a)),g==="stderr"||g==="stdev")u=[{op:g,field:c,as:`extent_${c}`},{op:h,field:c,as:`center_${c}`}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:`upper_${c}`},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:`lower_${c}`}],f=[{fieldPrefix:"center_",titlePrefix:Of(h)},{fieldPrefix:"upper_",titlePrefix:Kk(h,g,"+")},{fieldPrefix:"lower_",titlePrefix:Kk(h,g,"-")}],d=!0;else{let p,m,y;g==="ci"?(p="mean",m="ci0",y="ci1"):(p="median",m="q1",y="q3"),u=[{op:m,field:c,as:`lower_${c}`},{op:y,field:c,as:`upper_${c}`},{op:p,field:c,as:`center_${c}`}],f=[{fieldPrefix:"upper_",titlePrefix:wu({field:c,aggregate:y,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:wu({field:c,aggregate:m,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:wu({field:c,aggregate:p,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&U(S4(e.center,e.extent)),o==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:`upper_${c}`},{calculate:`datum["${c}"]`,as:`lower_${c}`}]):o==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:`upper_${c}`}],r?l.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:`lower_${c}`}):l.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:`lower_${c}`}));for(const h of l)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:as(as(h.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}function Kk(e,t,n){return`${Of(e)} ${n} ${t}`}const Z_="errorband",vae=["band","borders"],bae=new Y0(Z_,Z5);function Z5(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:X0(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:o,markDef:a,outerSpec:s,tooltipEncoding:u}=Q5(e,Z_,t),l=a,c=J_(l,r,i,o,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const g=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),g),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign(Object.assign({},h),g),{aria:!1})):l.interpolate?U(tS("interpolate")):l.tension&&U(tS("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:u}),...c({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:u})]})}const eP={};function eE(e,t,n){const i=new Y0(e,t);eP[e]={normalizer:i,parts:n}}function xae(){return z(eP)}eE(ep,V5,uae);eE(Q_,J5,fae);eE(Z_,Z5,vae);const wae=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],tP={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},nP={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},_ae=z(tP),Eae=z(nP),Sae={header:1,headerRow:1,headerColumn:1,headerFacet:1},iP=z(Sae),rP=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Oae={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Aae={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},yr="_vgsid_",kae={point:{on:"click",fields:[yr],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function tE(e){return e==="legend"||!!(e!=null&&e.legend)}function O1(e){return tE(e)&&K(e)}function nE(e){return!!(e!=null&&e.select)}var Cae=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function oP(e){const t=[];for(const n of e||[]){if(nE(n))continue;const{expr:i,bind:r}=n,o=Cae(n,["expr","bind"]);if(r&&i){const a=Object.assign(Object.assign({},o),{bind:r,init:i});t.push(a)}else{const a=Object.assign(Object.assign(Object.assign({},o),i?{update:i}:{}),r?{bind:r}:{});t.push(a)}}return t}function $ae(e){return V0(e)||rE(e)||iE(e)}function iE(e){return"concat"in e}function V0(e){return"vconcat"in e}function rE(e){return"hconcat"in e}function aP({step:e,offsetIsDiscrete:t}){var n;return t?(n=e.for)!==null&&n!==void 0?n:"offset":"position"}function vr(e){return K(e)&&e.step!==void 0}function Jk(e){return e.view||e.width||e.height}const Qk=20,Fae={align:1,bounds:1,center:1,columns:1,spacing:1},Tae=z(Fae);function Mae(e,t,n){var i,r;const o=n[t],a={},{spacing:s,columns:u}=o;s!==void 0&&(a.spacing=s),u!==void 0&&(U0(e)&&!ld(e.facet)||iE(e))&&(a.columns=u),V0(e)&&(a.columns=1);for(const l of Tae)if(e[l]!==void 0)if(l==="spacing"){const c=e[l];a[l]=De(c)?c:{row:(i=c.row)!==null&&i!==void 0?i:s,column:(r=c.column)!==null&&r!==void 0?r:s}}else a[l]=e[l];return a}var Dae=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Iv(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function tp(e,t){const n=np(e,t);return vr(n)?n.step:sP}function np(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return nt(i,{step:e.step})}const sP=20,Nae={continuousWidth:200,continuousHeight:200,step:sP},jae={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Nae,mark:Ooe,arc:{},area:{},bar:Coe,circle:{},geoshape:{},image:{},line:{},point:{},rect:$oe,rule:{color:"black"},square:{},text:{color:"black"},tick:Foe,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:soe,projection:{},legend:Oae,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:kae,style:{},title:{},facet:{spacing:Qk},concat:{spacing:Qk},normalizedNumberFormat:".0%"},Rr=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],Zk={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},eC={blue:Rr[0],orange:Rr[1],red:Rr[2],teal:Rr[3],green:Rr[4],yellow:Rr[5],purple:Rr[6],pink:Rr[7],brown:Rr[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Rae(e={}){return{signals:[{name:"color",value:K(e)?Object.assign(Object.assign({},eC),e):eC}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Pae(e){return{signals:[{name:"fontSize",value:K(e)?Object.assign(Object.assign({},Zk),e):Zk}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Iae(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function uP(e){const t=z(e||{}),n={};for(const i of t){const r=e[i];n[i]=dd(r)?hF(r):Nn(r)}return n}function Lae(e){const t=z(e),n={};for(const i of t)n[i]=uP(e[i]);return n}const zae=[...b5,...z5,...iP,"background","padding","legend","lineBreak","scale","style","title","view"];function lP(e={}){const{color:t,font:n,fontSize:i,selection:r}=e,o=Dae(e,["color","font","fontSize","selection"]),a=sl({},le(jae),n?Iae(n):{},t?Rae(t):{},i?Pae(i):{},o||{});r&&ul(a,"selection",r,!0);const s=yn(a,zae);for(const u of["background","lineBreak","padding"])a[u]&&(s[u]=Nn(a[u]));for(const u of b5)a[u]&&(s[u]=dn(a[u]));for(const u of z5)a[u]&&(s[u]=uP(a[u]));for(const u of iP)a[u]&&(s[u]=dn(a[u]));return a.legend&&(s.legend=dn(a.legend)),a.scale&&(s.scale=dn(a.scale)),a.style&&(s.style=Lae(a.style)),a.title&&(s.title=dn(a.title)),a.view&&(s.view=dn(a.view)),s}const Bae=new Set(["view",...boe]),Uae=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],qae=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},Soe);function Wae(e){e=le(e);for(const t of Uae)delete e[t];if(e.axis)for(const t in e.axis)dd(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of wae)delete e.legend[t];if(e.mark){for(const t of qk)delete e.mark[t];e.mark.tooltip&&K(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(oP(e.params)),delete e.params);for(const t of Bae){for(const i of qk)delete e[t][i];const n=qae[t];if(n)for(const i of n)delete e[t][i];Hae(e,t)}for(const t of xae())delete e[t];Gae(e);for(const t in e)K(e[t])&&Me(e[t])&&delete e[t];return Me(e)?void 0:e}function Gae(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=dF(e.title);Me(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),Me(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),Me(i)?delete e.title:e.title=i}function Hae(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const o=Object.assign(Object.assign({},r),e.style[n!=null?n:t]);Me(o)||(e.style[n!=null?n:t]=o),i||delete e[t]}function K0(e){return"layer"in e}function Yae(e){return"repeat"in e}function Xae(e){return!I(e.repeat)&&e.repeat.layer}var Vae=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class oE{map(t,n){return U0(t)?this.mapFacet(t,n):Yae(t)?this.mapRepeat(t,n):rE(t)?this.mapHConcat(t,n):V0(t)?this.mapVConcat(t,n):iE(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(K0(t))return this.mapLayer(t,n);if(go(t))return this.mapUnit(t,n);throw new Error(zb(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,r=Vae(t,["concat"]);return Object.assign(Object.assign({},r),{concat:i.map(o=>this.map(o,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const Kae={zero:1,center:1,normalize:1};function Jae(e){return e in Kae}const Qae=new Set([p5,I0,P0,Vg,z0,P_,I_,L0,m5,R_]),Zae=new Set([I0,P0,p5]);function tu(e){return q(e)&&Ju(e)==="quantitative"&&!e.bin}function tC(e,t){var n,i;const r=t==="x"?"y":"radius",o=e[t],a=e[r];if(q(o)&&q(a))if(tu(o)&&tu(a)){if(o.stack)return t;if(a.stack)return r;const s=q(o)&&!!o.aggregate,u=q(a)&&!!a.aggregate;if(s!==u)return s?t:r;{const l=(n=o.scale)===null||n===void 0?void 0:n.type,c=(i=a.scale)===null||i===void 0?void 0:i.type;if(l&&l!=="linear")return r;if(c&&c!=="linear")return t}}else{if(tu(o))return t;if(tu(a))return r}else{if(tu(o))return t;if(tu(a))return r}}function ese(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function cP(e,t){var n,i;const r=pr(e)?e.type:e;if(!Qae.has(r))return null;const o=tC(t,"x")||tC(t,"theta");if(!o)return null;const a=t[o],s=q(a)?H(a,{}):void 0,u=ese(o),l=[],c=new Set;if(t[u]){const h=t[u],g=q(h)?H(h,{}):void 0;g&&g!==s&&(l.push(u),c.add(g));const p=u==="x"?"xOffset":"yOffset",m=t[p],y=q(m)?H(m,{}):void 0;y&&y!==s&&(l.push(p),c.add(y))}const f=rL.reduce((h,g)=>{if(g!=="tooltip"&&ns(t,g)){const p=t[g];for(const m of V(p)){const y=mr(m);if(y.aggregate)continue;const v=H(y,{});(!v||!c.has(v))&&h.push({channel:g,fieldDef:y})}}return h},[]);let d;return a.stack!==void 0?ua(a.stack)?d=a.stack?"zero":null:d=a.stack:Zae.has(r)&&(d="zero"),!d||!Jae(d)||X_(t)&&f.length===0?null:((n=a==null?void 0:a.scale)===null||n===void 0?void 0:n.type)&&((i=a==null?void 0:a.scale)===null||i===void 0?void 0:i.type)!==bn.LINEAR?(U(w4(a.scale.type)),null):se(t[Or(o)])?(a.stack!==void 0&&U(x4(o)),null):(q(a)&&a.aggregate&&!mL.has(a.aggregate)&&U(_4(a.aggregate)),{groupbyChannels:l,groupbyFields:c,fieldChannel:o,impute:a.impute===null?!1:Ea(r),stackBy:f,offset:d})}var fP=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function tse(e){const t=fP(e,["point","line"]);return z(t).length>1?t:t.type}function nse(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:yn(e[t],["point","line"])}));return e}function A1(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?K(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?K(t.point)?t.point:{}:void 0}function nC(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class ise{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(go(t)){const{mark:i,encoding:r}=t,o=pr(i)?i:{type:i};switch(o.type){case"line":case"rule":case"trail":return!!A1(o,n[o.type],r);case"area":return!!A1(o,n[o.type],r)||!!nC(o,n[o.type])}}return!1}run(t,n,i){const{config:r}=n,{params:o,projection:a,mark:s,encoding:u}=t,l=fP(t,["params","projection","mark","encoding"]),c=X0(u,r),f=pr(s)?s:{type:s},d=A1(f,r[f.type],c),h=f.type==="area"&&nC(f,r[f.type]),g=[Object.assign(Object.assign({},o?{params:o}:{}),{mark:tse(Object.assign(Object.assign({},f.type==="area"&&f.opacity===void 0&&f.fillOpacity===void 0?{opacity:.7}:{}),f)),encoding:yn(c,["shape"])})],p=cP(f,c);let m=c;if(p){const{fieldChannel:y,offset:v}=p;m=Object.assign(Object.assign({},c),{[y]:Object.assign(Object.assign({},c[y]),v?{stack:v}:{})})}return m=yn(m,["y2","x2"]),h&&g.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},Ou(f,["clip","interpolate","tension","tooltip"])),h),encoding:m})),d&&g.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},Ou(f,["clip","tooltip"])),d),encoding:m})),i(Object.assign(Object.assign({},l),{layer:g}),Object.assign(Object.assign({},n),{config:nse(r)}))}}var rse=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ose(e,t){return t?ld(e)?hP(e,t):dP(e,t):e}function k1(e,t){return t?hP(e,t):e}function Lv(e,t,n){const i=t[e];if(zoe(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});U(RL(i.repeat));return}return t}function dP(e,t){if(e=Lv("field",e,t),e!==void 0){if(e===null)return null;if(W_(e)&&ar(e.sort)){const n=Lv("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function iC(e,t){if(q(e))return dP(e,t);{const n=Lv("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function rC(e,t){if(se(e)){const n=iC(e,t);if(n)return n;if(q0(e))return{condition:e.condition}}else{if(cd(e)){const n=iC(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):rse(e,["condition"])}return e}}function hP(e,t){const n={};for(const i in e)if(ee(e,i)){const r=e[i];if(I(r))n[i]=r.map(o=>rC(o,t)).filter(o=>o);else{const o=rC(r,t);o!==void 0&&(n[i]=o)}}return n}class ase{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(go(t)){const{encoding:n,mark:i}=t;if(i==="line"||pr(i)&&i.type==="line")for(const r of tL){const o=Cs(r),a=n[o];if(n[r]&&(q(a)&&!Et(a.bin)||Mr(a)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:o}=t;return U(i4(!!r.x2,!!r.y2)),i(Object.assign(Object.assign({},t),{mark:K(o)?Object.assign(Object.assign({},o),{type:"rule"}):"rule"}),n)}}var vo=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class sse extends oE{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[lae,dae,bae,new ise,new ase]}map(t,n){if(go(t)){const i=ns(t.encoding,Vr),r=ns(t.encoding,Kr),o=ns(t.encoding,yp);if(i||r||o)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,o=k1(t.encoding,n.repeater),a=Object.assign(Object.assign({},t),o?{encoding:o}:{});if(i||r)return this.mapUnitWithParentEncodingOrProjection(a,n);const s=this.mapLayerOrUnit.bind(this);for(const u of this.nonFacetUnitNormalizers)if(u.hasMatchingType(a,n.config))return u.run(a,n,s);return a}mapRepeat(t,n){return Xae(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r}=t,o=vo(t,["repeat","spec"]),{row:a,column:s,layer:u}=i,{repeater:l={},repeaterPrefix:c=""}=n;return a||s?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),s?{column:s}:{}),spec:{repeat:{layer:u},spec:r}}),n):Object.assign(Object.assign({},o),{layer:u.map(f=>{const d=Object.assign(Object.assign({},l),{layer:f}),h=`${(r.name||"")+c}child__layer_${qe(f)}`,g=this.mapLayerOrUnit(r,Object.assign(Object.assign({},n),{repeater:d,repeaterPrefix:h}));return g.name=h,g})})}mapNonLayerRepeat(t,n){var i;const{repeat:r,spec:o,data:a}=t,s=vo(t,["repeat","spec","data"]);!I(r)&&t.columns&&(t=yn(t,["columns"]),U(JE("repeat")));const u=[],{repeater:l={},repeaterPrefix:c=""}=n,f=!I(r)&&r.row||[l?l.row:null],d=!I(r)&&r.column||[l?l.column:null],h=I(r)&&r||[l?l.repeat:null];for(const p of h)for(const m of f)for(const y of d){const v={repeat:p,row:m,column:y,layer:l.layer},b=(o.name||"")+c+"child__"+(I(r)?`${qe(p)}`:(r.row?`row_${qe(m)}`:"")+(r.column?`column_${qe(y)}`:"")),x=this.map(o,Object.assign(Object.assign({},n),{repeater:v,repeaterPrefix:b}));x.name=b,u.push(yn(x,["data"]))}const g=I(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(i=o.data)!==null&&i!==void 0?i:a,align:"all"},s),{columns:g,concat:u})}mapFacet(t,n){const{facet:i}=t;return ld(i)&&t.columns&&(t=yn(t,["columns"]),U(JE("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:o,parentProjection:a,config:s}=n,u=aC({parentProjection:a,projection:r}),l=oC({parentEncoding:o,encoding:k1(i,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),u?{projection:u}:{}),l?{encoding:l}:{}),{config:s})}mapFacetedUnit(t,n){const i=t.encoding,{row:r,column:o,facet:a}=i,s=vo(i,["row","column","facet"]),{mark:u,width:l,projection:c,height:f,view:d,params:h,encoding:g}=t,p=vo(t,["mark","width","projection","height","view","params","encoding"]),{facetMapping:m,layout:y}=this.getFacetMappingAndLayout({row:r,column:o,facet:a},n),v=k1(s,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),y),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),d?{view:d}:{}),c?{projection:c}:{}),{mark:u,encoding:v}),h?{params:h}:{})}),n)}getFacetMappingAndLayout(t,n){var i;const{row:r,column:o,facet:a}=t;if(r||o){a&&U(t4([...r?[Vr]:[],...o?[Kr]:[]]));const s={},u={};for(const l of[Vr,Kr]){const c=t[l];if(c){const f=vo(c,["align","center","spacing","columns"]);s[l]=f;for(const d of["align","center","spacing"])c[d]!==void 0&&((i=u[d])!==null&&i!==void 0||(u[d]={}),u[d][l]=c[d])}}return{facetMapping:s,layout:u}}else{const{align:s,center:u,spacing:l,columns:c}=a,f=vo(a,["align","center","spacing","columns"]);return{facetMapping:ose(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},s?{align:s}:{}),u?{center:u}:{}),l?{spacing:l}:{}),c?{columns:c}:{})}}}mapLayer(t,n){var{parentEncoding:i,parentProjection:r}=n,o=vo(n,["parentEncoding","parentProjection"]);const{encoding:a,projection:s}=t,u=vo(t,["encoding","projection"]),l=Object.assign(Object.assign({},o),{parentEncoding:oC({parentEncoding:i,encoding:a,layer:!0}),parentProjection:aC({parentProjection:r,projection:s})});return super.mapLayer(u,l)}}function oC({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...z(e),...z(t)]);for(const o of r){const a=t[o],s=e[o];if(se(a)){const u=Object.assign(Object.assign({},s),a);i[o]=u}else cd(a)?i[o]=Object.assign(Object.assign({},a),{condition:Object.assign(Object.assign({},s),a.condition)}):a||a===null?i[o]=a:(n||ji(s)||Z(s)||se(s)||I(s))&&(i[o]=s)}}else i=t;return!i||Me(i)?void 0:i}function aC(e){const{parentProjection:t,projection:n}=e;return t&&n&&U(UL({parentProjection:t,projection:n})),n!=null?n:t}function aE(e){return"filter"in e}function use(e){return(e==null?void 0:e.stop)!==void 0}function gP(e){return"lookup"in e}function lse(e){return"data"in e}function cse(e){return"param"in e}function fse(e){return"pivot"in e}function dse(e){return"density"in e}function hse(e){return"quantile"in e}function gse(e){return"regression"in e}function pse(e){return"loess"in e}function mse(e){return"sample"in e}function yse(e){return"window"in e}function vse(e){return"joinaggregate"in e}function bse(e){return"flatten"in e}function xse(e){return"calculate"in e}function pP(e){return"bin"in e}function wse(e){return"impute"in e}function _se(e){return"timeUnit"in e}function Ese(e){return"aggregate"in e}function Sse(e){return"stack"in e}function Ose(e){return"fold"in e}function Ase(e){return e.map(t=>aE(t)?{filter:gu(t.filter,V4)}:t)}var Uo=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class kse extends oE{map(t,n){var i,r;return(i=n.emptySelections)!==null&&i!==void 0||(n.emptySelections={}),(r=n.selectionPredicates)!==null&&r!==void 0||(n.selectionPredicates={}),t=sC(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=sC(t,n),t.encoding){const i={};for(const[r,o]of Go(t.encoding))i[r]=mP(o,n);t=Object.assign(Object.assign({},t),{encoding:i})}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const i=t,{selection:r}=i,o=Uo(i,["selection"]);return r?Object.assign(Object.assign({},o),{params:Go(r).map(([a,s])=>{var u;const l=s,{init:c,bind:f,empty:d}=l,h=Uo(l,["init","bind","empty"]);h.type==="single"?(h.type="point",h.toggle=!1):h.type==="multi"&&(h.type="point"),n.emptySelections[a]=d!=="none";for(const g of zt((u=n.selectionPredicates[a])!==null&&u!==void 0?u:{}))g.empty=d!=="none";return{name:a,value:c,select:h,bind:f}})}):t}}function sC(e,t){const{transform:n}=e,i=Uo(e,["transform"]);if(n){const r=n.map(o=>{if(aE(o))return{filter:zv(o,t)};if(pP(o)&&$s(o.bin))return Object.assign(Object.assign({},o),{bin:yP(o.bin)});if(gP(o)){const a=o.from,{selection:s}=a,u=Uo(a,["selection"]);return s?Object.assign(Object.assign({},o),{from:Object.assign({param:s},u)}):o}return o});return Object.assign(Object.assign({},i),{transform:r})}return e}function mP(e,t){var n,i;const r=le(e);if(q(r)&&$s(r.bin)&&(r.bin=yP(r.bin)),zs(r)&&((i=(n=r.scale)===null||n===void 0?void 0:n.domain)===null||i===void 0?void 0:i.selection)){const o=r.scale.domain,{selection:a}=o,s=Uo(o,["selection"]);r.scale.domain=Object.assign(Object.assign({},s),a?{param:a}:{})}if(q0(r))if(I(r.condition))r.condition=r.condition.map(o=>{const{selection:a,param:s,test:u}=o,l=Uo(o,["selection","param","test"]);return s?o:Object.assign(Object.assign({},l),{test:zv(o,t)})});else{const o=mP(r.condition,t),{selection:a,param:s,test:u}=o,l=Uo(o,["selection","param","test"]);r.condition=s?r.condition:Object.assign(Object.assign({},l),{test:zv(r.condition,t)})}return r}function yP(e){const t=e.extent;if(t!=null&&t.selection){const{selection:n}=t,i=Uo(t,["selection"]);return Object.assign(Object.assign({},e),{extent:Object.assign(Object.assign({},i),{param:n})})}return e}function zv(e,t){const n=i=>gu(i,r=>{var o,a,s;const u=(o=t.emptySelections[r])!==null&&o!==void 0?o:!0,l={param:r,empty:u};return(a=(s=t.selectionPredicates)[r])!==null&&a!==void 0||(s[r]=[]),t.selectionPredicates[r].push(l),l});return e.selection?n(e.selection):gu(e.test||e.filter,i=>i.selection?n(i.selection):i)}class Bv extends oE{map(t,n){var i;const r=(i=n.selections)!==null&&i!==void 0?i:[];if(t.params&&!go(t)){const o=[];for(const a of t.params)nE(a)?r.push(a):o.push(a);t.params=o}return n.selections=r,super.map(t,vP(t,n))}mapUnit(t,n){var i;const r=n.selections;if(!r||!r.length)return t;const o=((i=n.path)!==null&&i!==void 0?i:[]).concat(t.name),a=[];for(const s of r)if(!s.views||!s.views.length)a.push(s);else for(const u of s.views)(Y(u)&&(u===t.name||o.indexOf(u)>=0)||I(u)&&u.map(l=>o.indexOf(l)).every((l,c,f)=>l!==-1&&(c===0||l>f[c-1])))&&a.push(s);return a.length&&(t.params=a),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=Bv.prototype[e];Bv.prototype[e]=function(n,i){return t.call(this,n,vP(n,i))}}function vP(e,t){var n;return e.name?Object.assign(Object.assign({},t),{path:((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name)}):t}function bP(e,t){t===void 0&&(t=lP(e.config));const n=Tse(e,t),{width:i,height:r}=e,o=Mse(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),o?{autosize:o}:{})}const Cse=new sse,$se=new kse,Fse=new Bv;function Tse(e,t={}){const n={config:t};return Fse.map(Cse.map($se.map(e,n),n),n)}function uC(e){return Y(e)?{type:e}:e!=null?e:{}}function Mse(e,t,n){let{width:i,height:r}=t;const o=go(e)||K0(e),a={};o?i=="container"&&r=="container"?(a.type="fit",a.contains="padding"):i=="container"?(a.type="fit-x",a.contains="padding"):r=="container"&&(a.type="fit-y",a.contains="padding"):(i=="container"&&(U(YE("width")),i=void 0),r=="container"&&(U(YE("height")),r=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},a),n?uC(n.autosize):{}),uC(e.autosize));if(s.type==="fit"&&!o&&(U(AL),s.type="pad"),i=="container"&&!(s.type=="fit"||s.type=="fit-x")&&U(XE("width")),r=="container"&&!(s.type=="fit"||s.type=="fit-y")&&U(XE("height")),!Zi(s,{type:"pad"}))return s}function Dse(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function Nse(e){return e?`fit-${_p(e)}`:"fit"}const jse=["background","padding"];function lC(e,t){const n={};for(const i of jse)e&&e[i]!==void 0&&(n[i]=Nn(e[i]));return t&&(n.params=e.params),n}class po{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new po(le(this.explicit),le(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return nt(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of z(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function Yi(e){return{explicit:!0,value:e}}function Tn(e){return{explicit:!1,value:e}}function xP(e){return(t,n,i,r)=>{const o=e(t.value,n.value);return o>0?t:o<0?n:J0(t,n,i,r)}}function J0(e,t,n,i){return e.explicit&&t.explicit&&U(h4(n,i,e.value,t.value)),e}function ia(e,t,n,i,r=J0){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Zi(e.value,t.value)?e:r(e,t,n,i)}class Rse extends po{constructor(t={},n={},i=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function el(e){return"url"in e}function mf(e){return"values"in e}function wP(e){return"name"in e&&!el(e)&&!mf(e)&&!qo(e)}function qo(e){return e&&(_P(e)||EP(e)||sE(e))}function _P(e){return"sequence"in e}function EP(e){return"sphere"in e}function sE(e){return"graticule"in e}var Pe;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(Pe||(Pe={}));var Pse=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Es(e,t=!0,n=Wt){if(I(e)){const i=e.map(r=>Es(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Fs(e))return n(t?Gc(e):I4(e));return t?n(Ie(e)):e}function Ise(e,t){var n;for(const i of zt((n=e.component.selection)!==null&&n!==void 0?n:{})){const r=i.name;let o=`${r}${aa}, ${i.resolve==="global"?"true":`{unit: ${tl(e)}}`}`;for(const a of Z0)!a.defined(i)||(a.signals&&(t=a.signals(e,i,t)),a.modifyExpr&&(o=a.modifyExpr(e,i,o)));t.push({name:r+yue,on:[{events:{signal:i.name+aa},update:`modify(${G(i.name+Ss)}, ${o})`}]})}return uE(t)}function Lse(e,t){if(e.component.selection&&z(e.component.selection).length){const n=G(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:_a("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return uE(t)}function zse(e,t){var n;let i=!1;for(const r of zt((n=e.component.selection)!==null&&n!==void 0?n:{})){const o=r.name,a=G(o+Ss);if(t.filter(u=>u.name===o).length===0){const u=r.resolve==="global"?"union":r.resolve,l=r.type==="point"?", true, true)":")";t.push({name:r.name,update:`${LP}(${a}, ${G(u)}${l}`})}i=!0;for(const u of Z0)u.defined(r)&&u.topLevelSignals&&(t=u.topLevelSignals(e,r,t))}return i&&t.filter(o=>o.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),uE(t)}function Bse(e,t){var n;const i=[...t],r=tl(e,{escape:!1});for(const o of zt((n=e.component.selection)!==null&&n!==void 0?n:{})){const a={name:o.name+Ss};if(o.project.hasSelectionId&&(a.transform=[{type:"collect",sort:{field:yr}}]),o.init){const u=o.project.items.map(l=>Pse(l,["signals"]));a.values=o.project.hasSelectionId?o.init.map(l=>({unit:r,[yr]:Es(l,!1)[0]})):o.init.map(l=>({unit:r,fields:u,values:Es(l,!1)}))}i.filter(u=>u.name===o.name+Ss).length||i.push(a)}return i}function SP(e,t){var n;for(const i of zt((n=e.component.selection)!==null&&n!==void 0?n:{}))for(const r of Z0)r.defined(i)&&r.marks&&(t=r.marks(e,i,t));return t}function Use(e,t){for(const n of e.children)tt(n)&&(t=SP(n,t));return t}function qse(e,t,n,i){const r=WP(e,t.param,t);return{signal:Un(n.get("type"))&&I(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function uE(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class je{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){U(LL);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this);const i=t.parent.removeChild(t);this._parent=n,n.addChild(this,i),t.parent=this}}class rn extends je{constructor(t,n,i,r){super(t,n),this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${K$()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var cC=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class sr extends je{constructor(t,n){super(t),this.formula=n}clone(){return new sr(null,le(this.formula))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,o)=>{const{field:a,timeUnit:s}=o;if(s){const u=H(o,{forAs:!0});r[be({as:u,field:a,timeUnit:s})]={as:u,field:a,timeUnit:s}}return r},{});return Me(i)?null:new sr(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:r}=i,o=cC(i,["timeUnit"]),a=Ht(r),s=Object.assign(Object.assign({},o),{timeUnit:a});return new sr(t,{[be(s)]:s})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of Go(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(zt(this.formula).map(t=>t.as))}dependentFields(){return new Set(zt(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${be(this.formula)}`}assemble(){const t=[];for(const n of zt(this.formula)){const{field:i,as:r,timeUnit:o}=n,a=Ht(o),{unit:s,utc:u}=a,l=cC(a,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:ei(i),type:"timeunit"},s?{units:Gb(s)}:{}),u?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return t}}var Wse=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const hd="_tuple_fields";class Gse{constructor(...t){this.items=t,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const Hse={defined:()=>!0,parse:(e,t,n)=>{var i;const r=t.name,o=(i=t.project)!==null&&i!==void 0?i:t.project=new Gse,a={},s={},u=new Set,l=(p,m)=>{const y=m==="visual"?p.channel:p.field;let v=qe(`${r}_${y}`);for(let b=1;u.has(v);b++)v=qe(`${r}_${y}_${b}`);return u.add(v),{[m]:v}},c=t.type,f=e.config.selection[c],d=n.value!==void 0?V(n.value):null;let{fields:h,encodings:g}=K(n.select)?n.select:{};if(!h&&!g&&d){for(const p of d)if(!!K(p))for(const m of z(p))eL(m)?(g||(g=[])).push(m):c==="interval"?(U(jL),g=f.encodings):(h||(h=[])).push(m)}!h&&!g&&(g=f.encodings,"fields"in f&&(h=f.fields));for(const p of g!=null?g:[]){const m=e.fieldDef(p);if(m){let y=m.field;if(m.aggregate){U(kL(p,m.aggregate));continue}else if(!y){U(KE(p));continue}if(m.timeUnit){y=e.vgField(p);const v={timeUnit:m.timeUnit,as:y,field:m.field};s[be(v)]=v}if(!a[y]){let v="E";if(c==="interval"){const x=e.getScaleComponent(p).get("type");Un(x)&&(v="R")}else m.bin&&(v="R-RE");const b={field:y,channel:p,type:v};b.signals=Object.assign(Object.assign({},l(b,"data")),l(b,"visual")),o.items.push(a[y]=b),o.hasField[y]=o.hasChannel[p]=a[y],o.hasSelectionId=o.hasSelectionId||y===yr}}else U(KE(p))}for(const p of h!=null?h:[]){if(o.hasField[p])continue;const m={type:"E",field:p};m.signals=Object.assign({},l(m,"data")),o.items.push(m),o.hasField[p]=m,o.hasSelectionId=o.hasSelectionId||p===yr}d&&(t.init=d.map(p=>o.items.map(m=>K(p)?p[m.channel]!==void 0?p[m.channel]:p[m.field]:p))),Me(s)||(o.timeUnit=new sr(null,s))},signals:(e,t,n)=>{const i=t.name+hd;return n.filter(o=>o.name===i).length>0||t.project.hasSelectionId?n:n.concat({name:i,value:t.project.items.map(o=>{const a=Wse(o,["signals","hasLegend"]);return a.field=ei(a.field),a})})}},ra={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!ga(r))continue;const o=e.getScaleComponent(r),a=o?o.get("type"):void 0;if(!o||!Un(a)){U(FL);continue}o.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(a=>n.filter(s=>s.name===a.signals.data).length===0);if(!e.parent||qv(e)||i.length===0)return n;const r=n.filter(a=>a.name===t.name)[0];let o=r.update;if(o.indexOf(LP)>=0)r.update=`{${i.map(a=>`${G(ei(a.field))}: ${a.signals.data}`).join(", ")}}`;else{for(const a of i){const s=`${G(ei(a.field))}: ${a.signals.data}`;o.includes(s)||(o=`${o.substring(0,o.length-1)}, ${s}}`)}r.update=o}return n.concat(i.map(a=>({name:a.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!qv(e))for(const i of t.scales){const r=n.filter(o=>o.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function Uv(e,t){return`domain(${G(e.scaleName(t))})`}function qv(e){var t;return e.parent&&$l(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:qv(e.parent.parent))}var Yse=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const _u="_brush",Wv="_scale_trigger",Xse={defined:e=>e.type==="interval",signals:(e,t,n)=>{const i=t.name,r=i+hd,o=ra.defined(t),a=t.init?t.init[0]:null,s=[],u=[];if(t.translate&&!o){const c=`!event.item || event.item.mark.name !== ${G(i+_u)}`;OP(t,(f,d)=>{var h,g;const p=V((h=(g=d.between[0]).filter)!==null&&h!==void 0?h:g.filter=[]);return p.includes(c)||p.push(c),f})}t.project.items.forEach((c,f)=>{const d=c.channel;if(d!==He&&d!==bt){U("Interval selections only support x and y encoding channels.");return}const h=a?a[f]:null,g=Vse(e,t,c,h),p=c.signals.data,m=c.signals.visual,y=G(e.scaleName(d)),v=e.getScaleComponent(d).get("type"),b=Un(v)?"+":"";n.push(...g),s.push(p),u.push({scaleName:e.scaleName(d),expr:`(!isArray(${p}) || (${b}invert(${y}, ${m})[0] === ${b}${p}[0] && ${b}invert(${y}, ${m})[1] === ${b}${p}[1]))`})}),!o&&u.length&&n.push({name:i+Wv,value:{},on:[{events:u.map(c=>({scale:c.scaleName})),update:`${u.map(c=>c.expr).join(" && ")} ? ${i+Wv} : {}`}]});const l=`unit: ${tl(e)}, fields: ${r}, values`;return n.concat(Object.assign(Object.assign({name:i+aa},a?{init:`{${l}: ${Es(a)}}`}:{}),s.length?{on:[{events:[{signal:s.join(" || ")}],update:`${s.join(" && ")} ? {${l}: [${s}]} : null`}]}:{}))},marks:(e,t,n)=>{const i=t.name,{x:r,y:o}=t.project.hasChannel,a=r==null?void 0:r.signals.visual,s=o==null?void 0:o.signals.visual,u=`data(${G(t.name+Ss)})`;if(ra.defined(t)||!r&&!o)return n;const l={x:r!==void 0?{signal:`${a}[0]`}:{value:0},y:o!==void 0?{signal:`${s}[0]`}:{value:0},x2:r!==void 0?{signal:`${a}[1]`}:{field:{group:"width"}},y2:o!==void 0?{signal:`${s}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of z(l))l[m]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${tl(e)}`},l[m]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:h}=c,g=Yse(c,["fill","fillOpacity","cursor"]),p=z(g).reduce((m,y)=>(m[y]=[{test:[r!==void 0&&`${a}[0] !== ${a}[1]`,o!==void 0&&`${s}[0] !== ${s}[1]`].filter(v=>v).join(" && "),value:g[y]},{value:null}],m),{});return[{name:`${i+_u}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+_u,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),p)}}]}};function Vse(e,t,n,i){const r=n.channel,o=n.signals.visual,a=n.signals.data,s=ra.defined(t),u=G(e.scaleName(r)),l=e.getScaleComponent(r),c=l?l.get("type"):void 0,f=p=>`scale(${u}, ${p})`,d=e.getSizeSignalRef(r===He?"width":"height").signal,h=`${r}(unit)`,g=OP(t,(p,m)=>[...p,{events:m.between[0],update:`[${h}, ${h}]`},{events:m,update:`[${o}[0], clamp(${h}, 0, ${d})]`}]);return g.push({events:{signal:t.name+Wv},update:Un(c)?`[${f(`${a}[0]`)}, ${f(`${a}[1]`)}]`:"[0, 0]"}),s?[{name:a,on:[]}]:[Object.assign(Object.assign({name:o},i?{init:Es(i,!0,f)}:{value:[]}),{on:g}),Object.assign(Object.assign({name:a},i?{init:Es(i)}:{}),{on:[{events:{signal:o},update:`${o}[0] === ${o}[1] ? null : invert(${u}, ${o})`}]})]}function OP(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(U(`${i} is not an ordered event stream for interval selections.`),n),[])}const Kse={defined:e=>e.type==="point",signals:(e,t,n)=>{var i;const r=t.name,o=r+hd,a=t.project,s="(item().isVoronoi ? datum.datum : datum)",u=zt((i=e.component.selection)!==null&&i!==void 0?i:{}).reduce((d,h)=>h.type==="interval"?d.concat(h.name+_u):d,[]).map(d=>`indexof(item().mark.name, '${d}') < 0`).join(" && "),l=`datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0${u?` && ${u}`:""}`;let c=`unit: ${tl(e)}, `;if(t.project.hasSelectionId)c+=`${yr}: ${s}[${G(yr)}]`;else{const d=a.items.map(h=>{const g=e.fieldDef(h.channel);return g!=null&&g.bin?`[${s}[${G(e.vgField(h.channel,{}))}], ${s}[${G(e.vgField(h.channel,{binSuffix:"end"}))}]]`:`${s}[${G(h.field)}]`}).join(", ");c+=`fields: ${o}, values: [${d}]`}const f=t.events;return n.concat([{name:r+aa,on:f?[{events:f,update:`${l} ? {${c}} : null`,force:!0}]:[]}])}};function Ol(e,t,n,i){const r=q0(t)&&t.condition,o=i(t);if(r){const s=V(r).map(u=>{const l=i(u);if(Loe(u)){const{param:c,empty:f}=u,d=qP(e,{param:c,empty:f});return Object.assign({test:d},l)}else{const c=op(e,u.test);return Object.assign({test:c},l)}});return{[n]:[...s,...o!==void 0?[o]:[]]}}else return o!==void 0?{[n]:o}:{}}function lE(e,t="text"){const n=e.encoding[t];return Ol(e,n,t,i=>Q0(i,e.config))}function Q0(e,t,n="datum"){if(e){if(ji(e))return ze(e.value);if(se(e)){const{format:i,formatType:r}=Qg(e);return U_({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function AP(e,t={}){const{encoding:n,markDef:i,config:r,stack:o}=e,a=n.tooltip;if(I(a))return{tooltip:fC({tooltip:a},o,r,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return Ol(e,a,"tooltip",u=>{const l=Q0(u,r,s);if(l)return l;if(u===null)return;let c=Fe("tooltip",i,r);if(c===!0&&(c={content:"encoding"}),Y(c))return{value:c};if(K(c))return Z(c)?c:c.content==="encoding"?fC(n,o,r,t):{signal:s}})}}function kP(e,t,n,{reactiveGeom:i}={}){const r={},o=i?"datum.datum":"datum",a=[];function s(l,c){const f=Cs(c),d=oi(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),h=d.title||H_(d,n),g=V(h).join(", ");let p;if(xt(c)){const m=c==="x"?"x2":"y2",y=mr(e[m]);if(Et(d.bin)&&y){const v=H(d,{expr:o}),b=H(y,{expr:o}),{format:x,formatType:_}=Qg(d);p=ud(v,b,x,_,n),r[m]=!0}}if((xt(c)||c===ai||c===Pi)&&t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:m,formatType:y}=Qg(d);p=U_({fieldOrDatumDef:d,format:m,formatType:y,expr:o,config:n,normalizeStack:!0}).signal}p!=null||(p=Q0(d,n,o).signal),a.push({channel:c,key:g,value:p})}V_(e,(l,c)=>{q(l)?s(l,c):W0(l)&&s(l.condition,c)});const u={};for(const{channel:l,key:c,value:f}of a)!r[l]&&!u[c]&&(u[c]=f);return u}function fC(e,t,n,{reactiveGeom:i}={}){const r=kP(e,t,n,{reactiveGeom:i}),o=Go(r).map(([a,s])=>`"${a}": ${s}`);return o.length>0?{signal:`{${o.join(", ")}}`}:void 0}function Jse(e){const{markDef:t,config:n}=e,i=Fe("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),Qse(e)),Zse(e))}function Qse(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=Fe("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in EL?{}:{ariaRoleDescription:{value:t}}}function Zse(e){const{encoding:t,markDef:n,config:i,stack:r}=e,o=t.description;if(o)return Ol(e,o,"description",u=>Q0(u,e.config));const a=Fe("description",n,i);if(a!=null)return{description:ze(a)};if(i.aria===!1)return{};const s=kP(t,r,i);if(!Me(s))return{description:{signal:Go(s).map(([u,l],c)=>`"${c>0?"; ":""}${u}: " + (${l})`).join(" + ")}}}function ht(e,t,n={}){const{markDef:i,encoding:r,config:o}=t,{vgChannel:a}=n;let{defaultRef:s,defaultValue:u}=n;s===void 0&&(u!=null||(u=Fe(e,i,o,{vgChannel:a,ignoreVgConfig:!0})),u!==void 0&&(s=ze(u)));const l=r[e];return Ol(t,l,a!=null?a:e,c=>B_({channel:e,channelDef:c,markDef:i,config:o,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s}))}function CP(e,t={filled:void 0}){var n,i,r,o;const{markDef:a,encoding:s,config:u}=e,{type:l}=a,c=(n=t.filled)!==null&&n!==void 0?n:Fe("filled",a,u),f=me(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=(r=(i=Fe(c===!0?"color":void 0,a,u,{vgChannel:"fill"}))!==null&&i!==void 0?i:u.mark[c===!0&&"color"])!==null&&r!==void 0?r:f,h=(o=Fe(c===!1?"color":void 0,a,u,{vgChannel:"stroke"}))!==null&&o!==void 0?o:u.mark[c===!1&&"color"],g=c?"fill":"stroke",p=Object.assign(Object.assign({},d?{fill:ze(d)}:{}),h?{stroke:ze(h)}:{});return a.color&&(c?a.fill:a.stroke)&&U(_F("property",{fill:"fill"in a,stroke:"stroke"in a})),Object.assign(Object.assign(Object.assign(Object.assign({},p),ht("color",e,{vgChannel:g,defaultValue:c?d:h})),ht("fill",e,{defaultValue:s.fill?d:void 0})),ht("stroke",e,{defaultValue:s.stroke?h:void 0}))}function eue(e){const{encoding:t,mark:n}=e,i=t.order;return!Ea(n)&&ji(i)?Ol(e,i,"zindex",r=>ze(r.value)):{}}function yf({channel:e,markDef:t,encoding:n={},model:i,bandPosition:r}){const o=`${e}Offset`,a=t[o],s=n[o];if((o==="xOffset"||o==="yOffset")&&s){const l=B_({channel:o,channelDef:s,markDef:t,config:i==null?void 0:i.config,scaleName:i.scaleName(o),scale:i.getScaleComponent(o),stack:null,defaultRef:ze(a),bandPosition:r});return{offsetType:"encoding",offset:l}}const u=t[o];return u?{offsetType:"visual",offset:u}:{}}function Pt(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:o,config:a,stack:s}=t,u=r[e],l=r[Or(e)],c=t.scaleName(e),f=t.getScaleComponent(e),{offset:d,offsetType:h}=yf({channel:e,markDef:o,encoding:r,model:t,bandPosition:.5}),g=cE({model:t,defaultPos:n,channel:e,scaleName:c,scale:f}),p=!u&&xt(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:tue({channel:e,channelDef:u,channel2Def:l,markDef:o,config:a,scaleName:c,scale:f,stack:s,offset:d,defaultRef:g,bandPosition:h==="encoding"?0:void 0});return p?{[i||e]:p}:void 0}function tue(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:o,markDef:a}=e;if(se(n)&&r&&t===r.fieldChannel){if(q(n)){let s=n.bandPosition;if(s===void 0&&a.type==="text"&&(t==="radius"||t==="theta")&&(s=.5),s!==void 0)return Kg({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:s,offset:o})}return ts(n,i,{suffix:"end"},{offset:o})}return L_(e)}function cE({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:o,config:a}=e;return()=>{const s=Cs(n),u=Ho(n),l=Fe(n,o,a,{vgChannel:u});if(l!==void 0)return zc(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const c=r.get("type");if(!me([bn.LOG,bn.TIME,bn.UTC],c)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return s==="y"?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[Sn(n)];return Object.assign(Object.assign({},c),{mult:.5})}}}}const nue={left:"x",center:"xc",right:"x2"},iue={top:"y",middle:"yc",bottom:"y2"};function $P(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Ho(e);const r=e==="x"?"align":"baseline",o=Fe(r,t,n);let a;return Z(o)?(U(n4(r)),a=void 0):a=o,e==="x"?nue[a||(i==="top"?"left":"center")]:iue[a||i]}function ip(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?FP(e,t,{defaultPos:n,defaultPos2:i}):Pt(e,t,{defaultPos:n})}function FP(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:o}=t,a=Or(e),s=Sn(e),u=rue(t,i,a),l=u[s]?$P(e,r,o):Ho(e);return Object.assign(Object.assign({},Pt(e,t,{defaultPos:n,vgChannel:l})),u)}function rue(e,t,n){const{encoding:i,mark:r,markDef:o,stack:a,config:s}=e,u=Cs(n),l=Sn(n),c=Ho(n),f=i[u],d=e.scaleName(u),h=e.getScaleComponent(u),{offset:g}=n in i||n in o?yf({channel:n,markDef:o,encoding:i,model:e}):yf({channel:u,markDef:o,encoding:i,model:e});if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const m=Sn(n),y=e.markDef[m];return y!=null?{[m]:{value:y}}:{[c]:{field:e.getName(n)}}}const p=oue({channel:n,channelDef:f,channel2Def:i[n],markDef:o,config:s,scaleName:d,scale:h,stack:a,offset:g,defaultRef:void 0});return p!==void 0?{[c]:p}:Hd(n,o)||Hd(n,{[n]:Dh(n,o,s.style),[l]:Dh(l,o,s.style)})||Hd(n,s[r])||Hd(n,s.mark)||{[c]:cE({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}function oue({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:o,scale:a,stack:s,offset:u,defaultRef:l}){return se(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?ts(t,o,{suffix:"start"},{offset:u}):L_({channel:e,channelDef:n,scaleName:o,scale:a,stack:s,markDef:i,config:r,offset:u,defaultRef:l})}function Hd(e,t){const n=Sn(e),i=Ho(e);if(t[i]!==void 0)return{[i]:zc(e,t[i])};if(t[e]!==void 0)return{[i]:zc(e,t[e])};if(t[n]){const r=t[n];if(ws(r))U(VL(n));else return{[n]:zc(e,r)}}}function oa(e,t){var n,i;const{config:r,encoding:o,markDef:a}=e,s=a.type,u=Or(t),l=Sn(t),c=o[t],f=o[u],d=e.getScaleComponent(t),h=d?d.get("type"):void 0,g=a.orient,p=(i=(n=o[l])!==null&&n!==void 0?n:o.size)!==null&&i!==void 0?i:Fe("size",a,r,{vgChannel:l}),m=s==="bar"&&(t==="x"?g==="vertical":g==="horizontal");return q(c)&&(Le(c.bin)||Et(c.bin)||c.timeUnit&&!f)&&!(p&&!ws(p))&&!wt(h)?uue({fieldDef:c,fieldDef2:f,channel:t,model:e}):(se(c)&&wt(h)||m)&&!f?sue(c,t,e):FP(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function aue(e,t,n,i,r){if(ws(r))if(n){const a=n.get("type");if(a==="band"){let s=`bandwidth('${t}')`;return r.band!==1&&(s=`${r.band} * ${s}`),{signal:`max(0.25, ${s})`}}else r.band!==1&&(U(a4(a)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(Z(r))return r;if(r)return{value:r}}if(n){const a=n.get("range");if(ma(a)&&De(a.step))return{value:a.step-2}}return{value:tp(i.view,e)-2}}function sue(e,t,n){const{markDef:i,encoding:r,config:o,stack:a}=n,s=i.orient,u=n.scaleName(t),l=n.getScaleComponent(t),c=Sn(t),f=Or(t),d=nL(t),h=n.scaleName(d),g=s==="horizontal"&&t==="y"||s==="vertical"&&t==="x";let p;(r.size||i.size)&&(g?p=ht("size",n,{vgChannel:c,defaultRef:ze(i.size)}):U(c4(i.type)));const m=!!p,y=$5({channel:t,fieldDef:e,markDef:i,config:o,scaleType:l==null?void 0:l.get("type"),useVlSizeChannel:g});p=p||{[c]:aue(c,h||u,l,o,y)};const v=(l==null?void 0:l.get("type"))==="band"&&ws(y)&&!m?"top":"middle",b=$P(t,i,o,v),x=b==="xc"||b==="yc",{offset:_,offsetType:E}=yf({channel:t,markDef:i,encoding:r,model:n,bandPosition:x?.5:0}),w=L_({channel:t,channelDef:e,markDef:i,config:o,scaleName:u,scale:l,stack:a,offset:_,defaultRef:cE({model:n,defaultPos:"mid",channel:t,scaleName:u,scale:l}),bandPosition:x?E==="encoding"?0:.5:Z(y)?{signal:`(1-${y})/2`}:ws(y)?(1-y.band)/2:0});if(c)return Object.assign({[b]:w},p);{const S=Ho(f),C=p[c],A=_?Object.assign(Object.assign({},C),{offset:_}):C;return{[b]:w,[S]:I(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:A})]:Object.assign(Object.assign({},w),{offset:A})}}}function Ql(e,t,n,i,r){if(eF(e))return 0;const o=e==="x"||e==="y2"?-t/2:t/2;if(Z(n)||Z(r)||Z(i)){const a=Jr(n),s=Jr(r),u=Jr(i),l=u?`${u} + `:"",c=a?`(${a} ? -1 : 1) * `:"",f=s?`(${s} + ${o})`:o;return{signal:l+c+f}}else return r=r||0,i+(n?-r-o:+r+o)}function uue({fieldDef:e,fieldDef2:t,channel:n,model:i}){var r,o,a;const{config:s,markDef:u,encoding:l}=i,c=i.getScaleComponent(n),f=i.scaleName(n),d=c?c.get("type"):void 0,h=c.get("reverse"),g=$5({channel:n,fieldDef:e,markDef:u,config:s,scaleType:d}),p=(r=i.component.axes[n])===null||r===void 0?void 0:r[0],m=(o=p==null?void 0:p.get("translate"))!==null&&o!==void 0?o:.5,y=xt(n)&&(a=Fe("binSpacing",u,s))!==null&&a!==void 0?a:0,v=Or(n),b=Ho(n),x=Ho(v),{offset:_}=yf({channel:n,markDef:u,encoding:l,model:i,bandPosition:0}),E=Z(g)?{signal:`(1-${g.signal})/2`}:ws(g)?(1-g.band)/2:.5;if(Le(e.bin)||e.timeUnit)return{[x]:dC({fieldDef:e,scaleName:f,bandPosition:E,offset:Ql(v,y,h,m,_)}),[b]:dC({fieldDef:e,scaleName:f,bandPosition:Z(E)?{signal:`1-${E.signal}`}:1-E,offset:Ql(n,y,h,m,_)})};if(Et(e.bin)){const w=ts(e,f,{},{offset:Ql(v,y,h,m,_)});if(q(t))return{[x]:w,[b]:ts(t,f,{},{offset:Ql(n,y,h,m,_)})};if($s(e.bin)&&e.bin.step)return{[x]:w,[b]:{signal:`scale("${f}", ${H(e,{expr:"datum"})} + ${e.bin.step})`,offset:Ql(n,y,h,m,_)}}}U(OF(v))}function dC({fieldDef:e,scaleName:t,bandPosition:n,offset:i}){return Kg({scaleName:t,fieldOrDatumDef:e,bandPosition:n,offset:i})}const lue=new Set(["aria","width","height"]);function ui(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?CP(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},cue(e.markDef,t)),hC(e,"fill",n)),hC(e,"stroke",i)),ht("opacity",e)),ht("fillOpacity",e)),ht("strokeOpacity",e)),ht("strokeWidth",e)),ht("strokeDash",e)),eue(e)),AP(e)),lE(e,"href")),Jse(e))}function hC(e,t,n){const{config:i,mark:r,markDef:o}=e;if(Fe("invalid",o,i)==="hide"&&n&&!Ea(r)){const s=fue(e,{invalid:!0,channels:Ep});if(s)return{[t]:[{test:s,value:null},...V(n)]}}return n?{[t]:n}:{}}function cue(e,t){return _L.reduce((n,i)=>(!lue.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=ze(e[i])),n),{})}function fue(e,{invalid:t=!1,channels:n}){const i=n.reduce((o,a)=>{const s=e.getScaleComponent(a);if(s){const u=s.get("type"),l=e.vgField(a,{expr:"datum"});l&&Un(u)&&(o[l]=!0)}return o},{}),r=z(i);if(r.length>0){const o=t?"||":"&&";return r.map(a=>z_(a,t)).join(` ${o} `)}}function fE(e){const{config:t,markDef:n}=e;if(Fe("invalid",n,t)){const r=due(e,{channels:Ar});if(r)return{defined:{signal:r}}}return{}}function due(e,{invalid:t=!1,channels:n}){const i=n.reduce((o,a)=>{var s;const u=e.getScaleComponent(a);if(u){const l=u.get("type"),c=e.vgField(a,{expr:"datum",binSuffix:!((s=e.stack)===null||s===void 0)&&s.impute?"mid":void 0});c&&Un(l)&&(o[c]=!0)}return o},{}),r=z(i);if(r.length>0){const o=t?"||":"&&";return r.map(a=>z_(a,t)).join(` ${o} `)}}function gC(e,t){if(t!==void 0)return{[e]:ze(t)}}const C1="voronoi",TP={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(C1)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,o=e.mark;if(Ea(o))return U(CL(o)),n;const a={name:e.getName(C1),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},AP(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,u=!1;return n.forEach((l,c)=>{var f;const d=(f=l.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?s=c:d.indexOf(C1)>=0&&(u=!0)}),u||n.splice(s+1,0,a),n}},MP={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!tE(e.bind),parse:(e,t,n)=>zP(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,o=t.bind,a=t.init&&t.init[0],s=TP.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((u,l)=>{var c,f;const d=qe(`${i}_${u.field}`);n.filter(g=>g.name===d).length||n.unshift(Object.assign(Object.assign({name:d},a?{init:Es(a[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${G(u.field)}] : null`}]:[],bind:(f=(c=o[u.field])!==null&&c!==void 0?c:o[u.channel])!==null&&f!==void 0?f:o}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,o=n.filter(l=>l.name===i+aa)[0],a=i+hd,s=r.items.map(l=>qe(`${i}_${l.field}`)),u=s.map(l=>`${l} !== null`).join(" && ");return s.length&&(o.update=`${u} ? {fields: ${a}, values: [${s.join(", ")}]} : null`),delete o.value,delete o.on,n}},rp="_toggle",DP={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+rp,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+aa,i=t.name+rp;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${tl(e)}}, `)+`${i} ? ${n} : null`}},hue={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=Y(t.clear)?_a(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(MP.defined(t))for(const i of t.project.items){const r=n.findIndex(o=>o.name===qe(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,o){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:o})}if(t.type==="interval")for(const r of t.project.items){const o=n.findIndex(a=>a.name===r.signals.visual);if(i(o,"[0, 0]"),o===-1){const a=n.findIndex(s=>s.name===r.signals.data);i(a,"null")}}else{let r=n.findIndex(o=>o.name===t.name+aa);i(r,"null"),DP.defined(t)&&(r=n.findIndex(o=>o.name===t.name+rp),i(r,"false"))}return n}},NP={defined:e=>{const t=e.resolve==="global"&&e.bind&&tE(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==yr;return t&&!n&&U(TL),t&&n},parse:(e,t,n)=>{var i;const r=le(n);if(r.select=Y(r.select)?{type:r.select,toggle:t.toggle}:Object.assign(Object.assign({},r.select),{toggle:t.toggle}),zP(t,r),K(n.select)&&(n.select.on||n.select.clear)){const s='event.item && indexof(event.item.mark.role, "legend") < 0';for(const u of t.events)u.filter=V((i=u.filter)!==null&&i!==void 0?i:[]),u.filter.includes(s)||u.filter.push(s)}const o=O1(t.bind)?t.bind.legend:"click",a=Y(o)?_a(o,"view"):V(o);t.bind={legend:{merge:a}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=O1(t.bind)&&t.bind.legend,o=a=>s=>{const u=le(s);return u.markname=a,u};for(const a of t.project.items){if(!a.hasLegend)continue;const s=`${qe(a.field)}_legend`,u=`${i}_${s}`;if(n.filter(c=>c.name===u).length===0){const c=r.merge.map(o(`${s}_symbols`)).concat(r.merge.map(o(`${s}_labels`))).concat(r.merge.map(o(`${s}_entries`)));n.unshift(Object.assign(Object.assign({name:u},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,o=n.find(d=>d.name===i+aa),a=i+hd,s=r.items.filter(d=>d.hasLegend).map(d=>qe(`${i}_${qe(d.field)}_legend`)),l=`${s.map(d=>`${d} !== null`).join(" && ")} ? {fields: ${a}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?o.on.push({events:s.map(d=>({signal:d})),update:l}):s.length>0&&(o.update=l,delete o.value,delete o.on);const c=n.find(d=>d.name===i+rp),f=O1(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:f})):c.on[0].events=f),n}};function gue(e,t,n){var i,r,o,a;const s=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;for(const u of zt((r=e.component.selection)!==null&&r!==void 0?r:{})){const l=(o=u.project.hasField[s])!==null&&o!==void 0?o:u.project.hasChannel[t];if(l&&NP.defined(u)){const c=(a=n.get("selections"))!==null&&a!==void 0?a:[];c.push(u.name),n.set("selections",c,!1),l.hasLegend=!0}}}const jP="_translate_anchor",RP="_translate_delta",pue={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=ra.defined(t),o=i+jP,{x:a,y:s}=t.project.hasChannel;let u=_a(t.translate,"scope");return r||(u=u.map(l=>(l.between[0].markname=i+_u,l))),n.push({name:o,value:{},on:[{events:u.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(a!==void 0?`, extent_x: ${r?Uv(e,He):`slice(${a.signals.visual})`}`:"")+(s!==void 0?`, extent_y: ${r?Uv(e,bt):`slice(${s.signals.visual})`}`:"")+"}"}]},{name:i+RP,value:{},on:[{events:u,update:`{x: ${o}.x - x(unit), y: ${o}.y - y(unit)}`}]}),a!==void 0&&pC(e,t,a,"width",n),s!==void 0&&pC(e,t,s,"height",n),n}};function pC(e,t,n,i,r){var o,a;const s=t.name,u=s+jP,l=s+RP,c=n.channel,f=ra.defined(t),d=r.filter(w=>w.name===n.signals[f?"data":"visual"])[0],h=e.getSizeSignalRef(i).signal,g=e.getScaleComponent(c),p=g.get("type"),m=g.get("reverse"),y=f?c===He?m?"":"-":m?"-":"":"",v=`${u}.extent_${c}`,b=`${y}${l}.${c} / ${f?`${h}`:`span(${v})`}`,x=f?p==="log"?"panLog":p==="symlog"?"panSymlog":p==="pow"?"panPow":"panLinear":"panLinear",_=f?p==="pow"?`, ${(o=g.get("exponent"))!==null&&o!==void 0?o:1}`:p==="symlog"?`, ${(a=g.get("constant"))!==null&&a!==void 0?a:1}`:"":"",E=`${x}(${v}, ${b}${_})`;d.on.push({events:{signal:l},update:f?E:`clampRange(${E}, 0, ${h})`})}const PP="_zoom_anchor",IP="_zoom_delta",mue={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=ra.defined(t),o=i+IP,{x:a,y:s}=t.project.hasChannel,u=G(e.scaleName(He)),l=G(e.scaleName(bt));let c=_a(t.zoom,"scope");return r||(c=c.map(f=>(f.markname=i+_u,f))),n.push({name:i+PP,on:[{events:c,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:o,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),a!==void 0&&mC(e,t,a,"width",n),s!==void 0&&mC(e,t,s,"height",n),n}};function mC(e,t,n,i,r){var o,a;const s=t.name,u=n.channel,l=ra.defined(t),c=r.filter(x=>x.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(u),h=d.get("type"),g=l?Uv(e,u):c.name,p=s+IP,m=`${s}${PP}.${u}`,y=l?h==="log"?"zoomLog":h==="symlog"?"zoomSymlog":h==="pow"?"zoomPow":"zoomLinear":"zoomLinear",v=l?h==="pow"?`, ${(o=d.get("exponent"))!==null&&o!==void 0?o:1}`:h==="symlog"?`, ${(a=d.get("constant"))!==null&&a!==void 0?a:1}`:"":"",b=`${y}(${g}, ${m}, ${p}${v})`;c.on.push({events:{signal:p},update:l?b:`clampRange(${b}, 0, ${f})`})}const Ss="_store",aa="_tuple",yue="_modify",LP="vlSelectionResolve",Z0=[Kse,Xse,Hse,DP,MP,ra,NP,hue,pue,mue,TP];function vue(e){let t=e.parent;for(;t&&!Ti(t);)t=t.parent;return t}function tl(e,{escape:t}={escape:!0}){let n=t?G(e.name):e.name;const i=vue(e);if(i){const{facet:r}=i;for(const o of Yn)r[o]&&(n+=` + '__facet_${o}_' + (facet[${G(i.vgField(o))}])`)}return n}function dE(e){var t;return zt((t=e.component.selection)!==null&&t!==void 0?t:{}).reduce((n,i)=>n||i.project.hasSelectionId,!1)}function zP(e,t){(Y(t.select)||!t.select.on)&&delete e.events,(Y(t.select)||!t.select.clear)&&delete e.clear,(Y(t.select)||!t.select.toggle)&&delete e.toggle}function Gv(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...Gv(e.object)),t.push(...Gv(e.property))),t)}function BP(e){return e.object.type==="MemberExpression"?BP(e.object):e.object.name==="datum"}function UP(e){const t=a_(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&BP(i)&&n.add(Gv(i).slice(1).join("."))}),n}class Al extends je{constructor(t,n,i){super(t),this.model=n,this.filter=i,this.expr=op(this.model,this.filter,this),this._dependentFields=UP(this.expr)}clone(){return new Al(null,this.model,le(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function bue(e,t){var n;const i={},r=e.config.selection;if(!t||!t.length)return i;for(const o of t){const a=qe(o.name),s=o.select,u=Y(s)?s:s.type,l=K(s)?le(s):{type:u},c=r[u];for(const d in c)d==="fields"||d==="encodings"||(d==="mark"&&(l[d]=Object.assign(Object.assign({},c[d]),l[d])),(l[d]===void 0||l[d]===!0)&&(l[d]=(n=c[d])!==null&&n!==void 0?n:l[d]));const f=i[a]=Object.assign(Object.assign({},l),{name:a,type:u,init:o.value,bind:o.bind,events:Y(l.on)?_a(l.on,"scope"):V(le(l.on))});for(const d of Z0)d.defined(f)&&d.parse&&d.parse(e,f,o)}return i}function qP(e,t,n,i="datum"){const r=Y(t)?t:t.param,o=qe(r),a=G(o+Ss);let s;try{s=e.getSelectionComponent(o,r)}catch{return`!!${o}`}if(s.project.timeUnit){const d=n!=null?n:e.component.data.raw,h=s.project.timeUnit.clone();d.parent?h.insertAsParentOf(d):d.parent=h}const u=s.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",l=s.resolve==="global"?")":`, ${G(s.resolve)})`,c=`${u}${a}, ${i}${l}`,f=`length(data(${a}))`;return t.empty===!1?`${f} && ${c}`:`!${f} || ${c}`}function WP(e,t,n){const i=qe(t),r=n.encoding;let o=n.field,a;try{a=e.getSelectionComponent(i,t)}catch{return i}if(!r&&!o)o=a.project.items[0].field,a.project.items.length>1&&U(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${G(o)}.`);else if(r&&!o){const s=a.project.items.filter(u=>u.channel===r);!s.length||s.length>1?(o=a.project.items[0].field,U((s.length?"Multiple ":"No ")+`matching ${G(r)} encoding found for selection ${G(n.param)}. Using "field": ${G(o)}.`)):o=s[0].field}return`${a.name}[${G(ei(o))}]`}function xue(e,t){var n;for(const[i,r]of Go((n=e.component.selection)!==null&&n!==void 0?n:{})){const o=e.getName(`lookup_${i}`);e.component.data.outputNodes[o]=r.materialized=new rn(new Al(t,e,{param:i}),o,Pe.Lookup,e.component.data.outputNodeRefCounts)}}function op(e,t,n){return Cc(t,i=>Y(i)?i:H4(i)?qP(e,i,n):DF(i))}var Yd=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function wue(e,t){if(!!e)return I(e)&&!Eo(e)?e.map(n=>H_(n,t)).join(", "):e}function $1(e,t,n,i){var r,o,a,s,u;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(o=(s=e.encode)[t])!==null&&o!==void 0||(s[t]={}),(a=(u=e.encode[t]).update)!==null&&a!==void 0||(u.update={}),e.encode[t].update[n]=i}function Oc(e,t,n,i={header:!1}){var r,o;const a=e.combine(),{disable:s,orient:u,scale:l,labelExpr:c,title:f,zindex:d}=a,h=Yd(a,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(const g in h){const p=Zoe[g],m=h[g];if(p&&p!==t&&p!=="both")delete h[g];else if(dd(m)){const{condition:y}=m,v=Yd(m,["condition"]),b=V(y),x=Yk[g];if(x){const{vgProp:_,part:E}=x,w=[...b.map(S=>{const{test:C}=S,A=Yd(S,["test"]);return Object.assign({test:op(null,C)},A)}),v];$1(h,E,_,w),delete h[g]}else if(x===null){const _={signal:b.map(E=>{const{test:w}=E,S=Yd(E,["test"]);return`${op(null,w)} ? ${HE(S)} : `}).join("")+HE(v)};h[g]=_}}else if(Z(m)){const y=Yk[g];if(y){const{vgProp:v,part:b}=y;$1(h,b,v,m),delete h[g]}}me(["labelAlign","labelBaseline"],g)&&h[g]===null&&delete h[g]}if(t==="grid"){if(!h.grid)return;if(h.encode){const{grid:g}=h.encode;h.encode=Object.assign({},g?{grid:g}:{}),Me(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:l,orient:u},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:nt(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(c!==void 0){let p=c;((o=(r=h.encode)===null||r===void 0?void 0:r.labels)===null||o===void 0?void 0:o.update)&&Z(h.encode.labels.update.text)&&(p=as(c,"datum.label",h.encode.labels.update.text.signal)),$1(h,"labels","text",{signal:p})}if(h.labelAlign===null&&delete h.labelAlign,h.encode){for(const p of I5)e.hasAxisPart(p)||delete h.encode[p];Me(h.encode)&&delete h.encode}const g=wue(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},g?{title:g}:{}),h),n.aria===!1?{aria:!1}:{}),{zindex:nt(d,0)})}}}function GP(e){const{axes:t}=e.component,n=[];for(const i of Ar)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const o=i==="x"?"height":"width",a=e.getSizeSignalRef(o).signal;o!==a&&n.push({name:o,update:a})}}return n}function _ue(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>Oc(r,"grid",t)),...i.map(r=>Oc(r,"grid",t)),...n.map(r=>Oc(r,"main",t)),...i.map(r=>Oc(r,"main",t))].filter(r=>r)}function yC(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const o=n==="x"?"bottom":"left",a=t[n==="x"?"axisBottom":"axisLeft"]||{},s=t[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...z(a),...z(s)]),l={};for(const c of u.values())l[c]={signal:`${i.signal} === "${o}" ? ${Jr(a[c])} : ${Jr(s[c])}`};return l}return t[r]})])}function Eue(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:f5(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],o=e==="x"?"axisX":"axisY",a=Z(n)?"axisOrient":`axis${Of(n)}`,s=[...r,...r.map(l=>o+l.substr(4))],u=["axis",a,o];return{vlOnlyAxisConfig:yC(s,i,e,n),vgAxisConfig:yC(u,i,e,n),axisConfigStyle:Sue([...u,...s],i)}}function Sue(e,t){var n;const i=[{}];for(const r of e){let o=(n=t[r])===null||n===void 0?void 0:n.style;if(o){o=V(o);for(const a of o)i.push(t.style[a])}}return Object.assign.apply(null,i)}function Hv(e,t,n,i={}){var r;const o=pF(e,n,t);if(o!==void 0)return{configFrom:"style",configValue:o};for(const a of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[a])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:a,configValue:i[a][e]};return{}}const vC={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return E5(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return S5(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(i=t.grid)!==null&&i!==void 0?i:Oue(n,e)},gridScale:({model:e,channel:t})=>Aue(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||YP(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||HP(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:Cue(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:$ue(t.type,n,q(t)&&!!t.timeUnit,q(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var o;const a=e==="x"?"width":e==="y"?"height":void 0,s=a?t.getSizeSignalRef(a):void 0;return(o=n.tickCount)!==null&&o!==void 0?o:Tue({fieldOrDatumDef:i,scaleType:r,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=XP(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),o=n==="x"?"x2":"y2",a=t.fieldDef(o);return yF(r?[Hk(r)]:[],q(a)?[Hk(a)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Mue(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:Due(n,t)}};function Oue(e,t){return!wt(e)&&q(t)&&!Le(t==null?void 0:t.bin)&&!Et(t==null?void 0:t.bin)}function Aue(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function kue(e,t,n,i,r){const o=t==null?void 0:t.labelAngle;if(o!==void 0)return Z(o)?o:Wc(o);{const{configValue:a}=Hv("labelAngle",i,t==null?void 0:t.style,r);return a!==void 0?Wc(a):n===He&&me([j_,N_],e.type)&&!(q(e)&&e.timeUnit)?270:void 0}}function Yv(e){return`(((${e.signal} % 360) + 360) % 360)`}function HP(e,t,n,i){if(e!==void 0)if(n==="x"){if(Z(e)){const r=Yv(e),o=Z(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${o} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(Z(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(Z(e)){const r=Yv(e),o=Z(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${r} && ${r} <= 135) === ${o} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(Z(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function YP(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,o=i?"bottom":"left";if(Z(e)){const a=Yv(e),s=Z(t)?`(${t.signal} === "${o}")`:t===o;return{signal:`(${r?`(${a} + 90)`:a} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${a} && ${a} < ${180+r}) === ${s} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(Z(t)){const a=r<e&&e<180+r?"===":"!==";return{signal:`${`${t.signal} ${a} "${o}"`} ? "left" : "right"`}}return(r<e&&e<180+r)==(t===o)?"left":"right"}function Cue(e,t){if(t==="x"&&me(["quantitative","temporal"],e))return!0}function $ue(e,t,n,i){if(n&&!K(i)||e!=="nominal"&&e!=="ordinal")return t==="log"||t==="symlog"?"greedy":!0}function Fue(e){return e==="x"?"bottom":"left"}function Tue({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!wt(t)&&t!=="log"){if(q(e)){if(Le(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&me(["month","hours","day","quarter"],(r=Ht(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function XP(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),o=i?i.title:void 0,a=r?r.title:void 0;if(o&&a)return vF(o,a);if(o)return o;if(a)return a;if(o!==void 0)return o;if(a!==void 0)return a}function Mue(e,t){const n=e.values;if(I(n))return P5(t,n);if(Z(n))return n}function Due(e,t){return e==="rect"&&Jg(t)?1:0}class nl extends je{constructor(t,n){super(t),this.transform=n,this._dependentFields=UP(this.transform.calculate)}clone(){return new nl(null,le(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(!!zs(i)&&k5(i.sort)){const{field:o,timeUnit:a}=i,s=i.sort,u=s.map((l,c)=>`${DF({field:o,timeUnit:a,equal:l})} ? ${c} : `).join("")+s.length;t=new nl(t,{calculate:u,as:il(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${be(this.transform)}`}}function il(e,t,n){return H(e,Object.assign({prefix:t,suffix:"sort_index"},n!=null?n:{}))}function em(e,t){return me(["top","bottom"],t)?"column":me(["left","right"],t)||e==="row"?"row":"column"}function rl(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return nt((t||{})[e],r[e],n.header[e])}function tm(e,t,n,i){const r={};for(const o of e){const a=rl(o,t||{},n,i);a!==void 0&&(r[o]=a)}return r}const hE=["row","column"],gE=["header","footer"];function Nue(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:o,titleAngle:a,titleOrient:s}=tm(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),u=em(t,s),l=Wc(a);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),KP(l,u)),VP(u,l,o)),JP(i,r,t,_ae,tP))}}function VP(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=YP(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function KP(e,t){const n=HP(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function jue(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of gE)if(n[r])for(const o of n[r]){const a=Pue(e,t,r,n,o);a!=null&&i.push(a)}return i}function Rue(e,t){var n;const{sort:i}=e;return ar(i)?{field:H(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:I(i)?{field:il(e,t,{expr:"datum"}),order:"ascending"}:{field:H(e,{expr:"datum"}),order:i!=null?i:"ascending"}}function Xv(e,t,n){const{format:i,formatType:r,labelAngle:o,labelAnchor:a,labelOrient:s,labelExpr:u}=tm(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=U_({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=em(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?as(as(u,"datum.label",l),"datum.value",H(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),KP(o,c)),VP(c,o,a)),JP(n,e,t,Eae,nP))}function Pue(e,t,n,i,r){if(r){let o=null;const{facetFieldDef:a}=i,s=e.config?e.config:void 0;if(a&&r.labels){const{labelOrient:f}=tm(["labelOrient"],a.header,s,t);(t==="row"&&!me(["top","bottom"],f)||t==="column"&&!me(["left","right"],f))&&(o=Xv(a,t,s))}const u=Ti(e)&&!ld(e.facet),l=r.axes,c=(l==null?void 0:l.length)>0;if(o||c){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:Rue(a,t)}:{}),c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),o?{title:o}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const Iue={column:{start:0,end:1},row:{start:1,end:0}};function Lue(e,t){return Iue[t][e]}function zue(e,t){const n={};for(const i of Yn){const r=e[i];if(r!=null&&r.facetFieldDef){const{titleAnchor:o,titleOrient:a}=tm(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),s=em(i,a),u=Lue(o,s);u!==void 0&&(n[s]=u)}}return Me(n)?void 0:n}function JP(e,t,n,i,r){const o={};for(const a of i){if(!r[a])continue;const s=rl(a,t==null?void 0:t.header,e,n);s!==void 0&&(o[r[a]]=s)}return o}function pE(e){return[...Xd(e,"width"),...Xd(e,"height"),...Xd(e,"childWidth"),...Xd(e,"childHeight")]}function Xd(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const o=e.getScaleComponent(n);if(o){const a=o.get("type"),s=o.get("range");if(wt(a)&&ma(s)){const u=e.scaleName(n);return Ti(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[bC(u,s)]:[bC(u,s),{name:r,update:QP(u,o,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const o=r.endsWith("width"),a=o?"containerSize()[0]":"containerSize()[1]",s=Iv(e.config.view,o?"width":"height"),u=`isFinite(${a}) ? ${a} : ${s}`;return[{name:r,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:r,value:i}]}function bC(e,t){const n=`${e}_step`;return Z(t.step)?{name:n,update:t.step.signal}:{name:n,value:t.step}}function QP(e,t,n){const i=t.get("type"),r=t.get("padding"),o=nt(t.get("paddingOuter"),r);let a=t.get("paddingInner");return a=i==="band"?a!==void 0?a:r:1,`bandspace(${n}, ${Jr(a)}, ${Jr(o)}) * ${e}_step`}function ZP(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function e6(e,t){return z(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),Ol(t,r,i,o=>ze(o.value)))},{})}function t6(e,t){if(Ti(t))return e==="theta"?"independent":"shared";if($l(t))return"shared";if(_E(t))return xt(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function mE(e,t){const n=e.scale[t],i=xt(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&U(p4(t)),"independent"):e[i][t]||"shared"}const Bue=Object.assign(Object.assign({},Aae),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),n6=z(Bue);class Uue extends po{}const xC={symbols:que,gradient:Wue,labels:Gue,entries:Hue};function que(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:o}){var a,s,u,l,c,f,d,h;if(o!=="symbol")return;const{markDef:g,encoding:p,config:m,mark:y}=n,v=g.filled&&y!=="trail";let b=Object.assign(Object.assign({},OL({},n,_oe)),CP(n,{filled:v}));const x=(a=r.get("symbolOpacity"))!==null&&a!==void 0?a:m.legend.symbolOpacity,_=(s=r.get("symbolFillColor"))!==null&&s!==void 0?s:m.legend.symbolFillColor,E=(u=r.get("symbolStrokeColor"))!==null&&u!==void 0?u:m.legend.symbolStrokeColor,w=x===void 0?(l=i6(p.opacity))!==null&&l!==void 0?l:g.opacity:void 0;if(b.fill){if(i==="fill"||v&&i===_n)delete b.fill;else if(b.fill.field)_?delete b.fill:(b.fill=ze((c=m.legend.symbolBaseFillColor)!==null&&c!==void 0?c:"black"),b.fillOpacity=ze(w!=null?w:1));else if(I(b.fill)){const S=(h=(d=Vv((f=p.fill)!==null&&f!==void 0?f:p.color))!==null&&d!==void 0?d:g.fill)!==null&&h!==void 0?h:v&&g.color;S&&(b.fill=ze(S))}}if(b.stroke){if(i==="stroke"||!v&&i===_n)delete b.stroke;else if(b.stroke.field||E)delete b.stroke;else if(I(b.stroke)){const S=nt(Vv(p.stroke||p.color),g.stroke,v?g.color:void 0);S&&(b.stroke={value:S})}}if(i!==lo){const S=q(t)&&o6(n,r,t);S?b.opacity=[Object.assign({test:S},ze(w!=null?w:1)),ze(m.legend.unselectedOpacity)]:w&&(b.opacity=ze(w))}return b=Object.assign(Object.assign({},b),e),Me(b)?void 0:b}function Wue(e,{model:t,legendType:n,legendCmpt:i}){var r;if(n!=="gradient")return;const{config:o,markDef:a,encoding:s}=t;let u={};const c=((r=i.get("gradientOpacity"))!==null&&r!==void 0?r:o.legend.gradientOpacity)===void 0?i6(s.opacity)||a.opacity:void 0;return c&&(u.opacity=ze(c)),u=Object.assign(Object.assign({},u),e),Me(u)?void 0:u}function Gue(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const o=n.legend(i)||{},a=n.config,s=q(t)?o6(n,r,t):void 0,u=s?[{test:s,value:1},{value:a.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=o;let f;_s(c)?f=ki({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:a}):l===void 0&&c===void 0&&a.customFormatTypes&&(t.type==="quantitative"&&a.numberFormatType?f=ki({fieldOrDatumDef:t,field:"datum.value",format:a.numberFormat,formatType:a.numberFormatType,config:a}):t.type==="temporal"&&a.timeFormatType&&q(t)&&t.timeUnit===void 0&&(f=ki({fieldOrDatumDef:t,field:"datum.value",format:a.timeFormat,formatType:a.timeFormatType,config:a})));const d=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),e);return Me(d)?void 0:d}function Hue(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function i6(e){return r6(e,(t,n)=>Math.max(t,n.value))}function Vv(e){return r6(e,(t,n)=>nt(t,n.value))}function r6(e,t){if(Boe(e))return V(e.condition).reduce(t,e.value);if(ji(e))return e.value}function o6(e,t,n){const i=t.get("selections");if(!(i!=null&&i.length))return;const r=G(n.field);return i.map(o=>`(!length(data(${G(qe(o)+Ss)})) || (${o}[${r}] && indexof(${o}[${r}], datum.value) >= 0))`).join(" || ")}const wC={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return E5(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return S5(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:Zue(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:ele(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:Xue(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>wu(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(pu(n)&&Ai(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>Yue(t,e)};function Yue(e,t){const n=e.values;if(I(n))return P5(t,n);if(Z(n))return n}function Xue(e,t,n,i){var r;if(t!=="shape"){const o=(r=Vv(n))!==null&&r!==void 0?r:i;if(o)return o}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function Vue(e){const{legend:t}=e;return nt(t.type,Kue(e))}function Kue({channel:e,timeUnit:t,scaleType:n}){if(pu(e)){if(me(["quarter","month","day"],t))return"symbol";if(Ai(n))return"gradient"}return"symbol"}function Jue({legendConfig:e,legendType:t,orient:n,legend:i}){var r,o;return(o=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&o!==void 0?o:Que(n,t)}function Que(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function Zue({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:o,gradientHorizontalMinLength:a,gradientVerticalMaxLength:s,gradientVerticalMinLength:u}=e;if(Ai(r))return n==="horizontal"?i==="top"||i==="bottom"?_C(t,"width",a,o):a:_C(t,"height",u,s)}function _C(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function ele(e){if(me(["quantile","threshold","log","symlog"],e))return"greedy"}function a6(e){const t=tt(e)?tle(e):ole(e);return e.component.legends=t,t}function tle(e){const{encoding:t}=e,n={};for(const i of[_n,...rP]){const r=st(t[i]);!r||!e.getScaleComponent(i)||i===En&&q(r)&&r.type===Sl||(n[i]=rle(e,i))}return n}function nle(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function ile(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function rle(e,t){var n,i,r;let o=e.legend(t);const{markDef:a,encoding:s,config:u}=e,l=u.legend,c=new Uue({},nle(e,t));gue(e,t,c);const f=o!==void 0?!o:l.disable;if(c.set("disable",f,o!==void 0),f)return c;o=o||{};const d=e.getScaleComponent(t).get("type"),h=st(s[t]),g=q(h)?(n=Ht(h.timeUnit))===null||n===void 0?void 0:n.unit:void 0,p=o.orient||u.legend.orient||"right",m=Vue({legend:o,channel:t,timeUnit:g,scaleType:d}),y=Jue({legend:o,legendType:m,orient:p,legendConfig:l}),v={legend:o,channel:t,model:e,markDef:a,encoding:s,fieldOrDatumDef:h,legendConfig:l,config:u,scaleType:d,orient:p,legendType:m,direction:y};for(const w of n6){if(m==="gradient"&&w.startsWith("symbol")||m==="symbol"&&w.startsWith("gradient"))continue;const S=w in wC?wC[w](v):o[w];if(S!==void 0){const C=ile(S,w,o,e.fieldDef(t));(C||u.legend[w]===void 0)&&c.set(w,S,C)}}const b=(i=o==null?void 0:o.encoding)!==null&&i!==void 0?i:{},x=c.get("selections"),_={},E={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:c,legendType:m};for(const w of["labels","legend","title","symbols","gradient","entries"]){const S=e6((r=b[w])!==null&&r!==void 0?r:{},e),C=w in xC?xC[w](S,E):S;C!==void 0&&!Me(C)&&(_[w]=Object.assign(Object.assign(Object.assign({},(x==null?void 0:x.length)&&q(h)?{name:`${qe(h.field)}_legend_${w}`}:{}),x!=null&&x.length?{interactive:!!x}:{}),{update:C}))}return Me(_)||c.set("encode",_,!!(o!=null&&o.encoding)),c}function ole(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){a6(i);for(const r of z(i.component.legends))n.legend[r]=mE(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=s6(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of z(t))for(const r of e.children)!r.component.legends[i]||n.legend[i]==="shared"&&delete r.component.legends[i];return t}function s6(e,t){var n,i,r,o;if(!e)return t.clone();const a=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(a.explicit&&s.explicit&&a.value!==s.value)return;let u=!1;for(const l of n6){const c=ia(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return ale(f,d);case"title":return bF(f,d);case"type":return u=!0,Tn("symbol")}return J0(f,d,l,"legend")});e.setWithExplicit(l,c)}return u&&(!((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0)&&i.gradient&&Mh(e.implicit,["encode","gradient"]),!((o=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||o===void 0)&&o.gradient&&Mh(e.explicit,["encode","gradient"])),e}function ale(e,t){return t.value==="circle"?t:e}var sle=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ule(e,t,n,i){var r,o,a,s,u;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(o=(s=e.encode)[t])!==null&&o!==void 0||(s[t]={}),(a=(u=e.encode[t]).update)!==null&&a!==void 0||(u.update={}),e.encode[t].update[n]=i}function u6(e){const t=e.component.legends,n={};for(const r of z(t)){const o=e.getScaleComponent(r),a=Ie(o.get("domains"));if(n[a])for(const s of n[a])s6(s,t[r])||n[a].push(t[r]);else n[a]=[t[r].clone()]}return zt(n).flat().map(r=>lle(r,e.config)).filter(r=>r!==void 0)}function lle(e,t){var n,i,r;const o=e.combine(),{disable:a,labelExpr:s,selections:u}=o,l=sle(o,["disable","labelExpr","selections"]);if(!a){if(t.aria===!1&&l.aria==null&&(l.aria=!1),!((n=l.encode)===null||n===void 0)&&n.symbols){const c=l.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!l.stroke&&(c.stroke={value:"transparent"});for(const f of rP)l[f]&&delete c[f]}if(l.title||delete l.title,s!==void 0){let c=s;((r=(i=l.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&Z(l.encode.labels.update.text)&&(c=as(s,"datum.label",l.encode.labels.update.text.signal)),ule(l,"labels","text",{signal:c})}return l}}function cle(e){return $l(e)||_E(e)?fle(e):l6(e)}function fle(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),l6(e))}function l6(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(a=>a.signal).join(", ")}]`},o=t.data.reduce((a,s)=>{const u=Z(s)?s.signal:`data('${e.lookupDataSource(s)}')`;return me(a,u)||a.push(u),a},[]);if(o.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:o.length>1?`[${o.join(", ")}]`:o[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const dle=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class c6 extends po{constructor(t,n,i,r){super(Object.assign({},n),{name:t}),this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function f6(e){e.component.projection=tt(e)?hle(e):mle(e)}function hle(e){var t;if(e.hasProjection){const n=dn(e.specifiedProjection),i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,o=i?gle(e):void 0,a=new c6(e.projectionName(!0),Object.assign(Object.assign({},(t=dn(e.config.projection))!==null&&t!==void 0?t:{}),n!=null?n:{}),r,o);return a.get("type")||a.set("type","equalEarth",!1),a}}function gle(e){const t=[],{encoding:n}=e;for(const i of[[_r,wr],[ti,Ii]])(st(n[i[0]])||st(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(En)&&e.typedFieldDef(En).type===Sl&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(Pe.Main)),t}function ple(e,t){const n=kb(dle,r=>!!(!ee(e.explicit,r)&&!ee(t.explicit,r)||ee(e.explicit,r)&&ee(t.explicit,r)&&Zi(e.get(r),t.get(r))));if(Zi(e.size,t.size)){if(n)return e;if(Zi(e.explicit,{}))return t;if(Zi(t.explicit,{}))return e}return null}function mle(e){if(e.children.length===0)return;let t;for(const i of e.children)f6(i);const n=kb(e.children,i=>{const r=i.component.projection;if(r)if(t){const o=ple(t,r);return o&&(t=o),!!o}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new c6(i,t.specifiedProjection,t.size,le(t.data));for(const o of e.children){const a=o.component.projection;a&&(a.isFit&&r.data.push(...o.component.projection.data),o.renameProjection(a.get("name"),i),a.merged=!0)}return r}}var yle=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function vle(e,t,n,i){var r,o;if(fd(t,n)){const a=tt(e)?(o=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&o!==void 0?o:{}:{},s=H(t,{expr:"datum"}),u=H(t,{expr:"datum",binSuffix:"end"});return{formulaAs:H(t,{binSuffix:"range",forAs:!0}),formula:ud(s,u,a.format,a.formatType,i)}}return{}}function d6(e,t){return`${fF(e)}_${t}`}function ble(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function yE(e,t,n){var i;const r=(i=G0(n,void 0))!==null&&i!==void 0?i:{},o=d6(r,t);return e.getName(`${o}_bins`)}function xle(e){return"as"in e}function EC(e,t,n){let i,r;xle(e)?i=Y(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[H(e,{forAs:!0}),H(e,{binSuffix:"end",forAs:!0})];const o=Object.assign({},G0(t,void 0)),a=d6(o,e.field),{signal:s,extentSignal:u}=ble(n,a);if(Sp(o.extent)){const c=o.extent;r=WP(n,c.param,c),delete o.extent}const l=Object.assign(Object.assign(Object.assign({bin:o,field:e.field,as:[i]},s?{signal:s}:{}),u?{extentSignal:u}:{}),r?{span:r}:{});return{key:a,binComponent:l}}class ur extends je{constructor(t,n){super(t),this.bins=n}clone(){return new ur(null,le(this.bins))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,o,a)=>{if(oi(o)&&Le(o.bin)){const{key:s,binComponent:u}=EC(o,o.bin,n);r[s]=Object.assign(Object.assign(Object.assign({},u),r[s]),vle(n,o,a,n.config))}return r},{});return Me(i)?null:new ur(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:o}=EC(n,n.bin,i);return new ur(t,{[r]:o})}merge(t,n){for(const i of z(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=er([...this.bins[i].as,...t.bins[i].as],be)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(zt(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(zt(this.bins).map(t=>t.field))}hash(){return`Bin ${be(this.bins)}`}assemble(){return zt(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,o=t.bin,{extent:a}=o,s=yle(o,["extent"]),u=Object.assign(Object.assign(Object.assign({type:"bin",field:ei(t.field),as:i,signal:t.signal},Sp(a)?{extent:null}:{extent:a}),t.span?{span:{signal:`span(${t.span})`}}:{}),s);!a&&t.extentSignal&&(n.push({type:"extent",field:ei(t.field),signal:t.extentSignal}),u.extent={signal:t.extentSignal}),n.push(u);for(const l of r)for(let c=0;c<2;c++)n.push({type:"formula",expr:H({field:i[c]},{expr:"datum"}),as:l[c]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function wle(e,t,n,i){var r;const o=tt(i)?i.encoding[Or(t)]:void 0;if(oi(n)&&tt(i)&&F5(n,o,i.markDef,i.config))e.add(H(n,{})),e.add(H(n,{suffix:"end"})),n.bin&&fd(n,t)&&e.add(H(n,{binSuffix:"range"}));else if(VI(t)){const a=XI(t);e.add(i.getName(a))}else e.add(H(n));return zs(n)&&coe((r=n.scale)===null||r===void 0?void 0:r.range)&&e.add(n.scale.range.field),e}function _le(e,t){var n;for(const i of z(t)){const r=t[i];for(const o of z(r))i in e?e[i][o]=new Set([...(n=e[i][o])!==null&&n!==void 0?n:[],...r[o]]):e[i]={[o]:r[o]}}}class Fi extends je{constructor(t,n,i){super(t),this.dimensions=n,this.measures=i}clone(){return new Fi(null,new Set(this.dimensions),le(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(a=>{a.aggregate&&(i=!0)});const r={},o=new Set;return!i||(n.forEachFieldDef((a,s)=>{var u,l,c,f;const{aggregate:d,field:h}=a;if(d)if(d==="count")(u=r["*"])!==null&&u!==void 0||(r["*"]={}),r["*"].count=new Set([H(a,{forAs:!0})]);else{if(no(d)||pa(d)){const g=no(d)?"argmin":"argmax",p=d[g];(l=r[p])!==null&&l!==void 0||(r[p]={}),r[p][g]=new Set([H({op:g,field:p},{forAs:!0})])}else(c=r[h])!==null&&c!==void 0||(r[h]={}),r[h][d]=new Set([H(a,{forAs:!0})]);ga(s)&&n.scaleDomain(s)==="unaggregated"&&((f=r[h])!==null&&f!==void 0||(r[h]={}),r[h].min=new Set([H({field:h,aggregate:"min"},{forAs:!0})]),r[h].max=new Set([H({field:h,aggregate:"max"},{forAs:!0})]))}else wle(o,s,a,n)}),o.size+z(r).length===0)?null:new Fi(t,o,r)}static makeFromTransform(t,n){var i,r,o;const a=new Set,s={};for(const u of n.aggregate){const{op:l,field:c,as:f}=u;l&&(l==="count"?((i=s["*"])!==null&&i!==void 0||(s["*"]={}),s["*"].count=new Set([f||H(u,{forAs:!0})])):((r=s[c])!==null&&r!==void 0||(s[c]={}),s[c][l]=new Set([f||H(u,{forAs:!0})])))}for(const u of(o=n.groupby)!==null&&o!==void 0?o:[])a.add(u);return a.size+z(s).length===0?null:new Fi(t,a,s)}merge(t){return Y$(this.dimensions,t.dimensions)?(_le(this.measures,t.measures),!0):(T4("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...z(this.measures)])}producedFields(){const t=new Set;for(const n of z(this.measures))for(const i of z(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${be({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const o of z(this.measures))for(const a of z(this.measures[o]))for(const s of this.measures[o][a])i.push(s),t.push(a),n.push(o==="*"?null:ei(o));return{type:"aggregate",groupby:[...this.dimensions].map(ei),ops:t,fields:n,as:i}}}class kl extends je{constructor(t,n,i,r){super(t),this.model=n,this.name=i,this.data=r;for(const o of Yn){const a=n.facet[o];if(a){const{bin:s,sort:u}=a;this[o]=Object.assign({name:n.getName(`${o}_domain`),fields:[H(a),...Le(s)?[H(a,{binSuffix:"end"})]:[]]},ar(u)?{sortField:u}:I(u)?{sortIndexField:il(a,o)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of Yn)this[n]&&(t+=` ${n.charAt(0)}:${be(this[n])}`);return t}get fields(){var t;const n=[];for(const i of Yn)!((t=this[i])===null||t===void 0)&&t.fields&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of Yn)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Ar){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),o=i.get("range");if(wt(r)&&ma(o)){const a=nm(this.childModel,n),s=wE(a);s?t[n]=s:U(Bb(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],o=[],a=[],s=[];r&&i&&i[r]&&(n?(o.push(`distinct_${i[r]}`),a.push("max")):(o.push(i[r]),a.push("distinct")),s.push(`distinct_${i[r]}`));const{sortField:u,sortIndexField:l}=this[t];if(u){const{op:c=B0,field:f}=u;o.push(f),a.push(c),s.push(H(u,{forAs:!0}))}else l&&(o.push(l),a.push("max"),s.push(l));return{name:this[t].name,source:n!=null?n:this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},o.length?{fields:o,ops:a,as:s}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:r}=this.model.layout,{layoutHeaders:o}=this.model.component,a=[],s={};for(const c of hE){for(const f of gE){const d=(n=o[c]&&o[c][f])!==null&&n!==void 0?n:[];for(const h of d)if(((i=h.axes)===null||i===void 0?void 0:i.length)>0){s[c]=!0;break}}if(s[c]){const f=`length(data("${this.facet.name}"))`,d=c==="row"?r?{signal:`ceil(${f} / ${r})`}:1:r?{signal:`min(${f}, ${r})`}:{signal:f};a.push({name:`${this.facet.name}_${c}`,transform:[{type:"sequence",start:0,stop:d}]})}}const{row:u,column:l}=s;return(u||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,t)),a}assemble(){var t,n;const i=[];let r=null;const o=this.getChildIndependentFieldsWithStep(),{column:a,row:s,facet:u}=this;if(a&&s&&(o.x||o.y)){r=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=o.x)!==null&&t!==void 0?t:[],(n=o.y)!==null&&n!==void 0?n:[]),c=l.map(()=>"distinct");i.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:c}]})}for(const l of[Kr,Vr])this[l]&&i.push(this.assembleRowColumnHeaderData(l,r,o));if(u){const l=this.assembleFacetHeaderData(o);l&&i.push(...l)}return i}}function SC(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function Ele(e,t){const n=Fb(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=SC(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=SC(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return U(IL(t)),null}function Sle(e){const t={};return oh(e.filter,n=>{var i;if(MF(n)){let r=null;Hb(n)?r=Nn(n.equal):Xb(n)?r=Nn(n.lte):Yb(n)?r=Nn(n.lt):Vb(n)?r=Nn(n.gt):Kb(n)?r=Nn(n.gte):Jb(n)?r=n.range[0]:Qb(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(Fs(r)?t[n.field]="date":De(r)?t[n.field]="number":Y(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Ole(e){const t={};function n(i){Zu(i)?t[i.field]="date":i.type==="quantitative"&&pL(i.aggregate)?t[i.field]="number":Au(i.field)>1?i.field in t||(t[i.field]="flatten"):zs(i)&&ar(i.sort)&&Au(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((tt(e)||Ti(e))&&e.forEachFieldDef((i,r)=>{if(oi(i))n(i);else{const o=Cs(r),a=e.fieldDef(o);n(Object.assign(Object.assign({},i),{type:a.type}))}}),tt(e)){const{mark:i,markDef:r,encoding:o}=e;if(Ea(i)&&!e.encoding.order){const a=r.orient==="horizontal"?"y":"x",s=o[a];q(s)&&s.type==="quantitative"&&!(s.field in t)&&(t[s.field]="number")}}return t}function Ale(e){const t={};if(tt(e)&&e.component.selection)for(const n of z(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&Au(r.field)>1&&(t[r.field]="flatten")}return t}class It extends je{constructor(t,n){super(t),this._parse=n}clone(){return new It(null,le(this._parse))}hash(){return`Parse ${be(this._parse)}`}static makeExplicit(t,n,i){var r;let o={};const a=n.data;return!qo(a)&&((r=a==null?void 0:a.format)===null||r===void 0?void 0:r.parse)&&(o=a.format.parse),this.makeWithAncestors(t,o,{},i)}static makeWithAncestors(t,n,i,r){for(const s of z(i)){const u=r.getWithExplicit(s);u.value!==void 0&&(u.explicit||u.value===i[s]||u.value==="derived"||i[s]==="flatten"?delete i[s]:U(QE(s,i[s],u.value)))}for(const s of z(n)){const u=r.get(s);u!==void 0&&(u===n[s]?delete n[s]:U(QE(s,n[s],u)))}const o=new po(n,i);r.copyAll(o);const a={};for(const s of z(o.combine())){const u=o.get(s);u!==null&&(a[s]=u)}return z(a).length===0||r.parseNothing?null:new It(t,a)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of z(this._parse)){const i=this._parse[n];Au(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(z(this._parse))}dependentFields(){return new Set(z(this._parse))}assembleTransforms(t=!1){return z(this._parse).filter(n=>t?Au(n)>1:!0).map(n=>{const i=Ele(n,this._parse[n]);return i?{type:"formula",expr:i,as:Tb(n)}:null}).filter(n=>n!==null)}}class sa extends je{clone(){return new sa(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([yr])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:yr}}}class gd extends je{constructor(t,n){super(t),this.params=n}clone(){return new gd(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${be(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class pd extends je{constructor(t,n){super(t),this.params=n}clone(){return new pd(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${be(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class Os extends je{constructor(t){super(null),t!=null||(t={name:"source"});let n;if(qo(t)||(n=t.format?Object.assign({},yn(t.format,["parse"])):{}),mf(t))this._data={values:t.values};else if(el(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];me(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else EP(t)?this._data={values:[{type:"Sphere"}]}:(wP(t)||qo(t))&&(this._data={});this._generator=qo(t),t.name&&(this._name=t.name),n&&!Me(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var OC=globalThis&&globalThis.__classPrivateFieldSet||function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},kle=globalThis&&globalThis.__classPrivateFieldGet||function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},Ac;function vE(e){return e instanceof Os||e instanceof gd||e instanceof pd}class bE{constructor(){Ac.set(this,void 0),OC(this,Ac,!1,"f")}setModified(){OC(this,Ac,!0,"f")}get modifiedFlag(){return kle(this,Ac,"f")}}Ac=new WeakMap;class Bs extends bE{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const i=[...this.getNodeDepths(t,0,new Map).entries()].sort((r,o)=>o[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class xE extends bE{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class Cle extends xE{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of z(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class $le extends xE{constructor(t){super(),this.requiresSelectionId=t&&dE(t)}run(t){t instanceof sa&&(this.requiresSelectionId&&(vE(t.parent)||t.parent instanceof Fi||t.parent instanceof It)||(this.setModified(),t.remove()))}}class Fle extends bE{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof sr&&(i=t.producedFields(),Cb(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class Tle extends xE{constructor(){super()}run(t){t instanceof rn&&!t.isRequired()&&(this.setModified(),t.remove())}}class Mle extends Bs{run(t){if(!vE(t)&&!(t.numChildren()>1)){for(const n of t.children)if(n instanceof It)if(t instanceof It)this.setModified(),t.merge(n);else{if($b(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class Dle extends Bs{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof It);if(t.numChildren()>1&&i.length>=1){const r={},o=new Set;for(const a of i){const s=a.parse;for(const u of z(s))u in r?r[u]!==s[u]&&o.add(u):r[u]=s[u]}for(const a of o)delete r[a];if(!Me(r)){this.setModified();const a=new It(t,r);for(const s of n){if(s instanceof It)for(const u of z(r))delete s.parse[u];t.removeChild(s),s.parent=a,s instanceof It&&z(s.parse).length===0&&s.remove()}}}}}class Nle extends Bs{run(t){t instanceof rn||t.numChildren()>0||t instanceof kl||t instanceof Os||(this.setModified(),t.remove())}}class jle extends Bs{run(t){const n=t.children.filter(r=>r instanceof sr),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class Rle extends Bs{run(t){const n=t.children.filter(r=>r instanceof Fi),i={};for(const r of n){const o=be(r.groupBy);o in i||(i[o]=[]),i[o].push(r)}for(const r of z(i)){const o=i[r];if(o.length>1){const a=o.pop();for(const s of o)a.merge(s)&&(t.removeChild(s),s.parent=a,s.remove(),this.setModified())}}}}class Ple extends Bs{constructor(t){super(),this.model=t}run(t){const n=!(vE(t)||t instanceof Al||t instanceof It||t instanceof sa),i=[],r=[];for(const o of t.children)o instanceof ur&&(n&&!$b(t.producedFields(),o.dependentFields())?i.push(o):r.push(o));if(i.length>0){const o=i.pop();for(const a of i)o.merge(a,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof ur?t.merge(o,this.model.renameSignal.bind(this.model)):o.swapWithParent()}if(r.length>1){const o=r.pop();for(const a of r)o.merge(a,this.model.renameSignal.bind(this.model));this.setModified()}}}class Ile extends Bs{run(t){const n=[...t.children];if(!os(n,a=>a instanceof rn)||t.numChildren()<=1)return;const r=[];let o;for(const a of n)if(a instanceof rn){let s=a;for(;s.numChildren()===1;){const[u]=s.children;if(u instanceof rn)s=u;else break}r.push(...s.children),o?(t.removeChild(a),a.parent=o.parent,o.parent.removeChild(o),o.parent=s,this.setModified()):o=s}else r.push(a);if(r.length){this.setModified();for(const a of r)a.parent.removeChild(a),a.parent=o}}}class Us extends je{constructor(t,n){super(t),this.transform=n}clone(){return new Us(null,le(this.transform))}addDimensions(t){this.transform.groupby=er(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:H(t)}hash(){return`JoinAggregateTransform ${be(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const o of this.transform.joinaggregate)n.push(o.op),i.push(this.getDefaultName(o)),t.push(o.field===void 0?null:o.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},r!==void 0?{groupby:r}:{})}}function Lle(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=H(i);return r&&t.push(r),t},[])}function zle(e){return I(e)&&e.every(t=>Y(t))&&e.length>1}class to extends je{constructor(t,n){super(t),this._stack=n}clone(){return new to(null,le(this._stack))}static makeFromTransform(t,n){const{stack:i,groupby:r,as:o,offset:a="zero"}=n,s=[],u=[];if(n.sort!==void 0)for(const f of n.sort)s.push(f.field),u.push(nt(f.order,"ascending"));const l={field:s,order:u};let c;return zle(o)?c=o:Y(o)?c=[o,`${o}_end`]:c=[`${n.stack}_start`,`${n.stack}_end`],new to(t,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:a,sort:l,facetby:[],as:c})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannels:o,fieldChannel:a,offset:s,impute:u}=i,l=o.map(h=>{const g=r[h];return mr(g)}).filter(h=>!!h),c=Lle(n),f=n.encoding.order;let d;return I(f)||q(f)?d=mF(f):d=c.reduce((h,g)=>(h.field.push(g),h.order.push(a==="y"?"descending":"ascending"),h),{field:[],order:[]}),new to(t,{dimensionFieldDefs:l,stackField:n.vgField(a),facetby:[],stackby:c,sort:d,offset:s,impute:u,as:[n.vgField(a,{suffix:"start",forAs:!0}),n.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${be(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:t,impute:n,groupby:i}=this._stack;return t.length>0?t.map(r=>r.bin?n?[H(r,{binSuffix:"mid"})]:[H(r,{}),H(r,{binSuffix:"end"})]:[H(r)]).flat():i!=null?i:[]}assemble(){const t=[],{facetby:n,dimensionFieldDefs:i,stackField:r,stackby:o,sort:a,offset:s,impute:u,as:l}=this._stack;if(u)for(const c of i){const{bandPosition:f=.5,bin:d}=c;if(d){const h=H(c,{expr:"datum"}),g=H(c,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:`${f}*${h}+${1-f}*${g}`,as:H(c,{binSuffix:"mid",forAs:!0})})}t.push({type:"impute",field:r,groupby:[...o,...n],key:H(c,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:a,as:l,offset:s}),t}}class Cl extends je{constructor(t,n){super(t),this.transform=n}clone(){return new Cl(null,le(this.transform))}addDimensions(t){this.transform.groupby=er(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(r=>i.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:H(t)}hash(){return`WindowTransform ${be(this.transform)}`}assemble(){var t;const n=[],i=[],r=[],o=[];for(const d of this.transform.window)i.push(d.op),r.push(this.getDefaultName(d)),o.push(d.param===void 0?null:d.param),n.push(d.field===void 0?null:d.field);const a=this.transform.frame,s=this.transform.groupby;if(a&&a[0]===null&&a[1]===null&&i.every(d=>Ib(d)))return Object.assign({type:"joinaggregate",as:r,ops:i,fields:n},s!==void 0?{groupby:s}:{});const u=[],l=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)u.push(d.field),l.push((t=d.order)!==null&&t!==void 0?t:"ascending");const c={field:u,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:o,as:r,ops:i,fields:n,sort:c},f!==void 0?{ignorePeers:f}:{}),s!==void 0?{groupby:s}:{}),a!==void 0?{frame:a}:{})}}function Ble(e){function t(n){if(!(n instanceof kl)){const i=n.clone();if(i instanceof rn){const r=Jv+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof Fi||i instanceof to||i instanceof Cl||i instanceof Us)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function Kv(e){if(e instanceof kl)if(e.numChildren()===1&&!(e.children[0]instanceof rn)){const t=e.children[0];(t instanceof Fi||t instanceof to||t instanceof Cl||t instanceof Us)&&t.addDimensions(e.fields),t.swapWithParent(),Kv(e)}else{const t=e.model.component.data.main;h6(t);const n=Ble(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(Kv)}function h6(e){if(e instanceof rn&&e.type===Pe.Main&&e.numChildren()===1){const t=e.children[0];t instanceof kl||(t.swapWithParent(),h6(e))}}const Jv="scale_",Vd=5;function Qv(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!Qv(t.children))return!1}return!0}function ci(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function AC(e,t,n){let i=e.sources,r=!1;return r=ci(new Tle,i)||r,r=ci(new $le(t),i)||r,i=i.filter(o=>o.numChildren()>0),r=ci(new Nle,i)||r,i=i.filter(o=>o.numChildren()>0),n||(r=ci(new Mle,i)||r,r=ci(new Ple(t),i)||r,r=ci(new Fle,i)||r,r=ci(new Dle,i)||r,r=ci(new Rle,i)||r,r=ci(new jle,i)||r,r=ci(new Cle,i)||r,r=ci(new Ile,i)||r),e.sources=i,r}function Ule(e,t){Qv(e.sources);let n=0,i=0;for(let r=0;r<Vd&&AC(e,t,!0);r++)n++;e.sources.map(Kv);for(let r=0;r<Vd&&AC(e,t,!1);r++)i++;Qv(e.sources),Math.max(n,i)===Vd&&U(`Maximum optimization runs(${Vd}) reached.`)}class xn{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new xn(()=>t(n))}}var qle=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function g6(e){tt(e)?Wle(e):Gle(e)}function Wle(e){const t=e.component.scales;for(const n of z(t)){const i=Yle(e,n);if(t[n].setWithExplicit("domains",i),Vle(e,n),e.component.data.isFaceted){let o=e;for(;!Ti(o)&&o.parent;)o=o.parent;if(o.component.resolve.scale[n]==="shared")for(const s of i.value)qr(s)&&(s.data=Jv+s.data.replace(Jv,""))}}}function Gle(e){for(const n of e.children)g6(n);const t=e.component.scales;for(const n of z(t)){let i,r=null;for(const o of e.children){const a=o.component.scales[n];if(a){i===void 0?i=a.getWithExplicit("domains"):i=ia(i,a.getWithExplicit("domains"),"domains","scale",Zv);const s=a.get("selectionExtent");r&&s&&r.param!==s.param&&U(NL),r=s}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function Hle(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:o}=kC(t,n);if(!r){U(o);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=kC(t,n);if(r)return"unaggregated"}return e}function Yle(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=Hle(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&st(i.x2)?st(i.x)?ia(wo(n,r,e,"x"),wo(n,r,e,"x2"),"domain","scale",Zv):wo(n,r,e,"x2"):t==="y"&&st(i.y2)?st(i.y)?ia(wo(n,r,e,"y"),wo(n,r,e,"y2"),"domain","scale",Zv):wo(n,r,e,"y2"):wo(n,r,e,t)}function Xle(e,t,n){return e.map(i=>({signal:`{data: ${H0(i,{timeUnit:n,type:t})}}`}))}function F1(e,t,n){var i;const r=(i=Ht(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?Xle(e,t,r):[e]}function wo(e,t,n,i){const{encoding:r}=n,o=st(r[i]),{type:a}=o,s=o.timeUnit;if(loe(t)){const f=wo(e,void 0,n,i),d=F1(t.unionWith,a,s);return Yi([...d,...f.value])}else{if(Z(t))return Yi([t]);if(t&&t!=="unaggregated"&&!h5(t))return Yi(F1(t,a,s))}const u=n.stack;if(u&&i===u.fieldChannel){if(u.offset==="normalize")return Tn([[0,1]]);const f=n.requestDataName(Pe.Main);return Tn([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=ga(i)&&q(o)?Kle(n,i,e):void 0;if(Mr(o)){const f=F1([o.datum],a,s);return Tn(f)}const c=o;if(t==="unaggregated"){const f=n.requestDataName(Pe.Main),{field:d}=o;return Tn([{data:f,field:H({field:d,aggregate:"min"})},{data:f,field:H({field:d,aggregate:"max"})}])}else if(Le(c.bin)){if(wt(e))return Tn(e==="bin-ordinal"?[]:[{data:qc(l)?n.requestDataName(Pe.Main):n.requestDataName(Pe.Raw),field:n.vgField(i,fd(c,i)?{binSuffix:"range"}:{}),sort:l===!0||!K(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=c;if(Le(f)){const d=yE(n,c.field,f);return Tn([new xn(()=>{const h=n.getSignalName(d);return`[${h}.start, ${h}.stop]`})])}else return Tn([{data:n.requestDataName(Pe.Main),field:n.vgField(i,{})}])}}else if(c.timeUnit&&me(["time","utc"],e)&&F5(c,tt(n)?n.encoding[Or(i)]:void 0,n.markDef,n.config)){const f=n.requestDataName(Pe.Main);return Tn([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Tn(l?[{data:qc(l)?n.requestDataName(Pe.Main):n.requestDataName(Pe.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(Pe.Main),field:n.vgField(i)}])}function T1(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n!=null?n:t?"sum":B0},i?{field:ei(i)}:{}),r?{order:r}:{})}function Vle(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,o=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,a=h5(r)&&r,s=$s(o)&&Sp(o.extent)&&o.extent;(a||s)&&i.set("selectionExtent",a!=null?a:s,!0)}function Kle(e,t,n){if(!wt(n))return;const i=e.fieldDef(t),r=i.sort;if(k5(r))return{op:"min",field:il(i,t),order:"ascending"};const{stack:o}=e,a=o?new Set([...o.groupbyFields,...o.stackBy.map(s=>s.fieldDef.field)]):void 0;if(ar(r)){const s=o&&!a.has(r.field);return T1(r,s)}else if(A5(r)){const{encoding:s,order:u}=r,l=e.fieldDef(s),{aggregate:c,field:f}=l,d=o&&!a.has(f);if(no(c)||pa(c))return T1({field:H(l),order:u},d);if(Ib(c)||!c)return T1({op:c,field:f,order:u},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(me(["ascending",void 0],r))return!0}}function kC(e,t){const{aggregate:n,type:i}=e;return n?Y(n)&&!yL.has(n)?{valid:!1,reason:u4(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:l4(e)}:{valid:!0}:{valid:!1,reason:s4(e)}}function Zv(e,t,n,i){return e.explicit&&t.explicit&&U(g4(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function Jle(e){const t=er(e.map(a=>qr(a)?qle(a,["sort"]):a),be),n=er(e.map(a=>{if(qr(a)){const s=a.sort;return s!==void 0&&!qc(s)&&("op"in s&&s.op==="count"&&delete s.field,s.order==="ascending"&&delete s.order),s}}).filter(a=>a!==void 0),be);if(t.length===0)return;if(t.length===1){const a=e[0];if(qr(a)&&n.length>0){let s=n[0];if(n.length>1)U(eS),s=!0;else if(K(s)&&"field"in s){const u=s.field;a.field===u&&(s=s.order?{order:s.order}:!0)}return Object.assign(Object.assign({},a),{sort:s})}return a}const i=er(n.map(a=>qc(a)||!("op"in a)||Y(a.op)&&a.op in hL?a:(U(m4(a)),!0)),be);let r;i.length===1?r=i[0]:i.length>1&&(U(eS),r=!0);const o=er(e.map(a=>qr(a)?a.data:null),a=>a);return o.length===1&&o[0]!==null?Object.assign({data:o[0],fields:t.map(s=>s.field)},r?{sort:r}:{}):Object.assign({fields:t},r?{sort:r}:{})}function wE(e){if(qr(e)&&Y(e.field))return e.field;if(bL(e)){let t;for(const n of e.fields)if(qr(n)&&Y(n.field)){if(!t)t=n.field;else if(t!==n.field)return U(y4),t}return U(v4),t}else if(xL(e)){U(b4);const t=e.fields[0];return Y(t)?t:void 0}}function nm(e,t){const i=e.component.scales[t].get("domains").map(r=>(qr(r)&&(r.data=e.lookupDataSource(r.data)),r));return Jle(i)}var Qle=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function p6(e){return $l(e)||_E(e)?e.children.reduce((t,n)=>t.concat(p6(n)),CC(e)):CC(e)}function CC(e){return z(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:o,type:a,selectionExtent:s,domains:u,range:l,reverse:c}=r,f=Qle(r,["name","type","selectionExtent","domains","range","reverse"]),d=Zle(r.range,o,n,e),h=nm(e,n),g=s?qse(e,s,i,h):null;return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:o,type:a},h?{domain:h}:{}),g?{domainRaw:g}:{}),{range:d}),c!==void 0?{reverse:c}:{}),f)),t},[])}function Zle(e,t,n,i){if(xt(n)){if(ma(e))return{step:{signal:`${t}_step`}}}else if(K(e)&&qr(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}class m6 extends po{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:os(this.get("domains"),t=>I(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const ece=["range","scheme"];function tce(e){const t=e.component.scales;for(const n of Ep){const i=t[n];if(!i)continue;const r=nce(n,e);i.setWithExplicit("range",r)}}function $C(e,t){const n=e.fieldDef(t);if(n!=null&&n.bin){const{bin:i,field:r}=n,o=Sn(t),a=e.getName(o);if(K(i)&&i.binned&&i.step!==void 0)return new xn(()=>{const s=e.scaleName(t),u=`(domain("${s}")[1] - domain("${s}")[0]) / ${i.step}`;return`${e.getSignalName(a)} / (${u})`});if(Le(i)){const s=yE(e,r,i);return new xn(()=>{const u=e.getSignalName(s),l=`(${u}.stop - ${u}.start) / ${u}.step`;return`${e.getSignalName(a)} / (${l})`})}}}function nce(e,t){const n=t.specifiedScales[e],{size:i}=t,o=t.getScaleComponent(e).get("type");for(const f of ece)if(n[f]!==void 0){const d=Mv(o,f),h=g5(e,f);if(!d)U(EF(o,f,e));else if(h)U(h);else switch(f){case"range":{const g=n.range;if(I(g)){if(xt(e))return Yi(g.map(p=>{if(p==="width"||p==="height"){const m=t.getName(p),y=t.getSignalName.bind(t);return xn.fromName(y,m)}return p}))}else if(K(g))return Yi({data:t.requestDataName(Pe.Main),field:g.field,sort:{op:"min",field:t.vgField(e)}});return Yi(g)}case"scheme":return Yi(ice(n[f]))}}const a=e===He||e==="xOffset"?"width":"height",s=i[a];if(vr(s)){if(xt(e))if(wt(o)){const f=y6(s,t,e);if(f)return Yi({step:f})}else U(SF(a));else if(fl(e)){const f=e===la?"x":"y";if(t.getScaleComponent(f).get("type")==="band"){const g=v6(s,o);if(g)return Yi(g)}}}const{rangeMin:u,rangeMax:l}=n,c=rce(e,t);return(u!==void 0||l!==void 0)&&Mv(o,"rangeMin")&&I(c)&&c.length===2?Yi([u!=null?u:c[0],l!=null?l:c[1]]):Tn(c)}function ice(e){return uoe(e)?Object.assign({scheme:e.name},yn(e,["name"])):{scheme:e}}function rce(e,t){const{size:n,config:i,mark:r,encoding:o}=t,a=t.getSignalName.bind(t),{type:s}=st(o[e]),l=t.getScaleComponent(e).get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case He:case bt:{if(me(["point","band"],l)){const g=b6(e,n,i.view);if(vr(g))return{step:y6(g,t,e)}}const d=Sn(e),h=t.getName(d);return e===bt&&Un(l)?[xn.fromName(a,h),0]:[0,xn.fromName(a,h)]}case la:case cl:return oce(e,t,l);case uo:{const d=t.component.scales[e].get("zero"),h=x6(r,d,i),g=uce(r,n,t,i);return Ku(l)?sce(h,g,ace(l,i,c,e)):[h,g]}case ai:return[0,Math.PI*2];case ks:return[0,360];case Pi:return[0,new xn(()=>{const d=t.getSignalName("width"),h=t.getSignalName("height");return`min(${d},${h})/2`})];case da:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case ha:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case En:return"symbol";case _n:case Er:case Sr:return l==="ordinal"?s==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case lo:case ca:case fa:return[i.scale.minOpacity,i.scale.maxOpacity]}}function y6(e,t,n){var i,r,o,a,s;const{encoding:u}=t,l=t.getScaleComponent(n),c=rF(n),f=u[c];if(aP({step:e,offsetIsDiscrete:se(f)&&u5(f.type)})==="offset"&&B5(u,c)){const h=t.getScaleComponent(c);let p=`domain('${t.scaleName(c)}').length`;if(h.get("type")==="band"){const y=(r=(i=h.get("paddingInner"))!==null&&i!==void 0?i:h.get("padding"))!==null&&r!==void 0?r:0,v=(a=(o=h.get("paddingOuter"))!==null&&o!==void 0?o:h.get("padding"))!==null&&a!==void 0?a:0;p=`bandspace(${p}, ${y}, ${v})`}const m=(s=l.get("paddingInner"))!==null&&s!==void 0?s:l.get("padding");return{signal:`${e.step} * ${p} / (1-${SL(m)})`}}else return e.step}function v6(e,t){if(aP({step:e,offsetIsDiscrete:wt(t)})==="offset")return{step:e.step}}function oce(e,t,n){const i=e===la?"x":"y",o=t.getScaleComponent(i).get("type"),a=t.scaleName(i);if(o==="band"){const s=b6(i,t.size,t.config.view);if(vr(s)){const u=v6(s,n);if(u)return u}return[0,{signal:`bandwidth('${a}')`}]}else return G$(`Cannot use ${e} scale if ${i} scale is not discrete.`)}function b6(e,t,n){const i=e===He?"width":"height",r=t[i];return r||np(n,i)}function ace(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&I(n)?n.length+1:(U(C4(i)),3)}}function sce(e,t,n){const i=()=>{const r=Jr(t),o=Jr(e),a=`(${r} - ${o}) / (${n} - 1)`;return`sequence(${o}, ${r} + ${a}, ${a})`};return Z(t)?new xn(i):{signal:i()}}function x6(e,t,n){if(t)return Z(t)?{signal:`${t.signal} ? 0 : ${x6(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Op("size",e))}const FC=.95;function uce(e,t,n,i){const r={x:$C(n,"x"),y:$C(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const o=TC(t,r,i.view);return De(o)?o-1:new xn(()=>`${o.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const o=TC(t,r,i.view);return De(o)?Math.pow(FC*o,2):new xn(()=>`pow(${FC} * ${o.signal}, 2)`)}}throw new Error(Op("size",e))}function TC(e,t,n){const i=vr(e.width)?e.width.step:tp(n,"width"),r=vr(e.height)?e.height.step:tp(n,"height");return t.x||t.y?new xn(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`):Math.min(i,r)}function w6(e,t){tt(e)?lce(e,t):E6(e,t)}function lce(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:o,specifiedScales:a}=e;for(const s of z(n)){const u=a[s],l=n[s],c=e.getScaleComponent(s),f=st(r[s]),d=u[t],h=c.get("type"),g=c.get("padding"),p=c.get("paddingInner"),m=Mv(h,t),y=g5(s,t);if(d!==void 0&&(m?y&&U(y):U(EF(h,t,s))),m&&y===void 0)if(d!==void 0){const v=f.timeUnit,b=f.type;switch(t){case"domainMax":case"domainMin":Fs(u[t])||b==="temporal"||v?l.set(t,{signal:H0(u[t],{type:b,timeUnit:v})},!0):l.set(t,u[t],!0);break;default:l.copyKeyFromObject(t,u)}}else{const v=t in MC?MC[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:g,scalePaddingInner:p,domain:u.domain,domainMin:u.domainMin,domainMax:u.domainMax,markDef:o,config:i,hasNestedOffsetScale:Rv(r,s),hasSecondaryRangeChannel:!!r[Or(s)]}):i.scale[t];v!==void 0&&l.set(t,v,!1)}}}const MC={bins:({model:e,fieldOrDatumDef:t})=>q(t)?cce(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>fce(e,t.type),nice:({scaleType:e,channel:t,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:o})=>dce(e,t,n,i,r,o),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>hce(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:o})=>gce(e,t,n.type,i,r.scale,o),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:o})=>pce(e,t,n,i,r.scale,o),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=q(e)?e.sort:void 0;return mce(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r,config:o,hasSecondaryRangeChannel:a})=>yce(e,t,n,i,r,o.scale,a)};function _6(e){tt(e)?tce(e):E6(e,"range")}function E6(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?_6(i):w6(i,t);for(const i of z(n)){let r;for(const o of e.children){const a=o.component.scales[i];if(a){const s=a.getWithExplicit(t);r=ia(r,s,t,"scale",xP((u,l)=>{switch(t){case"range":return u.step&&l.step?u.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function cce(e,t){const n=t.bin;if(Le(n)){const i=yE(e,t.field,n);return new xn(()=>e.getSignalName(i))}else if(Et(n)&&$s(n)&&n.step!==void 0)return{step:n.step}}function fce(e,t){if(me([_n,Er,Sr],e)&&t!=="nominal")return"hcl"}function dce(e,t,n,i,r,o){var a;if(!(((a=mr(o))===null||a===void 0?void 0:a.bin)||I(n)||r!=null||i!=null||me([bn.TIME,bn.UTC],e)))return xt(t)?!0:void 0}function hce(e,t,n,i,r,o){if(xt(e)){if(Ai(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:a,orient:s}=r;if(a==="bar"&&!(q(i)&&(i.bin||i.timeUnit))&&(s==="vertical"&&e==="x"||s==="horizontal"&&e==="y"))return o.continuousBandSize}if(t===bn.POINT)return n.pointPadding}}function gce(e,t,n,i,r,o=!1){if(e===void 0){if(xt(t)){const{bandPaddingInner:a,barBandPaddingInner:s,rectBandPaddingInner:u,bandWithNestedOffsetPaddingInner:l}=r;return o?l:nt(a,n==="bar"?s:u)}else if(fl(t)&&i===bn.BAND)return r.offsetBandPaddingInner}}function pce(e,t,n,i,r,o=!1){if(e===void 0){if(xt(t)){const{bandPaddingOuter:a,bandWithNestedOffsetPaddingOuter:s}=r;if(o)return s;if(n===bn.BAND)return nt(a,Z(i)?{signal:`${i.signal}/2`}:i/2)}else if(fl(t)){if(n===bn.POINT)return .5;if(n===bn.BAND)return r.offsetBandPaddingOuter}}}function mce(e,t,n,i){if(n==="x"&&i.xReverse!==void 0)return Un(e)&&t==="descending"?Z(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(Un(e)&&t==="descending")return!0}function yce(e,t,n,i,r,o,a){if(!!n&&n!=="unaggregated"&&Un(r)){if(I(n)){const u=n[0],l=n[n.length-1];if(u<=0&&l>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!Ku(r))return!0;if(!(q(t)&&t.bin)&&me([...Ar,...oL],e)){const{orient:u,type:l}=i;return me(["bar","area","line","trail"],l)&&(u==="horizontal"&&e==="y"||u==="vertical"&&e==="x")?!1:me(["bar","area"],l)&&!a?!0:o==null?void 0:o.zero}return!1}function vce(e,t,n,i,r=!1){const o=bce(t,n,i,r),{type:a}=e;return ga(t)?a!==void 0?poe(t,a)?q(n)&&!goe(a,n.type)?(U(d4(a,o)),o):a:(U(f4(t,a,o)),o):o:null}function bce(e,t,n,i){var r;switch(t.type){case"nominal":case"ordinal":{if(pu(e)||vm(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&U(bm(e,"ordinal")),"ordinal";if(xt(e)||fl(e)){if(me(["rect","bar","image","rule"],n.type)||i)return"band"}else if(n.type==="arc"&&e in Pb)return"band";const o=n[Sn(e)];return ws(o)||Qu(t)&&((r=t.axis)===null||r===void 0?void 0:r.tickBand)?"band":"point"}case"temporal":return pu(e)?"time":vm(e)==="discrete"?(U(bm(e,"temporal")),"ordinal"):q(t)&&t.timeUnit&&Ht(t.timeUnit).utc?"utc":"time";case"quantitative":return pu(e)?q(t)&&Le(t.bin)?"bin-ordinal":"linear":vm(e)==="discrete"?(U(bm(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(wF(t.type))}function xce(e,{ignoreRange:t}={}){S6(e),g6(e);for(const n of hoe)w6(e,n);t||_6(e)}function S6(e){tt(e)?e.component.scales=wce(e):e.component.scales=Ece(e)}function wce(e){const{encoding:t,mark:n,markDef:i}=e,r={};for(const o of Ep){const a=st(t[o]);if(a&&n===y5&&o===En&&a.type===Sl)continue;let s=a&&a.scale;if(fl(o)){const u=oF(o);if(!Rv(t,u)){s&&U(JL(o));continue}}if(a&&s!==null&&s!==!1){s!=null||(s={});const u=Rv(t,o),l=vce(s,o,a,i,u);r[o]=new m6(e.scaleName(`${o}`,!0),{value:l,explicit:s.type===l})}}return r}const _ce=xP((e,t)=>Uk(e)-Uk(t));function Ece(e){var t,n;const i=e.component.scales={},r={},o=e.component.resolve;for(const a of e.children){S6(a);for(const s of z(a.component.scales))if((t=(n=o.scale)[s])!==null&&t!==void 0||(n[s]=t6(s,e)),o.scale[s]==="shared"){const u=r[s],l=a.component.scales[s].getWithExplicit("type");u?ioe(u.value,l.value)?r[s]=ia(u,l,"type","scale",_ce):(o.scale[s]="independent",delete r[s]):r[s]=l}}for(const a of z(r)){const s=e.scaleName(a,!0),u=r[a];i[a]=new m6(s,u);for(const l of e.children){const c=l.component.scales[a];c&&(l.renameScale(c.get("name"),s),c.merged=!0)}}return i}var M1=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class D1{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function tt(e){return(e==null?void 0:e.type)==="unit"}function Ti(e){return(e==null?void 0:e.type)==="facet"}function _E(e){return(e==null?void 0:e.type)==="concat"}function $l(e){return(e==null?void 0:e.type)==="layer"}class EE{constructor(t,n,i,r,o,a,s){var u,l;this.type=n,this.parent=i,this.config=o,this.correctDataNames=c=>{var f,d,h;return!((f=c.from)===null||f===void 0)&&f.data&&(c.from.data=this.lookupDataSource(c.from.data)),!((h=(d=c.from)===null||d===void 0?void 0:d.facet)===null||h===void 0)&&h.data&&(c.from.facet.data=this.lookupDataSource(c.from.facet.data)),c},this.parent=i,this.config=o,this.view=dn(s),this.name=(u=t.name)!==null&&u!==void 0?u:r,this.title=Eo(t.title)?{text:t.title}:t.title?dn(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new D1,this.projectionNameMap=i?i.projectionNameMap:new D1,this.signalNameMap=i?i.signalNameMap:new D1,this.data=t.data,this.description=t.description,this.transforms=Ase((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:Mae(t,n,o),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:U0(t)||(i==null?void 0:i.component.data.isFaceted)&&t.data===void 0},layoutSize:new po,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?le(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){xce(this)}parseProjection(){f6(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){a6(this)}assembleEncodeFromView(t){const n=M1(t,["style"]),i={};for(const r of z(n)){const o=n[r];o!==void 0&&(i[r]=ze(o))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=ze(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n!=null?n:{}):Me(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=M1(t,["spacing"]),{component:r,config:o}=this,a=zue(r.layoutHeaders,o);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of Yn)t[i].title&&n.push(Nue(this,i));for(const i of hE)n=n.concat(jue(this,i));return n}assembleAxes(){return _ue(this.component.axes,this.config)}assembleLegends(){return u6(this)}assembleProjections(){return cle(this)}assembleTitle(){var t,n,i;const r=(t=this.title)!==null&&t!==void 0?t:{},{encoding:o}=r,a=M1(r,["encoding"]),s=Object.assign(Object.assign(Object.assign({},dF(this.config.title).nonMarkTitleProperties),a),o?{encode:{update:o}}:{});if(s.text)return me(["unit","layer"],this.type)?me(["middle",void 0],s.anchor)&&((n=s.frame)!==null&&n!==void 0||(s.frame="group")):(i=s.anchor)!==null&&i!==void 0||(s.anchor="start"),Me(s)?void 0:s}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Ti(this.parent)?p6(this):[];r.length>0&&(n.scales=r);const o=this.assembleAxes();o.length>0&&(n.axes=o);const a=this.assembleLegends();return a.length>0&&(n.legends=a),n}getName(t){return qe((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(Pe[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(Ti(this.parent)){const n=ZP(t),i=_p(n),r=this.component.scales[i];if(r&&!r.merged){const o=r.get("type"),a=r.get("range");if(wt(o)&&ma(a)){const s=r.get("name"),u=nm(this,i),l=wE(u);if(l){const c=H({aggregate:"distinct",field:l},{expr:"datum"});return{signal:QP(s,r,c)}}else return U(Bb(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(nF(t)&&ga(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error($L(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class O6 extends EE{vgField(t,n={}){const i=this.fieldDef(t);if(!!i)return H(i,n)}reduceFieldDef(t,n){return aae(this.getMapping(),(i,r,o)=>{const a=mr(r);return a?t(i,a,o):i},n)}forEachFieldDef(t,n){V_(this.getMapping(),(i,r)=>{const o=mr(i);o&&t(o,r)},n)}}var Sce=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class im extends je{constructor(t,n){var i,r,o;super(t),this.transform=n,this.transform=le(n);const a=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=a[0])!==null&&r!==void 0?r:"value",(o=a[1])!==null&&o!==void 0?o:"density"],n.groupby&&n.minsteps==null&&n.maxsteps==null&&n.steps==null&&(this.transform.steps=200)}clone(){return new im(null,le(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${be(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=Sce(t,["density"]);return Object.assign({type:"kde",field:n},i)}}class vf extends je{constructor(t,n){super(t),this.filter=n}clone(){return new vf(null,Object.assign({},this.filter))}static make(t,n){const{config:i,mark:r,markDef:o}=n;if(Fe("invalid",o,i)!=="filter")return null;const s=n.reduceFieldDef((u,l,c)=>{const f=ga(c)&&n.getScaleComponent(c);if(f){const d=f.get("type");Un(d)&&l.aggregate!=="count"&&!Ea(r)&&(u[l.field]=l)}return u},{});return z(s).length?new vf(t,s):null}dependentFields(){return new Set(z(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${be(this.filter)}`}assemble(){const t=z(this.filter).reduce((n,i)=>{const r=this.filter[i],o=H(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${o}) || (isValid(${o}) && isFinite(+${o})))`):r.type==="quantitative"&&(n.push(`isValid(${o})`),n.push(`isFinite(+${o})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class rm extends je{constructor(t,n){super(t),this.transform=n,this.transform=le(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((o,a)=>{var s;return(s=r[a])!==null&&s!==void 0?s:o})}clone(){return new rm(this.parent,le(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${be(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class om extends je{constructor(t,n){var i,r,o;super(t),this.transform=n,this.transform=le(n);const a=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=a[0])!==null&&r!==void 0?r:"key",(o=a[1])!==null&&o!==void 0?o:"value"]}clone(){return new om(null,le(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${be(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class Eu extends je{constructor(t,n,i,r){super(t),this.fields=n,this.geojson=i,this.signal=r}clone(){return new Eu(null,le(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[_r,wr],[ti,Ii]]){const o=r.map(a=>{const s=st(n.encoding[a]);return q(s)?s.field:Mr(s)?{expr:`${s.datum}`}:ji(s)?{expr:`${s.value}`}:void 0});(o[0]||o[1])&&(t=new Eu(t,o,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(En)){const r=n.typedFieldDef(En);r.type===Sl&&(t=new Eu(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(Y);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${be(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})]}}class bf extends je{constructor(t,n,i,r){super(t),this.projection=n,this.fields=i,this.as=r}clone(){return new bf(null,this.projection,le(this.fields),le(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[_r,wr],[ti,Ii]]){const r=i.map(a=>{const s=st(n.encoding[a]);return q(s)?s.field:Mr(s)?{expr:`${s.datum}`}:ji(s)?{expr:`${s.value}`}:void 0}),o=i[0]===ti?"2":"";(r[0]||r[1])&&(t=new bf(t,n.projectionName(),r,[n.getName(`x${o}`),n.getName(`y${o}`)]))}return t}dependentFields(){return new Set(this.fields.filter(Y))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${be(this.fields)} ${be(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class is extends je{constructor(t,n){super(t),this.transform=n}clone(){return new is(null,le(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t;return{signal:`sequence(${[n,i,...r?[r]:[]].join(",")})`}}static makeFromTransform(t,n){return new is(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,o=i.y;if(q(r)&&q(o)){const a=r.impute?r:o.impute?o:void 0;if(a===void 0)return;const s=r.impute?o:o.impute?r:void 0,{method:u,value:l,frame:c,keyvals:f}=a.impute,d=q5(n.mark,i);return new is(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:s.field},u?{method:u}:{}),l!==void 0?{value:l}:{}),c?{frame:c}:{}),f!==void 0?{keyvals:f}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${be(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:o,value:a,frame:s=[null,null]}=this.transform,u=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:use(i)?this.processSequence(i):i}:{}),{method:"value"}),o?{groupby:o}:{}),{value:!r||r==="value"?a:null});if(r&&r!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:s,ignorePeers:!1},o?{groupby:o}:{}),c={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[u,l,c]}else return[u]}}var Oce=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class am extends je{constructor(t,n){var i,r,o;super(t),this.transform=n,this.transform=le(n);const a=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=a[0])!==null&&r!==void 0?r:n.on,(o=a[1])!==null&&o!==void 0?o:n.loess]}clone(){return new am(null,le(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${be(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,r=Oce(t,["loess","on"]);return Object.assign({type:"loess",x:i,y:n},r)}}class xf extends je{constructor(t,n,i){super(t),this.transform=n,this.secondary=i}clone(){return new xf(null,le(this.transform),this.secondary)}static make(t,n,i,r){const o=n.component.data.sources,{from:a}=i;let s=null;if(lse(a)){let u=C6(a.data,o);u||(u=new Os(a.data),o.push(u));const l=n.getName(`lookup_${r}`);s=new rn(u,l,Pe.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=s}else if(cse(a)){const u=a.param;i=Object.assign({as:u},i);let l;try{l=n.getSelectionComponent(qe(u),u)}catch{throw new Error(ML(u))}if(s=l.materialized,!s)throw new Error(DL(u))}return new xf(t,i,s.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?V(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${be({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:V(this.transform.as)}:{});else{let n=this.transform.as;Y(n)||(U(BL),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var Ace=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class sm extends je{constructor(t,n){var i,r,o;super(t),this.transform=n,this.transform=le(n);const a=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=a[0])!==null&&r!==void 0?r:"prob",(o=a[1])!==null&&o!==void 0?o:"value"]}clone(){return new sm(null,le(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${be(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=Ace(t,["quantile"]);return Object.assign({type:"quantile",field:n},i)}}var kce=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class um extends je{constructor(t,n){var i,r,o;super(t),this.transform=n,this.transform=le(n);const a=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=a[0])!==null&&r!==void 0?r:n.on,(o=a[1])!==null&&o!==void 0?o:n.regression]}clone(){return new um(null,le(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${be(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,r=kce(t,["regression","on"]);return Object.assign({type:"regression",x:i,y:n},r)}}class lm extends je{constructor(t,n){super(t),this.transform=n}clone(){return new lm(null,le(this.transform))}addDimensions(t){var n;this.transform.groupby=er(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${be(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:o}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},r!==void 0?{limit:r}:{}),o!==void 0?{op:o}:{}),i!==void 0?{groupby:i}:{})}}class cm extends je{constructor(t,n){super(t),this.transform=n}clone(){return new cm(null,le(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${be(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function A6(e){let t=0;function n(i,r){var o;if(i instanceof Os&&!i.isGenerator&&!el(i.data)&&(e.push(r),r={name:null,source:r.name,transform:[]}),i instanceof It&&(i.parent instanceof Os&&!r.source?(r.format=Object.assign(Object.assign({},(o=r.format)!==null&&o!==void 0?o:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof kl){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}switch((i instanceof gd||i instanceof pd||i instanceof vf||i instanceof Al||i instanceof nl||i instanceof bf||i instanceof Fi||i instanceof xf||i instanceof Cl||i instanceof Us||i instanceof om||i instanceof rm||i instanceof im||i instanceof am||i instanceof sm||i instanceof um||i instanceof sa||i instanceof cm||i instanceof lm)&&r.transform.push(i.assemble()),(i instanceof ur||i instanceof sr||i instanceof is||i instanceof to||i instanceof Eu)&&r.transform.push(...i.assemble()),i instanceof rn&&(r.source&&r.transform.length===0?i.setSource(r.source):i.parent instanceof rn?i.setSource(r.name):(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1&&(e.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof rn&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let a=r.name;!r.source||r.transform.length>0?e.push(r):a=r.source;for(const s of i.children)n(s,{name:null,source:a,transform:[]});break}}}return n}function Cce(e){const t=[],n=A6(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function $ce(e,t){var n,i;const r=[],o=A6(r);let a=0;for(const u of e.sources){u.hasName()||(u.dataName=`source_${a++}`);const l=u.assemble();o(u,l)}for(const u of r)u.transform.length===0&&delete u.transform;let s=0;for(const[u,l]of r.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&r.splice(s++,0,r.splice(u,1)[0]);for(const u of r)for(const l of(i=u.transform)!==null&&i!==void 0?i:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const u of r)u.name in t&&(u.values=t[u.name]);return r}function Fce(e){return e==="top"||e==="left"||Z(e)?"header":"footer"}function Tce(e){for(const t of Yn)Mce(e,t);DC(e,"x"),DC(e,"y")}function Mce(e,t){var n;const{facet:i,config:r,child:o,component:a}=e;if(e.channelHasField(t)){const s=i[t],u=rl("title",null,r,t);let l=wu(s,r,{allowDisabling:!0,includeDefault:u===void 0||!!u});o.component.layoutHeaders[t].title&&(l=I(l)?l.join(", "):l,l+=` / ${o.component.layoutHeaders[t].title}`,o.component.layoutHeaders[t].title=null);const c=rl("labelOrient",s.header,r,t),f=s.header!==null?nt((n=s.header)===null||n===void 0?void 0:n.labels,r.header.labels,!0):!1,d=me(["bottom","right"],c)?"footer":"header";a.layoutHeaders[t]={title:s.header!==null?l:null,facetFieldDef:s,[d]:t==="facet"?[]:[k6(e,t,f)]}}}function k6(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function DC(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:o}=e.component;if(o.axis[t]=mE(o,t),o.axis[t]==="shared"){const a=t==="x"?"column":"row",s=r[a];for(const u of i.component.axes[t]){const l=Fce(u.get("orient"));(n=s[l])!==null&&n!==void 0||(s[l]=[k6(e,a,!1)]);const c=Oc(u,"main",e.config,{header:!0});c&&s[l][0].axes.push(c),u.mainExtracted=!0}}}}function Dce(e){SE(e),ap(e,"width"),ap(e,"height")}function Nce(e){SE(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";ap(e,t),ap(e,n)}function SE(e){for(const t of e.children)t.parseLayoutSize()}function ap(e,t){var n;const i=ZP(t),r=_p(i),o=e.component.resolve,a=e.component.layoutSize;let s;for(const u of e.children){const l=u.component.layoutSize.getWithExplicit(i),c=(n=o.scale[r])!==null&&n!==void 0?n:t6(r,e);if(c==="independent"&&l.value==="step"){s=void 0;break}if(s){if(c==="independent"&&s.value!==l.value){s=void 0;break}s=ia(s,l,i,"")}else s=l}if(s){for(const u of e.children)e.renameSignal(u.getName(i),e.getName(t)),u.component.layoutSize.set(i,"merged",!1);a.setWithExplicit(t,s)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function jce(e){const{size:t,component:n}=e;for(const i of Ar){const r=Sn(i);if(t[r]){const o=t[r];n.layoutSize.set(r,vr(o)?"step":o,!0)}else{const o=Rce(e,r);n.layoutSize.set(r,o,!1)}}}function Rce(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const o=r.get("type"),a=r.get("range");if(wt(o)){const s=np(i.view,t);return ma(a)||vr(s)?"step":s}else return Iv(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return Iv(i.view,t);{const o=np(i.view,t);return vr(o)?o.step:o}}}function eb(e,t,n){return H(t,Object.assign({suffix:`by_${H(e)}`},n!=null?n:{}))}class Bc extends O6{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve),this.child=$E(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!ld(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=z(t),i={};for(const r of n){if(![Vr,Kr].includes(r)){U(Op(r,"facet"));break}const o=t[r];if(o.field===void 0){U(V1(o,r));break}i[r]=this.initFacetFieldDef(o,r)}return i}initFacetFieldDef(t,n){const i=Y_(t,n);return i.header?i.header=dn(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=fm(this),this.child.parseData()}parseLayoutSize(){SE(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Tce(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const r={};for(const o of Yn)for(const a of gE){const s=this.component.layoutHeaders[o],u=s[a],{facetFieldDef:l}=s;if(l){const c=rl("titleOrient",l.header,this.config,o);if(["right","bottom"].includes(c)){const f=em(o,c);(t=r.titleAnchor)!==null&&t!==void 0||(r.titleAnchor={}),r.titleAnchor[f]="end"}}if(u!=null&&u[0]){const c=o==="row"?"height":"width",f=a==="header"?"headerBand":"footerBand";o!=="facet"&&!this.child.component.layoutSize.get(c)&&((n=r[f])!==null&&n!==void 0||(r[f]={}),r[f][o]=.5),s.title&&((i=r.offset)!==null&&i!==void 0||(r.offset={}),r.offset[o==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Bc))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroupStyle(){}assembleGroup(t){return this.parent&&this.parent instanceof Bc?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:H(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof Bc){if(this.child.channelHasField("column")){const r=H(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of Ar){const o=this.child.component.scales[r];if(o&&!o.merged){const a=o.get("type"),s=o.get("range");if(wt(a)&&ma(s)){const u=nm(this.child,r),l=wE(u);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):U(Bb(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:o,ops:a,as:s}=this.getCardinalityAggregateForChild(),u=[];for(const c of Yn){const f=this.facet[c];if(f){u.push(H(f));const{bin:d,sort:h}=f;if(Le(d)&&u.push(H(f,{binSuffix:"end"})),ar(h)){const{field:g,op:p=B0}=h,m=eb(f,h);i&&r?(o.push(m),a.push("max"),s.push(m)):(o.push(g),a.push(p),s.push(m))}else if(I(h)){const g=il(f,c);o.push(g),a.push("max"),s.push(g)}}}const l=!!i&&!!r;return Object.assign({name:t,data:n,groupby:u},l||o.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),o.length?{fields:o,ops:a,as:s}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?ar(i.sort)?[eb(i,i.sort,{expr:"datum"})]:I(i.sort)?[il(i,t,{expr:"datum"})]:[H(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i;return[(ar(r)?r.order:!I(r)&&r)||"ascending"]}return[]}assembleLabelTitle(){var t;const{facet:n,config:i}=this;if(n.facet)return Xv(n.facet,"facet",i);const r={row:["top","bottom"],column:["left","right"]};for(const o of hE)if(n[o]){const a=rl("labelOrient",(t=n[o])===null||t===void 0?void 0:t.header,i,o);if(r[o].includes(a))return Xv(n[o],o,i)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=Cce(n),r=t.assembleGroupEncodeEntry(!1),o=this.assembleLabelTitle()||t.assembleTitle(),a=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},o?{title:o}:{}),a?{style:a}:{}),{from:{facet:this.assembleFacet()},sort:{field:Yn.map(u=>this.facetSortFields(u)).flat(),order:Yn.map(u=>this.facetSortOrder(u)).flat()}}),i.length>0?{data:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(Lse(this,[])))]}getMapping(){return this.facet}}function Pce(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const o of[n,i])if(ar(o.sort)){const{field:a,op:s=B0}=o.sort;e=r=new Us(e,{joinaggregate:[{op:s,field:a,as:eb(o,o.sort,{forAs:!0})}],groupby:[H(o)]})}return r}return null}function C6(e,t){var n,i,r,o;for(const a of t){const s=a.data;if(e.name&&a.hasName()&&e.name!==a.dataName)continue;const u=(n=e.format)===null||n===void 0?void 0:n.mesh,l=(i=s.format)===null||i===void 0?void 0:i.feature;if(u&&l)continue;const c=(r=e.format)===null||r===void 0?void 0:r.feature;if((c||l)&&c!==l)continue;const f=(o=s.format)===null||o===void 0?void 0:o.mesh;if(!((u||f)&&u!==f)){if(mf(e)&&mf(s)){if(Zi(e.values,s.values))return a}else if(el(e)&&el(s)){if(e.url===s.url)return a}else if(wP(e)&&e.name===a.dataName)return a}}return null}function Ice(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Os({values:[]});return t.push(i),i}const n=C6(e.data,t);if(n)return qo(e.data)||(n.data.format=H$({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Os(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function Lce(e,t,n){var i,r;let o=0;for(const a of t.transforms){let s,u;if(xse(a))u=e=new nl(e,a),s="derived";else if(aE(a)){const l=Sle(a);u=e=(i=It.makeWithAncestors(e,{},l,n))!==null&&i!==void 0?i:e,e=new Al(e,t,a.filter)}else if(pP(a))u=e=ur.makeFromTransform(e,a,t),s="number";else if(_se(a))s="date",n.getWithExplicit(a.field).value===void 0&&(e=new It(e,{[a.field]:s}),n.set(a.field,s,!1)),u=e=sr.makeFromTransform(e,a);else if(Ese(a))u=e=Fi.makeFromTransform(e,a),s="number",dE(t)&&(e=new sa(e));else if(gP(a))u=e=xf.make(e,t,a,o++),s="derived";else if(yse(a))u=e=new Cl(e,a),s="number";else if(vse(a))u=e=new Us(e,a),s="number";else if(Sse(a))u=e=to.makeFromTransform(e,a),s="derived";else if(Ose(a))u=e=new om(e,a),s="derived";else if(bse(a))u=e=new rm(e,a),s="derived";else if(fse(a))u=e=new lm(e,a),s="derived";else if(mse(a))e=new cm(e,a);else if(wse(a))u=e=is.makeFromTransform(e,a),s="derived";else if(dse(a))u=e=new im(e,a),s="derived";else if(hse(a))u=e=new sm(e,a),s="derived";else if(gse(a))u=e=new um(e,a),s="derived";else if(pse(a))u=e=new am(e,a),s="derived";else{U(zL(a));continue}if(u&&s!==void 0)for(const l of(r=u.producedFields())!==null&&r!==void 0?r:[])n.set(l,s,!1)}return e}function fm(e){var t,n,i,r,o,a,s,u,l,c;let f=Ice(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,g=e.data,m=!(g&&(qo(g)||el(g)||mf(g)))&&e.parent?e.parent.component.data.ancestorParse.clone():new Rse;qo(g)?(_P(g)?f=new pd(f,g.sequence):sE(g)&&(f=new gd(f,g.graticule)),m.parseNothing=!0):((t=g==null?void 0:g.format)===null||t===void 0?void 0:t.parse)===null&&(m.parseNothing=!0),f=(n=It.makeExplicit(f,e,m))!==null&&n!==void 0?n:f,f=new sa(f);const y=e.parent&&$l(e.parent);(tt(e)||Ti(e))&&y&&(f=(i=ur.makeFromEncoding(f,e))!==null&&i!==void 0?i:f),e.transforms.length>0&&(f=Lce(f,e,m));const v=Ale(e),b=Ole(e);f=(r=It.makeWithAncestors(f,{},Object.assign(Object.assign({},v),b),m))!==null&&r!==void 0?r:f,tt(e)&&(f=Eu.parseAll(f,e),f=bf.parseAll(f,e)),(tt(e)||Ti(e))&&(y||(f=(o=ur.makeFromEncoding(f,e))!==null&&o!==void 0?o:f),f=(a=sr.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=nl.parseAllForSortIndex(f,e));const x=e.getDataName(Pe.Raw),_=new rn(f,x,Pe.Raw,h);if(d[x]=_,f=_,tt(e)){const C=Fi.makeFromEncoding(f,e);C&&(f=C,dE(e)&&(f=new sa(f))),f=(s=is.makeFromEncoding(f,e))!==null&&s!==void 0?s:f,f=(u=to.makeFromEncoding(f,e))!==null&&u!==void 0?u:f}tt(e)&&(f=(l=vf.make(f,e))!==null&&l!==void 0?l:f);const E=e.getDataName(Pe.Main),w=new rn(f,E,Pe.Main,h);d[E]=w,f=w,tt(e)&&xue(e,w);let S=null;if(Ti(e)){const C=e.getName("facet");f=(c=Pce(f,e.facet))!==null&&c!==void 0?c:f,S=new kl(f,e,C,w.getSource()),d[C]=S}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:_,main:w,facetRoot:S,ancestorParse:m})}class zce extends EE{constructor(t,n,i,r){var o,a,s,u;super(t,"concat",n,i,r,t.resolve),(((a=(o=t.resolve)===null||o===void 0?void 0:o.axis)===null||a===void 0?void 0:a.x)==="shared"||((u=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||u===void 0?void 0:u.y)==="shared")&&U(PL),this.children=this.getChildren(t).map((l,c)=>$E(l,this,this.getName(`concat_${c}`),void 0,r))}parseData(){this.component.data=fm(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of z(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return V0(t)?t.vconcat:rE(t)?t.hconcat:t.concat}parseLayoutSize(){Nce(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=pE(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleGroupStyle(){}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function Bce(e){return e===!1||e===null}const Uce=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},L5),{labelExpr:1,encode:1}),$6=z(Uce);class OE extends po{constructor(t={},n={},i=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new OE(le(this.explicit),le(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!Bce(this.get(t))}hasOrientSignalRef(){return Z(this.explicit.orient)}}function qce(e,t,n){var i;const{encoding:r,config:o}=e,a=(i=st(r[t]))!==null&&i!==void 0?i:st(r[Or(t)]),s=e.axis(t)||{},{format:u,formatType:l}=s;if(_s(l))return Object.assign({text:ki({fieldOrDatumDef:a,field:"datum.value",format:u,formatType:l,config:o})},n);if(u===void 0&&l===void 0&&o.customFormatTypes){if(Ju(a)==="quantitative"){if(Qu(a)&&a.stack==="normalize"&&o.normalizedNumberFormatType)return Object.assign({text:ki({fieldOrDatumDef:a,field:"datum.value",format:o.normalizedNumberFormat,formatType:o.normalizedNumberFormatType,config:o})},n);if(o.numberFormatType)return Object.assign({text:ki({fieldOrDatumDef:a,field:"datum.value",format:o.numberFormat,formatType:o.numberFormatType,config:o})},n)}if(Ju(a)==="temporal"&&o.timeFormatType&&q(a)&&!a.timeUnit)return Object.assign({text:ki({fieldOrDatumDef:a,field:"datum.value",format:o.timeFormat,formatType:o.timeFormatType,config:o})},n)}return n}function Wce(e){return Ar.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[Jce(n,e)]),t),{})}const Gce={bottom:"top",top:"bottom",left:"right",right:"left"};function Hce(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const o of e.children){o.parseAxesAndHeaders();for(const a of z(o.component.axes))i.axis[a]=mE(e.component.resolve,a),i.axis[a]==="shared"&&(n[a]=Yce(n[a],o.component.axes[a]),n[a]||(i.axis[a]="independent",delete n[a]))}for(const o of Ar){for(const a of e.children)if(!!a.component.axes[o]){if(i.axis[o]==="independent"){n[o]=((t=n[o])!==null&&t!==void 0?t:[]).concat(a.component.axes[o]);for(const s of a.component.axes[o]){const{value:u,explicit:l}=s.getWithExplicit("orient");if(!Z(u)){if(r[u]>0&&!l){const c=Gce[u];r[u]>r[c]&&s.set("orient",c,!1)}r[u]++}}}delete a.component.axes[o]}if(i.axis[o]==="independent"&&n[o]&&n[o].length>1)for(const a of n[o])!!a.get("grid")&&!a.explicit.grid&&(a.implicit.grid=!1)}}function Yce(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],o=t[i];if(!!r!=!!o)return;if(r&&o){const a=r.getWithExplicit("orient"),s=o.getWithExplicit("orient");if(a.explicit&&s.explicit&&a.value!==s.value)return;e[i]=Xce(r,o)}}}else return t.map(n=>n.clone());return e}function Xce(e,t){for(const n of $6){const i=ia(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,o)=>{switch(n){case"title":return bF(r,o);case"gridScale":return{explicit:r.explicit,value:nt(r.value,o.value)}}return J0(r,o,n,"axis")});e.setWithExplicit(n,i)}return e}function Vce(e,t,n,i,r){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(Z(n.labelAngle)?n.labelAngle:Wc(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===XP(i,r))return!0}return e===n[t]}const Kce=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Jce(e,t){var n,i,r;let o=t.axis(e);const a=new OE,s=st(t.encoding[e]),{mark:u,config:l}=t,c=(o==null?void 0:o.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=l.axis)===null||i===void 0?void 0:i.orient)||Fue(e),f=t.getScaleComponent(e).get("type"),d=Eue(e,f,c,t.config),h=o!==void 0?!o:Hv("disable",l.style,o==null?void 0:o.style,d).configValue;if(a.set("disable",h,o!==void 0),h)return a;o=o||{};const g=kue(s,o,e,l.style,d),p={fieldOrDatumDef:s,axis:o,channel:e,model:t,scaleType:f,orient:c,labelAngle:g,mark:u,config:l};for(const v of $6){const b=v in vC?vC[v](p):Xk(v)?o[v]:void 0,x=b!==void 0,_=Vce(b,v,o,t,e);if(x&&_)a.set(v,b,_);else{const{configValue:E=void 0,configFrom:w=void 0}=Xk(v)&&v!=="values"?Hv(v,l.style,o.style,d):{},S=E!==void 0;x&&!S?a.set(v,b,_):(w!=="vgAxisConfig"||Kce.has(v)&&S||dd(E)||Z(E))&&a.set(v,E,!1)}}const m=(r=o.encoding)!==null&&r!==void 0?r:{},y=I5.reduce((v,b)=>{var x;if(!a.hasAxisPart(b))return v;const _=e6((x=m[b])!==null&&x!==void 0?x:{},t),E=b==="labels"?qce(t,e,_):_;return E!==void 0&&!Me(E)&&(v[b]={update:E}),v},{});return Me(y)||a.set("encode",y,!!o.encoding||o.labelAngle!==void 0),a}function Qce({encoding:e,size:t}){for(const n of Ar){const i=Sn(n);vr(t[i])&&tr(e[n])&&(delete t[i],U(SF(i)))}return t}function Zce(e,t,n){const i=dn(e),r=Fe("orient",i,n);if(i.orient=ife(i.type,t,r),r!==void 0&&r!==i.orient&&U(r4(i.orient,r)),i.type==="bar"&&i.orient){const s=Fe("cornerRadiusEnd",i,n);if(s!==void 0){const u=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:koe[i.orient];for(const l of u)i[l]=s;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return Fe("opacity",i,n)===void 0&&(i.opacity=tfe(i.type,t)),Fe("cursor",i,n)===void 0&&(i.cursor=efe(i,t,n)),i}function efe(e,t,n){return t.href||e.href||Fe("href",e,n)?"pointer":e.cursor}function tfe(e,t){if(me([z0,R_,P_,I_],e)&&!X_(t))return .7}function nfe(e,t,{graticule:n}){if(n)return!1;const i=us("filled",e,t),r=e.type;return nt(i,r!==z0&&r!==L0&&r!==Vg)}function ife(e,t,n){switch(e){case z0:case P_:case I_:case m5:case yoe:case moe:return}const{x:i,y:r,x2:o,y2:a}=t;switch(e){case I0:if(q(i)&&(Et(i.bin)||q(r)&&r.aggregate&&!i.aggregate))return"vertical";if(q(r)&&(Et(r.bin)||q(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(a||o){if(n)return n;if(!o)return(q(i)&&i.type===xs&&!Le(i.bin)||jv(i))&&q(r)&&Et(r.bin)?"horizontal":"vertical";if(!a)return(q(r)&&r.type===xs&&!Le(r.bin)||jv(r))&&q(i)&&Et(i.bin)?"vertical":"horizontal"}case Vg:if(o&&!(q(i)&&Et(i.bin))&&a&&!(q(r)&&Et(r.bin)))return;case P0:if(a)return q(r)&&Et(r.bin)?"horizontal":"vertical";if(o)return q(i)&&Et(i.bin)?"vertical":"horizontal";if(e===Vg){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case L0:case R_:{const s=tr(i),u=tr(r);if(n)return n;if(s&&!u)return e!=="tick"?"horizontal":"vertical";if(!s&&u)return e!=="tick"?"vertical":"horizontal";if(s&&u){const l=i,c=r,f=l.type===Vu,d=c.type===Vu;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!l.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!c.aggregate&&e!=="tick"?"horizontal":"vertical"}else return}}return"vertical"}const rfe={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Pt("x",e,{defaultPos:"mid"})),Pt("y",e,{defaultPos:"mid"})),oa(e,"radius")),oa(e,"theta"))},ofe={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),ip("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),ip("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),fE(e))},afe={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),oa(e,"x")),oa(e,"y"))},sfe={vgMark:"shape",encodeEntry:e=>Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&q(n)&&n.type===Sl?{field:H(n,{expr:"datum"})}:{})]}},ufe={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),oa(e,"x")),oa(e,"y")),lE(e,"url"))},lfe={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Pt("x",e,{defaultPos:"mid"})),Pt("y",e,{defaultPos:"mid"})),ht("size",e,{vgChannel:"strokeWidth"})),fE(e))},cfe={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Pt("x",e,{defaultPos:"mid"})),Pt("y",e,{defaultPos:"mid"})),ht("size",e)),fE(e))};function AE(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Pt("x",e,{defaultPos:"mid"})),Pt("y",e,{defaultPos:"mid"})),ht("size",e)),ht("angle",e)),ffe(e,n,t))}function ffe(e,t,n){return n?{shape:{value:n}}:ht("shape",e)}const dfe={vgMark:"symbol",encodeEntry:e=>AE(e)},hfe={vgMark:"symbol",encodeEntry:e=>AE(e,"circle")},gfe={vgMark:"symbol",encodeEntry:e=>AE(e,"square")},pfe={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),oa(e,"x")),oa(e,"y"))},mfe={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ip("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),ip("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),ht("size",e,{vgChannel:"strokeWidth"}))}},yfe={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ui(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Pt("x",e,{defaultPos:"mid"})),Pt("y",e,{defaultPos:"mid"})),lE(e)),ht("size",e,{vgChannel:"fontSize"})),ht("angle",e)),gC("align",vfe(e.markDef,n,t))),gC("baseline",bfe(e.markDef,n,t))),Pt("radius",e,{defaultPos:null})),Pt("theta",e,{defaultPos:null}))}};function vfe(e,t,n){if(Fe("align",e,n)===void 0)return"center"}function bfe(e,t,n){if(Fe("baseline",e,n)===void 0)return"middle"}const xfe={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",o=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ui(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Pt("x",e,{defaultPos:"mid",vgChannel:"xc"})),Pt("y",e,{defaultPos:"mid",vgChannel:"yc"})),ht("size",e,{defaultValue:wfe(e),vgChannel:r})),{[o]:ze(Fe("thickness",n,t))})}};function wfe(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,o=r==="horizontal"?"width":"height",a=e.getScaleComponent(r==="horizontal"?"x":"y"),s=(t=Fe("size",i,n,{vgChannel:o}))!==null&&t!==void 0?t:n.tick.bandSize;if(s!==void 0)return s;{const u=a?a.get("range"):void 0;return u&&ma(u)&&De(u.step)?u.step*3/4:tp(n.view,o)*3/4}}const Kd={arc:rfe,area:ofe,bar:afe,circle:hfe,geoshape:sfe,image:ufe,line:lfe,point:dfe,rect:pfe,rule:mfe,square:gfe,text:yfe,tick:xfe,trail:cfe};function _fe(e){if(me([L0,P0,voe],e.mark)){const t=q5(e.mark,e.encoding);if(t.length>0)return Efe(e,t)}else if(e.mark===I0){const t=X1.some(n=>Fe(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return Sfe(e)}return kE(e)}const NC="faceted_path_";function Efe(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:NC+e.requestDataName(Pe.Main),data:e.requestDataName(Pe.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:kE(e,{fromPrefix:NC})}]}const jC="stack_group_";function Sfe(e){var t;const[n]=kE(e,{fromPrefix:jC}),i=e.scaleName(e.stack.fieldChannel),r=(c={})=>e.vgField(e.stack.fieldChannel,c),o=(c,f)=>{const d=[r({prefix:"min",suffix:"start",expr:f}),r({prefix:"max",suffix:"start",expr:f}),r({prefix:"min",suffix:"end",expr:f}),r({prefix:"max",suffix:"end",expr:f})];return`${c}(${d.map(h=>`scale('${i}',${h})`).join(",")})`};let a,s;e.stack.fieldChannel==="x"?(a=Object.assign(Object.assign({},Ou(n.encode.update,["y","yc","y2","height",...X1])),{x:{signal:o("min","datum")},x2:{signal:o("max","datum")},clip:{value:!0}}),s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},yn(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(a=Object.assign(Object.assign({},Ou(n.encode.update,["x","xc","x2","width"])),{y:{signal:o("min","datum")},y2:{signal:o("max","datum")},clip:{value:!0}}),s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},yn(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const c of X1){const f=us(c,e.markDef,e.config);n.encode.update[c]?(a[c]=n.encode.update[c],delete n.encode.update[c]):f&&(a[c]=ze(f)),f&&(n.encode.update[c]={value:0})}const u=[];if(((t=e.stack.groupbyChannels)===null||t===void 0?void 0:t.length)>0)for(const c of e.stack.groupbyChannels){const f=e.fieldDef(c),d=H(f);d&&u.push(d),((f==null?void 0:f.bin)||(f==null?void 0:f.timeUnit))&&u.push(H(f,{binSuffix:"end"}))}return a=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((c,f)=>{if(n.encode.update[f])return Object.assign(Object.assign({},c),{[f]:n.encode.update[f]});{const d=us(f,e.markDef,e.config);return d!==void 0?Object.assign(Object.assign({},c),{[f]:ze(d)}):c}},a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(Pe.Main),name:jC+e.requestDataName(Pe.Main),groupby:u,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:s},marks:[n]}]}]}function Ofe(e){var t;const{encoding:n,stack:i,mark:r,markDef:o,config:a}=e,s=n.order;if(!(!I(s)&&ji(s)&&H1(s.value)||!s&&H1(Fe("order",o,a)))){if((I(s)||q(s))&&!i)return mF(s,{expr:"datum"});if(Ea(r)){const u=o.orient==="horizontal"?"y":"x",l=n[u];if(q(l)){const c=l.sort;if(I(c))return{field:H(l,{prefix:u,suffix:"sort_index",expr:"datum"})};if(ar(c))return{field:H({aggregate:X_(e.encoding)?c.op:void 0,field:c.field},{expr:"datum"})};if(A5(c)){const f=e.fieldDef(c.encoding);return{field:H(f,{expr:"datum"}),order:c.order}}else return c===null?void 0:{field:H(l,{binSuffix:!((t=e.stack)===null||t===void 0)&&t.impute?"mid":void 0,expr:"datum"})}}return}}}function kE(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:o}=e,a=nt(i.clip,Afe(e),kfe(e)),s=gF(i),u=r.key,l=Ofe(e),c=Cfe(e),f=Fe("aria",i,o),d=Kd[n].postEncodingTransform?Kd[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:Kd[n].vgMark},a?{clip:!0}:{}),s?{style:s}:{}),u?{key:u.field}:{}),l?{sort:l}:{}),c||{}),f===!1?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(Pe.Main)},encode:{update:Kd[n].encodeEntry(e)}}),d?{transform:d}:{})]}function Afe(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return(t==null?void 0:t.get("selectionExtent"))||(n==null?void 0:n.get("selectionExtent"))?!0:void 0}function kfe(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function Cfe(e){if(!e.component.selection)return null;const t=z(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=z(i.component.selection).length,i=i.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class F6 extends O6{constructor(t,n,i,r={},o){var a;super(t,"unit",n,i,o,void 0,Jk(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const s=pr(t.mark)?Object.assign({},t.mark):{type:t.mark},u=s.type;s.filled===void 0&&(s.filled=nfe(s,o,{graticule:t.data&&sE(t.data)}));const l=this.encoding=rae(t.encoding||{},u,s.filled,o);this.markDef=Zce(s,l,o),this.size=Qce({encoding:l,size:Jk(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=cP(u,l),this.specifiedScales=this.initScales(u,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegends(l),this.specifiedProjection=t.projection,this.selection=((a=t.params)!==null&&a!==void 0?a:[]).filter(c=>nE(c))}get hasProjection(){const{encoding:t}=this,n=this.mark===y5,i=t&&KI.some(r=>se(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return Ep.reduce((i,r)=>{var o;const a=st(n[r]);return a&&(i[r]=this.initScale((o=a.scale)!==null&&o!==void 0?o:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=dn(t);return I(n)&&(r.domain=n.map(Nn)),I(i)&&(r.range=i.map(Nn)),r}initAxes(t){return Ar.reduce((n,i)=>{const r=t[i];if(se(r)||i===He&&se(t.x2)||i===bt&&se(t.y2)){const o=se(r)?r.axis:void 0;n[i]=o&&this.initAxis(Object.assign({},o))}return n},{})}initAxis(t){const n=z(t),i={};for(const r of n){const o=t[r];i[r]=dd(o)?hF(o):Nn(o)}return i}initLegends(t){return aL.reduce((n,i)=>{const r=st(t[i]);if(r&&uL(i)){const o=r.legend;n[i]=o&&dn(o)}return n},{})}parseData(){this.component.data=fm(this)}parseLayoutSize(){jce(this)}parseSelections(){this.component.selection=bue(this,this.selection)}parseMarkGroup(){this.component.mark=_fe(this)}parseAxesAndHeaders(){this.component.axes=Wce(this)}assembleSelectionTopLevelSignals(t){return zse(this,t)}assembleSignals(){return[...GP(this),...Ise(this,[])]}assembleSelectionData(t){return Bse(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return pE(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!$l(this.parent))&&(n=SP(this,n)),n.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};if(t!==void 0)return t;if(this.encoding.x||this.encoding.y)return"cell"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return ns(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return mr(n)}typedFieldDef(t){const n=this.fieldDef(t);return oi(n)?n:null}}class CE extends EE{constructor(t,n,i,r,o){super(t,"layer",n,i,o,t.resolve,t.view);const a=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((s,u)=>{if(K0(s))return new CE(s,this,this.getName(`layer_${u}`),a,o);if(go(s))return new F6(s,this,this.getName(`layer_${u}`),a,o);throw new Error(zb(s))})}parseData(){this.component.data=fm(this);for(const t of this.children)t.parseData()}parseLayoutSize(){Dce(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of z(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){Hce(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),GP(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),pE(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of V(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return Use(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),u6(this))}}function $E(e,t,n,i,r){if(U0(e))return new Bc(e,t,n,r);if(K0(e))return new CE(e,t,n,i,r);if(go(e))return new F6(e,t,n,i,r);if($ae(e))return new zce(e,t,n,r);throw new Error(zb(e))}var $fe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function T6(e,t={}){t.logger&&$4(t.logger),t.fieldTitle&&j5(t.fieldTitle);try{const n=lP(sl(t.config,e.config)),i=bP(e,n),r=$E(i,null,"",void 0,n);return r.parse(),Ule(r.component.data,r),{spec:Tfe(r,Ffe(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&F4(),t.fieldTitle&&Xoe()}}function Ffe(e,t,n,i){const r=i.component.layoutSize.get("width"),o=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):Y(t)&&(t={type:t}),r&&o&&Dse(t.type)){if(r==="step"&&o==="step")U(VE()),t.type="pad";else if(r==="step"||o==="step"){const a=r==="step"?"width":"height";U(VE(_p(a)));const s=a==="width"?"height":"width";t.type=Nse(s)}}return Object.assign(Object.assign(Object.assign({},z(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),lC(n,!1)),lC(e,!0))}function Tfe(e,t,n={},i){const r=e.config?Wae(e.config):void 0,o=[].concat(e.assembleSelectionData([]),$ce(e.component.data,n)),a=e.assembleProjections(),s=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter(h=>(h.name==="width"||h.name==="height")&&h.value!==void 0?(t[h.name]=+h.value,!1):!0);const{params:f}=t,d=$fe(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),s?{title:s}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:o}),a.length>0?{projections:a}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...oP(f)])),r?{config:r}:{}),i?{usermeta:i}:{})}const Mfe=$I.version;var Dfe=Object.freeze(Object.defineProperty({__proto__:null,version:Mfe,compile:T6,normalize:bP,deepEqual:Zi,duplicate:le,never:G$,pick:Ou,omit:yn,stringify:Ie,hash:be,isNullOrFalse:H1,contains:me,some:os,every:kb,mergeDeep:H$,unique:er,isEqual:WI,setEqual:Y$,hasIntersection:Cb,prefixGenerator:Y1,fieldIntersection:$b,isEmpty:Me,keys:z,vals:zt,entries:Go,isBoolean:qc,varName:qe,logicalExpr:Cc,deleteNestedProperty:Mh,titleCase:Of,accessPathWithDatum:Fb,flatAccessWithDatum:X$,replacePathInField:ei,replaceAll:as,removePathFromField:Tb,accessPathDepth:Au,getFirstDefined:nt,uniqueId:K$,resetIdCounter:HI,internalField:J$,isInternalField:Q$,normalizeAngle:Wc,isNumeric:mp},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Nfe=globalThis&&globalThis.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)r.hasOwnProperty(o)&&(i[o]=r[o])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),jfe=Object.prototype.hasOwnProperty;function tb(e,t){return jfe.call(e,t)}function nb(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var i=[];for(var r in e)tb(e,r)&&i.push(r);return i}function Rn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ib(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function Pa(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function M6(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function rb(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(rb(e[t]))return!0}else if(typeof e=="object"){for(var i=nb(e),r=i.length,o=0;o<r;o++)if(rb(e[i[o]]))return!0}}return!1}function RC(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r!="undefined"&&n.push(i+": "+r)}return n.join(`
`)}var D6=function(e){Nfe(t,e);function t(n,i,r,o,a){var s=this.constructor,u=e.call(this,RC(n,{name:i,index:r,operation:o,tree:a}))||this;return u.name=i,u.index=r,u.operation=o,u.tree=a,Object.setPrototypeOf(u,s.prototype),u.message=RC(n,{name:i,index:r,operation:o,tree:a}),u}return t}(Error),Ke=D6,Rfe=Rn,hu={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=sp(n,this.path);i&&(i=Rn(i));var r=rs(n,{op:"remove",path:this.from}).removed;return rs(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=sp(n,this.from);return rs(n,{op:"add",path:this.path,value:Rn(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:wf(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Pfe={add:function(e,t,n){return ib(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:hu.move,copy:hu.copy,test:hu.test,_get:hu._get};function sp(e,t){if(t=="")return e;var n={op:"_get",path:t};return rs(e,n),n.value}function rs(e,t,n,i,r,o){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),o===void 0&&(o=0),n&&(typeof n=="function"?n(t,0,e,t.path):up(t,0)),t.path===""){var a={newDocument:e};if(t.op==="add")return a.newDocument=t.value,a;if(t.op==="replace")return a.newDocument=t.value,a.removed=e,a;if(t.op==="move"||t.op==="copy")return a.newDocument=sp(e,t.from),t.op==="move"&&(a.removed=e),a;if(t.op==="test"){if(a.test=wf(e,t.value),a.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return a.newDocument=e,a}else{if(t.op==="remove")return a.removed=e,a.newDocument=null,a;if(t.op==="_get")return t.value=e,a;if(n)throw new Ke("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,t,e);return a}}else{i||(e=Rn(e));var s=t.path||"",u=s.split("/"),l=e,c=1,f=u.length,d=void 0,h=void 0,g=void 0;for(typeof n=="function"?g=n:g=up;;){if(h=u[c],h&&h.indexOf("~")!=-1&&(h=M6(h)),r&&(h=="__proto__"||h=="prototype"&&c>0&&u[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=u.slice(0,c).join("/"):c==f-1&&(d=t.path),d!==void 0&&g(t,0,e,d)),c++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!ib(h))throw new Ke("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,t,e);ib(h)&&(h=~~h)}if(c>=f){if(n&&t.op==="add"&&h>l.length)throw new Ke("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,t,e);var a=Pfe[t.op].call(t,l,h,e);if(a.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return a}}else if(c>=f){var a=hu[t.op].call(t,l,h,e);if(a.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",o,t,e);return a}if(l=l[h],n&&c<f&&(!l||typeof l!="object"))throw new Ke("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,t,e)}}}function dm(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new Ke("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=Rn(e));for(var o=new Array(t.length),a=0,s=t.length;a<s;a++)o[a]=rs(e,t[a],n,!0,r,a),e=o[a].newDocument;return o.newDocument=e,o}function Ife(e,t,n){var i=rs(e,t);if(i.test===!1)throw new Ke("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function up(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new Ke("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(hu[e.op]){if(typeof e.path!="string")throw new Ke("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Ke('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Ke("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Ke("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&rb(e.value))throw new Ke("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,o=i.split("/").length;if(r!==o+1&&r!==o)throw new Ke("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new Ke("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var a={op:"_get",path:e.from,value:void 0},s=N6([a],n);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ke("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Ke("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function N6(e,t,n){try{if(!Array.isArray(e))throw new Ke("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)dm(Rn(t),Rn(e),n||!0);else{n=n||up;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof Ke)return r;throw r}}function wf(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,o,a;if(n&&i){if(o=e.length,o!=t.length)return!1;for(r=o;r--!==0;)if(!wf(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var s=Object.keys(e);if(o=s.length,o!==Object.keys(t).length)return!1;for(r=o;r--!==0;)if(!t.hasOwnProperty(s[r]))return!1;for(r=o;r--!==0;)if(a=s[r],!wf(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}var Lfe=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:Ke,deepClone:Rfe,getValueByPointer:sp,applyOperation:rs,applyPatch:dm,applyReducer:Ife,validator:up,validate:N6,_areEquals:wf},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var FE=new WeakMap,zfe=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Bfe=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function Ufe(e){return FE.get(e)}function qfe(e,t){return e.observers.get(t)}function Wfe(e,t){e.observers.delete(t.callback)}function Gfe(e,t){t.unobserve()}function Hfe(e,t){var n=[],i,r=Ufe(e);if(!r)r=new zfe(e),FE.set(e,r);else{var o=qfe(r,t);i=o&&o.observer}if(i)return i;if(i={},r.value=Rn(e),t){i.callback=t,i.next=null;var a=function(){ob(i)},s=function(){clearTimeout(i.next),i.next=setTimeout(a)};typeof window!="undefined"&&(window.addEventListener("mouseup",s),window.addEventListener("keyup",s),window.addEventListener("mousedown",s),window.addEventListener("keydown",s),window.addEventListener("change",s))}return i.patches=n,i.object=e,i.unobserve=function(){ob(i),clearTimeout(i.next),Wfe(r,i),typeof window!="undefined"&&(window.removeEventListener("mouseup",s),window.removeEventListener("keyup",s),window.removeEventListener("mousedown",s),window.removeEventListener("keydown",s),window.removeEventListener("change",s))},r.observers.set(t,new Bfe(t,i)),i}function ob(e,t){t===void 0&&(t=!1);var n=FE.get(e.object);TE(n.value,e.object,e.patches,"",t),e.patches.length&&dm(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function TE(e,t,n,i,r){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var o=nb(t),a=nb(e),s=!1,u=a.length-1;u>=0;u--){var l=a[u],c=e[l];if(tb(t,l)&&!(t[l]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null&&Array.isArray(c)===Array.isArray(f)?TE(c,f,n,i+"/"+Pa(l),r):c!==f&&(r&&n.push({op:"test",path:i+"/"+Pa(l),value:Rn(c)}),n.push({op:"replace",path:i+"/"+Pa(l),value:Rn(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+Pa(l),value:Rn(c)}),n.push({op:"remove",path:i+"/"+Pa(l)}),s=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!(!s&&o.length==a.length))for(var u=0;u<o.length;u++){var l=o[u];!tb(e,l)&&t[l]!==void 0&&n.push({op:"add",path:i+"/"+Pa(l),value:Rn(t[l])})}}}function Yfe(e,t,n){n===void 0&&(n=!1);var i=[];return TE(e,t,i,"",n),i}var Xfe=Object.freeze(Object.defineProperty({__proto__:null,unobserve:Gfe,observe:Hfe,generate:ob,compare:Yfe},Symbol.toStringTag,{value:"Module"}));Object.assign({},Lfe,Xfe,{JsonPatchError:D6,deepClone:Rn,escapePathComponent:Pa,unescapePathComponent:M6});var Vfe=/("(?:[^\\"]|\\.)*")|[:,]/g,N1=function(t,n){var i,r,o;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?1/0:n.maxLength===void 0?80:n.maxLength,o=n.replacer,function a(s,u,l){var c,f,d,h,g,p,m,y,v,b,x,_;if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),x=JSON.stringify(s,o),x===void 0)return x;if(m=r-u.length-l,x.length<=m&&(v=x.replace(Vfe,function(E,w){return w||E+" "}),v.length<=m))return v;if(o!=null&&(s=JSON.parse(x),o=void 0),typeof s=="object"&&s!==null){if(y=u+i,d=[],f=0,Array.isArray(s))for(b="[",c="]",m=s.length;f<m;f++)d.push(a(s[f],y,f===m-1?0:1)||"null");else for(b="{",c="}",p=Object.keys(s),m=p.length;f<m;f++)h=p[f],g=JSON.stringify(h)+": ",_=a(s[h],y,g.length+(f===m-1?0:1)),_!==void 0&&d.push(g+_);if(d.length>0)return[b,i+d.join(`,
`+y),c].join(`
`+u)}return x}(t,"",0)};function Kfe(e,t,n){let i;t.x2&&(t.x?(n&&e.x>e.x2&&(i=e.x,e.x=e.x2,e.x2=i),e.width=e.x2-e.x):e.x=e.x2-(e.width||0)),t.xc&&(e.x=e.xc-(e.width||0)/2),t.y2&&(t.y?(n&&e.y>e.y2&&(i=e.y,e.y=e.y2,e.y2=i),e.height=e.y2-e.y):e.y=e.y2-(e.height||0)),t.yc&&(e.y=e.yc-(e.height||0)/2)}var Jfe={NaN:NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE},Qfe={"*":(e,t)=>e*t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,">":(e,t)=>e>t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"&":(e,t)=>e&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t},Zfe={"+":e=>+e,"-":e=>-e,"~":e=>~e,"!":e=>!e};const ede=Array.prototype.slice,ka=(e,t,n)=>{const i=n?n(t[0]):t[0];return i[e].apply(i,ede.call(t,1))},tde=(e,t,n,i,r,o,a)=>new Date(e,t||0,n!=null?n:1,i||0,r||0,o||0,a||0);var nde={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(e,t,n)=>Math.max(t,Math.min(n,e)),now:Date.now,utc:Date.UTC,datetime:tde,date:e=>new Date(e).getDate(),day:e=>new Date(e).getDay(),year:e=>new Date(e).getFullYear(),month:e=>new Date(e).getMonth(),hours:e=>new Date(e).getHours(),minutes:e=>new Date(e).getMinutes(),seconds:e=>new Date(e).getSeconds(),milliseconds:e=>new Date(e).getMilliseconds(),time:e=>new Date(e).getTime(),timezoneoffset:e=>new Date(e).getTimezoneOffset(),utcdate:e=>new Date(e).getUTCDate(),utcday:e=>new Date(e).getUTCDay(),utcyear:e=>new Date(e).getUTCFullYear(),utcmonth:e=>new Date(e).getUTCMonth(),utchours:e=>new Date(e).getUTCHours(),utcminutes:e=>new Date(e).getUTCMinutes(),utcseconds:e=>new Date(e).getUTCSeconds(),utcmilliseconds:e=>new Date(e).getUTCMilliseconds(),length:e=>e.length,join:function(){return ka("join",arguments)},indexof:function(){return ka("indexOf",arguments)},lastindexof:function(){return ka("lastIndexOf",arguments)},slice:function(){return ka("slice",arguments)},reverse:e=>e.slice().reverse(),parseFloat,parseInt,upper:e=>String(e).toUpperCase(),lower:e=>String(e).toLowerCase(),substring:function(){return ka("substring",arguments,String)},split:function(){return ka("split",arguments,String)},replace:function(){return ka("replace",arguments,String)},trim:e=>String(e).trim(),regexp:RegExp,test:(e,t)=>RegExp(e).test(t)};const ide=["view","item","group","xy","x","y"],rde={Literal:(e,t)=>t.value,Identifier:(e,t)=>{const n=t.name;return e.memberDepth>0?n:n==="datum"?e.datum:n==="event"?e.event:n==="item"?e.item:Jfe[n]||e.params["$"+n]},MemberExpression:(e,t)=>{const n=!t.computed,i=e(t.object);n&&(e.memberDepth+=1);const r=e(t.property);return n&&(e.memberDepth-=1),i[r]},CallExpression:(e,t)=>{const n=t.arguments;let i=t.callee.name;return i.startsWith("_")&&(i=i.slice(1)),i==="if"?e(n[0])?e(n[1]):e(n[2]):(e.fn[i]||nde[i]).apply(e.fn,n.map(e))},ArrayExpression:(e,t)=>t.elements.map(e),BinaryExpression:(e,t)=>Qfe[t.operator](e(t.left),e(t.right)),UnaryExpression:(e,t)=>Zfe[t.operator](e(t.argument)),ConditionalExpression:(e,t)=>e(t.test)?e(t.consequent):e(t.alternate),LogicalExpression:(e,t)=>t.operator==="&&"?e(t.left)&&e(t.right):e(t.left)||e(t.right),ObjectExpression:(e,t)=>t.properties.reduce((n,i)=>{e.memberDepth+=1;const r=e(i.key);return e.memberDepth-=1,n[r]=e(i.value),n},{})};function Zl(e,t,n,i,r,o){const a=s=>rde[s.type](a,s);return a.memberDepth=0,a.fn=Object.create(t),a.params=n,a.datum=i,a.event=r,a.item=o,ide.forEach(s=>a.fn[s]=(...u)=>r.vega[s](...u)),a(e)}var ode={operator(e,t){const n=t.ast,i=e.functions;return r=>Zl(n,i,r)},parameter(e,t){const n=t.ast,i=e.functions;return(r,o)=>Zl(n,i,o,r)},event(e,t){const n=t.ast,i=e.functions;return r=>Zl(n,i,void 0,void 0,r)},handler(e,t){const n=t.ast,i=e.functions;return(r,o)=>{const a=o.item&&o.item.datum;return Zl(n,i,r,a,o)}},encode(e,t){const{marktype:n,channels:i}=t,r=e.functions,o=n==="group"||n==="image"||n==="rect";return(a,s)=>{const u=a.datum;let l=0,c;for(const f in i)c=Zl(i[f].ast,r,s,u,void 0,a),a[f]!==c&&(a[f]=c,l=1);return n!=="rule"&&Kfe(a,i,o),l}}};function j6(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var ade="vega-themes",sde="2.10.0",ude="Themes for stylized Vega and Vega-Lite visualizations.",lde=["vega","vega-lite","themes","style"],cde="BSD-3-Clause",fde={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},dde=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],hde="build/vega-themes.js",gde="build/vega-themes.module.js",pde="build/vega-themes.min.js",mde="build/vega-themes.min.js",yde="build/vega-themes.module.d.ts",vde={type:"git",url:"https://github.com/vega/vega-themes.git"},bde=["src","build"],xde={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",prepare:"beemo create-config",eslintbase:"beemo eslint .",format:"yarn eslintbase --fix",lint:"yarn eslintbase",release:"auto shipit"},wde={"@auto-it/conventional-commits":"^10.32.2","@auto-it/first-time-contributor":"^10.32.2","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.0.6","rollup-plugin-ts":"^1.4.7",auto:"^10.32.2","browser-sync":"^2.27.7",concurrently:"^6.4.0","gh-pages":"^3.2.3",rollup:"^2.60.0","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-terser":"^7.0.2",typescript:"^4.4.4",vega:"^5.19.1","vega-lite":"^5.0.0","vega-lite-dev-config":"^0.20.0"},_de={vega:"*","vega-lite":"*"},Ede={name:ade,version:sde,description:ude,keywords:lde,license:cde,author:fde,contributors:dde,main:hde,module:gde,unpkg:pde,jsdelivr:mde,types:yde,repository:vde,files:bde,scripts:xde,devDependencies:wde,peerDependencies:_de};const nu="#fff",Sde="#888",Ode={background:"#333",title:{color:nu,subtitleColor:nu},style:{"guide-label":{fill:nu},"guide-title":{fill:nu}},axis:{domainColor:nu,gridColor:Sde,tickColor:nu}},Ca="#4572a7",Ade={background:"#fff",arc:{fill:Ca},area:{fill:Ca},line:{stroke:Ca,strokeWidth:2},path:{stroke:Ca},rect:{fill:Ca},shape:{stroke:Ca},symbol:{fill:Ca,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},$a="#30a2da",j1="#cbcbcb",kde="#999",Cde="#333",PC="#f0f0f0",IC="#333",$de={arc:{fill:$a},area:{fill:$a},axis:{domainColor:j1,grid:!0,gridColor:j1,gridWidth:1,labelColor:kde,labelFontSize:10,titleColor:Cde,tickColor:j1,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:PC,group:{fill:PC},legend:{labelColor:IC,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:IC,titleFontSize:14,titlePadding:10},line:{stroke:$a,strokeWidth:2},path:{stroke:$a,strokeWidth:.5},rect:{fill:$a},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:$a},bar:{binSpacing:2,fill:$a,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Fa="#000",Fde={group:{fill:"#e5e5e5"},arc:{fill:Fa},area:{fill:Fa},line:{stroke:Fa},path:{stroke:Fa},rect:{fill:Fa},shape:{stroke:Fa},symbol:{fill:Fa,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Tde=22,Mde="normal",LC="Benton Gothic, sans-serif",zC=11.5,Dde="normal",Ta="#82c6df",R1="Benton Gothic Bold, sans-serif",BC="normal",UC=13,ec={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},Nde={background:"#ffffff",title:{anchor:"start",color:"#000000",font:R1,fontSize:Tde,fontWeight:Mde},arc:{fill:Ta},area:{fill:Ta},line:{stroke:Ta,strokeWidth:2},path:{stroke:Ta},rect:{fill:Ta},shape:{stroke:Ta},symbol:{fill:Ta,size:30},axis:{labelFont:LC,labelFontSize:zC,labelFontWeight:Dde,titleFont:R1,titleFontSize:UC,titleFontWeight:BC},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:LC,labelFontSize:zC,symbolType:"square",titleFont:R1,titleFontSize:UC,titleFontWeight:BC},range:{category:ec["category-6"],diverging:ec["fireandice-6"],heatmap:ec["fire-7"],ordinal:ec["fire-7"],ramp:ec["fire-7"]}},Ma="#ab5787",Jd="#979797",jde={background:"#f9f9f9",arc:{fill:Ma},area:{fill:Ma},line:{stroke:Ma},path:{stroke:Ma},rect:{fill:Ma},shape:{stroke:Ma},symbol:{fill:Ma,size:30},axis:{domainColor:Jd,domainWidth:.5,gridWidth:.2,labelColor:Jd,tickColor:Jd,tickWidth:.2,titleColor:Jd},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Da="#3e5c69",Rde={background:"#fff",arc:{fill:Da},area:{fill:Da},line:{stroke:Da},path:{stroke:Da},rect:{fill:Da},shape:{stroke:Da},symbol:{fill:Da},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Hn="#1696d2",qC="#000000",Pde="#FFFFFF",Qd="Lato",P1="Lato",Ide="Lato",Lde="#DEDDDD",zde=18,tc={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},Bde={background:Pde,title:{anchor:"start",fontSize:zde,font:Qd},axisX:{domain:!0,domainColor:qC,domainWidth:1,grid:!1,labelFontSize:12,labelFont:P1,labelAngle:0,tickColor:qC,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:Qd},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:Lde,gridWidth:1,labelFontSize:12,labelFont:P1,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:Qd,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:P1,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:Qd,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:tc["six-groups-cat-1"],diverging:tc["diverging-colors"],heatmap:tc["diverging-colors"],ordinal:tc["six-groups-seq"],ramp:tc["shades-blue"]},area:{fill:Hn},rect:{fill:Hn},line:{color:Hn,stroke:Hn,strokeWidth:5},trail:{color:Hn,stroke:Hn,strokeWidth:0,size:1},path:{stroke:Hn,strokeWidth:.5},point:{filled:!0},text:{font:Ide,color:Hn,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Hn,stroke:null}},arc:{fill:Hn},shape:{stroke:Hn},symbol:{fill:Hn,size:30}},Na="#3366CC",WC="#ccc",Zd="Arial, sans-serif",Ude={arc:{fill:Na},area:{fill:Na},path:{stroke:Na},rect:{fill:Na},shape:{stroke:Na},symbol:{stroke:Na},circle:{fill:Na},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:Zd,fontSize:12},"guide-title":{font:Zd,fontSize:12},"group-title":{font:Zd,fontSize:12}},title:{font:Zd,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:WC,tickColor:WC,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},ME=e=>e*(1/3+1),GC=ME(9),HC=ME(10),YC=ME(12),nc="Segoe UI",XC="wf_standard-font, helvetica, arial, sans-serif",VC="#252423",ic="#605E5C",KC="transparent",qde="#C8C6C4",di="#118DFF",Wde="#12239E",Gde="#E66C37",Hde="#6B007B",Yde="#E044A7",Xde="#744EC2",Vde="#D9B300",Kde="#D64550",R6=di,P6="#DEEFFF",JC=[P6,R6],Jde=[P6,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",R6],Qde={view:{stroke:KC},background:KC,font:nc,header:{titleFont:XC,titleFontSize:YC,titleColor:VC,labelFont:nc,labelFontSize:HC,labelColor:ic},axis:{ticks:!1,grid:!1,domain:!1,labelColor:ic,labelFontSize:GC,titleFont:XC,titleColor:VC,titleFontSize:YC,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:qde,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:di},line:{stroke:di,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:nc,fontSize:GC,fill:ic},arc:{fill:di},area:{fill:di,line:!0,opacity:.6},path:{stroke:di},rect:{fill:di},point:{fill:di,filled:!0,size:75},shape:{stroke:di},symbol:{fill:di,strokeWidth:1.5,size:50},legend:{titleFont:nc,titleFontWeight:"bold",titleColor:ic,labelFont:nc,labelFontSize:HC,labelColor:ic,symbolType:"circle",symbolSize:75},range:{category:[di,Wde,Gde,Hde,Yde,Xde,Vde,Kde],diverging:JC,heatmap:JC,ordinal:Jde}},Zde=Ede.version;var ehe=Object.freeze(Object.defineProperty({__proto__:null,dark:Ode,excel:Ade,fivethirtyeight:$de,ggplot2:Fde,googlecharts:Ude,latimes:Nde,powerbi:Qde,quartz:jde,urbaninstitute:Bde,version:Zde,vox:Rde},Symbol.toStringTag,{value:"Module"}));/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function the(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function nhe(e,t,n){if(I(e))return`[${e.map(i=>t(Y(i)?i:QC(i,n))).join(", ")}]`;if(K(e)){let i="";const r=e,{title:o,image:a}=r,s=the(r,["title","image"]);o&&(i+=`<h2>${t(o)}</h2>`),a&&(i+=`<img src="${t(a)}">`);const u=Object.keys(s);if(u.length>0){i+="<table>";for(const l of u){let c=s[l];c!==void 0&&(K(c)&&(c=QC(c,n)),i+=`<tr><td class="key">${t(l)}:</td><td class="value">${t(c)}</td></tr>`)}i+="</table>"}return i||"{}"}return t(e)}function ihe(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function QC(e,t){return JSON.stringify(e,ihe(t))}var rhe=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black;
}
#vg-tooltip-element.visible {
  visibility: visible;
}
#vg-tooltip-element h2 {
  margin-top: 0;
  margin-bottom: 10px;
  font-size: 13px;
}
#vg-tooltip-element img {
  max-width: 200px;
  max-height: 200px;
}
#vg-tooltip-element table {
  border-spacing: 0;
}
#vg-tooltip-element table tr {
  border: none;
}
#vg-tooltip-element table tr td {
  overflow: hidden;
  text-overflow: ellipsis;
  padding-top: 2px;
  padding-bottom: 2px;
}
#vg-tooltip-element table tr td.key {
  color: #808080;
  max-width: 150px;
  text-align: right;
  padding-right: 4px;
}
#vg-tooltip-element table tr td.value {
  display: block;
  max-width: 300px;
  max-height: 7em;
  text-align: left;
}
#vg-tooltip-element.dark-theme {
  background-color: rgba(32, 32, 32, 0.9);
  border: 1px solid #f5f5f5;
  color: white;
}
#vg-tooltip-element.dark-theme td.key {
  color: #bfbfbf;
}
`;const I6="vg-tooltip-element",ohe={offsetX:10,offsetY:10,id:I6,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:ahe,maxDepth:2,formatTooltip:nhe};function ahe(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function she(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return rhe.toString().replace(I6,e)}function uhe(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let o=e.clientY+i;return o+t.height>window.innerHeight&&(o=+e.clientY-i-t.height),{x:r,y:o}}class lhe{constructor(t){this.options=Object.assign(Object.assign({},ohe),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const i=document.createElement("style");i.setAttribute("id",this.options.styleId),i.innerHTML=she(n);const r=document.head;r.childNodes.length>0?r.insertBefore(i,r.childNodes[0]):r.appendChild(i)}}tooltipHandler(t,n,i,r){var o;if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),((o=document.fullscreenElement)!==null&&o!==void 0?o:document.body).appendChild(this.el)),r==null||r===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=this.options.formatTooltip(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:a,y:s}=uhe(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${s}px; left: ${a}px`)}}function che(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ZC(e,t,n,i,r,o,a){try{var s=e[o](a),u=s.value}catch(l){n(l);return}s.done?t(u):Promise.resolve(u).then(i,r)}function lp(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var o=e.apply(t,n);function a(u){ZC(o,i,r,a,s,"next",u)}function s(u){ZC(o,i,r,a,s,"throw",u)}a(void 0)})}}var L6=Object.prototype,Xa=L6.hasOwnProperty,Qi,DE=typeof Symbol=="function"?Symbol:{},hm=DE.iterator||"@@iterator",fhe=DE.asyncIterator||"@@asyncIterator",cp=DE.toStringTag||"@@toStringTag";function z6(e,t,n,i){var r=t&&t.prototype instanceof ab?t:ab,o=Object.create(r.prototype),a=new sb(i||[]);return o._invoke=mhe(e,n,a),o}function NE(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(i){return{type:"throw",arg:i}}}var e$="suspendedStart",dhe="suspendedYield",t$="executing",eh="completed",_i={};function ab(){}function gm(){}function ol(){}var jE={};jE[hm]=function(){return this};var I1=Object.getPrototypeOf,th=I1&&I1(I1(RE([])));th&&th!==L6&&Xa.call(th,hm)&&(jE=th);var Fl=ol.prototype=ab.prototype=Object.create(jE);gm.prototype=Fl.constructor=ol;ol.constructor=gm;ol[cp]=gm.displayName="GeneratorFunction";function B6(e){["next","throw","return"].forEach(function(t){e[t]=function(n){return this._invoke(t,n)}})}function U6(e){var t=typeof e=="function"&&e.constructor;return t?t===gm||(t.displayName||t.name)==="GeneratorFunction":!1}function hhe(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,ol):(e.__proto__=ol,cp in e||(e[cp]="GeneratorFunction")),e.prototype=Object.create(Fl),e}function ghe(e){return{__await:e}}function pm(e,t){function n(o,a,s,u){var l=NE(e[o],e,a);if(l.type==="throw")u(l.arg);else{var c=l.arg,f=c.value;return f&&typeof f=="object"&&Xa.call(f,"__await")?t.resolve(f.__await).then(function(d){n("next",d,s,u)},function(d){n("throw",d,s,u)}):t.resolve(f).then(function(d){c.value=d,s(c)},function(d){return n("throw",d,s,u)})}}var i;function r(o,a){function s(){return new t(function(u,l){n(o,a,u,l)})}return i=i?i.then(s,s):s()}this._invoke=r}B6(pm.prototype);pm.prototype[fhe]=function(){return this};function phe(e,t,n,i,r){r===void 0&&(r=Promise);var o=new pm(z6(e,t,n,i),r);return U6(t)?o:o.next().then(function(a){return a.done?a.value:o.next()})}function mhe(e,t,n){var i=e$;return function(o,a){if(i===t$)throw new Error("Generator is already running");if(i===eh){if(o==="throw")throw a;return W6()}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=q6(s,n);if(u){if(u===_i)continue;return u}}if(n.method==="next")n.sent=n._sent=n.arg;else if(n.method==="throw"){if(i===e$)throw i=eh,n.arg;n.dispatchException(n.arg)}else n.method==="return"&&n.abrupt("return",n.arg);i=t$;var l=NE(e,t,n);if(l.type==="normal"){if(i=n.done?eh:dhe,l.arg===_i)continue;return{value:l.arg,done:n.done}}else l.type==="throw"&&(i=eh,n.method="throw",n.arg=l.arg)}}}function q6(e,t){var n=e.iterator[t.method];if(n===Qi){if(t.delegate=null,t.method==="throw"){if(e.iterator.return&&(t.method="return",t.arg=Qi,q6(e,t),t.method==="throw"))return _i;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return _i}var i=NE(n,e.iterator,t.arg);if(i.type==="throw")return t.method="throw",t.arg=i.arg,t.delegate=null,_i;var r=i.arg;if(!r)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,_i;if(r.done)t[e.resultName]=r.value,t.next=e.nextLoc,t.method!=="return"&&(t.method="next",t.arg=Qi);else return r;return t.delegate=null,_i}B6(Fl);Fl[cp]="Generator";Fl[hm]=function(){return this};Fl.toString=function(){return"[object Generator]"};function yhe(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L1(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function sb(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(yhe,this),this.reset(!0)}function vhe(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}}function RE(e){if(e){var t=e[hm];if(t)return t.call(e);if(typeof e.next=="function")return e;if(!isNaN(e.length)){var n=-1,i=function r(){for(;++n<e.length;)if(Xa.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=Qi,r.done=!0,r};return i.next=i}}return{next:W6}}function W6(){return{value:Qi,done:!0}}sb.prototype={constructor:sb,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=Qi,this.done=!1,this.delegate=null,this.method="next",this.arg=Qi,this.tryEntries.forEach(L1),!t)for(var n in this)n.charAt(0)==="t"&&Xa.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=Qi)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if(n.type==="throw")throw n.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(l,c){return a.type="throw",a.arg=t,n.next=l,c&&(n.method="next",n.arg=Qi),!!c}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if(o.tryLoc==="root")return i("end");if(o.tryLoc<=this.prev){var s=Xa.call(o,"catchLoc"),u=Xa.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else if(u){if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,n){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&Xa.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&(t==="break"||t==="continue")&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=n,o?(this.method="next",this.next=o.finallyLoc,_i):this.complete(a)},complete:function(t,n){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&n&&(this.next=n),_i},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),L1(i),_i}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc===t){var r=i.completion;if(r.type==="throw"){var o=r.arg;L1(i)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:RE(t),resultName:n,nextLoc:i},this.method==="next"&&(this.arg=Qi),_i}};var nr={wrap:z6,isGeneratorFunction:U6,AsyncIterator:pm,mark:hhe,awrap:ghe,async:phe,keys:vhe,values:RE},bhe=ke;ke.Node=As;ke.create=ke;function ke(e){var t=this;if(t instanceof ke||(t=new ke),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(r){t.push(r)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}ke.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t};ke.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};ke.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};ke.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)whe(this,arguments[e]);return this.length};ke.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)_he(this,arguments[e]);return this.length};ke.prototype.pop=function(){if(!!this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};ke.prototype.shift=function(){if(!!this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};ke.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,i=0;n!==null;i++)e.call(t,n.value,i,this),n=n.next};ke.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,i=this.length-1;n!==null;i--)e.call(t,n.value,i,this),n=n.prev};ke.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++)n=n.next;if(t===e&&n!==null)return n.value};ke.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++)n=n.prev;if(t===e&&n!==null)return n.value};ke.prototype.map=function(e,t){t=t||this;for(var n=new ke,i=this.head;i!==null;)n.push(e.call(t,i.value,this)),i=i.next;return n};ke.prototype.mapReverse=function(e,t){t=t||this;for(var n=new ke,i=this.tail;i!==null;)n.push(e.call(t,i.value,this)),i=i.prev;return n};ke.prototype.reduce=function(e,t){var n,i=this.head;if(arguments.length>1)n=t;else if(this.head)i=this.head.next,n=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=0;i!==null;r++)n=e(n,i.value,r),i=i.next;return n};ke.prototype.reduceReverse=function(e,t){var n,i=this.tail;if(arguments.length>1)n=t;else if(this.tail)i=this.tail.prev,n=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=this.length-1;i!==null;r--)n=e(n,i.value,r),i=i.prev;return n};ke.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;n!==null;t++)e[t]=n.value,n=n.next;return e};ke.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;n!==null;t++)e[t]=n.value,n=n.prev;return e};ke.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new ke;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(;r!==null&&i<t;i++,r=r.next)n.push(r.value);return n};ke.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new ke;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,r=this.tail;r!==null&&i>t;i--)r=r.prev;for(;r!==null&&i>e;i--,r=r.prev)n.push(r.value);return n};ke.prototype.splice=function(e,t){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,i=this.head;i!==null&&n<e;n++)i=i.next;for(var r=[],n=0;i&&n<t;n++)r.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var n=0;n<(arguments.length<=2?0:arguments.length-2);n++)i=xhe(this,i,n+2<2||arguments.length<=n+2?void 0:arguments[n+2]);return r};ke.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;n!==null;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=t,this.tail=e,this};function xhe(e,t,n){var i=t===e.head?new As(n,null,t,e):new As(n,t,t.next,e);return i.next===null&&(e.tail=i),i.prev===null&&(e.head=i),e.length++,i}function whe(e,t){e.tail=new As(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function _he(e,t){e.head=new As(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function As(e,t,n,i){if(!(this instanceof As))return new As(e,t,n,i);this.list=i,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}try{ke.prototype[Symbol.iterator]=nr.mark(function e(){var t;return nr.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:t=this.head;case 1:if(!t){i.next=7;break}return i.next=4,t.value;case 4:t=t.next,i.next=1;break;case 7:case"end":return i.stop()}},e,this)})}catch{}var Ehe=bhe,qa=Symbol("max"),Br=Symbol("length"),iu=Symbol("lengthCalculator"),Uc=Symbol("allowStale"),Va=Symbol("maxAge"),Ir=Symbol("dispose"),n$=Symbol("noDisposeOnSet"),dt=Symbol("lruList"),hi=Symbol("cache"),G6=Symbol("updateAgeOnGet"),z1=()=>1;class She{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[qa]=t.max||1/0;var n=t.length||z1;if(this[iu]=typeof n!="function"?z1:n,this[Uc]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[Va]=t.maxAge||0,this[Ir]=t.dispose,this[n$]=t.noDisposeOnSet||!1,this[G6]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[qa]=t||1/0,rc(this)}get max(){return this[qa]}set allowStale(t){this[Uc]=!!t}get allowStale(){return this[Uc]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[Va]=t,rc(this)}get maxAge(){return this[Va]}set lengthCalculator(t){typeof t!="function"&&(t=z1),t!==this[iu]&&(this[iu]=t,this[Br]=0,this[dt].forEach(n=>{n.length=this[iu](n.value,n.key),this[Br]+=n.length})),rc(this)}get lengthCalculator(){return this[iu]}get length(){return this[Br]}get itemCount(){return this[dt].length}rforEach(t,n){n=n||this;for(var i=this[dt].tail;i!==null;){var r=i.prev;i$(this,t,i,n),i=r}}forEach(t,n){n=n||this;for(var i=this[dt].head;i!==null;){var r=i.next;i$(this,t,i,n),i=r}}keys(){return this[dt].toArray().map(t=>t.key)}values(){return this[dt].toArray().map(t=>t.value)}reset(){this[Ir]&&this[dt]&&this[dt].length&&this[dt].forEach(t=>this[Ir](t.key,t.value)),this[hi]=new Map,this[dt]=new Ehe,this[Br]=0}dump(){return this[dt].map(t=>fp(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[dt]}set(t,n,i){if(i=i||this[Va],i&&typeof i!="number")throw new TypeError("maxAge must be a number");var r=i?Date.now():0,o=this[iu](n,t);if(this[hi].has(t)){if(o>this[qa])return Su(this,this[hi].get(t)),!1;var a=this[hi].get(t),s=a.value;return this[Ir]&&(this[n$]||this[Ir](t,s.value)),s.now=r,s.maxAge=i,s.value=n,this[Br]+=o-s.length,s.length=o,this.get(t),rc(this),!0}var u=new Ohe(t,n,o,r,i);return u.length>this[qa]?(this[Ir]&&this[Ir](t,n),!1):(this[Br]+=u.length,this[dt].unshift(u),this[hi].set(t,this[dt].head),rc(this),!0)}has(t){if(!this[hi].has(t))return!1;var n=this[hi].get(t).value;return!fp(this,n)}get(t){return B1(this,t,!0)}peek(t){return B1(this,t,!1)}pop(){var t=this[dt].tail;return t?(Su(this,t),t.value):null}del(t){Su(this,this[hi].get(t))}load(t){this.reset();for(var n=Date.now(),i=t.length-1;i>=0;i--){var r=t[i],o=r.e||0;if(o===0)this.set(r.k,r.v);else{var a=o-n;a>0&&this.set(r.k,r.v,a)}}}prune(){this[hi].forEach((t,n)=>B1(this,n,!1))}}var B1=(e,t,n)=>{var i=e[hi].get(t);if(i){var r=i.value;if(fp(e,r)){if(Su(e,i),!e[Uc])return}else n&&(e[G6]&&(i.value.now=Date.now()),e[dt].unshiftNode(i));return r.value}},fp=(e,t)=>{if(!t||!t.maxAge&&!e[Va])return!1;var n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[Va]&&n>e[Va]},rc=e=>{if(e[Br]>e[qa])for(var t=e[dt].tail;e[Br]>e[qa]&&t!==null;){var n=t.prev;Su(e,t),t=n}},Su=(e,t)=>{if(t){var n=t.value;e[Ir]&&e[Ir](n.key,n.value),e[Br]-=n.length,e[hi].delete(n.key),e[dt].removeNode(t)}};class Ohe{constructor(t,n,i,r,o){this.key=t,this.value=n,this.length=i,this.now=r,this.maxAge=o||0}}var i$=(e,t,n,i)=>{var r=n.value;fp(e,r)&&(Su(e,n),e[Uc]||(r=void 0)),r&&t.call(i,r.value,r.key,e)},Ahe=She,khe=["includePrerelease","loose","rtl"],Che=e=>e?typeof e!="object"?{loose:!0}:khe.filter(t=>e[t]).reduce((t,n)=>(t[n]=!0,t),{}):{},PE=Che,Ei={exports:{}},$he="2.0.0",Fhe=256,The=Number.MAX_SAFE_INTEGER||9007199254740991,Mhe=16,IE={SEMVER_SPEC_VERSION:$he,MAX_LENGTH:Fhe,MAX_SAFE_INTEGER:The,MAX_SAFE_COMPONENT_LENGTH:Mhe},Dhe=typeof process=="object"&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.error("SEMVER",...t)}:()=>{},mm=Dhe;(function(e,t){var n=IE.MAX_SAFE_COMPONENT_LENGTH,i=mm;t=e.exports={};var r=t.re=[],o=t.src=[],a=t.t={},s=0,u=(l,c,f)=>{var d=s++;i(l,d,c),a[l]=d,o[d]=c,r[d]=new RegExp(c,f?"g":void 0)};u("NUMERICIDENTIFIER","0|[1-9]\\d*"),u("NUMERICIDENTIFIERLOOSE","[0-9]+"),u("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),u("MAINVERSION","(".concat(o[a.NUMERICIDENTIFIER],")\\.")+"(".concat(o[a.NUMERICIDENTIFIER],")\\.")+"(".concat(o[a.NUMERICIDENTIFIER],")")),u("MAINVERSIONLOOSE","(".concat(o[a.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(o[a.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(o[a.NUMERICIDENTIFIERLOOSE],")")),u("PRERELEASEIDENTIFIER","(?:".concat(o[a.NUMERICIDENTIFIER],"|").concat(o[a.NONNUMERICIDENTIFIER],")")),u("PRERELEASEIDENTIFIERLOOSE","(?:".concat(o[a.NUMERICIDENTIFIERLOOSE],"|").concat(o[a.NONNUMERICIDENTIFIER],")")),u("PRERELEASE","(?:-(".concat(o[a.PRERELEASEIDENTIFIER],"(?:\\.").concat(o[a.PRERELEASEIDENTIFIER],")*))")),u("PRERELEASELOOSE","(?:-?(".concat(o[a.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(o[a.PRERELEASEIDENTIFIERLOOSE],")*))")),u("BUILDIDENTIFIER","[0-9A-Za-z-]+"),u("BUILD","(?:\\+(".concat(o[a.BUILDIDENTIFIER],"(?:\\.").concat(o[a.BUILDIDENTIFIER],")*))")),u("FULLPLAIN","v?".concat(o[a.MAINVERSION]).concat(o[a.PRERELEASE],"?").concat(o[a.BUILD],"?")),u("FULL","^".concat(o[a.FULLPLAIN],"$")),u("LOOSEPLAIN","[v=\\s]*".concat(o[a.MAINVERSIONLOOSE]).concat(o[a.PRERELEASELOOSE],"?").concat(o[a.BUILD],"?")),u("LOOSE","^".concat(o[a.LOOSEPLAIN],"$")),u("GTLT","((?:<|>)?=?)"),u("XRANGEIDENTIFIERLOOSE","".concat(o[a.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),u("XRANGEIDENTIFIER","".concat(o[a.NUMERICIDENTIFIER],"|x|X|\\*")),u("XRANGEPLAIN","[v=\\s]*(".concat(o[a.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(o[a.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(o[a.XRANGEIDENTIFIER],")")+"(?:".concat(o[a.PRERELEASE],")?").concat(o[a.BUILD],"?")+")?)?"),u("XRANGEPLAINLOOSE","[v=\\s]*(".concat(o[a.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(o[a.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(o[a.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(o[a.PRERELEASELOOSE],")?").concat(o[a.BUILD],"?")+")?)?"),u("XRANGE","^".concat(o[a.GTLT],"\\s*").concat(o[a.XRANGEPLAIN],"$")),u("XRANGELOOSE","^".concat(o[a.GTLT],"\\s*").concat(o[a.XRANGEPLAINLOOSE],"$")),u("COERCE","".concat("(^|[^\\d])(\\d{1,").concat(n,"})")+"(?:\\.(\\d{1,".concat(n,"}))?")+"(?:\\.(\\d{1,".concat(n,"}))?")+"(?:$|[^\\d])"),u("COERCERTL",o[a.COERCE],!0),u("LONETILDE","(?:~>?)"),u("TILDETRIM","(\\s*)".concat(o[a.LONETILDE],"\\s+"),!0),t.tildeTrimReplace="$1~",u("TILDE","^".concat(o[a.LONETILDE]).concat(o[a.XRANGEPLAIN],"$")),u("TILDELOOSE","^".concat(o[a.LONETILDE]).concat(o[a.XRANGEPLAINLOOSE],"$")),u("LONECARET","(?:\\^)"),u("CARETTRIM","(\\s*)".concat(o[a.LONECARET],"\\s+"),!0),t.caretTrimReplace="$1^",u("CARET","^".concat(o[a.LONECARET]).concat(o[a.XRANGEPLAIN],"$")),u("CARETLOOSE","^".concat(o[a.LONECARET]).concat(o[a.XRANGEPLAINLOOSE],"$")),u("COMPARATORLOOSE","^".concat(o[a.GTLT],"\\s*(").concat(o[a.LOOSEPLAIN],")$|^$")),u("COMPARATOR","^".concat(o[a.GTLT],"\\s*(").concat(o[a.FULLPLAIN],")$|^$")),u("COMPARATORTRIM","(\\s*)".concat(o[a.GTLT],"\\s*(").concat(o[a.LOOSEPLAIN],"|").concat(o[a.XRANGEPLAIN],")"),!0),t.comparatorTrimReplace="$1$2$3",u("HYPHENRANGE","^\\s*(".concat(o[a.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(o[a.XRANGEPLAIN],")")+"\\s*$"),u("HYPHENRANGELOOSE","^\\s*(".concat(o[a.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(o[a.XRANGEPLAINLOOSE],")")+"\\s*$"),u("STAR","(<|>)?=?\\s*\\*"),u("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),u("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Ei,Ei.exports);var r$=/^[0-9]+$/,H6=(e,t)=>{var n=r$.test(e),i=r$.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1},Nhe=(e,t)=>H6(t,e),jhe={compareIdentifiers:H6,rcompareIdentifiers:Nhe},nh=mm,o$=IE.MAX_LENGTH,ih=IE.MAX_SAFE_INTEGER,a$=Ei.exports.re,s$=Ei.exports.t,Rhe=PE,ru=jhe.compareIdentifiers;class gi{constructor(t,n){if(n=Rhe(n),t instanceof gi){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError("Invalid Version: ".concat(t));if(t.length>o$)throw new TypeError("version is longer than ".concat(o$," characters"));nh("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;var i=t.trim().match(n.loose?a$[s$.LOOSE]:a$[s$.FULL]);if(!i)throw new TypeError("Invalid Version: ".concat(t));if(this.raw=t,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>ih||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ih||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ih||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){var o=+r;if(o>=0&&o<ih)return o}return r}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}toString(){return this.version}compare(t){if(nh("SemVer.compare",this.version,this.options,t),!(t instanceof gi)){if(typeof t=="string"&&t===this.version)return 0;t=new gi(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof gi||(t=new gi(t,this.options)),ru(this.major,t.major)||ru(this.minor,t.minor)||ru(this.patch,t.patch)}comparePre(t){if(t instanceof gi||(t=new gi(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var n=0;do{var i=this.prerelease[n],r=t.prerelease[n];if(nh("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return ru(i,r)}while(++n)}compareBuild(t){t instanceof gi||(t=new gi(t,this.options));var n=0;do{var i=this.build[n],r=t.build[n];if(nh("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return ru(i,r)}while(++n)}inc(t,n){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n),this.inc("pre",n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n),this.inc("pre",n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var i=this.prerelease.length;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);i===-1&&this.prerelease.push(0)}n&&(ru(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=[n,0]):this.prerelease=[n,0]);break;default:throw new Error("invalid increment argument: ".concat(t))}return this.format(),this.raw=this.version,this}}var LE=gi,u$=LE,Phe=(e,t,n)=>new u$(e,n).compare(new u$(t,n)),Tl=Phe,Ihe=Tl,Lhe=(e,t,n)=>Ihe(e,t,n)===0,zhe=Lhe,Bhe=Tl,Uhe=(e,t,n)=>Bhe(e,t,n)!==0,qhe=Uhe,Whe=Tl,Ghe=(e,t,n)=>Whe(e,t,n)>0,Hhe=Ghe,Yhe=Tl,Xhe=(e,t,n)=>Yhe(e,t,n)>=0,Vhe=Xhe,Khe=Tl,Jhe=(e,t,n)=>Khe(e,t,n)<0,Qhe=Jhe,Zhe=Tl,ege=(e,t,n)=>Zhe(e,t,n)<=0,tge=ege,nge=zhe,ige=qhe,rge=Hhe,oge=Vhe,age=Qhe,sge=tge,uge=(e,t,n,i)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return nge(e,n,i);case"!=":return ige(e,n,i);case">":return rge(e,n,i);case">=":return oge(e,n,i);case"<":return age(e,n,i);case"<=":return sge(e,n,i);default:throw new TypeError("Invalid operator: ".concat(t))}},lge=uge,U1,l$;function cge(){if(l$)return U1;l$=1;var e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(c,f){if(f=n(f),c instanceof t){if(c.loose===!!f.loose)return c;c=c.value}a("comparator",c,f),this.options=f,this.loose=!!f.loose,this.parse(c),this.semver===e?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(c){var f=this.options.loose?i[r.COMPARATORLOOSE]:i[r.COMPARATOR],d=c.match(f);if(!d)throw new TypeError("Invalid comparator: ".concat(c));this.operator=d[1]!==void 0?d[1]:"",this.operator==="="&&(this.operator=""),d[2]?this.semver=new s(d[2],this.options.loose):this.semver=e}toString(){return this.value}test(c){if(a("Comparator.test",c,this.options.loose),this.semver===e||c===e)return!0;if(typeof c=="string")try{c=new s(c,this.options)}catch{return!1}return o(c,this.operator,this.semver,this.options)}intersects(c,f){if(!(c instanceof t))throw new TypeError("a Comparator is required");if((!f||typeof f!="object")&&(f={loose:!!f,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new u(c.value,f).test(this.value);if(c.operator==="")return c.value===""?!0:new u(this.value,f).test(c.semver);var d=(this.operator===">="||this.operator===">")&&(c.operator===">="||c.operator===">"),h=(this.operator==="<="||this.operator==="<")&&(c.operator==="<="||c.operator==="<"),g=this.semver.version===c.semver.version,p=(this.operator===">="||this.operator==="<=")&&(c.operator===">="||c.operator==="<="),m=o(this.semver,"<",c.semver,f)&&(this.operator===">="||this.operator===">")&&(c.operator==="<="||c.operator==="<"),y=o(this.semver,">",c.semver,f)&&(this.operator==="<="||this.operator==="<")&&(c.operator===">="||c.operator===">");return d||h||g&&p||m||y}}U1=t;var n=PE,i=Ei.exports.re,r=Ei.exports.t,o=lge,a=mm,s=LE,u=Y6();return U1}function c$(e,t){var n=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=fge(e))||t&&e&&typeof e.length=="number"){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(l){throw l},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){n=n.call(e)},n:function(){var l=n.next();return o=l.done,l},e:function(l){a=!0,s=l},f:function(){try{!o&&n.return!=null&&n.return()}finally{if(a)throw s}}}}function fge(e,t){if(!!e){if(typeof e=="string")return f$(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f$(e,t)}}function f$(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var q1,d$;function Y6(){if(d$)return q1;d$=1;class e{constructor(F,k){if(k=i(k),F instanceof e)return F.loose===!!k.loose&&F.includePrerelease===!!k.includePrerelease?F:new e(F.raw,k);if(F instanceof r)return this.raw=F.value,this.set=[[F]],this.format(),this;if(this.options=k,this.loose=!!k.loose,this.includePrerelease=!!k.includePrerelease,this.raw=F,this.set=F.split("||").map(R=>this.parseRange(R.trim())).filter(R=>R.length),!this.set.length)throw new TypeError("Invalid SemVer Range: ".concat(F));if(this.set.length>1){var M=this.set[0];if(this.set=this.set.filter(R=>!d(R[0])),this.set.length===0)this.set=[M];else if(this.set.length>1){var $=c$(this.set),T;try{for($.s();!(T=$.n()).done;){var D=T.value;if(D.length===1&&h(D[0])){this.set=[D];break}}}catch(R){$.e(R)}finally{$.f()}}}this.format()}format(){return this.range=this.set.map(F=>F.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(F){F=F.trim();var k=Object.keys(this.options).join(","),M="parseRange:".concat(k,":").concat(F),$=n.get(M);if($)return $;var T=this.options.loose,D=T?s[u.HYPHENRANGELOOSE]:s[u.HYPHENRANGE];F=F.replace(D,C(this.options.includePrerelease)),o("hyphen replace",F),F=F.replace(s[u.COMPARATORTRIM],l),o("comparator trim",F),F=F.replace(s[u.TILDETRIM],c),F=F.replace(s[u.CARETTRIM],f),F=F.split(/\s+/).join(" ");var R=F.split(" ").map(pe=>p(pe,this.options)).join(" ").split(/\s+/).map(pe=>S(pe,this.options));T&&(R=R.filter(pe=>(o("loose invalid filter",pe,this.options),!!pe.match(s[u.COMPARATORLOOSE])))),o("range list",R);var L=new Map,J=R.map(pe=>new r(pe,this.options)),ue=c$(J),_e;try{for(ue.s();!(_e=ue.n()).done;){var Ee=_e.value;if(d(Ee))return[Ee];L.set(Ee.value,Ee)}}catch(pe){ue.e(pe)}finally{ue.f()}L.size>1&&L.has("")&&L.delete("");var Ye=[...L.values()];return n.set(M,Ye),Ye}intersects(F,k){if(!(F instanceof e))throw new TypeError("a Range is required");return this.set.some(M=>g(M,k)&&F.set.some($=>g($,k)&&M.every(T=>$.every(D=>T.intersects(D,k)))))}test(F){if(!F)return!1;if(typeof F=="string")try{F=new a(F,this.options)}catch{return!1}for(var k=0;k<this.set.length;k++)if(A(this.set[k],F,this.options))return!0;return!1}}q1=e;var t=Ahe,n=new t({max:1e3}),i=PE,r=cge(),o=mm,a=LE,s=Ei.exports.re,u=Ei.exports.t,l=Ei.exports.comparatorTrimReplace,c=Ei.exports.tildeTrimReplace,f=Ei.exports.caretTrimReplace,d=O=>O.value==="<0.0.0-0",h=O=>O.value==="",g=(O,F)=>{for(var k=!0,M=O.slice(),$=M.pop();k&&M.length;)k=M.every(T=>$.intersects(T,F)),$=M.pop();return k},p=(O,F)=>(o("comp",O,F),O=b(O,F),o("caret",O),O=y(O,F),o("tildes",O),O=_(O,F),o("xrange",O),O=w(O,F),o("stars",O),O),m=O=>!O||O.toLowerCase()==="x"||O==="*",y=(O,F)=>O.trim().split(/\s+/).map(k=>v(k,F)).join(" "),v=(O,F)=>{var k=F.loose?s[u.TILDELOOSE]:s[u.TILDE];return O.replace(k,(M,$,T,D,R)=>{o("tilde",O,M,$,T,D,R);var L;return m($)?L="":m(T)?L=">=".concat($,".0.0 <").concat(+$+1,".0.0-0"):m(D)?L=">=".concat($,".").concat(T,".0 <").concat($,".").concat(+T+1,".0-0"):R?(o("replaceTilde pr",R),L=">=".concat($,".").concat(T,".").concat(D,"-").concat(R," <").concat($,".").concat(+T+1,".0-0")):L=">=".concat($,".").concat(T,".").concat(D," <").concat($,".").concat(+T+1,".0-0"),o("tilde return",L),L})},b=(O,F)=>O.trim().split(/\s+/).map(k=>x(k,F)).join(" "),x=(O,F)=>{o("caret",O,F);var k=F.loose?s[u.CARETLOOSE]:s[u.CARET],M=F.includePrerelease?"-0":"";return O.replace(k,($,T,D,R,L)=>{o("caret",O,$,T,D,R,L);var J;return m(T)?J="":m(D)?J=">=".concat(T,".0.0").concat(M," <").concat(+T+1,".0.0-0"):m(R)?T==="0"?J=">=".concat(T,".").concat(D,".0").concat(M," <").concat(T,".").concat(+D+1,".0-0"):J=">=".concat(T,".").concat(D,".0").concat(M," <").concat(+T+1,".0.0-0"):L?(o("replaceCaret pr",L),T==="0"?D==="0"?J=">=".concat(T,".").concat(D,".").concat(R,"-").concat(L," <").concat(T,".").concat(D,".").concat(+R+1,"-0"):J=">=".concat(T,".").concat(D,".").concat(R,"-").concat(L," <").concat(T,".").concat(+D+1,".0-0"):J=">=".concat(T,".").concat(D,".").concat(R,"-").concat(L," <").concat(+T+1,".0.0-0")):(o("no pr"),T==="0"?D==="0"?J=">=".concat(T,".").concat(D,".").concat(R).concat(M," <").concat(T,".").concat(D,".").concat(+R+1,"-0"):J=">=".concat(T,".").concat(D,".").concat(R).concat(M," <").concat(T,".").concat(+D+1,".0-0"):J=">=".concat(T,".").concat(D,".").concat(R," <").concat(+T+1,".0.0-0")),o("caret return",J),J})},_=(O,F)=>(o("replaceXRanges",O,F),O.split(/\s+/).map(k=>E(k,F)).join(" ")),E=(O,F)=>{O=O.trim();var k=F.loose?s[u.XRANGELOOSE]:s[u.XRANGE];return O.replace(k,(M,$,T,D,R,L)=>{o("xRange",O,M,$,T,D,R,L);var J=m(T),ue=J||m(D),_e=ue||m(R),Ee=_e;return $==="="&&Ee&&($=""),L=F.includePrerelease?"-0":"",J?$===">"||$==="<"?M="<0.0.0-0":M="*":$&&Ee?(ue&&(D=0),R=0,$===">"?($=">=",ue?(T=+T+1,D=0,R=0):(D=+D+1,R=0)):$==="<="&&($="<",ue?T=+T+1:D=+D+1),$==="<"&&(L="-0"),M="".concat($+T,".").concat(D,".").concat(R).concat(L)):ue?M=">=".concat(T,".0.0").concat(L," <").concat(+T+1,".0.0-0"):_e&&(M=">=".concat(T,".").concat(D,".0").concat(L," <").concat(T,".").concat(+D+1,".0-0")),o("xRange return",M),M})},w=(O,F)=>(o("replaceStars",O,F),O.trim().replace(s[u.STAR],"")),S=(O,F)=>(o("replaceGTE0",O,F),O.trim().replace(s[F.includePrerelease?u.GTE0PRE:u.GTE0],"")),C=O=>(F,k,M,$,T,D,R,L,J,ue,_e,Ee,Ye)=>(m(M)?k="":m($)?k=">=".concat(M,".0.0").concat(O?"-0":""):m(T)?k=">=".concat(M,".").concat($,".0").concat(O?"-0":""):D?k=">=".concat(k):k=">=".concat(k).concat(O?"-0":""),m(J)?L="":m(ue)?L="<".concat(+J+1,".0.0-0"):m(_e)?L="<".concat(J,".").concat(+ue+1,".0-0"):Ee?L="<=".concat(J,".").concat(ue,".").concat(_e,"-").concat(Ee):O?L="<".concat(J,".").concat(ue,".").concat(+_e+1,"-0"):L="<=".concat(L),"".concat(k," ").concat(L).trim()),A=(O,F,k)=>{for(var M=0;M<O.length;M++)if(!O[M].test(F))return!1;if(F.prerelease.length&&!k.includePrerelease){for(var $=0;$<O.length;$++)if(o(O[$].semver),O[$].semver!==r.ANY&&O[$].semver.prerelease.length>0){var T=O[$].semver;if(T.major===F.major&&T.minor===F.minor&&T.patch===F.patch)return!0}return!1}return!0};return q1}var dge=Y6(),hge=(e,t,n)=>{try{t=new dge(t,n)}catch{return!1}return t.test(e)},X6=hge;function gge(e,t,n){var i=e.open(t),r=1e4,o=250,a=new URL(t),s=a.origin,u=~~(r/o);function l(f){f.source===i&&(u=0,e.removeEventListener("message",l,!1))}e.addEventListener("message",l,!1);function c(){u<=0||(i.postMessage(n,s),setTimeout(c,o),u-=1)}setTimeout(c,o)}var pge=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box;
}
.vega-embed.has-actions {
  padding-right: 38px;
}
.vega-embed details:not([open]) > :not(summary) {
  display: none !important;
}
.vega-embed summary {
  list-style: none;
  position: absolute;
  top: 0;
  right: 0;
  padding: 6px;
  z-index: 1000;
  background: white;
  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
  color: #1b1e23;
  border: 1px solid #aaa;
  border-radius: 999px;
  opacity: 0.2;
  transition: opacity 0.4s ease-in;
  cursor: pointer;
  line-height: 0px;
}
.vega-embed summary::-webkit-details-marker {
  display: none;
}
.vega-embed summary:active {
  box-shadow: #aaa 0px 0px 0px 1px inset;
}
.vega-embed summary svg {
  width: 14px;
  height: 14px;
}
.vega-embed details[open] summary {
  opacity: 0.7;
}
.vega-embed:hover summary, .vega-embed:focus-within summary {
  opacity: 1 !important;
  transition: opacity 0.2s ease;
}
.vega-embed .vega-actions {
  position: absolute;
  z-index: 1001;
  top: 35px;
  right: -9px;
  display: flex;
  flex-direction: column;
  padding-bottom: 8px;
  padding-top: 8px;
  border-radius: 4px;
  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
  border: 1px solid #d9d9d9;
  background: white;
  animation-duration: 0.15s;
  animation-name: scale-in;
  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
  text-align: left;
}
.vega-embed .vega-actions a {
  padding: 8px 16px;
  font-family: sans-serif;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  color: #434a56;
  text-decoration: none;
}
.vega-embed .vega-actions a:hover, .vega-embed .vega-actions a:focus {
  background-color: #f7f7f9;
  color: black;
}
.vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
  content: "";
  display: inline-block;
  position: absolute;
}
.vega-embed .vega-actions::before {
  left: auto;
  right: 14px;
  top: -16px;
  border: 8px solid rgba(0, 0, 0, 0);
  border-bottom-color: #d9d9d9;
}
.vega-embed .vega-actions::after {
  left: auto;
  right: 15px;
  top: -14px;
  border: 7px solid rgba(0, 0, 0, 0);
  border-bottom-color: #fff;
}
.vega-embed .chart-wrapper.fit-x {
  width: 100%;
}
.vega-embed .chart-wrapper.fit-y {
  height: 100%;
}

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px;
}

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function V6(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];mge(e,a)}return e}function mge(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];ul(e,r,t[r],!0)}}var W1;function yge(e,t){var n=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=vge(e))||t&&e&&typeof e.length=="number"){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(l){throw l},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){n=n.call(e)},n:function(){var l=n.next();return o=l.done,l},e:function(l){a=!0,s=l},f:function(){try{!o&&n.return!=null&&n.return()}finally{if(a)throw s}}}}function vge(e,t){if(!!e){if(typeof e=="string")return h$(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h$(e,t)}}function h$(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function g$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Wo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g$(Object(n),!0).forEach(function(i){che(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var Gi=Zre,_f=Dfe,rh=typeof window!="undefined"?window:void 0;_f===void 0&&rh!==null&&rh!==void 0&&(W1=rh.vl)!==null&&W1!==void 0&&W1.compile&&(_f=rh.vl);var bge={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},xge={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},kc={vega:"Vega","vega-lite":"Vega-Lite"},dp={vega:Gi.version,"vega-lite":_f?_f.version:"not available"},wge={vega:e=>e,"vega-lite":(e,t)=>_f.compile(e,{config:t}).spec},_ge=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,Ege="chart-wrapper";function Sge(e){return typeof e=="function"}function p$(e,t,n,i){var r="<html><head>".concat(t,'</head><body><pre><code class="json">'),o="</code></pre>".concat(n,"</body></html>"),a=window.open("");a.document.write(r+e+o),a.document.title="".concat(kc[i]," JSON Source")}function Oge(e,t){if(e.$schema){var n=j6(e.$schema);if(t&&t!==n.library){var i;console.warn("The given visualization spec is written in ".concat(kc[n.library],", but mode argument sets ").concat((i=kc[t])!==null&&i!==void 0?i:t,"."))}var r=n.library;return X6(dp[r],"^".concat(n.version.slice(1)))||console.warn("The input spec uses ".concat(kc[r]," ").concat(n.version,", but the current version of ").concat(kc[r]," is v").concat(dp[r],".")),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t!=null?t:"vega"}function Age(e){return!!(e&&"load"in e)}function m$(e){return Age(e)?e:Gi.loader(e)}function kge(e){var t,n,i=(t=(n=e.usermeta)===null||n===void 0?void 0:n.embedOptions)!==null&&t!==void 0?t:{};return Y(i.defaultStyle)&&(i.defaultStyle=!1),i}function Cge(e,t){return ub.apply(this,arguments)}function ub(){return ub=lp(nr.mark(function e(t,n){var i,r,o,a,s,u,l,c,f,d,h,g=arguments;return nr.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(o=g.length>2&&g[2]!==void 0?g[2]:{},!Y(n)){m.next=10;break}return s=m$(o.loader),m.t0=JSON,m.next=6,s.load(n);case 6:m.t1=m.sent,a=m.t0.parse.call(m.t0,m.t1),m.next=11;break;case 10:a=n;case 11:return u=kge(a),l=u.loader,(!s||l)&&(s=m$((c=o.loader)!==null&&c!==void 0?c:l)),m.next=16,y$(u,s);case 16:return f=m.sent,m.next=19,y$(o,s);case 19:return d=m.sent,h=Wo(Wo({},V6(d,f)),{},{config:sl((i=d.config)!==null&&i!==void 0?i:{},(r=f.config)!==null&&r!==void 0?r:{})}),m.next=23,Fge(t,a,h,s);case 23:return m.abrupt("return",m.sent);case 24:case"end":return m.stop()}},e)})),ub.apply(this,arguments)}function y$(e,t){return lb.apply(this,arguments)}function lb(){return lb=lp(nr.mark(function e(t,n){var i,r,o;return nr.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!Y(t.config)){s.next=8;break}return s.t1=JSON,s.next=4,n.load(t.config);case 4:s.t2=s.sent,s.t0=s.t1.parse.call(s.t1,s.t2),s.next=9;break;case 8:s.t0=(i=t.config)!==null&&i!==void 0?i:{};case 9:if(r=s.t0,!Y(t.patch)){s.next=18;break}return s.t4=JSON,s.next=14,n.load(t.patch);case 14:s.t5=s.sent,s.t3=s.t4.parse.call(s.t4,s.t5),s.next=19;break;case 18:s.t3=t.patch;case 19:return o=s.t3,s.abrupt("return",Wo(Wo(Wo({},t),o?{patch:o}:{}),r?{config:r}:{}));case 21:case"end":return s.stop()}},e)})),lb.apply(this,arguments)}function $ge(e){var t,n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:(t=document.head)!==null&&t!==void 0?t:document.body}}function Fge(e,t){return cb.apply(this,arguments)}function cb(){return cb=lp(nr.mark(function e(t,n){var i,r,o,a,s,u,l,c,f,d,h,g,p,m,y,v,b,x,_,E,w,S,C,A,O,F,k,M,$,T,D,R,L,J,ue,_e,Ee,Ye,pe,ft,li,$t,X,ae,de,B,We,we,Ze,Xe,qn,mo=arguments;return nr.wrap(function(qs){for(;;)switch(qs.prev=qs.next){case 0:if(qn=function(){Ye&&document.removeEventListener("click",Ye),R.finalize()},c=mo.length>2&&mo[2]!==void 0?mo[2]:{},f=mo.length>3?mo[3]:void 0,d=c.theme?sl(ehe[c.theme],(i=c.config)!==null&&i!==void 0?i:{}):c.config,h=ua(c.actions)?c.actions:V6({},bge,(r=c.actions)!==null&&r!==void 0?r:{}),g=Wo(Wo({},xge),c.i18n),p=(o=c.renderer)!==null&&o!==void 0?o:"canvas",m=(a=c.logLevel)!==null&&a!==void 0?a:Gi.Warn,y=(s=c.downloadFileName)!==null&&s!==void 0?s:"visualization",v=typeof t=="string"?document.querySelector(t):t,v){qs.next=12;break}throw new Error("".concat(t," does not exist"));case 12:if(c.defaultStyle!==!1&&(b="vega-embed-style",x=$ge(v),_=x.root,E=x.rootContainer,_.getElementById(b)||(w=document.createElement("style"),w.id=b,w.innerHTML=c.defaultStyle===void 0||c.defaultStyle===!0?pge.toString():c.defaultStyle,E.appendChild(w))),S=Oge(n,c.mode),C=wge[S](n,d),S==="vega-lite"&&C.$schema&&(A=j6(C.$schema),X6(dp.vega,"^".concat(A.version.slice(1)))||console.warn("The compiled spec uses Vega ".concat(A.version,", but current version is v").concat(dp.vega,"."))),v.classList.add("vega-embed"),h&&v.classList.add("has-actions"),v.innerHTML="",O=v,h&&(F=document.createElement("div"),F.classList.add(Ege),v.appendChild(F),O=F),k=c.patch,k&&(C=k instanceof Function?k(C):dm(C,k,!0,!1).newDocument),c.formatLocale&&Gi.formatLocale(c.formatLocale),c.timeFormatLocale&&Gi.timeFormatLocale(c.timeFormatLocale),c.expressionFunctions)for(M in c.expressionFunctions)$=c.expressionFunctions[M],"fn"in $?Gi.expressionFunction(M,$.fn,$.visitor):$ instanceof Function&&Gi.expressionFunction(M,$);return T=c.ast,D=Gi.parse(C,S==="vega-lite"?{}:d,{ast:T}),R=new(c.viewClass||Gi.View)(D,Wo({loader:f,logLevel:m,renderer:p},T?{expr:(u=(l=Gi.expressionInterpreter)!==null&&l!==void 0?l:c.expr)!==null&&u!==void 0?u:ode}:{})),R.addSignalListener("autosize",(Wn,ln)=>{var Fn=ln.type;Fn=="fit-x"?(O.classList.add("fit-x"),O.classList.remove("fit-y")):Fn=="fit-y"?(O.classList.remove("fit-x"),O.classList.add("fit-y")):Fn=="fit"?O.classList.add("fit-x","fit-y"):O.classList.remove("fit-x","fit-y")}),c.tooltip!==!1&&(L=Sge(c.tooltip)?c.tooltip:new lhe(c.tooltip===!0?{}:c.tooltip).call,R.tooltip(L)),J=c.hover,J===void 0&&(J=S==="vega"),J&&(ue=typeof J=="boolean"?{}:J,_e=ue.hoverSet,Ee=ue.updateSet,R.hover(_e,Ee)),c&&(c.width!=null&&R.width(c.width),c.height!=null&&R.height(c.height),c.padding!=null&&R.padding(c.padding)),qs.next=37,R.initialize(O,c.bind).runAsync();case 37:if(h!==!1){if(pe=v,c.defaultStyle!==!1&&(ft=document.createElement("details"),ft.title=g.CLICK_TO_VIEW_ACTIONS,v.append(ft),pe=ft,li=document.createElement("summary"),li.innerHTML=_ge,ft.append(li),Ye=Wn=>{ft.contains(Wn.target)||ft.removeAttribute("open")},document.addEventListener("click",Ye)),$t=document.createElement("div"),pe.append($t),$t.classList.add("vega-actions"),h===!0||h.export!==!1){X=yge(["svg","png"]);try{for(de=function(){var ln=ae.value;if(h===!0||h.export===!0||h.export[ln]){var Fn=g["".concat(ln.toUpperCase(),"_ACTION")],Ws=document.createElement("a");Ws.text=Fn,Ws.href="#",Ws.target="_blank",Ws.download="".concat(y,".").concat(ln),Ws.addEventListener("mousedown",function(){var K6=lp(nr.mark(function zE(J6){var BE;return nr.wrap(function(Ml){for(;;)switch(Ml.prev=Ml.next){case 0:return J6.preventDefault(),Ml.next=3,R.toImageURL(ln,c.scaleFactor);case 3:BE=Ml.sent,this.href=BE;case 5:case"end":return Ml.stop()}},zE,this)}));return function(zE){return K6.apply(this,arguments)}}()),$t.append(Ws)}},X.s();!(ae=X.n()).done;)de()}catch(Wn){X.e(Wn)}finally{X.f()}}(h===!0||h.source!==!1)&&(B=document.createElement("a"),B.text=g.SOURCE_ACTION,B.href="#",B.addEventListener("click",function(Wn){var ln,Fn;p$(N1(n),(ln=c.sourceHeader)!==null&&ln!==void 0?ln:"",(Fn=c.sourceFooter)!==null&&Fn!==void 0?Fn:"",S),Wn.preventDefault()}),$t.append(B)),S==="vega-lite"&&(h===!0||h.compiled!==!1)&&(We=document.createElement("a"),We.text=g.COMPILED_ACTION,We.href="#",We.addEventListener("click",function(Wn){var ln,Fn;p$(N1(C),(ln=c.sourceHeader)!==null&&ln!==void 0?ln:"",(Fn=c.sourceFooter)!==null&&Fn!==void 0?Fn:"","vega"),Wn.preventDefault()}),$t.append(We)),(h===!0||h.editor!==!1)&&(Ze=(we=c.editorUrl)!==null&&we!==void 0?we:"https://vega.github.io/editor/",Xe=document.createElement("a"),Xe.text=g.EDITOR_ACTION,Xe.href="#",Xe.addEventListener("click",function(Wn){gge(window,Ze,{config:d,mode:S,renderer:p,spec:N1(n)}),Wn.preventDefault()}),$t.append(Xe))}return qs.abrupt("return",{view:R,spec:n,vgSpec:C,finalize:qn,embedOptions:c});case 39:case"end":return qs.stop()}},e)})),cb.apply(this,arguments)}const Tge=v$({props:{id:{type:String,required:!0},spec:{type:Object,required:!0},config:{type:Object,default:()=>{}}},methods:{async draw(){const e=this.config,t=this.spec,n=T6(t,{config:e}).spec;await Cge(`#${this.id}`,n,{actions:!1});var i=document.getElementById("main");if(!i)throw new Error("No #main");i.scrollTop=i.scrollHeight}},mounted(){this.draw()}}),Mge=["id"];function Dge(e,t,n,i,r,o){return G1(),b$("div",{id:e.id},null,8,Mge)}var Nge=Q6(Tge,[["render",Dge]]);const jge={class:"w-full p-3"},zge=v$({__name:"DsCodeBlock",props:{id:{type:String,required:!0},code:{type:String,required:!0}},setup(e){const t=UE({}),n=UE(!1);function i(){n.value=!1,t.value={}}async function r(o){i(),await aI();let a=o;return typeof o=="string"&&(o.startsWith(`{
  "$schema"`)?(t.value=JSON.parse(o),n.value=!0,a=null):a=o),a}return tI(()=>i()),(o,a)=>(G1(),b$("div",jge,[nI(ym(iI),{controls:!0,id:e.id,py:ym(Z6),code:e.code,theme:ym(eI).isDarkMode.value==!0?"dark":"light",dispatch:r,width:"52rem",onRun:a[0]||(a[0]=s=>i())},null,8,["id","py","code","theme"]),n.value?(G1(),rI(Nge,{key:0,id:e.id,spec:t.value},null,8,["id","spec"])):oI("",!0)]))}});export{zge as default};
